"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/chat/route";
exports.ids = ["app/api/chat/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("assert");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "string_decoder":
/*!*********************************!*\
  !*** external "string_decoder" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("string_decoder");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "tty":
/*!**********************!*\
  !*** external "tty" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tty");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:crypto");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Fnegishi%2FDocuments%2Fdevelop%2FHackathon%2FTokyoOpenDataHackathon%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fnegishi%2FDocuments%2Fdevelop%2FHackathon%2FTokyoOpenDataHackathon&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Fnegishi%2FDocuments%2Fdevelop%2FHackathon%2FTokyoOpenDataHackathon%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fnegishi%2FDocuments%2Fdevelop%2FHackathon%2FTokyoOpenDataHackathon&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_negishi_Documents_develop_Hackathon_TokyoOpenDataHackathon_src_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/chat/route.ts */ \"(rsc)/./src/app/api/chat/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/chat/route\",\n        pathname: \"/api/chat\",\n        filename: \"route\",\n        bundlePath: \"app/api/chat/route\"\n    },\n    resolvedPagePath: \"/Users/negishi/Documents/develop/Hackathon/TokyoOpenDataHackathon/src/app/api/chat/route.ts\",\n    nextConfigOutput,\n    userland: _Users_negishi_Documents_develop_Hackathon_TokyoOpenDataHackathon_src_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/chat/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZjaGF0JTJGcm91dGUmcGFnZT0lMkZhcGklMkZjaGF0JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGY2hhdCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRm5lZ2lzaGklMkZEb2N1bWVudHMlMkZkZXZlbG9wJTJGSGFja2F0aG9uJTJGVG9reW9PcGVuRGF0YUhhY2thdGhvbiUyRnNyYyUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZuZWdpc2hpJTJGRG9jdW1lbnRzJTJGZGV2ZWxvcCUyRkhhY2thdGhvbiUyRlRva3lvT3BlbkRhdGFIYWNrYXRob24maXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQzJDO0FBQ3hIO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdG9reW8tb3BlbmRhdGEtaGFja2F0aG9uLz9lOWM1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9uZWdpc2hpL0RvY3VtZW50cy9kZXZlbG9wL0hhY2thdGhvbi9Ub2t5b09wZW5EYXRhSGFja2F0aG9uL3NyYy9hcHAvYXBpL2NoYXQvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2NoYXQvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9jaGF0XCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9jaGF0L3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL25lZ2lzaGkvRG9jdW1lbnRzL2RldmVsb3AvSGFja2F0aG9uL1Rva3lvT3BlbkRhdGFIYWNrYXRob24vc3JjL2FwcC9hcGkvY2hhdC9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvY2hhdC9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Fnegishi%2FDocuments%2Fdevelop%2FHackathon%2FTokyoOpenDataHackathon%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fnegishi%2FDocuments%2Fdevelop%2FHackathon%2FTokyoOpenDataHackathon&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/chat/route.ts":
/*!***********************************!*\
  !*** ./src/app/api/chat/route.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_validation__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/validation */ \"(rsc)/./src/lib/validation.ts\");\n/* harmony import */ var _lib_services_SessionManager__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/services/SessionManager */ \"(rsc)/./src/lib/services/SessionManager.ts\");\n/* harmony import */ var _lib_services_RedisService__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/services/RedisService */ \"(rsc)/./src/lib/services/RedisService.ts\");\n/* harmony import */ var _lib_errors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/errors */ \"(rsc)/./src/lib/errors.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./src/lib/logger.ts\");\n/* harmony import */ var _lib_monitoring_PerformanceMonitor__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/lib/monitoring/PerformanceMonitor */ \"(rsc)/./src/lib/monitoring/PerformanceMonitor.ts\");\n/* harmony import */ var _lib_services_SimpleRAGService__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @/lib/services/SimpleRAGService */ \"(rsc)/./src/lib/services/SimpleRAGService.ts\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist/esm-node/v4.js\");\n\n\n\n\n\n\n\n\n\nasync function POST(request) {\n    const requestId = (0,_lib_logger__WEBPACK_IMPORTED_MODULE_5__.generateRequestId)();\n    const timer = _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.performance(\"Chat API Request\", requestId);\n    const perfMonitor = (0,_lib_monitoring_PerformanceMonitor__WEBPACK_IMPORTED_MODULE_6__.getPerformanceMonitor)();\n    const requestStartTime = Date.now();\n    // Record API request count\n    perfMonitor.recordCount(\"api.chat.requests\", 1, {\n        method: \"POST\",\n        endpoint: \"/api/chat\"\n    });\n    try {\n        const sessionManager = _lib_services_SessionManager__WEBPACK_IMPORTED_MODULE_2__.SessionManager.getInstance();\n        const redisService = (0,_lib_services_RedisService__WEBPACK_IMPORTED_MODULE_3__.getRedisService)();\n        const simpleRAGService = new _lib_services_SimpleRAGService__WEBPACK_IMPORTED_MODULE_7__.SimpleRAGService();\n        // Get client IP for rate limiting\n        const clientIP = request.headers.get(\"x-forwarded-for\") || request.headers.get(\"x-real-ip\") || \"unknown\";\n        _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.info(\"Chat request received\", {\n            clientIP,\n            userAgent: request.headers.get(\"user-agent\")\n        }, requestId);\n        // Check rate limit with Redis (fallback to memory)\n        let rateLimitResult;\n        try {\n            rateLimitResult = await redisService.checkRateLimit(clientIP, 900, 100); // 15 minutes, 100 requests\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.warn(\"Redis rate limiting failed, using fallback\", {\n                clientIP,\n                fallback: \"memory-based-rate-limiting\",\n                error: error.message\n            });\n            rateLimitResult = (0,_lib_validation__WEBPACK_IMPORTED_MODULE_1__.checkRateLimit)(clientIP);\n        }\n        if (!rateLimitResult.allowed) {\n            const retryAfter = \"retryAfter\" in rateLimitResult ? rateLimitResult.retryAfter : undefined;\n            const error = _lib_errors__WEBPACK_IMPORTED_MODULE_4__.ErrorFactory.rateLimitExceeded(retryAfter);\n            const response = (0,_lib_errors__WEBPACK_IMPORTED_MODULE_4__.handleApiError)(error, \"ja\");\n            _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.security(\"Rate limit exceeded\", {\n                clientIP,\n                retryAfter\n            }, requestId);\n            const duration = timer.end();\n            _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.api(\"POST\", \"/api/chat\", error.statusCode, duration, requestId);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(response, {\n                status: error.statusCode,\n                headers: {\n                    \"Retry-After\": retryAfter ? retryAfter.toString() : \"60\",\n                    \"X-RateLimit-Limit\": \"100\",\n                    \"X-RateLimit-Remaining\": (\"remaining\" in rateLimitResult ? rateLimitResult.remaining : 0).toString(),\n                    \"X-RateLimit-Reset\": (\"resetTime\" in rateLimitResult ? Math.ceil(rateLimitResult.resetTime / 1000) : Math.ceil((Date.now() + 60000) / 1000)).toString()\n                }\n            });\n        }\n        const body = await request.json();\n        // Validate and sanitize input\n        const validation = (0,_lib_validation__WEBPACK_IMPORTED_MODULE_1__.validateChatRequest)(body);\n        if (!validation.isValid) {\n            const error = _lib_errors__WEBPACK_IMPORTED_MODULE_4__.ErrorFactory.validationFailed(validation.errors.join(\", \"), validation.errors);\n            const response = (0,_lib_errors__WEBPACK_IMPORTED_MODULE_4__.handleApiError)(error, body.language || \"ja\");\n            _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.warn(\"Input validation failed\", {\n                errors: validation.errors,\n                originalMessage: body.message?.substring(0, 100)\n            }, requestId);\n            const duration = timer.end();\n            _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.api(\"POST\", \"/api/chat\", error.statusCode, duration, requestId);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(response, {\n                status: error.statusCode\n            });\n        }\n        const sanitizedData = validation.sanitized;\n        const { message, sessionId, language, useVoice, inputType = \"text\", location, requestedScope } = sanitizedData;\n        // Validate and get session\n        _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.info(\"Attempting to get session\", {\n            sessionId: sessionId.substring(0, 8) + \"...\"\n        }, requestId);\n        const session = await sessionManager.getSession(sessionId);\n        if (!session) {\n            const error = _lib_errors__WEBPACK_IMPORTED_MODULE_4__.ErrorFactory.sessionNotFound();\n            const response = (0,_lib_errors__WEBPACK_IMPORTED_MODULE_4__.handleApiError)(error, language);\n            _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.warn(\"Session not found\", {\n                sessionId: sessionId.substring(0, 8) + \"...\"\n            }, requestId);\n            const duration = timer.end();\n            _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.api(\"POST\", \"/api/chat\", error.statusCode, duration, requestId);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(response, {\n                status: error.statusCode\n            });\n        }\n        _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.info(\"Session found successfully\", {\n            sessionId: sessionId.substring(0, 8) + \"...\",\n            language: session.language,\n            createdAt: session.createdAt,\n            lastActivity: session.lastActivity\n        }, requestId);\n        // Update session language if different\n        if (session.language !== language) {\n            await sessionManager.setSessionLanguage(sessionId, language);\n            _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.info(\"Session language updated\", {\n                sessionId: sessionId.substring(0, 8) + \"...\",\n                from: session.language,\n                to: language\n            }, requestId);\n        }\n        _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.business(\"Chat message processed\", {\n            messageLength: message.length,\n            sessionId: sessionId.substring(0, 8) + \"...\",\n            language,\n            useVoice,\n            inputType,\n            sessionMessageCount: session.messageCount,\n            hasLocation: !!location,\n            hasRequestedScope: !!requestedScope\n        }, requestId);\n        // Execute simple RAG processing\n        let ragResponse;\n        const ragTimer = _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.performance(\"Simple RAG Processing\", requestId);\n        const perfRAGTimer = perfMonitor.startTimer(\"rag.processing\", {\n            language,\n            messageLength: message.length.toString(),\n            sessionId: sessionId.substring(0, 8) + \"...\"\n        });\n        try {\n            ragResponse = await simpleRAGService.processQuery(message, language);\n            perfRAGTimer();\n            ragTimer.end({\n                confidence: ragResponse.confidence,\n                sourceCount: ragResponse.sources.length,\n                processingTime: ragResponse.processingTime\n            });\n            // Record RAG processing metrics\n            perfMonitor.recordCount(\"rag.success\", 1);\n            perfMonitor.recordCount(\"rag.confidence\", Math.round(ragResponse.confidence * 100));\n            perfMonitor.recordCount(\"rag.sources\", ragResponse.sources.length);\n            perfMonitor.recordTiming(\"rag.processingTime\", ragResponse.processingTime);\n            _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.info(\"Simple RAG processing completed\", {\n                confidence: ragResponse.confidence,\n                sourceCount: ragResponse.sources.length,\n                processingTime: ragResponse.processingTime\n            }, requestId);\n        } catch (error) {\n            perfRAGTimer();\n            ragTimer.end({\n                error: true\n            });\n            perfMonitor.recordCount(\"rag.errors\", 1);\n            _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.error(\"Simple RAG processing failed\", error, {\n                messageLength: message.length,\n                sessionId: sessionId.substring(0, 8) + \"...\"\n            }, requestId);\n            // Fallback to basic response\n            ragResponse = {\n                content: `申し訳ございませんが、システム処理中にエラーが発生しました。\n\n「${message}」について、基本的な情報をお調べします。より具体的な質問がございましたら、もう一度お聞かせください。`,\n                sources: [],\n                confidence: 0.2,\n                processingTime: Date.now() - requestStartTime\n            };\n        }\n        // Store user message in session with enhanced metadata\n        const userMessage = {\n            id: (0,uuid__WEBPACK_IMPORTED_MODULE_8__[\"default\"])(),\n            role: \"user\",\n            content: message,\n            timestamp: new Date(),\n            metadata: {\n                inputType,\n                language,\n                clientIP: clientIP.substring(0, 10) + \"...\",\n                hasLocation: !!location,\n                requestedScope: requestedScope ? {\n                    timeRange: requestedScope.timeRange,\n                    locationRange: requestedScope.locationRange\n                } : undefined\n            }\n        };\n        await sessionManager.addMessage(sessionId, userMessage);\n        // Handle voice synthesis (client-side)\n        let audioUrl;\n        if (useVoice) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.info(\"Voice synthesis requested - will be handled client-side\", {\n                language,\n                textLength: ragResponse.content.length,\n                confidence: ragResponse.confidence\n            }, requestId);\n            perfMonitor.recordCount(\"speech.clientSideRequested\", 1);\n        }\n        // Store assistant response with simple metadata\n        const assistantMessage = {\n            id: (0,uuid__WEBPACK_IMPORTED_MODULE_8__[\"default\"])(),\n            role: \"assistant\",\n            content: ragResponse.content,\n            timestamp: new Date(),\n            metadata: {\n                confidence: ragResponse.confidence,\n                sources: ragResponse.sources.map((source)=>({\n                        id: source.id,\n                        title: source.title,\n                        url: source.metadata?.source || \"#\",\n                        description: source.description,\n                        category: source.category,\n                        lastUpdated: source.metadata?.lastUpdated || new Date()\n                    })),\n                processingTime: ragResponse.processingTime\n            }\n        };\n        await sessionManager.addMessage(sessionId, assistantMessage);\n        // Simple chat response with basic RAG capabilities\n        const simpleChatResponse = {\n            response: ragResponse.content,\n            audioUrl,\n            sources: ragResponse.sources.length > 0 ? ragResponse.sources.map((source)=>({\n                    id: source.id,\n                    title: source.title,\n                    url: source.metadata?.source || \"#\",\n                    description: source.description,\n                    category: source.category,\n                    lastUpdated: source.metadata?.lastUpdated || new Date()\n                })) : undefined,\n            shouldPlayAudio: inputType === \"voice\",\n            // Simple RAG response fields\n            confidence: ragResponse.confidence,\n            metadata: {\n                processingTime: ragResponse.processingTime,\n                sourceCount: ragResponse.sources.length\n            }\n        };\n        const response = {\n            success: true,\n            data: simpleChatResponse\n        };\n        const duration = timer.end({\n            responseLength: ragResponse.content.length,\n            sourceCount: ragResponse.sources.length,\n            confidence: ragResponse.confidence,\n            hasAudio: !!audioUrl,\n            processingTime: ragResponse.processingTime\n        });\n        // Record simple performance metrics\n        perfMonitor.recordCount(\"api.chat.success\", 1);\n        perfMonitor.recordTiming(\"api.chat.duration\", duration);\n        perfMonitor.recordCount(\"api.chat.responseLength\", ragResponse.content.length);\n        perfMonitor.recordCount(\"api.chat.sources\", ragResponse.sources.length);\n        perfMonitor.recordCount(\"api.chat.confidence\", Math.round(ragResponse.confidence * 100));\n        _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.api(\"POST\", \"/api/chat\", 200, duration, requestId);\n        _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.business(\"Simple RAG chat response generated\", {\n            responseLength: ragResponse.content.length,\n            sourceCount: ragResponse.sources.length,\n            confidence: ragResponse.confidence,\n            processingTime: ragResponse.processingTime,\n            language\n        }, requestId);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(response, {\n            status: 200\n        });\n    } catch (error) {\n        const appError = error instanceof _lib_errors__WEBPACK_IMPORTED_MODULE_4__.AppError ? error : _lib_errors__WEBPACK_IMPORTED_MODULE_4__.ErrorFactory.internalError(error);\n        const response = (0,_lib_errors__WEBPACK_IMPORTED_MODULE_4__.handleApiError)(appError, \"ja\");\n        const duration = timer.end({\n            error: true\n        });\n        // Record error metrics\n        perfMonitor.recordCount(\"api.chat.errors\", 1, {\n            errorCode: appError.code,\n            statusCode: appError.statusCode.toString()\n        });\n        perfMonitor.recordTiming(\"api.chat.errorDuration\", duration);\n        _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.error(\"Chat API error\", error, {\n            code: appError.code,\n            statusCode: appError.statusCode\n        }, requestId);\n        _lib_logger__WEBPACK_IMPORTED_MODULE_5__.log.api(\"POST\", \"/api/chat\", appError.statusCode, duration, requestId);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(response, {\n            status: appError.statusCode\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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WUFBWTJFLFNBQVMzRSxVQUFVO1FBQ2pDLEdBQUdqQztRQUVIUiw0Q0FBR0EsQ0FBQ3dDLEdBQUcsQ0FBQyxRQUFRLGFBQWE0RSxTQUFTM0UsVUFBVSxFQUFFSCxVQUFVOUI7UUFFNUQsT0FBT2hCLHFEQUFZQSxDQUFDa0QsSUFBSSxDQUFDTixVQUFVO1lBQUVPLFFBQVF5RSxTQUFTM0UsVUFBVTtRQUFDO0lBQ25FO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90b2t5by1vcGVuZGF0YS1oYWNrYXRob24vLi9zcmMvYXBwL2FwaS9jaGF0L3JvdXRlLnRzPzQ2YjciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IENoYXRSZXNwb25zZSwgQXBpUmVzcG9uc2UsIE1lc3NhZ2UsIFN1cHBvcnRlZExhbmd1YWdlIH0gZnJvbSAnQC90eXBlcyc7XG5pbXBvcnQgeyB2YWxpZGF0ZUNoYXRSZXF1ZXN0LCBjaGVja1JhdGVMaW1pdCB9IGZyb20gJ0AvbGliL3ZhbGlkYXRpb24nO1xuaW1wb3J0IHsgU2Vzc2lvbk1hbmFnZXIgfSBmcm9tICdAL2xpYi9zZXJ2aWNlcy9TZXNzaW9uTWFuYWdlcic7XG5pbXBvcnQgeyBnZXRSZWRpc1NlcnZpY2UgfSBmcm9tICdAL2xpYi9zZXJ2aWNlcy9SZWRpc1NlcnZpY2UnO1xuaW1wb3J0IHsgRXJyb3JGYWN0b3J5LCBoYW5kbGVBcGlFcnJvciwgQXBwRXJyb3IgfSBmcm9tICdAL2xpYi9lcnJvcnMnO1xuaW1wb3J0IHsgbG9nLCBnZW5lcmF0ZVJlcXVlc3RJZCB9IGZyb20gJ0AvbGliL2xvZ2dlcic7XG5pbXBvcnQgeyBnZXRQZXJmb3JtYW5jZU1vbml0b3IgfSBmcm9tICdAL2xpYi9tb25pdG9yaW5nL1BlcmZvcm1hbmNlTW9uaXRvcic7XG5pbXBvcnQgeyBTaW1wbGVSQUdTZXJ2aWNlIH0gZnJvbSAnQC9saWIvc2VydmljZXMvU2ltcGxlUkFHU2VydmljZSc7XG5pbXBvcnQgeyB2NCBhcyB1dWlkdjQgfSBmcm9tICd1dWlkJztcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgY29uc3QgcmVxdWVzdElkID0gZ2VuZXJhdGVSZXF1ZXN0SWQoKTtcbiAgY29uc3QgdGltZXIgPSBsb2cucGVyZm9ybWFuY2UoJ0NoYXQgQVBJIFJlcXVlc3QnLCByZXF1ZXN0SWQpO1xuICBjb25zdCBwZXJmTW9uaXRvciA9IGdldFBlcmZvcm1hbmNlTW9uaXRvcigpO1xuICBjb25zdCByZXF1ZXN0U3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgXG4gIC8vIFJlY29yZCBBUEkgcmVxdWVzdCBjb3VudFxuICBwZXJmTW9uaXRvci5yZWNvcmRDb3VudCgnYXBpLmNoYXQucmVxdWVzdHMnLCAxLCB7XG4gICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgZW5kcG9pbnQ6ICcvYXBpL2NoYXQnXG4gIH0pO1xuICBcbiAgdHJ5IHtcbiAgICBjb25zdCBzZXNzaW9uTWFuYWdlciA9IFNlc3Npb25NYW5hZ2VyLmdldEluc3RhbmNlKCk7XG4gICAgY29uc3QgcmVkaXNTZXJ2aWNlID0gZ2V0UmVkaXNTZXJ2aWNlKCk7XG4gICAgY29uc3Qgc2ltcGxlUkFHU2VydmljZSA9IG5ldyBTaW1wbGVSQUdTZXJ2aWNlKCk7XG5cbiAgICAvLyBHZXQgY2xpZW50IElQIGZvciByYXRlIGxpbWl0aW5nXG4gICAgY29uc3QgY2xpZW50SVAgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LWZvcndhcmRlZC1mb3InKSB8fCBcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5oZWFkZXJzLmdldCgneC1yZWFsLWlwJykgfHwgXG4gICAgICAgICAgICAgICAgICAgICd1bmtub3duJztcbiAgICBcbiAgICBsb2cuaW5mbygnQ2hhdCByZXF1ZXN0IHJlY2VpdmVkJywge1xuICAgICAgY2xpZW50SVAsXG4gICAgICB1c2VyQWdlbnQ6IHJlcXVlc3QuaGVhZGVycy5nZXQoJ3VzZXItYWdlbnQnKSxcbiAgICB9LCByZXF1ZXN0SWQpO1xuICAgIFxuICAgIC8vIENoZWNrIHJhdGUgbGltaXQgd2l0aCBSZWRpcyAoZmFsbGJhY2sgdG8gbWVtb3J5KVxuICAgIGxldCByYXRlTGltaXRSZXN1bHQ7XG4gICAgdHJ5IHtcbiAgICAgIHJhdGVMaW1pdFJlc3VsdCA9IGF3YWl0IHJlZGlzU2VydmljZS5jaGVja1JhdGVMaW1pdChjbGllbnRJUCwgOTAwLCAxMDApOyAvLyAxNSBtaW51dGVzLCAxMDAgcmVxdWVzdHNcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nLndhcm4oJ1JlZGlzIHJhdGUgbGltaXRpbmcgZmFpbGVkLCB1c2luZyBmYWxsYmFjaycsIHtcbiAgICAgICAgY2xpZW50SVAsXG4gICAgICAgIGZhbGxiYWNrOiAnbWVtb3J5LWJhc2VkLXJhdGUtbGltaXRpbmcnLFxuICAgICAgICBlcnJvcjogKGVycm9yIGFzIEVycm9yKS5tZXNzYWdlXG4gICAgICB9KTtcbiAgICAgIHJhdGVMaW1pdFJlc3VsdCA9IGNoZWNrUmF0ZUxpbWl0KGNsaWVudElQKTtcbiAgICB9XG5cbiAgICBpZiAoIXJhdGVMaW1pdFJlc3VsdC5hbGxvd2VkKSB7XG4gICAgICBjb25zdCByZXRyeUFmdGVyID0gJ3JldHJ5QWZ0ZXInIGluIHJhdGVMaW1pdFJlc3VsdCA/IHJhdGVMaW1pdFJlc3VsdC5yZXRyeUFmdGVyIDogdW5kZWZpbmVkO1xuICAgICAgY29uc3QgZXJyb3IgPSBFcnJvckZhY3RvcnkucmF0ZUxpbWl0RXhjZWVkZWQocmV0cnlBZnRlcik7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGhhbmRsZUFwaUVycm9yKGVycm9yLCAnamEnKTtcbiAgICAgIFxuICAgICAgbG9nLnNlY3VyaXR5KCdSYXRlIGxpbWl0IGV4Y2VlZGVkJywge1xuICAgICAgICBjbGllbnRJUCxcbiAgICAgICAgcmV0cnlBZnRlcixcbiAgICAgIH0sIHJlcXVlc3RJZCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gdGltZXIuZW5kKCk7XG4gICAgICBsb2cuYXBpKCdQT1NUJywgJy9hcGkvY2hhdCcsIGVycm9yLnN0YXR1c0NvZGUsIGR1cmF0aW9uLCByZXF1ZXN0SWQpO1xuICAgICAgXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24ocmVzcG9uc2UsIHsgXG4gICAgICAgIHN0YXR1czogZXJyb3Iuc3RhdHVzQ29kZSxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdSZXRyeS1BZnRlcic6IHJldHJ5QWZ0ZXIgPyByZXRyeUFmdGVyLnRvU3RyaW5nKCkgOiAnNjAnLFxuICAgICAgICAgICdYLVJhdGVMaW1pdC1MaW1pdCc6ICcxMDAnLFxuICAgICAgICAgICdYLVJhdGVMaW1pdC1SZW1haW5pbmcnOiAoJ3JlbWFpbmluZycgaW4gcmF0ZUxpbWl0UmVzdWx0ID8gcmF0ZUxpbWl0UmVzdWx0LnJlbWFpbmluZyA6IDApLnRvU3RyaW5nKCksXG4gICAgICAgICAgJ1gtUmF0ZUxpbWl0LVJlc2V0JzogKCdyZXNldFRpbWUnIGluIHJhdGVMaW1pdFJlc3VsdCA/IE1hdGguY2VpbChyYXRlTGltaXRSZXN1bHQucmVzZXRUaW1lIC8gMTAwMCkgOiBNYXRoLmNlaWwoKERhdGUubm93KCkgKyA2MDAwMCkgLyAxMDAwKSkudG9TdHJpbmcoKSxcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuICAgIFxuICAgIC8vIFZhbGlkYXRlIGFuZCBzYW5pdGl6ZSBpbnB1dFxuICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZUNoYXRSZXF1ZXN0KGJvZHkpO1xuICAgIGlmICghdmFsaWRhdGlvbi5pc1ZhbGlkKSB7XG4gICAgICBjb25zdCBlcnJvciA9IEVycm9yRmFjdG9yeS52YWxpZGF0aW9uRmFpbGVkKFxuICAgICAgICB2YWxpZGF0aW9uLmVycm9ycy5qb2luKCcsICcpLFxuICAgICAgICB2YWxpZGF0aW9uLmVycm9yc1xuICAgICAgKTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gaGFuZGxlQXBpRXJyb3IoZXJyb3IsIGJvZHkubGFuZ3VhZ2UgfHwgJ2phJyk7XG4gICAgICBcbiAgICAgIGxvZy53YXJuKCdJbnB1dCB2YWxpZGF0aW9uIGZhaWxlZCcsIHtcbiAgICAgICAgZXJyb3JzOiB2YWxpZGF0aW9uLmVycm9ycyxcbiAgICAgICAgb3JpZ2luYWxNZXNzYWdlOiBib2R5Lm1lc3NhZ2U/LnN1YnN0cmluZygwLCAxMDApLCAvLyBUcnVuY2F0ZSBmb3IgbG9nZ2luZ1xuICAgICAgfSwgcmVxdWVzdElkKTtcbiAgICAgIFxuICAgICAgY29uc3QgZHVyYXRpb24gPSB0aW1lci5lbmQoKTtcbiAgICAgIGxvZy5hcGkoJ1BPU1QnLCAnL2FwaS9jaGF0JywgZXJyb3Iuc3RhdHVzQ29kZSwgZHVyYXRpb24sIHJlcXVlc3RJZCk7XG4gICAgICBcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihyZXNwb25zZSwgeyBzdGF0dXM6IGVycm9yLnN0YXR1c0NvZGUgfSk7XG4gICAgfVxuXG4gICAgY29uc3Qgc2FuaXRpemVkRGF0YSA9IHZhbGlkYXRpb24uc2FuaXRpemVkIGFzIGFueTtcbiAgICBjb25zdCB7IG1lc3NhZ2UsIHNlc3Npb25JZCwgbGFuZ3VhZ2UsIHVzZVZvaWNlLCBpbnB1dFR5cGUgPSAndGV4dCcsIGxvY2F0aW9uLCByZXF1ZXN0ZWRTY29wZSB9ID0gc2FuaXRpemVkRGF0YTtcblxuICAgIC8vIFZhbGlkYXRlIGFuZCBnZXQgc2Vzc2lvblxuICAgIGxvZy5pbmZvKCdBdHRlbXB0aW5nIHRvIGdldCBzZXNzaW9uJywgeyBzZXNzaW9uSWQ6IHNlc3Npb25JZC5zdWJzdHJpbmcoMCwgOCkgKyAnLi4uJyB9LCByZXF1ZXN0SWQpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBzZXNzaW9uTWFuYWdlci5nZXRTZXNzaW9uKHNlc3Npb25JZCk7XG4gICAgaWYgKCFzZXNzaW9uKSB7XG4gICAgICBjb25zdCBlcnJvciA9IEVycm9yRmFjdG9yeS5zZXNzaW9uTm90Rm91bmQoKTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gaGFuZGxlQXBpRXJyb3IoZXJyb3IsIGxhbmd1YWdlKTtcbiAgICAgIFxuICAgICAgbG9nLndhcm4oJ1Nlc3Npb24gbm90IGZvdW5kJywgeyBzZXNzaW9uSWQ6IHNlc3Npb25JZC5zdWJzdHJpbmcoMCwgOCkgKyAnLi4uJyB9LCByZXF1ZXN0SWQpO1xuICAgICAgXG4gICAgICBjb25zdCBkdXJhdGlvbiA9IHRpbWVyLmVuZCgpO1xuICAgICAgbG9nLmFwaSgnUE9TVCcsICcvYXBpL2NoYXQnLCBlcnJvci5zdGF0dXNDb2RlLCBkdXJhdGlvbiwgcmVxdWVzdElkKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHJlc3BvbnNlLCB7IHN0YXR1czogZXJyb3Iuc3RhdHVzQ29kZSB9KTtcbiAgICB9XG4gICAgbG9nLmluZm8oJ1Nlc3Npb24gZm91bmQgc3VjY2Vzc2Z1bGx5JywgeyBcbiAgICAgIHNlc3Npb25JZDogc2Vzc2lvbklkLnN1YnN0cmluZygwLCA4KSArICcuLi4nLFxuICAgICAgbGFuZ3VhZ2U6IHNlc3Npb24ubGFuZ3VhZ2UsXG4gICAgICBjcmVhdGVkQXQ6IHNlc3Npb24uY3JlYXRlZEF0LFxuICAgICAgbGFzdEFjdGl2aXR5OiBzZXNzaW9uLmxhc3RBY3Rpdml0eVxuICAgIH0sIHJlcXVlc3RJZCk7XG5cbiAgICAvLyBVcGRhdGUgc2Vzc2lvbiBsYW5ndWFnZSBpZiBkaWZmZXJlbnRcbiAgICBpZiAoc2Vzc2lvbi5sYW5ndWFnZSAhPT0gbGFuZ3VhZ2UpIHtcbiAgICAgIGF3YWl0IHNlc3Npb25NYW5hZ2VyLnNldFNlc3Npb25MYW5ndWFnZShzZXNzaW9uSWQsIGxhbmd1YWdlKTtcbiAgICAgIGxvZy5pbmZvKCdTZXNzaW9uIGxhbmd1YWdlIHVwZGF0ZWQnLCB7IFxuICAgICAgICBzZXNzaW9uSWQ6IHNlc3Npb25JZC5zdWJzdHJpbmcoMCwgOCkgKyAnLi4uJywgXG4gICAgICAgIGZyb206IHNlc3Npb24ubGFuZ3VhZ2UsIFxuICAgICAgICB0bzogbGFuZ3VhZ2UgXG4gICAgICB9LCByZXF1ZXN0SWQpO1xuICAgIH1cblxuICAgIGxvZy5idXNpbmVzcygnQ2hhdCBtZXNzYWdlIHByb2Nlc3NlZCcsIHtcbiAgICAgIG1lc3NhZ2VMZW5ndGg6IG1lc3NhZ2UubGVuZ3RoLFxuICAgICAgc2Vzc2lvbklkOiBzZXNzaW9uSWQuc3Vic3RyaW5nKDAsIDgpICsgJy4uLicsIC8vIFBhcnRpYWwgZm9yIHByaXZhY3lcbiAgICAgIGxhbmd1YWdlLFxuICAgICAgdXNlVm9pY2UsXG4gICAgICBpbnB1dFR5cGUsXG4gICAgICBzZXNzaW9uTWVzc2FnZUNvdW50OiBzZXNzaW9uLm1lc3NhZ2VDb3VudCxcbiAgICAgIGhhc0xvY2F0aW9uOiAhIWxvY2F0aW9uLFxuICAgICAgaGFzUmVxdWVzdGVkU2NvcGU6ICEhcmVxdWVzdGVkU2NvcGUsXG4gICAgfSwgcmVxdWVzdElkKTtcblxuICAgIC8vIEV4ZWN1dGUgc2ltcGxlIFJBRyBwcm9jZXNzaW5nXG4gICAgbGV0IHJhZ1Jlc3BvbnNlO1xuICAgIGNvbnN0IHJhZ1RpbWVyID0gbG9nLnBlcmZvcm1hbmNlKCdTaW1wbGUgUkFHIFByb2Nlc3NpbmcnLCByZXF1ZXN0SWQpO1xuICAgIGNvbnN0IHBlcmZSQUdUaW1lciA9IHBlcmZNb25pdG9yLnN0YXJ0VGltZXIoJ3JhZy5wcm9jZXNzaW5nJywge1xuICAgICAgbGFuZ3VhZ2UsXG4gICAgICBtZXNzYWdlTGVuZ3RoOiBtZXNzYWdlLmxlbmd0aC50b1N0cmluZygpLFxuICAgICAgc2Vzc2lvbklkOiBzZXNzaW9uSWQuc3Vic3RyaW5nKDAsIDgpICsgJy4uLidcbiAgICB9KTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgcmFnUmVzcG9uc2UgPSBhd2FpdCBzaW1wbGVSQUdTZXJ2aWNlLnByb2Nlc3NRdWVyeShtZXNzYWdlLCBsYW5ndWFnZSBhcyBTdXBwb3J0ZWRMYW5ndWFnZSk7XG4gICAgICBcbiAgICAgIHBlcmZSQUdUaW1lcigpO1xuICAgICAgcmFnVGltZXIuZW5kKHtcbiAgICAgICAgY29uZmlkZW5jZTogcmFnUmVzcG9uc2UuY29uZmlkZW5jZSxcbiAgICAgICAgc291cmNlQ291bnQ6IHJhZ1Jlc3BvbnNlLnNvdXJjZXMubGVuZ3RoLFxuICAgICAgICBwcm9jZXNzaW5nVGltZTogcmFnUmVzcG9uc2UucHJvY2Vzc2luZ1RpbWVcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBSZWNvcmQgUkFHIHByb2Nlc3NpbmcgbWV0cmljc1xuICAgICAgcGVyZk1vbml0b3IucmVjb3JkQ291bnQoJ3JhZy5zdWNjZXNzJywgMSk7XG4gICAgICBwZXJmTW9uaXRvci5yZWNvcmRDb3VudCgncmFnLmNvbmZpZGVuY2UnLCBNYXRoLnJvdW5kKHJhZ1Jlc3BvbnNlLmNvbmZpZGVuY2UgKiAxMDApKTtcbiAgICAgIHBlcmZNb25pdG9yLnJlY29yZENvdW50KCdyYWcuc291cmNlcycsIHJhZ1Jlc3BvbnNlLnNvdXJjZXMubGVuZ3RoKTtcbiAgICAgIHBlcmZNb25pdG9yLnJlY29yZFRpbWluZygncmFnLnByb2Nlc3NpbmdUaW1lJywgcmFnUmVzcG9uc2UucHJvY2Vzc2luZ1RpbWUpO1xuICAgICAgXG4gICAgICBsb2cuaW5mbygnU2ltcGxlIFJBRyBwcm9jZXNzaW5nIGNvbXBsZXRlZCcsIHtcbiAgICAgICAgY29uZmlkZW5jZTogcmFnUmVzcG9uc2UuY29uZmlkZW5jZSxcbiAgICAgICAgc291cmNlQ291bnQ6IHJhZ1Jlc3BvbnNlLnNvdXJjZXMubGVuZ3RoLFxuICAgICAgICBwcm9jZXNzaW5nVGltZTogcmFnUmVzcG9uc2UucHJvY2Vzc2luZ1RpbWVcbiAgICAgIH0sIHJlcXVlc3RJZCk7XG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcGVyZlJBR1RpbWVyKCk7XG4gICAgICByYWdUaW1lci5lbmQoeyBlcnJvcjogdHJ1ZSB9KTtcbiAgICAgIHBlcmZNb25pdG9yLnJlY29yZENvdW50KCdyYWcuZXJyb3JzJywgMSk7XG4gICAgICBcbiAgICAgIGxvZy5lcnJvcignU2ltcGxlIFJBRyBwcm9jZXNzaW5nIGZhaWxlZCcsIGVycm9yIGFzIEVycm9yLCB7XG4gICAgICAgIG1lc3NhZ2VMZW5ndGg6IG1lc3NhZ2UubGVuZ3RoLFxuICAgICAgICBzZXNzaW9uSWQ6IHNlc3Npb25JZC5zdWJzdHJpbmcoMCwgOCkgKyAnLi4uJ1xuICAgICAgfSwgcmVxdWVzdElkKTtcbiAgICAgIFxuICAgICAgLy8gRmFsbGJhY2sgdG8gYmFzaWMgcmVzcG9uc2VcbiAgICAgIHJhZ1Jlc3BvbnNlID0ge1xuICAgICAgICBjb250ZW50OiBg55Sz44GX6Kiz44GU44GW44GE44G+44Gb44KT44GM44CB44K344K544OG44Og5Yem55CG5Lit44Gr44Ko44Op44O844GM55m655Sf44GX44G+44GX44Gf44CCXG5cbuOAjCR7bWVzc2FnZX3jgI3jgavjgaTjgYTjgabjgIHln7rmnKznmoTjgarmg4XloLHjgpLjgYroqr/jgbnjgZfjgb7jgZnjgILjgojjgorlhbfkvZPnmoTjgaros6rllY/jgYzjgZTjgZbjgYTjgb7jgZfjgZ/jgonjgIHjgoLjgYbkuIDluqbjgYrogZ7jgYvjgZvjgY/jgaDjgZXjgYTjgIJgLFxuICAgICAgICBzb3VyY2VzOiBbXSxcbiAgICAgICAgY29uZmlkZW5jZTogMC4yLFxuICAgICAgICBwcm9jZXNzaW5nVGltZTogRGF0ZS5ub3coKSAtIHJlcXVlc3RTdGFydFRpbWVcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gU3RvcmUgdXNlciBtZXNzYWdlIGluIHNlc3Npb24gd2l0aCBlbmhhbmNlZCBtZXRhZGF0YVxuICAgIGNvbnN0IHVzZXJNZXNzYWdlOiBNZXNzYWdlID0ge1xuICAgICAgaWQ6IHV1aWR2NCgpLFxuICAgICAgcm9sZTogJ3VzZXInLFxuICAgICAgY29udGVudDogbWVzc2FnZSxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIGlucHV0VHlwZSxcbiAgICAgICAgbGFuZ3VhZ2UsXG4gICAgICAgIGNsaWVudElQOiBjbGllbnRJUC5zdWJzdHJpbmcoMCwgMTApICsgJy4uLicsIC8vIFBhcnRpYWwgZm9yIHByaXZhY3lcbiAgICAgICAgaGFzTG9jYXRpb246ICEhbG9jYXRpb24sXG4gICAgICAgIHJlcXVlc3RlZFNjb3BlOiByZXF1ZXN0ZWRTY29wZSA/IHtcbiAgICAgICAgICB0aW1lUmFuZ2U6IHJlcXVlc3RlZFNjb3BlLnRpbWVSYW5nZSxcbiAgICAgICAgICBsb2NhdGlvblJhbmdlOiByZXF1ZXN0ZWRTY29wZS5sb2NhdGlvblJhbmdlXG4gICAgICAgIH0gOiB1bmRlZmluZWQsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBhd2FpdCBzZXNzaW9uTWFuYWdlci5hZGRNZXNzYWdlKHNlc3Npb25JZCwgdXNlck1lc3NhZ2UpO1xuXG4gICAgLy8gSGFuZGxlIHZvaWNlIHN5bnRoZXNpcyAoY2xpZW50LXNpZGUpXG4gICAgbGV0IGF1ZGlvVXJsOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgaWYgKHVzZVZvaWNlKSB7XG4gICAgICBsb2cuaW5mbygnVm9pY2Ugc3ludGhlc2lzIHJlcXVlc3RlZCAtIHdpbGwgYmUgaGFuZGxlZCBjbGllbnQtc2lkZScsIHtcbiAgICAgICAgbGFuZ3VhZ2UsXG4gICAgICAgIHRleHRMZW5ndGg6IHJhZ1Jlc3BvbnNlLmNvbnRlbnQubGVuZ3RoLFxuICAgICAgICBjb25maWRlbmNlOiByYWdSZXNwb25zZS5jb25maWRlbmNlLFxuICAgICAgfSwgcmVxdWVzdElkKTtcbiAgICAgIHBlcmZNb25pdG9yLnJlY29yZENvdW50KCdzcGVlY2guY2xpZW50U2lkZVJlcXVlc3RlZCcsIDEpO1xuICAgIH1cblxuICAgIC8vIFN0b3JlIGFzc2lzdGFudCByZXNwb25zZSB3aXRoIHNpbXBsZSBtZXRhZGF0YVxuICAgIGNvbnN0IGFzc2lzdGFudE1lc3NhZ2U6IE1lc3NhZ2UgPSB7XG4gICAgICBpZDogdXVpZHY0KCksXG4gICAgICByb2xlOiAnYXNzaXN0YW50JyxcbiAgICAgIGNvbnRlbnQ6IHJhZ1Jlc3BvbnNlLmNvbnRlbnQsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICBjb25maWRlbmNlOiByYWdSZXNwb25zZS5jb25maWRlbmNlLFxuICAgICAgICBzb3VyY2VzOiByYWdSZXNwb25zZS5zb3VyY2VzLm1hcChzb3VyY2UgPT4gKHtcbiAgICAgICAgICBpZDogc291cmNlLmlkLFxuICAgICAgICAgIHRpdGxlOiBzb3VyY2UudGl0bGUsXG4gICAgICAgICAgdXJsOiBzb3VyY2UubWV0YWRhdGE/LnNvdXJjZSB8fCAnIycsXG4gICAgICAgICAgZGVzY3JpcHRpb246IHNvdXJjZS5kZXNjcmlwdGlvbixcbiAgICAgICAgICBjYXRlZ29yeTogc291cmNlLmNhdGVnb3J5LFxuICAgICAgICAgIGxhc3RVcGRhdGVkOiBzb3VyY2UubWV0YWRhdGE/Lmxhc3RVcGRhdGVkIHx8IG5ldyBEYXRlKClcbiAgICAgICAgfSkpLFxuICAgICAgICBwcm9jZXNzaW5nVGltZTogcmFnUmVzcG9uc2UucHJvY2Vzc2luZ1RpbWVcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIGF3YWl0IHNlc3Npb25NYW5hZ2VyLmFkZE1lc3NhZ2Uoc2Vzc2lvbklkLCBhc3Npc3RhbnRNZXNzYWdlKTtcblxuICAgIC8vIFNpbXBsZSBjaGF0IHJlc3BvbnNlIHdpdGggYmFzaWMgUkFHIGNhcGFiaWxpdGllc1xuICAgIGNvbnN0IHNpbXBsZUNoYXRSZXNwb25zZTogQ2hhdFJlc3BvbnNlICYge1xuICAgICAgY29uZmlkZW5jZT86IG51bWJlcjtcbiAgICAgIG1ldGFkYXRhPzoge1xuICAgICAgICBwcm9jZXNzaW5nVGltZTogbnVtYmVyO1xuICAgICAgICBzb3VyY2VDb3VudDogbnVtYmVyO1xuICAgICAgfTtcbiAgICB9ID0ge1xuICAgICAgcmVzcG9uc2U6IHJhZ1Jlc3BvbnNlLmNvbnRlbnQsXG4gICAgICBhdWRpb1VybCxcbiAgICAgIHNvdXJjZXM6IHJhZ1Jlc3BvbnNlLnNvdXJjZXMubGVuZ3RoID4gMCA/IHJhZ1Jlc3BvbnNlLnNvdXJjZXMubWFwKHNvdXJjZSA9PiAoe1xuICAgICAgICBpZDogc291cmNlLmlkLFxuICAgICAgICB0aXRsZTogc291cmNlLnRpdGxlLFxuICAgICAgICB1cmw6IHNvdXJjZS5tZXRhZGF0YT8uc291cmNlIHx8ICcjJyxcbiAgICAgICAgZGVzY3JpcHRpb246IHNvdXJjZS5kZXNjcmlwdGlvbixcbiAgICAgICAgY2F0ZWdvcnk6IHNvdXJjZS5jYXRlZ29yeSxcbiAgICAgICAgbGFzdFVwZGF0ZWQ6IHNvdXJjZS5tZXRhZGF0YT8ubGFzdFVwZGF0ZWQgfHwgbmV3IERhdGUoKVxuICAgICAgfSkpIDogdW5kZWZpbmVkLFxuICAgICAgc2hvdWxkUGxheUF1ZGlvOiBpbnB1dFR5cGUgPT09ICd2b2ljZScsIC8vIOmfs+WjsOWFpeWKm+aZguOBruOBv+mfs+WjsOWHuuWKm1xuICAgICAgLy8gU2ltcGxlIFJBRyByZXNwb25zZSBmaWVsZHNcbiAgICAgIGNvbmZpZGVuY2U6IHJhZ1Jlc3BvbnNlLmNvbmZpZGVuY2UsXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICBwcm9jZXNzaW5nVGltZTogcmFnUmVzcG9uc2UucHJvY2Vzc2luZ1RpbWUsXG4gICAgICAgIHNvdXJjZUNvdW50OiByYWdSZXNwb25zZS5zb3VyY2VzLmxlbmd0aFxuICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdCByZXNwb25zZTogQXBpUmVzcG9uc2U8dHlwZW9mIHNpbXBsZUNoYXRSZXNwb25zZT4gPSB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogc2ltcGxlQ2hhdFJlc3BvbnNlLFxuICAgIH07XG4gICAgXG4gICAgY29uc3QgZHVyYXRpb24gPSB0aW1lci5lbmQoe1xuICAgICAgcmVzcG9uc2VMZW5ndGg6IHJhZ1Jlc3BvbnNlLmNvbnRlbnQubGVuZ3RoLFxuICAgICAgc291cmNlQ291bnQ6IHJhZ1Jlc3BvbnNlLnNvdXJjZXMubGVuZ3RoLFxuICAgICAgY29uZmlkZW5jZTogcmFnUmVzcG9uc2UuY29uZmlkZW5jZSxcbiAgICAgIGhhc0F1ZGlvOiAhIWF1ZGlvVXJsLFxuICAgICAgcHJvY2Vzc2luZ1RpbWU6IHJhZ1Jlc3BvbnNlLnByb2Nlc3NpbmdUaW1lLFxuICAgIH0pO1xuICAgIFxuICAgIC8vIFJlY29yZCBzaW1wbGUgcGVyZm9ybWFuY2UgbWV0cmljc1xuICAgIHBlcmZNb25pdG9yLnJlY29yZENvdW50KCdhcGkuY2hhdC5zdWNjZXNzJywgMSk7XG4gICAgcGVyZk1vbml0b3IucmVjb3JkVGltaW5nKCdhcGkuY2hhdC5kdXJhdGlvbicsIGR1cmF0aW9uKTtcbiAgICBwZXJmTW9uaXRvci5yZWNvcmRDb3VudCgnYXBpLmNoYXQucmVzcG9uc2VMZW5ndGgnLCByYWdSZXNwb25zZS5jb250ZW50Lmxlbmd0aCk7XG4gICAgcGVyZk1vbml0b3IucmVjb3JkQ291bnQoJ2FwaS5jaGF0LnNvdXJjZXMnLCByYWdSZXNwb25zZS5zb3VyY2VzLmxlbmd0aCk7XG4gICAgcGVyZk1vbml0b3IucmVjb3JkQ291bnQoJ2FwaS5jaGF0LmNvbmZpZGVuY2UnLCBNYXRoLnJvdW5kKHJhZ1Jlc3BvbnNlLmNvbmZpZGVuY2UgKiAxMDApKTtcbiAgICBcbiAgICBsb2cuYXBpKCdQT1NUJywgJy9hcGkvY2hhdCcsIDIwMCwgZHVyYXRpb24sIHJlcXVlc3RJZCk7XG4gICAgbG9nLmJ1c2luZXNzKCdTaW1wbGUgUkFHIGNoYXQgcmVzcG9uc2UgZ2VuZXJhdGVkJywge1xuICAgICAgcmVzcG9uc2VMZW5ndGg6IHJhZ1Jlc3BvbnNlLmNvbnRlbnQubGVuZ3RoLFxuICAgICAgc291cmNlQ291bnQ6IHJhZ1Jlc3BvbnNlLnNvdXJjZXMubGVuZ3RoLFxuICAgICAgY29uZmlkZW5jZTogcmFnUmVzcG9uc2UuY29uZmlkZW5jZSxcbiAgICAgIHByb2Nlc3NpbmdUaW1lOiByYWdSZXNwb25zZS5wcm9jZXNzaW5nVGltZSxcbiAgICAgIGxhbmd1YWdlXG4gICAgfSwgcmVxdWVzdElkKTtcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihyZXNwb25zZSwgeyBzdGF0dXM6IDIwMCB9KTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnN0IGFwcEVycm9yID0gZXJyb3IgaW5zdGFuY2VvZiBBcHBFcnJvciA/IGVycm9yIDogRXJyb3JGYWN0b3J5LmludGVybmFsRXJyb3IoZXJyb3IpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gaGFuZGxlQXBpRXJyb3IoYXBwRXJyb3IsICdqYScpO1xuICAgIFxuICAgIGNvbnN0IGR1cmF0aW9uID0gdGltZXIuZW5kKHsgZXJyb3I6IHRydWUgfSk7XG4gICAgXG4gICAgLy8gUmVjb3JkIGVycm9yIG1ldHJpY3NcbiAgICBwZXJmTW9uaXRvci5yZWNvcmRDb3VudCgnYXBpLmNoYXQuZXJyb3JzJywgMSwge1xuICAgICAgZXJyb3JDb2RlOiBhcHBFcnJvci5jb2RlLFxuICAgICAgc3RhdHVzQ29kZTogYXBwRXJyb3Iuc3RhdHVzQ29kZS50b1N0cmluZygpXG4gICAgfSk7XG4gICAgcGVyZk1vbml0b3IucmVjb3JkVGltaW5nKCdhcGkuY2hhdC5lcnJvckR1cmF0aW9uJywgZHVyYXRpb24pO1xuICAgIFxuICAgIGxvZy5lcnJvcignQ2hhdCBBUEkgZXJyb3InLCBlcnJvciBhcyBFcnJvciwge1xuICAgICAgY29kZTogYXBwRXJyb3IuY29kZSxcbiAgICAgIHN0YXR1c0NvZGU6IGFwcEVycm9yLnN0YXR1c0NvZGUsXG4gICAgfSwgcmVxdWVzdElkKTtcbiAgICBcbiAgICBsb2cuYXBpKCdQT1NUJywgJy9hcGkvY2hhdCcsIGFwcEVycm9yLnN0YXR1c0NvZGUsIGR1cmF0aW9uLCByZXF1ZXN0SWQpO1xuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHJlc3BvbnNlLCB7IHN0YXR1czogYXBwRXJyb3Iuc3RhdHVzQ29kZSB9KTtcbiAgfVxufSJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJ2YWxpZGF0ZUNoYXRSZXF1ZXN0IiwiY2hlY2tSYXRlTGltaXQiLCJTZXNzaW9uTWFuYWdlciIsImdldFJlZGlzU2VydmljZSIsIkVycm9yRmFjdG9yeSIsImhhbmRsZUFwaUVycm9yIiwiQXBwRXJyb3IiLCJsb2ciLCJnZW5lcmF0ZVJlcXVlc3RJZCIsImdldFBlcmZvcm1hbmNlTW9uaXRvciIsIlNpbXBsZVJBR1NlcnZpY2UiLCJ2NCIsInV1aWR2NCIsIlBPU1QiLCJyZXF1ZXN0IiwicmVxdWVzdElkIiwidGltZXIiLCJwZXJmb3JtYW5jZSIsInBlcmZNb25pdG9yIiwicmVxdWVzdFN0YXJ0VGltZSIsIkRhdGUiLCJub3ciLCJyZWNvcmRDb3VudCIsIm1ldGhvZCIsImVuZHBvaW50Iiwic2Vzc2lvbk1hbmFnZXIiLCJnZXRJbnN0YW5jZSIsInJlZGlzU2VydmljZSIsInNpbXBsZVJBR1NlcnZpY2UiLCJjbGllbnRJUCIsImhlYWRlcnMiLCJnZXQiLCJpbmZvIiwidXNlckFnZW50IiwicmF0ZUxpbWl0UmVzdWx0IiwiZXJyb3IiLCJ3YXJuIiwiZmFsbGJhY2siLCJtZXNzYWdlIiwiYWxsb3dlZCIsInJldHJ5QWZ0ZXIiLCJ1bmRlZmluZWQiLCJyYXRlTGltaXRFeGNlZWRlZCIsInJlc3BvbnNlIiwic2VjdXJpdHkiLCJkdXJhdGlvbiIsImVuZCIsImFwaSIsInN0YXR1c0NvZGUiLCJqc29uIiwic3RhdHVzIiwidG9TdHJpbmciLCJyZW1haW5pbmciLCJNYXRoIiwiY2VpbCIsInJlc2V0VGltZSIsImJvZHkiLCJ2YWxpZGF0aW9uIiwiaXNWYWxpZCIsInZhbGlkYXRpb25GYWlsZWQiLCJlcnJvcnMiLCJqb2luIiwibGFuZ3VhZ2UiLCJvcmlnaW5hbE1lc3NhZ2UiLCJzdWJzdHJpbmciLCJzYW5pdGl6ZWREYXRhIiwic2FuaXRpemVkIiwic2Vzc2lvbklkIiwidXNlVm9pY2UiLCJpbnB1dFR5cGUiLCJsb2NhdGlvbiIsInJlcXVlc3RlZFNjb3BlIiwic2Vzc2lvbiIsImdldFNlc3Npb24iLCJzZXNzaW9uTm90Rm91bmQiLCJjcmVhdGVkQXQiLCJsYXN0QWN0aXZpdHkiLCJzZXRTZXNzaW9uTGFuZ3VhZ2UiLCJmcm9tIiwidG8iLCJidXNpbmVzcyIsIm1lc3NhZ2VMZW5ndGgiLCJsZW5ndGgiLCJzZXNzaW9uTWVzc2FnZUNvdW50IiwibWVzc2FnZUNvdW50IiwiaGFzTG9jYXRpb24iLCJoYXNSZXF1ZXN0ZWRTY29wZSIsInJhZ1Jlc3BvbnNlIiwicmFnVGltZXIiLCJwZXJmUkFHVGltZXIiLCJzdGFydFRpbWVyIiwicHJvY2Vzc1F1ZXJ5IiwiY29uZmlkZW5jZSIsInNvdXJjZUNvdW50Iiwic291cmNlcyIsInByb2Nlc3NpbmdUaW1lIiwicm91bmQiLCJyZWNvcmRUaW1pbmciLCJjb250ZW50IiwidXNlck1lc3NhZ2UiLCJpZCIsInJvbGUiLCJ0aW1lc3RhbXAiLCJtZXRhZGF0YSIsInRpbWVSYW5nZSIsImxvY2F0aW9uUmFuZ2UiLCJhZGRNZXNzYWdlIiwiYXVkaW9VcmwiLCJ0ZXh0TGVuZ3RoIiwiYXNzaXN0YW50TWVzc2FnZSIsIm1hcCIsInNvdXJjZSIsInRpdGxlIiwidXJsIiwiZGVzY3JpcHRpb24iLCJjYXRlZ29yeSIsImxhc3RVcGRhdGVkIiwic2ltcGxlQ2hhdFJlc3BvbnNlIiwic2hvdWxkUGxheUF1ZGlvIiwic3VjY2VzcyIsImRhdGEiLCJyZXNwb25zZUxlbmd0aCIsImhhc0F1ZGlvIiwiYXBwRXJyb3IiLCJpbnRlcm5hbEVycm9yIiwiZXJyb3JDb2RlIiwiY29kZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/chat/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/cache/SearchCache.ts":
/*!**************************************!*\
  !*** ./src/lib/cache/SearchCache.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SearchCache: () => (/* binding */ SearchCache),\n/* harmony export */   getSearchCache: () => (/* binding */ getSearchCache)\n/* harmony export */ });\n// In-memory search cache with LRU eviction\nclass SearchCache {\n    constructor(maxSize = 1000, ttlMinutes = 15){\n        this.cache = new Map();\n        this.cleanupInterval = null;\n        this.maxSize = maxSize;\n        this.ttl = ttlMinutes * 60 * 1000;\n        this.startCleanupProcess();\n    }\n    generateCacheKey(query) {\n        const normalized = {\n            text: query.text.toLowerCase().trim(),\n            category: query.category || \"\",\n            language: query.language || \"ja\",\n            limit: query.limit || 10,\n            filters: query.filters || {}\n        };\n        return JSON.stringify(normalized);\n    }\n    get(query) {\n        const key = this.generateCacheKey(query);\n        const entry = this.cache.get(key);\n        if (!entry) {\n            return null;\n        }\n        // Check if entry has expired\n        const now = Date.now();\n        if (now - entry.timestamp > this.ttl) {\n            this.cache.delete(key);\n            return null;\n        }\n        // Update access information for LRU\n        entry.accessCount++;\n        entry.lastAccessed = now;\n        this.cache.set(key, entry);\n        // Mark result as coming from cache\n        return {\n            ...entry.result,\n            usedCache: true\n        };\n    }\n    set(query, result) {\n        const key = this.generateCacheKey(query);\n        const now = Date.now();\n        // Remove oldest entries if cache is full\n        if (this.cache.size >= this.maxSize) {\n            this.evictLRU();\n        }\n        const entry = {\n            key,\n            result: {\n                ...result,\n                usedCache: false\n            },\n            timestamp: now,\n            accessCount: 0,\n            lastAccessed: now\n        };\n        this.cache.set(key, entry);\n    }\n    evictLRU() {\n        if (this.cache.size === 0) return;\n        let oldestKey = \"\";\n        let oldestTime = Infinity;\n        for (const [key, entry] of this.cache.entries()){\n            if (entry.lastAccessed < oldestTime) {\n                oldestTime = entry.lastAccessed;\n                oldestKey = key;\n            }\n        }\n        if (oldestKey) {\n            this.cache.delete(oldestKey);\n        }\n    }\n    startCleanupProcess() {\n        // Clean up expired entries every 5 minutes\n        this.cleanupInterval = setInterval(()=>{\n            this.cleanupExpired();\n        }, 5 * 60 * 1000);\n    }\n    cleanupExpired() {\n        const now = Date.now();\n        const keysToDelete = [];\n        for (const [key, entry] of this.cache.entries()){\n            if (now - entry.timestamp > this.ttl) {\n                keysToDelete.push(key);\n            }\n        }\n        for (const key of keysToDelete){\n            this.cache.delete(key);\n        }\n        console.log(`🧹 Cache cleanup: removed ${keysToDelete.length} expired entries`);\n    }\n    // Manual cache invalidation\n    invalidate(pattern) {\n        let removedCount = 0;\n        if (!pattern) {\n            // Clear all cache\n            removedCount = this.cache.size;\n            this.cache.clear();\n        } else {\n            // Remove entries matching pattern\n            const keysToDelete = [];\n            for (const [key] of this.cache.entries()){\n                if (key.includes(pattern.toLowerCase())) {\n                    keysToDelete.push(key);\n                }\n            }\n            for (const key of keysToDelete){\n                this.cache.delete(key);\n            }\n            removedCount = keysToDelete.length;\n        }\n        console.log(`🗑️ Cache invalidation: removed ${removedCount} entries`);\n        return removedCount;\n    }\n    // Cache statistics\n    getStats() {\n        const totalAccess = Array.from(this.cache.values()).reduce((sum, entry)=>sum + entry.accessCount, 0);\n        const avgAccessCount = this.cache.size > 0 ? totalAccess / this.cache.size : 0;\n        return {\n            size: this.cache.size,\n            maxSize: this.maxSize,\n            hitRate: 0,\n            averageAccessCount: avgAccessCount\n        };\n    }\n    // Cleanup method for proper resource management\n    cleanup() {\n        if (this.cleanupInterval) {\n            clearInterval(this.cleanupInterval);\n            this.cleanupInterval = null;\n        }\n        this.cache.clear();\n        console.log(\"\\uD83E\\uDDF9 SearchCache cleanup completed\");\n    }\n}\n// Singleton instance\nlet searchCacheInstance = null;\nconst getSearchCache = ()=>{\n    if (!searchCacheInstance) {\n        searchCacheInstance = new SearchCache();\n    }\n    return searchCacheInstance;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFRLENBQUM7UUFDckUsT0FBT0E7SUFDVDtJQUVBLG1CQUFtQjtJQUNuQkcsV0FLRTtRQUNBLE1BQU1DLGNBQWNDLE1BQU1DLElBQUksQ0FBQyxJQUFJLENBQUNsRCxLQUFLLENBQUNtRCxNQUFNLElBQzdDQyxNQUFNLENBQUMsQ0FBQ0MsS0FBS2xDLFFBQVVrQyxNQUFNbEMsTUFBTUssV0FBVyxFQUFFO1FBRW5ELE1BQU04QixpQkFBaUIsSUFBSSxDQUFDdEQsS0FBSyxDQUFDNkIsSUFBSSxHQUFHLElBQUltQixjQUFjLElBQUksQ0FBQ2hELEtBQUssQ0FBQzZCLElBQUksR0FBRztRQUU3RSxPQUFPO1lBQ0xBLE1BQU0sSUFBSSxDQUFDN0IsS0FBSyxDQUFDNkIsSUFBSTtZQUNyQi9CLFNBQVMsSUFBSSxDQUFDQSxPQUFPO1lBQ3JCeUQsU0FBUztZQUNUQyxvQkFBb0JGO1FBQ3RCO0lBQ0Y7SUFFQSxnREFBZ0Q7SUFDaERHLFVBQWdCO1FBQ2QsSUFBSSxJQUFJLENBQUN2RCxlQUFlLEVBQUU7WUFDeEJ3RCxjQUFjLElBQUksQ0FBQ3hELGVBQWU7WUFDbEMsSUFBSSxDQUFDQSxlQUFlLEdBQUc7UUFDekI7UUFDQSxJQUFJLENBQUNGLEtBQUssQ0FBQzZDLEtBQUs7UUFDaEJOLFFBQVFDLEdBQUcsQ0FBQztJQUNkO0FBQ0Y7QUFFQSxxQkFBcUI7QUFDckIsSUFBSW1CLHNCQUEwQztBQUV2QyxNQUFNQyxpQkFBaUI7SUFDNUIsSUFBSSxDQUFDRCxxQkFBcUI7UUFDeEJBLHNCQUFzQixJQUFJL0Q7SUFDNUI7SUFDQSxPQUFPK0Q7QUFDVCxFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdG9reW8tb3BlbmRhdGEtaGFja2F0aG9uLy4vc3JjL2xpYi9jYWNoZS9TZWFyY2hDYWNoZS50cz81NjU1Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIEluLW1lbW9yeSBzZWFyY2ggY2FjaGUgd2l0aCBMUlUgZXZpY3Rpb25cbmltcG9ydCB7IFNlYXJjaFF1ZXJ5LCBTZWFyY2hSZXN1bHQsIE9wZW5EYXRhSXRlbSB9IGZyb20gJ0AvdHlwZXMnO1xuXG5pbnRlcmZhY2UgQ2FjaGVFbnRyeSB7XG4gIGtleTogc3RyaW5nO1xuICByZXN1bHQ6IFNlYXJjaFJlc3VsdDtcbiAgdGltZXN0YW1wOiBudW1iZXI7XG4gIGFjY2Vzc0NvdW50OiBudW1iZXI7XG4gIGxhc3RBY2Nlc3NlZDogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgU2VhcmNoQ2FjaGUge1xuICBwcml2YXRlIGNhY2hlID0gbmV3IE1hcDxzdHJpbmcsIENhY2hlRW50cnk+KCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgbWF4U2l6ZTogbnVtYmVyO1xuICBwcml2YXRlIHJlYWRvbmx5IHR0bDogbnVtYmVyOyAvLyBUaW1lIHRvIGxpdmUgaW4gbWlsbGlzZWNvbmRzXG4gIHByaXZhdGUgY2xlYW51cEludGVydmFsOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKG1heFNpemU6IG51bWJlciA9IDEwMDAsIHR0bE1pbnV0ZXM6IG51bWJlciA9IDE1KSB7XG4gICAgdGhpcy5tYXhTaXplID0gbWF4U2l6ZTtcbiAgICB0aGlzLnR0bCA9IHR0bE1pbnV0ZXMgKiA2MCAqIDEwMDA7XG4gICAgdGhpcy5zdGFydENsZWFudXBQcm9jZXNzKCk7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlQ2FjaGVLZXkocXVlcnk6IFNlYXJjaFF1ZXJ5KTogc3RyaW5nIHtcbiAgICBjb25zdCBub3JtYWxpemVkID0ge1xuICAgICAgdGV4dDogcXVlcnkudGV4dC50b0xvd2VyQ2FzZSgpLnRyaW0oKSxcbiAgICAgIGNhdGVnb3J5OiBxdWVyeS5jYXRlZ29yeSB8fCAnJyxcbiAgICAgIGxhbmd1YWdlOiBxdWVyeS5sYW5ndWFnZSB8fCAnamEnLFxuICAgICAgbGltaXQ6IHF1ZXJ5LmxpbWl0IHx8IDEwLFxuICAgICAgZmlsdGVyczogcXVlcnkuZmlsdGVycyB8fCB7fSxcbiAgICB9O1xuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShub3JtYWxpemVkKTtcbiAgfVxuXG4gIGdldChxdWVyeTogU2VhcmNoUXVlcnkpOiBTZWFyY2hSZXN1bHQgfCBudWxsIHtcbiAgICBjb25zdCBrZXkgPSB0aGlzLmdlbmVyYXRlQ2FjaGVLZXkocXVlcnkpO1xuICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5jYWNoZS5nZXQoa2V5KTtcblxuICAgIGlmICghZW50cnkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIGVudHJ5IGhhcyBleHBpcmVkXG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBpZiAobm93IC0gZW50cnkudGltZXN0YW1wID4gdGhpcy50dGwpIHtcbiAgICAgIHRoaXMuY2FjaGUuZGVsZXRlKGtleSk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgYWNjZXNzIGluZm9ybWF0aW9uIGZvciBMUlVcbiAgICBlbnRyeS5hY2Nlc3NDb3VudCsrO1xuICAgIGVudHJ5Lmxhc3RBY2Nlc3NlZCA9IG5vdztcbiAgICB0aGlzLmNhY2hlLnNldChrZXksIGVudHJ5KTtcblxuICAgIC8vIE1hcmsgcmVzdWx0IGFzIGNvbWluZyBmcm9tIGNhY2hlXG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmVudHJ5LnJlc3VsdCxcbiAgICAgIHVzZWRDYWNoZTogdHJ1ZSxcbiAgICB9O1xuICB9XG5cbiAgc2V0KHF1ZXJ5OiBTZWFyY2hRdWVyeSwgcmVzdWx0OiBTZWFyY2hSZXN1bHQpOiB2b2lkIHtcbiAgICBjb25zdCBrZXkgPSB0aGlzLmdlbmVyYXRlQ2FjaGVLZXkocXVlcnkpO1xuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG5cbiAgICAvLyBSZW1vdmUgb2xkZXN0IGVudHJpZXMgaWYgY2FjaGUgaXMgZnVsbFxuICAgIGlmICh0aGlzLmNhY2hlLnNpemUgPj0gdGhpcy5tYXhTaXplKSB7XG4gICAgICB0aGlzLmV2aWN0TFJVKCk7XG4gICAgfVxuXG4gICAgY29uc3QgZW50cnk6IENhY2hlRW50cnkgPSB7XG4gICAgICBrZXksXG4gICAgICByZXN1bHQ6IHtcbiAgICAgICAgLi4ucmVzdWx0LFxuICAgICAgICB1c2VkQ2FjaGU6IGZhbHNlLFxuICAgICAgfSxcbiAgICAgIHRpbWVzdGFtcDogbm93LFxuICAgICAgYWNjZXNzQ291bnQ6IDAsIC8vIFN0YXJ0IHdpdGggMCwgd2lsbCBiZSBpbmNyZW1lbnRlZCBvbiBmaXJzdCBhY2Nlc3NcbiAgICAgIGxhc3RBY2Nlc3NlZDogbm93LFxuICAgIH07XG5cbiAgICB0aGlzLmNhY2hlLnNldChrZXksIGVudHJ5KTtcbiAgfVxuXG4gIHByaXZhdGUgZXZpY3RMUlUoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY2FjaGUuc2l6ZSA9PT0gMCkgcmV0dXJuO1xuICAgIFxuICAgIGxldCBvbGRlc3RLZXkgPSAnJztcbiAgICBsZXQgb2xkZXN0VGltZSA9IEluZmluaXR5O1xuXG4gICAgZm9yIChjb25zdCBba2V5LCBlbnRyeV0gb2YgdGhpcy5jYWNoZS5lbnRyaWVzKCkpIHtcbiAgICAgIGlmIChlbnRyeS5sYXN0QWNjZXNzZWQgPCBvbGRlc3RUaW1lKSB7XG4gICAgICAgIG9sZGVzdFRpbWUgPSBlbnRyeS5sYXN0QWNjZXNzZWQ7XG4gICAgICAgIG9sZGVzdEtleSA9IGtleTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAob2xkZXN0S2V5KSB7XG4gICAgICB0aGlzLmNhY2hlLmRlbGV0ZShvbGRlc3RLZXkpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc3RhcnRDbGVhbnVwUHJvY2VzcygpOiB2b2lkIHtcbiAgICAvLyBDbGVhbiB1cCBleHBpcmVkIGVudHJpZXMgZXZlcnkgNSBtaW51dGVzXG4gICAgdGhpcy5jbGVhbnVwSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICB0aGlzLmNsZWFudXBFeHBpcmVkKCk7XG4gICAgfSwgNSAqIDYwICogMTAwMCk7XG4gIH1cblxuICBwcml2YXRlIGNsZWFudXBFeHBpcmVkKCk6IHZvaWQge1xuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgY29uc3Qga2V5c1RvRGVsZXRlOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBba2V5LCBlbnRyeV0gb2YgdGhpcy5jYWNoZS5lbnRyaWVzKCkpIHtcbiAgICAgIGlmIChub3cgLSBlbnRyeS50aW1lc3RhbXAgPiB0aGlzLnR0bCkge1xuICAgICAgICBrZXlzVG9EZWxldGUucHVzaChrZXkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXNUb0RlbGV0ZSkge1xuICAgICAgdGhpcy5jYWNoZS5kZWxldGUoa2V5KTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhg8J+nuSBDYWNoZSBjbGVhbnVwOiByZW1vdmVkICR7a2V5c1RvRGVsZXRlLmxlbmd0aH0gZXhwaXJlZCBlbnRyaWVzYCk7XG4gIH1cblxuICAvLyBNYW51YWwgY2FjaGUgaW52YWxpZGF0aW9uXG4gIGludmFsaWRhdGUocGF0dGVybj86IHN0cmluZyk6IG51bWJlciB7XG4gICAgbGV0IHJlbW92ZWRDb3VudCA9IDA7XG5cbiAgICBpZiAoIXBhdHRlcm4pIHtcbiAgICAgIC8vIENsZWFyIGFsbCBjYWNoZVxuICAgICAgcmVtb3ZlZENvdW50ID0gdGhpcy5jYWNoZS5zaXplO1xuICAgICAgdGhpcy5jYWNoZS5jbGVhcigpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBSZW1vdmUgZW50cmllcyBtYXRjaGluZyBwYXR0ZXJuXG4gICAgICBjb25zdCBrZXlzVG9EZWxldGU6IHN0cmluZ1tdID0gW107XG4gICAgICBmb3IgKGNvbnN0IFtrZXldIG9mIHRoaXMuY2FjaGUuZW50cmllcygpKSB7XG4gICAgICAgIGlmIChrZXkuaW5jbHVkZXMocGF0dGVybi50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgICAgIGtleXNUb0RlbGV0ZS5wdXNoKGtleSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgZm9yIChjb25zdCBrZXkgb2Yga2V5c1RvRGVsZXRlKSB7XG4gICAgICAgIHRoaXMuY2FjaGUuZGVsZXRlKGtleSk7XG4gICAgICB9XG4gICAgICByZW1vdmVkQ291bnQgPSBrZXlzVG9EZWxldGUubGVuZ3RoO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKGDwn5eR77iPIENhY2hlIGludmFsaWRhdGlvbjogcmVtb3ZlZCAke3JlbW92ZWRDb3VudH0gZW50cmllc2ApO1xuICAgIHJldHVybiByZW1vdmVkQ291bnQ7XG4gIH1cblxuICAvLyBDYWNoZSBzdGF0aXN0aWNzXG4gIGdldFN0YXRzKCk6IHtcbiAgICBzaXplOiBudW1iZXI7XG4gICAgbWF4U2l6ZTogbnVtYmVyO1xuICAgIGhpdFJhdGU6IG51bWJlcjtcbiAgICBhdmVyYWdlQWNjZXNzQ291bnQ6IG51bWJlcjtcbiAgfSB7XG4gICAgY29uc3QgdG90YWxBY2Nlc3MgPSBBcnJheS5mcm9tKHRoaXMuY2FjaGUudmFsdWVzKCkpXG4gICAgICAucmVkdWNlKChzdW0sIGVudHJ5KSA9PiBzdW0gKyBlbnRyeS5hY2Nlc3NDb3VudCwgMCk7XG4gICAgXG4gICAgY29uc3QgYXZnQWNjZXNzQ291bnQgPSB0aGlzLmNhY2hlLnNpemUgPiAwID8gdG90YWxBY2Nlc3MgLyB0aGlzLmNhY2hlLnNpemUgOiAwO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBzaXplOiB0aGlzLmNhY2hlLnNpemUsXG4gICAgICBtYXhTaXplOiB0aGlzLm1heFNpemUsXG4gICAgICBoaXRSYXRlOiAwLCAvLyBXb3VsZCBuZWVkIHRvIHRyYWNrIGhpdHMvbWlzc2VzIHRvIGNhbGN1bGF0ZSB0aGlzXG4gICAgICBhdmVyYWdlQWNjZXNzQ291bnQ6IGF2Z0FjY2Vzc0NvdW50LFxuICAgIH07XG4gIH1cblxuICAvLyBDbGVhbnVwIG1ldGhvZCBmb3IgcHJvcGVyIHJlc291cmNlIG1hbmFnZW1lbnRcbiAgY2xlYW51cCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jbGVhbnVwSW50ZXJ2YWwpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5jbGVhbnVwSW50ZXJ2YWwpO1xuICAgICAgdGhpcy5jbGVhbnVwSW50ZXJ2YWwgPSBudWxsO1xuICAgIH1cbiAgICB0aGlzLmNhY2hlLmNsZWFyKCk7XG4gICAgY29uc29sZS5sb2coJ/Cfp7kgU2VhcmNoQ2FjaGUgY2xlYW51cCBjb21wbGV0ZWQnKTtcbiAgfVxufVxuXG4vLyBTaW5nbGV0b24gaW5zdGFuY2VcbmxldCBzZWFyY2hDYWNoZUluc3RhbmNlOiBTZWFyY2hDYWNoZSB8IG51bGwgPSBudWxsO1xuXG5leHBvcnQgY29uc3QgZ2V0U2VhcmNoQ2FjaGUgPSAoKTogU2VhcmNoQ2FjaGUgPT4ge1xuICBpZiAoIXNlYXJjaENhY2hlSW5zdGFuY2UpIHtcbiAgICBzZWFyY2hDYWNoZUluc3RhbmNlID0gbmV3IFNlYXJjaENhY2hlKCk7XG4gIH1cbiAgcmV0dXJuIHNlYXJjaENhY2hlSW5zdGFuY2U7XG59OyJdLCJuYW1lcyI6WyJTZWFyY2hDYWNoZSIsImNvbnN0cnVjdG9yIiwibWF4U2l6ZSIsInR0bE1pbnV0ZXMiLCJjYWNoZSIsIk1hcCIsImNsZWFudXBJbnRlcnZhbCIsInR0bCIsInN0YXJ0Q2xlYW51cFByb2Nlc3MiLCJnZW5lcmF0ZUNhY2hlS2V5IiwicXVlcnkiLCJub3JtYWxpemVkIiwidGV4dCIsInRvTG93ZXJDYXNlIiwidHJpbSIsImNhdGVnb3J5IiwibGFuZ3VhZ2UiLCJsaW1pdCIsImZpbHRlcnMiLCJKU09OIiwic3RyaW5naWZ5IiwiZ2V0Iiwia2V5IiwiZW50cnkiLCJub3ciLCJEYXRlIiwidGltZXN0YW1wIiwiZGVsZXRlIiwiYWNjZXNzQ291bnQiLCJsYXN0QWNjZXNzZWQiLCJzZXQiLCJyZXN1bHQiLCJ1c2VkQ2FjaGUiLCJzaXplIiwiZXZpY3RMUlUiLCJvbGRlc3RLZXkiLCJvbGRlc3RUaW1lIiwiSW5maW5pdHkiLCJlbnRyaWVzIiwic2V0SW50ZXJ2YWwiLCJjbGVhbnVwRXhwaXJlZCIsImtleXNUb0RlbGV0ZSIsInB1c2giLCJjb25zb2xlIiwibG9nIiwibGVuZ3RoIiwiaW52YWxpZGF0ZSIsInBhdHRlcm4iLCJyZW1vdmVkQ291bnQiLCJjbGVhciIsImluY2x1ZGVzIiwiZ2V0U3RhdHMiLCJ0b3RhbEFjY2VzcyIsIkFycmF5IiwiZnJvbSIsInZhbHVlcyIsInJlZHVjZSIsInN1bSIsImF2Z0FjY2Vzc0NvdW50IiwiaGl0UmF0ZSIsImF2ZXJhZ2VBY2Nlc3NDb3VudCIsImNsZWFudXAiLCJjbGVhckludGVydmFsIiwic2VhcmNoQ2FjaGVJbnN0YW5jZSIsImdldFNlYXJjaENhY2hlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/cache/SearchCache.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/config.ts":
/*!***************************!*\
  !*** ./src/lib/config.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   getApiBaseUrl: () => (/* binding */ getApiBaseUrl),\n/* harmony export */   getSecureConfig: () => (/* binding */ getSecureConfig),\n/* harmony export */   isDevelopment: () => (/* binding */ isDevelopment),\n/* harmony export */   isProduction: () => (/* binding */ isProduction),\n/* harmony export */   securityConfig: () => (/* binding */ securityConfig),\n/* harmony export */   validateConfig: () => (/* binding */ validateConfig)\n/* harmony export */ });\n// API Key validation utility\nconst validateApiKey = (key, keyName)=>{\n    if (!key || key.length === 0) {\n        throw new Error(`${keyName} is required but not provided`);\n    }\n    // Check for dummy/placeholder values (更に厳格に)\n    const invalidPatterns = [\n        \"your_key_here\",\n        \"placeholder\",\n        \"dummy\",\n        \"test_key\",\n        \"example\",\n        \"sample\",\n        \"fake\",\n        \"mock\",\n        \"development\",\n        \"dev\",\n        \"localhost\"\n    ];\n    if (invalidPatterns.some((pattern)=>key.toLowerCase().includes(pattern))) {\n        throw new Error(`${keyName} appears to be a placeholder value`);\n    }\n    // Enhanced format validation for Gemini API key\n    if (keyName === \"GEMINI_API_KEY\") {\n        if (!key.startsWith(\"AIza\")) {\n            throw new Error(`${keyName} format is invalid (must start with 'AIza')`);\n        }\n        // Length validation (Gemini API keys are typically 39 characters)\n        if (key.length < 30 || key.length > 50) {\n            throw new Error(`${keyName} length is invalid (expected 30-50 characters)`);\n        }\n        // Character validation (should contain only alphanumeric and specific symbols)\n        if (!/^[A-Za-z0-9_-]+$/.test(key)) {\n            throw new Error(`${keyName} contains invalid characters`);\n        }\n    }\n    // Environment-specific validation\n    if (false) {}\n    return key;\n};\n// Safe configuration loading with validation\nconst loadConfig = ()=>{\n    try {\n        const geminiApiKey = validateApiKey(process.env.GEMINI_API_KEY, \"GEMINI_API_KEY\");\n        return {\n            geminiApiKey,\n            redisUrl: process.env.REDIS_URL,\n            gcpProjectId: process.env.GOOGLE_CLOUD_PROJECT_ID,\n            gcpRegion: process.env.GOOGLE_CLOUD_REGION || \"us-central1\",\n            enableVoice: \"true\" === \"true\",\n            enableMultiLanguage: \"true\" === \"true\",\n            maxSessionDuration: Math.max(60000, parseInt(\"3600000\" || 0)),\n            maxMessagesPerSession: Math.max(1, parseInt(\"50\" || 0)),\n            enableDynamicSearch: process.env.NEXT_PUBLIC_ENABLE_DYNAMIC_SEARCH !== \"false\",\n            tokyoOpenDataCatalogUrl: process.env.TOKYO_OPEN_DATA_CATALOG_URL || \"https://catalog.data.metro.tokyo.lg.jp\",\n            maxConcurrentDatasetRequests: Math.max(1, parseInt(process.env.MAX_CONCURRENT_DATASET_REQUESTS || \"5\"))\n        };\n    } catch (error) {\n        console.error(\"Configuration validation failed:\", error);\n        throw error;\n    }\n};\nconst config = loadConfig();\nconst validateConfig = ()=>{\n    const requiredKeys = [\n        \"geminiApiKey\"\n    ];\n    const missingKeys = requiredKeys.filter((key)=>!config[key]);\n    if (missingKeys.length > 0) {\n        throw new Error(`Missing required configuration: ${missingKeys.join(\", \")}`);\n    }\n    // Additional runtime validation\n    if (config.maxSessionDuration < 60000) {\n        throw new Error(\"maxSessionDuration must be at least 60 seconds\");\n    }\n    if (config.maxMessagesPerSession < 1) {\n        throw new Error(\"maxMessagesPerSession must be at least 1\");\n    }\n    // Security validation\n    if (false) {}\n    console.log(\"✅ Configuration validation passed\");\n};\n// Secure configuration getter - never logs sensitive values\nconst getSecureConfig = ()=>{\n    return {\n        ...config,\n        geminiApiKey: config.geminiApiKey ? \"[REDACTED]\" : \"NOT_SET\",\n        redisUrl: config.redisUrl ? \"[REDACTED]\" : \"NOT_SET\"\n    };\n};\nconst getApiBaseUrl = ()=>{\n    const baseUrl = \"http://localhost:3000\" || 0;\n    // Validate URL format\n    try {\n        new URL(baseUrl);\n        return baseUrl;\n    } catch  {\n        console.warn(`Invalid API base URL: ${baseUrl}, falling back to localhost`);\n        return \"http://localhost:3000\";\n    }\n};\nconst isProduction = ()=>{\n    return \"development\" === \"production\";\n};\nconst isDevelopment = ()=>{\n    return \"development\" === \"development\";\n};\n// Security configuration\nconst securityConfig = {\n    // Rate limiting\n    rateLimiting: {\n        windowMs: 15 * 60 * 1000,\n        maxRequests: isProduction() ? 100 : 1000,\n        skipSuccessfulRequests: false,\n        skipFailedRequests: false\n    },\n    // Input validation\n    validation: {\n        maxMessageLength: 2000,\n        maxFileSize: 10 * 1024 * 1024,\n        allowedAudioTypes: [\n            \"audio/webm\",\n            \"audio/mp3\",\n            \"audio/wav\",\n            \"audio/m4a\"\n        ]\n    },\n    // Session security\n    session: {\n        maxAge: config.maxSessionDuration,\n        httpOnly: true,\n        secure: isProduction(),\n        sameSite: \"strict\"\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VUFBVTtRQUNWQyxRQUFRZjtRQUNSZ0IsVUFBVTtJQUNaO0FBQ0YsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL3Rva3lvLW9wZW5kYXRhLWhhY2thdGhvbi8uL3NyYy9saWIvY29uZmlnLnRzP2EzZWYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwQ29uZmlnIH0gZnJvbSAnQC90eXBlcyc7XG5cbi8vIEFQSSBLZXkgdmFsaWRhdGlvbiB1dGlsaXR5XG5jb25zdCB2YWxpZGF0ZUFwaUtleSA9IChrZXk6IHN0cmluZyB8IHVuZGVmaW5lZCwga2V5TmFtZTogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgaWYgKCFrZXkgfHwga2V5Lmxlbmd0aCA9PT0gMCkge1xuICAgIHRocm93IG5ldyBFcnJvcihgJHtrZXlOYW1lfSBpcyByZXF1aXJlZCBidXQgbm90IHByb3ZpZGVkYCk7XG4gIH1cbiAgXG4gIC8vIENoZWNrIGZvciBkdW1teS9wbGFjZWhvbGRlciB2YWx1ZXMgKOabtOOBq+WOs+agvOOBqylcbiAgY29uc3QgaW52YWxpZFBhdHRlcm5zID0gW1xuICAgICd5b3VyX2tleV9oZXJlJywgJ3BsYWNlaG9sZGVyJywgJ2R1bW15JywgJ3Rlc3Rfa2V5JywgJ2V4YW1wbGUnLFxuICAgICdzYW1wbGUnLCAnZmFrZScsICdtb2NrJywgJ2RldmVsb3BtZW50JywgJ2RldicsICdsb2NhbGhvc3QnXG4gIF07XG4gIGlmIChpbnZhbGlkUGF0dGVybnMuc29tZShwYXR0ZXJuID0+IGtleS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHBhdHRlcm4pKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgJHtrZXlOYW1lfSBhcHBlYXJzIHRvIGJlIGEgcGxhY2Vob2xkZXIgdmFsdWVgKTtcbiAgfVxuICBcbiAgLy8gRW5oYW5jZWQgZm9ybWF0IHZhbGlkYXRpb24gZm9yIEdlbWluaSBBUEkga2V5XG4gIGlmIChrZXlOYW1lID09PSAnR0VNSU5JX0FQSV9LRVknKSB7XG4gICAgaWYgKCFrZXkuc3RhcnRzV2l0aCgnQUl6YScpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7a2V5TmFtZX0gZm9ybWF0IGlzIGludmFsaWQgKG11c3Qgc3RhcnQgd2l0aCAnQUl6YScpYCk7XG4gICAgfVxuICAgIFxuICAgIC8vIExlbmd0aCB2YWxpZGF0aW9uIChHZW1pbmkgQVBJIGtleXMgYXJlIHR5cGljYWxseSAzOSBjaGFyYWN0ZXJzKVxuICAgIGlmIChrZXkubGVuZ3RoIDwgMzAgfHwga2V5Lmxlbmd0aCA+IDUwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7a2V5TmFtZX0gbGVuZ3RoIGlzIGludmFsaWQgKGV4cGVjdGVkIDMwLTUwIGNoYXJhY3RlcnMpYCk7XG4gICAgfVxuICAgIFxuICAgIC8vIENoYXJhY3RlciB2YWxpZGF0aW9uIChzaG91bGQgY29udGFpbiBvbmx5IGFscGhhbnVtZXJpYyBhbmQgc3BlY2lmaWMgc3ltYm9scylcbiAgICBpZiAoIS9eW0EtWmEtejAtOV8tXSskLy50ZXN0KGtleSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgJHtrZXlOYW1lfSBjb250YWlucyBpbnZhbGlkIGNoYXJhY3RlcnNgKTtcbiAgICB9XG4gIH1cbiAgXG4gIC8vIEVudmlyb25tZW50LXNwZWNpZmljIHZhbGlkYXRpb25cbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicpIHtcbiAgICAvLyBJbiBwcm9kdWN0aW9uLCBlbnN1cmUga2V5IGRvZXNuJ3QgY29udGFpbiBkZXZlbG9wbWVudCBpbmRpY2F0b3JzXG4gICAgY29uc3QgZGV2SW5kaWNhdG9ycyA9IFsnZGV2JywgJ3Rlc3QnLCAnbG9jYWwnLCAnc3RhZ2luZyddO1xuICAgIGlmIChkZXZJbmRpY2F0b3JzLnNvbWUoaW5kaWNhdG9yID0+IGtleS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGluZGljYXRvcikpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7a2V5TmFtZX0gYXBwZWFycyB0byBiZSBhIGRldmVsb3BtZW50IGtleSBpbiBwcm9kdWN0aW9uIGVudmlyb25tZW50YCk7XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4ga2V5O1xufTtcblxuLy8gU2FmZSBjb25maWd1cmF0aW9uIGxvYWRpbmcgd2l0aCB2YWxpZGF0aW9uXG5jb25zdCBsb2FkQ29uZmlnID0gKCk6IEFwcENvbmZpZyA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgZ2VtaW5pQXBpS2V5ID0gdmFsaWRhdGVBcGlLZXkocHJvY2Vzcy5lbnYuR0VNSU5JX0FQSV9LRVksICdHRU1JTklfQVBJX0tFWScpO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBnZW1pbmlBcGlLZXksXG4gICAgICByZWRpc1VybDogcHJvY2Vzcy5lbnYuUkVESVNfVVJMLFxuICAgICAgZ2NwUHJvamVjdElkOiBwcm9jZXNzLmVudi5HT09HTEVfQ0xPVURfUFJPSkVDVF9JRCxcbiAgICAgIGdjcFJlZ2lvbjogcHJvY2Vzcy5lbnYuR09PR0xFX0NMT1VEX1JFR0lPTiB8fCAndXMtY2VudHJhbDEnLFxuICAgICAgZW5hYmxlVm9pY2U6IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0VOQUJMRV9WT0lDRSA9PT0gJ3RydWUnLFxuICAgICAgZW5hYmxlTXVsdGlMYW5ndWFnZTogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfRU5BQkxFX01VTFRJTEFORyA9PT0gJ3RydWUnLFxuICAgICAgbWF4U2Vzc2lvbkR1cmF0aW9uOiBNYXRoLm1heCg2MDAwMCwgcGFyc2VJbnQocHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfTUFYX1NFU1NJT05fRFVSQVRJT04gfHwgJzM2MDAwMDAnKSksIC8vIG1pbiAxIG1pbnV0ZVxuICAgICAgbWF4TWVzc2FnZXNQZXJTZXNzaW9uOiBNYXRoLm1heCgxLCBwYXJzZUludChwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19NQVhfTUVTU0FHRVNfUEVSX1NFU1NJT04gfHwgJzUwJykpLCAvLyBtaW4gMSBtZXNzYWdlXG4gICAgICBlbmFibGVEeW5hbWljU2VhcmNoOiBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19FTkFCTEVfRFlOQU1JQ19TRUFSQ0ggIT09ICdmYWxzZScsIC8vIOODh+ODleOCqeODq+ODiOacieWKuVxuICAgICAgdG9reW9PcGVuRGF0YUNhdGFsb2dVcmw6IHByb2Nlc3MuZW52LlRPS1lPX09QRU5fREFUQV9DQVRBTE9HX1VSTCB8fCAnaHR0cHM6Ly9jYXRhbG9nLmRhdGEubWV0cm8udG9reW8ubGcuanAnLFxuICAgICAgbWF4Q29uY3VycmVudERhdGFzZXRSZXF1ZXN0czogTWF0aC5tYXgoMSwgcGFyc2VJbnQocHJvY2Vzcy5lbnYuTUFYX0NPTkNVUlJFTlRfREFUQVNFVF9SRVFVRVNUUyB8fCAnNScpKSxcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0NvbmZpZ3VyYXRpb24gdmFsaWRhdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgY29uZmlnOiBBcHBDb25maWcgPSBsb2FkQ29uZmlnKCk7XG5cbmV4cG9ydCBjb25zdCB2YWxpZGF0ZUNvbmZpZyA9ICgpOiB2b2lkID0+IHtcbiAgY29uc3QgcmVxdWlyZWRLZXlzID0gWydnZW1pbmlBcGlLZXknXTtcbiAgY29uc3QgbWlzc2luZ0tleXMgPSByZXF1aXJlZEtleXMuZmlsdGVyKGtleSA9PiAhY29uZmlnW2tleSBhcyBrZXlvZiBBcHBDb25maWddKTtcbiAgXG4gIGlmIChtaXNzaW5nS2V5cy5sZW5ndGggPiAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBNaXNzaW5nIHJlcXVpcmVkIGNvbmZpZ3VyYXRpb246ICR7bWlzc2luZ0tleXMuam9pbignLCAnKX1gKTtcbiAgfVxuICBcbiAgLy8gQWRkaXRpb25hbCBydW50aW1lIHZhbGlkYXRpb25cbiAgaWYgKGNvbmZpZy5tYXhTZXNzaW9uRHVyYXRpb24gPCA2MDAwMCkge1xuICAgIHRocm93IG5ldyBFcnJvcignbWF4U2Vzc2lvbkR1cmF0aW9uIG11c3QgYmUgYXQgbGVhc3QgNjAgc2Vjb25kcycpO1xuICB9XG4gIFxuICBpZiAoY29uZmlnLm1heE1lc3NhZ2VzUGVyU2Vzc2lvbiA8IDEpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ21heE1lc3NhZ2VzUGVyU2Vzc2lvbiBtdXN0IGJlIGF0IGxlYXN0IDEnKTtcbiAgfVxuICBcbiAgLy8gU2VjdXJpdHkgdmFsaWRhdGlvblxuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJykge1xuICAgIC8vIEVuc3VyZSBzZW5zaXRpdmUgY29uZmlnIGlzIG5vdCBsb2dnZWQgaW4gcHJvZHVjdGlvblxuICAgIGlmIChjb25maWcuZ2VtaW5pQXBpS2V5Lmxlbmd0aCA8IDMwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FQSSBrZXkgYXBwZWFycyB0byBiZSB0b28gc2hvcnQgZm9yIHByb2R1Y3Rpb24gdXNlJyk7XG4gICAgfVxuICAgIFxuICAgIC8vIFZhbGlkYXRlIFJlZGlzIFVSTCBpbiBwcm9kdWN0aW9uIGlmIHByb3ZpZGVkXG4gICAgaWYgKGNvbmZpZy5yZWRpc1VybCAmJiAhY29uZmlnLnJlZGlzVXJsLnN0YXJ0c1dpdGgoJ3JlZGlzOi8vJykgJiYgIWNvbmZpZy5yZWRpc1VybC5zdGFydHNXaXRoKCdyZWRpc3M6Ly8nKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIFJlZGlzIFVSTCBmb3JtYXQgaW4gcHJvZHVjdGlvbicpO1xuICAgIH1cbiAgfVxuICBcbiAgY29uc29sZS5sb2coJ+KchSBDb25maWd1cmF0aW9uIHZhbGlkYXRpb24gcGFzc2VkJyk7XG59O1xuXG4vLyBTZWN1cmUgY29uZmlndXJhdGlvbiBnZXR0ZXIgLSBuZXZlciBsb2dzIHNlbnNpdGl2ZSB2YWx1ZXNcbmV4cG9ydCBjb25zdCBnZXRTZWN1cmVDb25maWcgPSAoKSA9PiB7XG4gIHJldHVybiB7XG4gICAgLi4uY29uZmlnLFxuICAgIGdlbWluaUFwaUtleTogY29uZmlnLmdlbWluaUFwaUtleSA/ICdbUkVEQUNURURdJyA6ICdOT1RfU0VUJyxcbiAgICByZWRpc1VybDogY29uZmlnLnJlZGlzVXJsID8gJ1tSRURBQ1RFRF0nIDogJ05PVF9TRVQnLFxuICB9O1xufTtcblxuZXhwb3J0IGNvbnN0IGdldEFwaUJhc2VVcmwgPSAoKTogc3RyaW5nID0+IHtcbiAgY29uc3QgYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0FQSV9CQVNFX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdDozMDAwJztcbiAgXG4gIC8vIFZhbGlkYXRlIFVSTCBmb3JtYXRcbiAgdHJ5IHtcbiAgICBuZXcgVVJMKGJhc2VVcmwpO1xuICAgIHJldHVybiBiYXNlVXJsO1xuICB9IGNhdGNoIHtcbiAgICBjb25zb2xlLndhcm4oYEludmFsaWQgQVBJIGJhc2UgVVJMOiAke2Jhc2VVcmx9LCBmYWxsaW5nIGJhY2sgdG8gbG9jYWxob3N0YCk7XG4gICAgcmV0dXJuICdodHRwOi8vbG9jYWxob3N0OjMwMDAnO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgaXNQcm9kdWN0aW9uID0gKCk6IGJvb2xlYW4gPT4ge1xuICByZXR1cm4gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJztcbn07XG5cbmV4cG9ydCBjb25zdCBpc0RldmVsb3BtZW50ID0gKCk6IGJvb2xlYW4gPT4ge1xuICByZXR1cm4gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCc7XG59O1xuXG4vLyBTZWN1cml0eSBjb25maWd1cmF0aW9uXG5leHBvcnQgY29uc3Qgc2VjdXJpdHlDb25maWcgPSB7XG4gIC8vIFJhdGUgbGltaXRpbmdcbiAgcmF0ZUxpbWl0aW5nOiB7XG4gICAgd2luZG93TXM6IDE1ICogNjAgKiAxMDAwLCAvLyAxNSBtaW51dGVzXG4gICAgbWF4UmVxdWVzdHM6IGlzUHJvZHVjdGlvbigpID8gMTAwIDogMTAwMCwgLy8gUHJvZHVjdGlvbjogMTAwLzE1bWluLCBEZXY6IDEwMDAvMTVtaW5cbiAgICBza2lwU3VjY2Vzc2Z1bFJlcXVlc3RzOiBmYWxzZSxcbiAgICBza2lwRmFpbGVkUmVxdWVzdHM6IGZhbHNlLFxuICB9LFxuICBcbiAgLy8gSW5wdXQgdmFsaWRhdGlvblxuICB2YWxpZGF0aW9uOiB7XG4gICAgbWF4TWVzc2FnZUxlbmd0aDogMjAwMCxcbiAgICBtYXhGaWxlU2l6ZTogMTAgKiAxMDI0ICogMTAyNCwgLy8gMTBNQlxuICAgIGFsbG93ZWRBdWRpb1R5cGVzOiBbJ2F1ZGlvL3dlYm0nLCAnYXVkaW8vbXAzJywgJ2F1ZGlvL3dhdicsICdhdWRpby9tNGEnXSxcbiAgfSxcbiAgXG4gIC8vIFNlc3Npb24gc2VjdXJpdHlcbiAgc2Vzc2lvbjoge1xuICAgIG1heEFnZTogY29uZmlnLm1heFNlc3Npb25EdXJhdGlvbixcbiAgICBodHRwT25seTogdHJ1ZSxcbiAgICBzZWN1cmU6IGlzUHJvZHVjdGlvbigpLFxuICAgIHNhbWVTaXRlOiAnc3RyaWN0JyBhcyBjb25zdCxcbiAgfSxcbn07Il0sIm5hbWVzIjpbInZhbGlkYXRlQXBpS2V5Iiwia2V5Iiwia2V5TmFtZSIsImxlbmd0aCIsIkVycm9yIiwiaW52YWxpZFBhdHRlcm5zIiwic29tZSIsInBhdHRlcm4iLCJ0b0xvd2VyQ2FzZSIsImluY2x1ZGVzIiwic3RhcnRzV2l0aCIsInRlc3QiLCJwcm9jZXNzIiwiZGV2SW5kaWNhdG9ycyIsImluZGljYXRvciIsImxvYWRDb25maWciLCJnZW1pbmlBcGlLZXkiLCJlbnYiLCJHRU1JTklfQVBJX0tFWSIsInJlZGlzVXJsIiwiUkVESVNfVVJMIiwiZ2NwUHJvamVjdElkIiwiR09PR0xFX0NMT1VEX1BST0pFQ1RfSUQiLCJnY3BSZWdpb24iLCJHT09HTEVfQ0xPVURfUkVHSU9OIiwiZW5hYmxlVm9pY2UiLCJORVhUX1BVQkxJQ19FTkFCTEVfVk9JQ0UiLCJlbmFibGVNdWx0aUxhbmd1YWdlIiwiTkVYVF9QVUJMSUNfRU5BQkxFX01VTFRJTEFORyIsIm1heFNlc3Npb25EdXJhdGlvbiIsIk1hdGgiLCJtYXgiLCJwYXJzZUludCIsIk5FWFRfUFVCTElDX01BWF9TRVNTSU9OX0RVUkFUSU9OIiwibWF4TWVzc2FnZXNQZXJTZXNzaW9uIiwiTkVYVF9QVUJMSUNfTUFYX01FU1NBR0VTX1BFUl9TRVNTSU9OIiwiZW5hYmxlRHluYW1pY1NlYXJjaCIsIk5FWFRfUFVCTElDX0VOQUJMRV9EWU5BTUlDX1NFQVJDSCIsInRva3lvT3BlbkRhdGFDYXRhbG9nVXJsIiwiVE9LWU9fT1BFTl9EQVRBX0NBVEFMT0dfVVJMIiwibWF4Q29uY3VycmVudERhdGFzZXRSZXF1ZXN0cyIsIk1BWF9DT05DVVJSRU5UX0RBVEFTRVRfUkVRVUVTVFMiLCJlcnJvciIsImNvbnNvbGUiLCJjb25maWciLCJ2YWxpZGF0ZUNvbmZpZyIsInJlcXVpcmVkS2V5cyIsIm1pc3NpbmdLZXlzIiwiZmlsdGVyIiwiam9pbiIsImxvZyIsImdldFNlY3VyZUNvbmZpZyIsImdldEFwaUJhc2VVcmwiLCJiYXNlVXJsIiwiTkVYVF9QVUJMSUNfQVBJX0JBU0VfVVJMIiwiVVJMIiwid2FybiIsImlzUHJvZHVjdGlvbiIsImlzRGV2ZWxvcG1lbnQiLCJzZWN1cml0eUNvbmZpZyIsInJhdGVMaW1pdGluZyIsIndpbmRvd01zIiwibWF4UmVxdWVzdHMiLCJza2lwU3VjY2Vzc2Z1bFJlcXVlc3RzIiwic2tpcEZhaWxlZFJlcXVlc3RzIiwidmFsaWRhdGlvbiIsIm1heE1lc3NhZ2VMZW5ndGgiLCJtYXhGaWxlU2l6ZSIsImFsbG93ZWRBdWRpb1R5cGVzIiwic2Vzc2lvbiIsIm1heEFnZSIsImh0dHBPbmx5Iiwic2VjdXJlIiwic2FtZVNpdGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/config.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/errors.ts":
/*!***************************!*\
  !*** ./src/lib/errors.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AppError: () => (/* binding */ AppError),\n/* harmony export */   ErrorCode: () => (/* binding */ ErrorCode),\n/* harmony export */   ErrorFactory: () => (/* binding */ ErrorFactory),\n/* harmony export */   extractErrorInfo: () => (/* binding */ extractErrorInfo),\n/* harmony export */   handleApiError: () => (/* binding */ handleApiError)\n/* harmony export */ });\n// Standardized error handling system\nvar ErrorCode;\n(function(ErrorCode) {\n    // Authentication & Authorization\n    ErrorCode[\"INVALID_API_KEY\"] = \"INVALID_API_KEY\";\n    ErrorCode[\"RATE_LIMIT_EXCEEDED\"] = \"RATE_LIMIT_EXCEEDED\";\n    // Validation\n    ErrorCode[\"VALIDATION_FAILED\"] = \"VALIDATION_FAILED\";\n    ErrorCode[\"INVALID_INPUT\"] = \"INVALID_INPUT\";\n    ErrorCode[\"INVALID_SESSION\"] = \"INVALID_SESSION\";\n    ErrorCode[\"SESSION_NOT_FOUND\"] = \"SESSION_NOT_FOUND\";\n    // External Services\n    ErrorCode[\"GEMINI_API_ERROR\"] = \"GEMINI_API_ERROR\";\n    ErrorCode[\"GEMINI_QUOTA_EXCEEDED\"] = \"GEMINI_QUOTA_EXCEEDED\";\n    ErrorCode[\"GEMINI_UNAVAILABLE\"] = \"GEMINI_UNAVAILABLE\";\n    // Data & Search\n    ErrorCode[\"SEARCH_FAILED\"] = \"SEARCH_FAILED\";\n    ErrorCode[\"DATA_FETCH_FAILED\"] = \"DATA_FETCH_FAILED\";\n    ErrorCode[\"INDEX_INITIALIZATION_FAILED\"] = \"INDEX_INITIALIZATION_FAILED\";\n    // Audio Processing\n    ErrorCode[\"AUDIO_PROCESSING_FAILED\"] = \"AUDIO_PROCESSING_FAILED\";\n    ErrorCode[\"UNSUPPORTED_AUDIO_FORMAT\"] = \"UNSUPPORTED_AUDIO_FORMAT\";\n    ErrorCode[\"AUDIO_TOO_LARGE\"] = \"AUDIO_TOO_LARGE\";\n    // System\n    ErrorCode[\"INTERNAL_ERROR\"] = \"INTERNAL_ERROR\";\n    ErrorCode[\"SERVICE_UNAVAILABLE\"] = \"SERVICE_UNAVAILABLE\";\n    ErrorCode[\"CONFIGURATION_ERROR\"] = \"CONFIGURATION_ERROR\";\n})(ErrorCode || (ErrorCode = {}));\nclass AppError extends Error {\n    constructor(errorDetails){\n        super(errorDetails.message);\n        this.name = \"AppError\";\n        this.code = errorDetails.code;\n        this.statusCode = errorDetails.statusCode;\n        this.isRetryable = errorDetails.isRetryable;\n        this.details = errorDetails.details;\n        this.userMessage = errorDetails.userMessage;\n        // Maintains proper stack trace for where our error was thrown\n        Error.captureStackTrace(this, AppError);\n    }\n    toJSON() {\n        return {\n            name: this.name,\n            code: this.code,\n            message: this.message,\n            statusCode: this.statusCode,\n            isRetryable: this.isRetryable,\n            details: this.details,\n            stack: this.stack\n        };\n    }\n    getUserMessage(language = \"ja\") {\n        return this.userMessage[language] || this.userMessage.ja || this.message;\n    }\n}\n// Predefined error factories\nconst ErrorFactory = {\n    validationFailed: (details, validationErrors)=>{\n        return new AppError({\n            code: \"VALIDATION_FAILED\",\n            message: `Validation failed: ${details}`,\n            details: validationErrors,\n            statusCode: 400,\n            isRetryable: false,\n            userMessage: {\n                ja: \"入力内容に問題があります。正しい形式で入力してください。\",\n                en: \"There is an issue with your input. Please enter in the correct format.\",\n                zh: \"输入内容有问题。请以正确格式输入。\",\n                ko: \"입력 내용에 문제가 있습니다. 올바른 형식으로 입력해주세요.\"\n            }\n        });\n    },\n    rateLimitExceeded: (retryAfter = 60)=>{\n        return new AppError({\n            code: \"RATE_LIMIT_EXCEEDED\",\n            message: \"Rate limit exceeded\",\n            details: {\n                retryAfter\n            },\n            statusCode: 429,\n            isRetryable: true,\n            userMessage: {\n                ja: \"リクエストが多すぎます。しばらくお待ちください。\",\n                en: \"Too many requests. Please wait a moment.\",\n                zh: \"请求过多。请稍等。\",\n                ko: \"요청이 너무 많습니다. 잠시 기다려 주세요.\"\n            }\n        });\n    },\n    sessionNotFound: ()=>{\n        return new AppError({\n            code: \"SESSION_NOT_FOUND\",\n            message: \"Session not found or expired\",\n            statusCode: 404,\n            isRetryable: false,\n            userMessage: {\n                ja: \"セッションが見つからないか期限切れです。新しいセッションを作成してください。\",\n                en: \"Session not found or expired. Please create a new session.\",\n                zh: \"会话未找到或已过期。请创建新会话。\",\n                ko: \"세션을 찾을 수 없거나 만료되었습니다. 새 세션을 만들어주세요.\"\n            }\n        });\n    },\n    geminiApiError: (originalError)=>{\n        const isQuotaError = originalError?.message?.toLowerCase().includes(\"quota\");\n        const isUnavailable = originalError?.message?.toLowerCase().includes(\"unavailable\");\n        if (isQuotaError) {\n            return new AppError({\n                code: \"GEMINI_QUOTA_EXCEEDED\",\n                message: \"Gemini API quota exceeded\",\n                details: originalError,\n                statusCode: 503,\n                isRetryable: true,\n                userMessage: {\n                    ja: \"AIサービスの利用制限に達しました。しばらく後にお試しください。\",\n                    en: \"AI service usage limit reached. Please try again later.\",\n                    zh: \"AI服务使用限制已达到。请稍后再试。\",\n                    ko: \"AI 서비스 사용 한도에 도달했습니다. 나중에 다시 시도해주세요.\"\n                }\n            });\n        }\n        if (isUnavailable) {\n            return new AppError({\n                code: \"GEMINI_UNAVAILABLE\",\n                message: \"Gemini API temporarily unavailable\",\n                details: originalError,\n                statusCode: 503,\n                isRetryable: true,\n                userMessage: {\n                    ja: \"AIサービスが一時的に利用できません。しばらく後にお試しください。\",\n                    en: \"AI service is temporarily unavailable. Please try again later.\",\n                    zh: \"AI服务暂时不可用。请稍后再试。\",\n                    ko: \"AI 서비스가 일시적으로 사용할 수 없습니다. 나중에 다시 시도해주세요.\"\n                }\n            });\n        }\n        return new AppError({\n            code: \"GEMINI_API_ERROR\",\n            message: \"Gemini API error\",\n            details: originalError,\n            statusCode: 500,\n            isRetryable: false,\n            userMessage: {\n                ja: \"AIサービスでエラーが発生しました。\",\n                en: \"An error occurred with the AI service.\",\n                zh: \"AI服务发生错误。\",\n                ko: \"AI 서비스에서 오류가 발생했습니다.\"\n            }\n        });\n    },\n    searchFailed: (originalError)=>{\n        return new AppError({\n            code: \"SEARCH_FAILED\",\n            message: \"Search operation failed\",\n            details: originalError,\n            statusCode: 500,\n            isRetryable: true,\n            userMessage: {\n                ja: \"検索処理でエラーが発生しました。\",\n                en: \"An error occurred during search.\",\n                zh: \"搜索处理中发生错误。\",\n                ko: \"검색 처리 중 오류가 발생했습니다.\"\n            }\n        });\n    },\n    audioProcessingFailed: (originalError)=>{\n        return new AppError({\n            code: \"AUDIO_PROCESSING_FAILED\",\n            message: \"Audio processing failed\",\n            details: originalError,\n            statusCode: 500,\n            isRetryable: true,\n            userMessage: {\n                ja: \"音声処理でエラーが発生しました。\",\n                en: \"An error occurred during audio processing.\",\n                zh: \"音频处理中发生错误。\",\n                ko: \"음성 처리 중 오류가 발생했습니다.\"\n            }\n        });\n    },\n    internalError: (originalError)=>{\n        return new AppError({\n            code: \"INTERNAL_ERROR\",\n            message: \"Internal server error\",\n            details:  true ? originalError : 0,\n            statusCode: 500,\n            isRetryable: false,\n            userMessage: {\n                ja: \"システムエラーが発生しました。しばらく後にお試しください。\",\n                en: \"A system error occurred. Please try again later.\",\n                zh: \"系统错误。请稍后再试。\",\n                ko: \"시스템 오류가 발생했습니다. 나중에 다시 시도해주세요.\"\n            }\n        });\n    }\n};\n// Error handler for API responses\nconst handleApiError = (error, language = \"ja\")=>{\n    if (error instanceof AppError) {\n        return {\n            success: false,\n            error: error.getUserMessage(language),\n            code: error.code,\n            retryable: error.isRetryable\n        };\n    }\n    // Handle unknown errors\n    const internalError = ErrorFactory.internalError(error);\n    return {\n        success: false,\n        error: internalError.getUserMessage(language),\n        code: internalError.code,\n        retryable: internalError.isRetryable\n    };\n};\n// Utility to safely extract error information\nconst extractErrorInfo = (error)=>{\n    if (error instanceof Error) {\n        return {\n            message: error.message,\n            stack: error.stack,\n            details: error instanceof AppError ? error.details : undefined\n        };\n    }\n    if (typeof error === \"string\") {\n        return {\n            message: error\n        };\n    }\n    if (typeof error === \"object\" && error !== null) {\n        return {\n            message: error.message || \"Unknown error\",\n            details: error\n        };\n    }\n    return {\n        message: \"Unknown error occurred\"\n    };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2Vycm9ycy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBLHFDQUFxQzs7VUFFekJBO0lBQ1YsaUNBQWlDOzs7SUFJakMsYUFBYTs7Ozs7SUFNYixvQkFBb0I7Ozs7SUFLcEIsZ0JBQWdCOzs7O0lBS2hCLG1CQUFtQjs7OztJQUtuQixTQUFTOzs7O0dBMUJDQSxjQUFBQTtBQXlDTCxNQUFNQyxpQkFBaUJDO0lBTzVCQyxZQUFZQyxZQUEwQixDQUFFO1FBQ3RDLEtBQUssQ0FBQ0EsYUFBYUMsT0FBTztRQUMxQixJQUFJLENBQUNDLElBQUksR0FBRztRQUNaLElBQUksQ0FBQ0MsSUFBSSxHQUFHSCxhQUFhRyxJQUFJO1FBQzdCLElBQUksQ0FBQ0MsVUFBVSxHQUFHSixhQUFhSSxVQUFVO1FBQ3pDLElBQUksQ0FBQ0MsV0FBVyxHQUFHTCxhQUFhSyxXQUFXO1FBQzNDLElBQUksQ0FBQ0MsT0FBTyxHQUFHTixhQUFhTSxPQUFPO1FBQ25DLElBQUksQ0FBQ0MsV0FBVyxHQUFHUCxhQUFhTyxXQUFXO1FBRTNDLDhEQUE4RDtRQUM5RFQsTUFBTVUsaUJBQWlCLENBQUMsSUFBSSxFQUFFWDtJQUNoQztJQUVBWSxTQUFTO1FBQ1AsT0FBTztZQUNMUCxNQUFNLElBQUksQ0FBQ0EsSUFBSTtZQUNmQyxNQUFNLElBQUksQ0FBQ0EsSUFBSTtZQUNmRixTQUFTLElBQUksQ0FBQ0EsT0FBTztZQUNyQkcsWUFBWSxJQUFJLENBQUNBLFVBQVU7WUFDM0JDLGFBQWEsSUFBSSxDQUFDQSxXQUFXO1lBQzdCQyxTQUFTLElBQUksQ0FBQ0EsT0FBTztZQUNyQkksT0FBTyxJQUFJLENBQUNBLEtBQUs7UUFDbkI7SUFDRjtJQUVBQyxlQUFlQyxXQUFtQixJQUFJLEVBQVU7UUFDOUMsT0FBTyxJQUFJLENBQUNMLFdBQVcsQ0FBQ0ssU0FBUyxJQUFJLElBQUksQ0FBQ0wsV0FBVyxDQUFDTSxFQUFFLElBQUksSUFBSSxDQUFDWixPQUFPO0lBQzFFO0FBQ0Y7QUFFQSw2QkFBNkI7QUFDdEIsTUFBTWEsZUFBZTtJQUMxQkMsa0JBQWtCLENBQUNULFNBQWlCVTtRQUNsQyxPQUFPLElBQUluQixTQUFTO1lBQ2xCTSxJQUFJO1lBQ0pGLFNBQVMsQ0FBQyxtQkFBbUIsRUFBRUssUUFBUSxDQUFDO1lBQ3hDQSxTQUFTVTtZQUNUWixZQUFZO1lBQ1pDLGFBQWE7WUFDYkUsYUFBYTtnQkFDWE0sSUFBSTtnQkFDSkksSUFBSTtnQkFDSkMsSUFBSTtnQkFDSkMsSUFBSTtZQUNOO1FBQ0Y7SUFDRjtJQUVBQyxtQkFBbUIsQ0FBQ0MsYUFBcUIsRUFBRTtRQUN6QyxPQUFPLElBQUl4QixTQUFTO1lBQ2xCTSxJQUFJO1lBQ0pGLFNBQVM7WUFDVEssU0FBUztnQkFBRWU7WUFBVztZQUN0QmpCLFlBQVk7WUFDWkMsYUFBYTtZQUNiRSxhQUFhO2dCQUNYTSxJQUFJO2dCQUNKSSxJQUFJO2dCQUNKQyxJQUFJO2dCQUNKQyxJQUFJO1lBQ047UUFDRjtJQUNGO0lBRUFHLGlCQUFpQjtRQUNmLE9BQU8sSUFBSXpCLFNBQVM7WUFDbEJNLElBQUk7WUFDSkYsU0FBUztZQUNURyxZQUFZO1lBQ1pDLGFBQWE7WUFDYkUsYUFBYTtnQkFDWE0sSUFBSTtnQkFDSkksSUFBSTtnQkFDSkMsSUFBSTtnQkFDSkMsSUFBSTtZQUNOO1FBQ0Y7SUFDRjtJQUVBSSxnQkFBZ0IsQ0FBQ0M7UUFDZixNQUFNQyxlQUFlRCxlQUFldkIsU0FBU3lCLGNBQWNDLFNBQVM7UUFDcEUsTUFBTUMsZ0JBQWdCSixlQUFldkIsU0FBU3lCLGNBQWNDLFNBQVM7UUFFckUsSUFBSUYsY0FBYztZQUNoQixPQUFPLElBQUk1QixTQUFTO2dCQUNsQk0sSUFBSTtnQkFDSkYsU0FBUztnQkFDVEssU0FBU2tCO2dCQUNUcEIsWUFBWTtnQkFDWkMsYUFBYTtnQkFDYkUsYUFBYTtvQkFDWE0sSUFBSTtvQkFDSkksSUFBSTtvQkFDSkMsSUFBSTtvQkFDSkMsSUFBSTtnQkFDTjtZQUNGO1FBQ0Y7UUFFQSxJQUFJUyxlQUFlO1lBQ2pCLE9BQU8sSUFBSS9CLFNBQVM7Z0JBQ2xCTSxJQUFJO2dCQUNKRixTQUFTO2dCQUNUSyxTQUFTa0I7Z0JBQ1RwQixZQUFZO2dCQUNaQyxhQUFhO2dCQUNiRSxhQUFhO29CQUNYTSxJQUFJO29CQUNKSSxJQUFJO29CQUNKQyxJQUFJO29CQUNKQyxJQUFJO2dCQUNOO1lBQ0Y7UUFDRjtRQUVBLE9BQU8sSUFBSXRCLFNBQVM7WUFDbEJNLElBQUk7WUFDSkYsU0FBUztZQUNUSyxTQUFTa0I7WUFDVHBCLFlBQVk7WUFDWkMsYUFBYTtZQUNiRSxhQUFhO2dCQUNYTSxJQUFJO2dCQUNKSSxJQUFJO2dCQUNKQyxJQUFJO2dCQUNKQyxJQUFJO1lBQ047UUFDRjtJQUNGO0lBRUFVLGNBQWMsQ0FBQ0w7UUFDYixPQUFPLElBQUkzQixTQUFTO1lBQ2xCTSxJQUFJO1lBQ0pGLFNBQVM7WUFDVEssU0FBU2tCO1lBQ1RwQixZQUFZO1lBQ1pDLGFBQWE7WUFDYkUsYUFBYTtnQkFDWE0sSUFBSTtnQkFDSkksSUFBSTtnQkFDSkMsSUFBSTtnQkFDSkMsSUFBSTtZQUNOO1FBQ0Y7SUFDRjtJQUVBVyx1QkFBdUIsQ0FBQ047UUFDdEIsT0FBTyxJQUFJM0IsU0FBUztZQUNsQk0sSUFBSTtZQUNKRixTQUFTO1lBQ1RLLFNBQVNrQjtZQUNUcEIsWUFBWTtZQUNaQyxhQUFhO1lBQ2JFLGFBQWE7Z0JBQ1hNLElBQUk7Z0JBQ0pJLElBQUk7Z0JBQ0pDLElBQUk7Z0JBQ0pDLElBQUk7WUFDTjtRQUNGO0lBQ0Y7SUFFQVksZUFBZSxDQUFDUDtRQUNkLE9BQU8sSUFBSTNCLFNBQVM7WUFDbEJNLElBQUk7WUFDSkYsU0FBUztZQUNUSyxTQUFTMEIsS0FBeUIsR0FBZ0JSLGdCQUFnQlMsQ0FBU0E7WUFDM0U3QixZQUFZO1lBQ1pDLGFBQWE7WUFDYkUsYUFBYTtnQkFDWE0sSUFBSTtnQkFDSkksSUFBSTtnQkFDSkMsSUFBSTtnQkFDSkMsSUFBSTtZQUNOO1FBQ0Y7SUFDRjtBQUNGLEVBQUU7QUFFRixrQ0FBa0M7QUFDM0IsTUFBTWUsaUJBQWlCLENBQUNDLE9BQVl2QixXQUFtQixJQUFJO0lBQ2hFLElBQUl1QixpQkFBaUJ0QyxVQUFVO1FBQzdCLE9BQU87WUFDTHVDLFNBQVM7WUFDVEQsT0FBT0EsTUFBTXhCLGNBQWMsQ0FBQ0M7WUFDNUJULE1BQU1nQyxNQUFNaEMsSUFBSTtZQUNoQmtDLFdBQVdGLE1BQU05QixXQUFXO1FBQzlCO0lBQ0Y7SUFFQSx3QkFBd0I7SUFDeEIsTUFBTTBCLGdCQUFnQmpCLGFBQWFpQixhQUFhLENBQUNJO0lBQ2pELE9BQU87UUFDTEMsU0FBUztRQUNURCxPQUFPSixjQUFjcEIsY0FBYyxDQUFDQztRQUNwQ1QsTUFBTTRCLGNBQWM1QixJQUFJO1FBQ3hCa0MsV0FBV04sY0FBYzFCLFdBQVc7SUFDdEM7QUFDRixFQUFFO0FBRUYsOENBQThDO0FBQ3ZDLE1BQU1pQyxtQkFBbUIsQ0FBQ0g7SUFDL0IsSUFBSUEsaUJBQWlCckMsT0FBTztRQUMxQixPQUFPO1lBQ0xHLFNBQVNrQyxNQUFNbEMsT0FBTztZQUN0QlMsT0FBT3lCLE1BQU16QixLQUFLO1lBQ2xCSixTQUFTNkIsaUJBQWlCdEMsV0FBV3NDLE1BQU03QixPQUFPLEdBQUcyQjtRQUN2RDtJQUNGO0lBRUEsSUFBSSxPQUFPRSxVQUFVLFVBQVU7UUFDN0IsT0FBTztZQUFFbEMsU0FBU2tDO1FBQU07SUFDMUI7SUFFQSxJQUFJLE9BQU9BLFVBQVUsWUFBWUEsVUFBVSxNQUFNO1FBQy9DLE9BQU87WUFDTGxDLFNBQVNrQyxNQUFNbEMsT0FBTyxJQUFJO1lBQzFCSyxTQUFTNkI7UUFDWDtJQUNGO0lBRUEsT0FBTztRQUFFbEMsU0FBUztJQUF5QjtBQUM3QyxFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdG9reW8tb3BlbmRhdGEtaGFja2F0aG9uLy4vc3JjL2xpYi9lcnJvcnMudHM/NDUxYSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTdGFuZGFyZGl6ZWQgZXJyb3IgaGFuZGxpbmcgc3lzdGVtXG5cbmV4cG9ydCBlbnVtIEVycm9yQ29kZSB7XG4gIC8vIEF1dGhlbnRpY2F0aW9uICYgQXV0aG9yaXphdGlvblxuICBJTlZBTElEX0FQSV9LRVkgPSAnSU5WQUxJRF9BUElfS0VZJyxcbiAgUkFURV9MSU1JVF9FWENFRURFRCA9ICdSQVRFX0xJTUlUX0VYQ0VFREVEJyxcbiAgXG4gIC8vIFZhbGlkYXRpb25cbiAgVkFMSURBVElPTl9GQUlMRUQgPSAnVkFMSURBVElPTl9GQUlMRUQnLFxuICBJTlZBTElEX0lOUFVUID0gJ0lOVkFMSURfSU5QVVQnLFxuICBJTlZBTElEX1NFU1NJT04gPSAnSU5WQUxJRF9TRVNTSU9OJyxcbiAgU0VTU0lPTl9OT1RfRk9VTkQgPSAnU0VTU0lPTl9OT1RfRk9VTkQnLFxuICBcbiAgLy8gRXh0ZXJuYWwgU2VydmljZXNcbiAgR0VNSU5JX0FQSV9FUlJPUiA9ICdHRU1JTklfQVBJX0VSUk9SJyxcbiAgR0VNSU5JX1FVT1RBX0VYQ0VFREVEID0gJ0dFTUlOSV9RVU9UQV9FWENFRURFRCcsXG4gIEdFTUlOSV9VTkFWQUlMQUJMRSA9ICdHRU1JTklfVU5BVkFJTEFCTEUnLFxuICBcbiAgLy8gRGF0YSAmIFNlYXJjaFxuICBTRUFSQ0hfRkFJTEVEID0gJ1NFQVJDSF9GQUlMRUQnLFxuICBEQVRBX0ZFVENIX0ZBSUxFRCA9ICdEQVRBX0ZFVENIX0ZBSUxFRCcsXG4gIElOREVYX0lOSVRJQUxJWkFUSU9OX0ZBSUxFRCA9ICdJTkRFWF9JTklUSUFMSVpBVElPTl9GQUlMRUQnLFxuICBcbiAgLy8gQXVkaW8gUHJvY2Vzc2luZ1xuICBBVURJT19QUk9DRVNTSU5HX0ZBSUxFRCA9ICdBVURJT19QUk9DRVNTSU5HX0ZBSUxFRCcsXG4gIFVOU1VQUE9SVEVEX0FVRElPX0ZPUk1BVCA9ICdVTlNVUFBPUlRFRF9BVURJT19GT1JNQVQnLFxuICBBVURJT19UT09fTEFSR0UgPSAnQVVESU9fVE9PX0xBUkdFJyxcbiAgXG4gIC8vIFN5c3RlbVxuICBJTlRFUk5BTF9FUlJPUiA9ICdJTlRFUk5BTF9FUlJPUicsXG4gIFNFUlZJQ0VfVU5BVkFJTEFCTEUgPSAnU0VSVklDRV9VTkFWQUlMQUJMRScsXG4gIENPTkZJR1VSQVRJT05fRVJST1IgPSAnQ09ORklHVVJBVElPTl9FUlJPUicsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRXJyb3JEZXRhaWxzIHtcbiAgY29kZTogRXJyb3JDb2RlO1xuICBtZXNzYWdlOiBzdHJpbmc7XG4gIGRldGFpbHM/OiBhbnk7XG4gIHN0YXR1c0NvZGU6IG51bWJlcjtcbiAgaXNSZXRyeWFibGU6IGJvb2xlYW47XG4gIHVzZXJNZXNzYWdlOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+OyAvLyBNdWx0aS1sYW5ndWFnZSB1c2VyIG1lc3NhZ2VzXG59XG5cbmV4cG9ydCBjbGFzcyBBcHBFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgcHVibGljIHJlYWRvbmx5IGNvZGU6IEVycm9yQ29kZTtcbiAgcHVibGljIHJlYWRvbmx5IHN0YXR1c0NvZGU6IG51bWJlcjtcbiAgcHVibGljIHJlYWRvbmx5IGlzUmV0cnlhYmxlOiBib29sZWFuO1xuICBwdWJsaWMgcmVhZG9ubHkgZGV0YWlscz86IGFueTtcbiAgcHVibGljIHJlYWRvbmx5IHVzZXJNZXNzYWdlOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xuXG4gIGNvbnN0cnVjdG9yKGVycm9yRGV0YWlsczogRXJyb3JEZXRhaWxzKSB7XG4gICAgc3VwZXIoZXJyb3JEZXRhaWxzLm1lc3NhZ2UpO1xuICAgIHRoaXMubmFtZSA9ICdBcHBFcnJvcic7XG4gICAgdGhpcy5jb2RlID0gZXJyb3JEZXRhaWxzLmNvZGU7XG4gICAgdGhpcy5zdGF0dXNDb2RlID0gZXJyb3JEZXRhaWxzLnN0YXR1c0NvZGU7XG4gICAgdGhpcy5pc1JldHJ5YWJsZSA9IGVycm9yRGV0YWlscy5pc1JldHJ5YWJsZTtcbiAgICB0aGlzLmRldGFpbHMgPSBlcnJvckRldGFpbHMuZGV0YWlscztcbiAgICB0aGlzLnVzZXJNZXNzYWdlID0gZXJyb3JEZXRhaWxzLnVzZXJNZXNzYWdlO1xuICAgIFxuICAgIC8vIE1haW50YWlucyBwcm9wZXIgc3RhY2sgdHJhY2UgZm9yIHdoZXJlIG91ciBlcnJvciB3YXMgdGhyb3duXG4gICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgQXBwRXJyb3IpO1xuICB9XG5cbiAgdG9KU09OKCkge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgICBjb2RlOiB0aGlzLmNvZGUsXG4gICAgICBtZXNzYWdlOiB0aGlzLm1lc3NhZ2UsXG4gICAgICBzdGF0dXNDb2RlOiB0aGlzLnN0YXR1c0NvZGUsXG4gICAgICBpc1JldHJ5YWJsZTogdGhpcy5pc1JldHJ5YWJsZSxcbiAgICAgIGRldGFpbHM6IHRoaXMuZGV0YWlscyxcbiAgICAgIHN0YWNrOiB0aGlzLnN0YWNrLFxuICAgIH07XG4gIH1cblxuICBnZXRVc2VyTWVzc2FnZShsYW5ndWFnZTogc3RyaW5nID0gJ2phJyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMudXNlck1lc3NhZ2VbbGFuZ3VhZ2VdIHx8IHRoaXMudXNlck1lc3NhZ2UuamEgfHwgdGhpcy5tZXNzYWdlO1xuICB9XG59XG5cbi8vIFByZWRlZmluZWQgZXJyb3IgZmFjdG9yaWVzXG5leHBvcnQgY29uc3QgRXJyb3JGYWN0b3J5ID0ge1xuICB2YWxpZGF0aW9uRmFpbGVkOiAoZGV0YWlsczogc3RyaW5nLCB2YWxpZGF0aW9uRXJyb3JzPzogc3RyaW5nW10pOiBBcHBFcnJvciA9PiB7XG4gICAgcmV0dXJuIG5ldyBBcHBFcnJvcih7XG4gICAgICBjb2RlOiBFcnJvckNvZGUuVkFMSURBVElPTl9GQUlMRUQsXG4gICAgICBtZXNzYWdlOiBgVmFsaWRhdGlvbiBmYWlsZWQ6ICR7ZGV0YWlsc31gLFxuICAgICAgZGV0YWlsczogdmFsaWRhdGlvbkVycm9ycyxcbiAgICAgIHN0YXR1c0NvZGU6IDQwMCxcbiAgICAgIGlzUmV0cnlhYmxlOiBmYWxzZSxcbiAgICAgIHVzZXJNZXNzYWdlOiB7XG4gICAgICAgIGphOiAn5YWl5Yqb5YaF5a6544Gr5ZWP6aGM44GM44GC44KK44G+44GZ44CC5q2j44GX44GE5b2i5byP44Gn5YWl5Yqb44GX44Gm44GP44Gg44GV44GE44CCJyxcbiAgICAgICAgZW46ICdUaGVyZSBpcyBhbiBpc3N1ZSB3aXRoIHlvdXIgaW5wdXQuIFBsZWFzZSBlbnRlciBpbiB0aGUgY29ycmVjdCBmb3JtYXQuJyxcbiAgICAgICAgemg6ICfovpPlhaXlhoXlrrnmnInpl67popjjgILor7fku6XmraPnoa7moLzlvI/ovpPlhaXjgIInLFxuICAgICAgICBrbzogJ+yeheugpSDrgrTsmqnsl5Ag66y47KCc6rCAIOyeiOyKteuLiOuLpC4g7Jis67CU66W4IO2YleyLneycvOuhnCDsnoXroKXtlbTso7zshLjsmpQuJyxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0sXG5cbiAgcmF0ZUxpbWl0RXhjZWVkZWQ6IChyZXRyeUFmdGVyOiBudW1iZXIgPSA2MCk6IEFwcEVycm9yID0+IHtcbiAgICByZXR1cm4gbmV3IEFwcEVycm9yKHtcbiAgICAgIGNvZGU6IEVycm9yQ29kZS5SQVRFX0xJTUlUX0VYQ0VFREVELFxuICAgICAgbWVzc2FnZTogJ1JhdGUgbGltaXQgZXhjZWVkZWQnLFxuICAgICAgZGV0YWlsczogeyByZXRyeUFmdGVyIH0sXG4gICAgICBzdGF0dXNDb2RlOiA0MjksXG4gICAgICBpc1JldHJ5YWJsZTogdHJ1ZSxcbiAgICAgIHVzZXJNZXNzYWdlOiB7XG4gICAgICAgIGphOiAn44Oq44Kv44Ko44K544OI44GM5aSa44GZ44GO44G+44GZ44CC44GX44Gw44KJ44GP44GK5b6F44Gh44GP44Gg44GV44GE44CCJyxcbiAgICAgICAgZW46ICdUb28gbWFueSByZXF1ZXN0cy4gUGxlYXNlIHdhaXQgYSBtb21lbnQuJyxcbiAgICAgICAgemg6ICfor7fmsYLov4flpJrjgILor7fnqI3nrYnjgIInLFxuICAgICAgICBrbzogJ+yalOyyreydtCDrhIjrrLQg66eO7Iq164uI64ukLiDsnqDsi5wg6riw64uk66CkIOyjvOyEuOyalC4nLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSxcblxuICBzZXNzaW9uTm90Rm91bmQ6ICgpOiBBcHBFcnJvciA9PiB7XG4gICAgcmV0dXJuIG5ldyBBcHBFcnJvcih7XG4gICAgICBjb2RlOiBFcnJvckNvZGUuU0VTU0lPTl9OT1RfRk9VTkQsXG4gICAgICBtZXNzYWdlOiAnU2Vzc2lvbiBub3QgZm91bmQgb3IgZXhwaXJlZCcsXG4gICAgICBzdGF0dXNDb2RlOiA0MDQsXG4gICAgICBpc1JldHJ5YWJsZTogZmFsc2UsXG4gICAgICB1c2VyTWVzc2FnZToge1xuICAgICAgICBqYTogJ+OCu+ODg+OCt+ODp+ODs+OBjOimi+OBpOOBi+OCieOBquOBhOOBi+acn+mZkOWIh+OCjOOBp+OBmeOAguaWsOOBl+OBhOOCu+ODg+OCt+ODp+ODs+OCkuS9nOaIkOOBl+OBpuOBj+OBoOOBleOBhOOAgicsXG4gICAgICAgIGVuOiAnU2Vzc2lvbiBub3QgZm91bmQgb3IgZXhwaXJlZC4gUGxlYXNlIGNyZWF0ZSBhIG5ldyBzZXNzaW9uLicsXG4gICAgICAgIHpoOiAn5Lya6K+d5pyq5om+5Yiw5oiW5bey6L+H5pyf44CC6K+35Yib5bu65paw5Lya6K+d44CCJyxcbiAgICAgICAga286ICfshLjshZjsnYQg7LC+7J2EIOyImCDsl4bqsbDrgpgg66eM66OM65CY7JeI7Iq164uI64ukLiDsg4gg7IS47IWY7J2EIOunjOuTpOyWtOyjvOyEuOyalC4nLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSxcblxuICBnZW1pbmlBcGlFcnJvcjogKG9yaWdpbmFsRXJyb3I6IGFueSk6IEFwcEVycm9yID0+IHtcbiAgICBjb25zdCBpc1F1b3RhRXJyb3IgPSBvcmlnaW5hbEVycm9yPy5tZXNzYWdlPy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdxdW90YScpO1xuICAgIGNvbnN0IGlzVW5hdmFpbGFibGUgPSBvcmlnaW5hbEVycm9yPy5tZXNzYWdlPy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCd1bmF2YWlsYWJsZScpO1xuICAgIFxuICAgIGlmIChpc1F1b3RhRXJyb3IpIHtcbiAgICAgIHJldHVybiBuZXcgQXBwRXJyb3Ioe1xuICAgICAgICBjb2RlOiBFcnJvckNvZGUuR0VNSU5JX1FVT1RBX0VYQ0VFREVELFxuICAgICAgICBtZXNzYWdlOiAnR2VtaW5pIEFQSSBxdW90YSBleGNlZWRlZCcsXG4gICAgICAgIGRldGFpbHM6IG9yaWdpbmFsRXJyb3IsXG4gICAgICAgIHN0YXR1c0NvZGU6IDUwMyxcbiAgICAgICAgaXNSZXRyeWFibGU6IHRydWUsXG4gICAgICAgIHVzZXJNZXNzYWdlOiB7XG4gICAgICAgICAgamE6ICdBSeOCteODvOODk+OCueOBruWIqeeUqOWItumZkOOBq+mBlOOBl+OBvuOBl+OBn+OAguOBl+OBsOOCieOBj+W+jOOBq+OBiuippuOBl+OBj+OBoOOBleOBhOOAgicsXG4gICAgICAgICAgZW46ICdBSSBzZXJ2aWNlIHVzYWdlIGxpbWl0IHJlYWNoZWQuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuJyxcbiAgICAgICAgICB6aDogJ0FJ5pyN5Yqh5L2/55So6ZmQ5Yi25bey6L6+5Yiw44CC6K+356iN5ZCO5YaN6K+V44CCJyxcbiAgICAgICAgICBrbzogJ0FJIOyEnOu5hOyKpCDsgqzsmqkg7ZWc64+E7JeQIOuPhOuLrO2WiOyKteuLiOuLpC4g64KY7KSR7JeQIOuLpOyLnCDsi5zrj4TtlbTso7zshLjsmpQuJyxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBpZiAoaXNVbmF2YWlsYWJsZSkge1xuICAgICAgcmV0dXJuIG5ldyBBcHBFcnJvcih7XG4gICAgICAgIGNvZGU6IEVycm9yQ29kZS5HRU1JTklfVU5BVkFJTEFCTEUsXG4gICAgICAgIG1lc3NhZ2U6ICdHZW1pbmkgQVBJIHRlbXBvcmFyaWx5IHVuYXZhaWxhYmxlJyxcbiAgICAgICAgZGV0YWlsczogb3JpZ2luYWxFcnJvcixcbiAgICAgICAgc3RhdHVzQ29kZTogNTAzLFxuICAgICAgICBpc1JldHJ5YWJsZTogdHJ1ZSxcbiAgICAgICAgdXNlck1lc3NhZ2U6IHtcbiAgICAgICAgICBqYTogJ0FJ44K144O844OT44K544GM5LiA5pmC55qE44Gr5Yip55So44Gn44GN44G+44Gb44KT44CC44GX44Gw44KJ44GP5b6M44Gr44GK6Kmm44GX44GP44Gg44GV44GE44CCJyxcbiAgICAgICAgICBlbjogJ0FJIHNlcnZpY2UgaXMgdGVtcG9yYXJpbHkgdW5hdmFpbGFibGUuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuJyxcbiAgICAgICAgICB6aDogJ0FJ5pyN5Yqh5pqC5pe25LiN5Y+v55So44CC6K+356iN5ZCO5YaN6K+V44CCJyxcbiAgICAgICAgICBrbzogJ0FJIOyEnOu5hOyKpOqwgCDsnbzsi5zsoIHsnLzroZwg7IKs7Jqp7ZWgIOyImCDsl4bsirXri4jri6QuIOuCmOykkeyXkCDri6Tsi5wg7Iuc64+E7ZW07KO87IS47JqULicsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIG5ldyBBcHBFcnJvcih7XG4gICAgICBjb2RlOiBFcnJvckNvZGUuR0VNSU5JX0FQSV9FUlJPUixcbiAgICAgIG1lc3NhZ2U6ICdHZW1pbmkgQVBJIGVycm9yJyxcbiAgICAgIGRldGFpbHM6IG9yaWdpbmFsRXJyb3IsXG4gICAgICBzdGF0dXNDb2RlOiA1MDAsXG4gICAgICBpc1JldHJ5YWJsZTogZmFsc2UsXG4gICAgICB1c2VyTWVzc2FnZToge1xuICAgICAgICBqYTogJ0FJ44K144O844OT44K544Gn44Ko44Op44O844GM55m655Sf44GX44G+44GX44Gf44CCJyxcbiAgICAgICAgZW46ICdBbiBlcnJvciBvY2N1cnJlZCB3aXRoIHRoZSBBSSBzZXJ2aWNlLicsXG4gICAgICAgIHpoOiAnQUnmnI3liqHlj5HnlJ/plJnor6/jgIInLFxuICAgICAgICBrbzogJ0FJIOyEnOu5hOyKpOyXkOyEnCDsmKTrpZjqsIAg67Cc7IOd7ZaI7Iq164uI64ukLicsXG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuXG4gIHNlYXJjaEZhaWxlZDogKG9yaWdpbmFsRXJyb3I6IGFueSk6IEFwcEVycm9yID0+IHtcbiAgICByZXR1cm4gbmV3IEFwcEVycm9yKHtcbiAgICAgIGNvZGU6IEVycm9yQ29kZS5TRUFSQ0hfRkFJTEVELFxuICAgICAgbWVzc2FnZTogJ1NlYXJjaCBvcGVyYXRpb24gZmFpbGVkJyxcbiAgICAgIGRldGFpbHM6IG9yaWdpbmFsRXJyb3IsXG4gICAgICBzdGF0dXNDb2RlOiA1MDAsXG4gICAgICBpc1JldHJ5YWJsZTogdHJ1ZSxcbiAgICAgIHVzZXJNZXNzYWdlOiB7XG4gICAgICAgIGphOiAn5qSc57Si5Yem55CG44Gn44Ko44Op44O844GM55m655Sf44GX44G+44GX44Gf44CCJyxcbiAgICAgICAgZW46ICdBbiBlcnJvciBvY2N1cnJlZCBkdXJpbmcgc2VhcmNoLicsXG4gICAgICAgIHpoOiAn5pCc57Si5aSE55CG5Lit5Y+R55Sf6ZSZ6K+v44CCJyxcbiAgICAgICAga286ICfqsoDsg4kg7LKY66asIOykkSDsmKTrpZjqsIAg67Cc7IOd7ZaI7Iq164uI64ukLicsXG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuXG4gIGF1ZGlvUHJvY2Vzc2luZ0ZhaWxlZDogKG9yaWdpbmFsRXJyb3I6IGFueSk6IEFwcEVycm9yID0+IHtcbiAgICByZXR1cm4gbmV3IEFwcEVycm9yKHtcbiAgICAgIGNvZGU6IEVycm9yQ29kZS5BVURJT19QUk9DRVNTSU5HX0ZBSUxFRCxcbiAgICAgIG1lc3NhZ2U6ICdBdWRpbyBwcm9jZXNzaW5nIGZhaWxlZCcsXG4gICAgICBkZXRhaWxzOiBvcmlnaW5hbEVycm9yLFxuICAgICAgc3RhdHVzQ29kZTogNTAwLFxuICAgICAgaXNSZXRyeWFibGU6IHRydWUsXG4gICAgICB1c2VyTWVzc2FnZToge1xuICAgICAgICBqYTogJ+mfs+WjsOWHpueQhuOBp+OCqOODqeODvOOBjOeZuueUn+OBl+OBvuOBl+OBn+OAgicsXG4gICAgICAgIGVuOiAnQW4gZXJyb3Igb2NjdXJyZWQgZHVyaW5nIGF1ZGlvIHByb2Nlc3NpbmcuJyxcbiAgICAgICAgemg6ICfpn7PpopHlpITnkIbkuK3lj5HnlJ/plJnor6/jgIInLFxuICAgICAgICBrbzogJ+ydjOyEsSDsspjrpqwg7KSRIOyYpOulmOqwgCDrsJzsg53tlojsirXri4jri6QuJyxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0sXG5cbiAgaW50ZXJuYWxFcnJvcjogKG9yaWdpbmFsRXJyb3I6IGFueSk6IEFwcEVycm9yID0+IHtcbiAgICByZXR1cm4gbmV3IEFwcEVycm9yKHtcbiAgICAgIGNvZGU6IEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUixcbiAgICAgIG1lc3NhZ2U6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgZGV0YWlsczogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBvcmlnaW5hbEVycm9yIDogdW5kZWZpbmVkLFxuICAgICAgc3RhdHVzQ29kZTogNTAwLFxuICAgICAgaXNSZXRyeWFibGU6IGZhbHNlLFxuICAgICAgdXNlck1lc3NhZ2U6IHtcbiAgICAgICAgamE6ICfjgrfjgrnjg4bjg6Djgqjjg6njg7zjgYznmbrnlJ/jgZfjgb7jgZfjgZ/jgILjgZfjgbDjgonjgY/lvozjgavjgYroqabjgZfjgY/jgaDjgZXjgYTjgIInLFxuICAgICAgICBlbjogJ0Egc3lzdGVtIGVycm9yIG9jY3VycmVkLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLicsXG4gICAgICAgIHpoOiAn57O757uf6ZSZ6K+v44CC6K+356iN5ZCO5YaN6K+V44CCJyxcbiAgICAgICAga286ICfsi5zsiqTthZwg7Jik66WY6rCAIOuwnOyDne2WiOyKteuLiOuLpC4g64KY7KSR7JeQIOuLpOyLnCDsi5zrj4TtlbTso7zshLjsmpQuJyxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0sXG59O1xuXG4vLyBFcnJvciBoYW5kbGVyIGZvciBBUEkgcmVzcG9uc2VzXG5leHBvcnQgY29uc3QgaGFuZGxlQXBpRXJyb3IgPSAoZXJyb3I6IGFueSwgbGFuZ3VhZ2U6IHN0cmluZyA9ICdqYScpID0+IHtcbiAgaWYgKGVycm9yIGluc3RhbmNlb2YgQXBwRXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogZXJyb3IuZ2V0VXNlck1lc3NhZ2UobGFuZ3VhZ2UpLFxuICAgICAgY29kZTogZXJyb3IuY29kZSxcbiAgICAgIHJldHJ5YWJsZTogZXJyb3IuaXNSZXRyeWFibGUsXG4gICAgfTtcbiAgfVxuICBcbiAgLy8gSGFuZGxlIHVua25vd24gZXJyb3JzXG4gIGNvbnN0IGludGVybmFsRXJyb3IgPSBFcnJvckZhY3RvcnkuaW50ZXJuYWxFcnJvcihlcnJvcik7XG4gIHJldHVybiB7XG4gICAgc3VjY2VzczogZmFsc2UsXG4gICAgZXJyb3I6IGludGVybmFsRXJyb3IuZ2V0VXNlck1lc3NhZ2UobGFuZ3VhZ2UpLFxuICAgIGNvZGU6IGludGVybmFsRXJyb3IuY29kZSxcbiAgICByZXRyeWFibGU6IGludGVybmFsRXJyb3IuaXNSZXRyeWFibGUsXG4gIH07XG59O1xuXG4vLyBVdGlsaXR5IHRvIHNhZmVseSBleHRyYWN0IGVycm9yIGluZm9ybWF0aW9uXG5leHBvcnQgY29uc3QgZXh0cmFjdEVycm9ySW5mbyA9IChlcnJvcjogYW55KTogeyBtZXNzYWdlOiBzdHJpbmc7IHN0YWNrPzogc3RyaW5nOyBkZXRhaWxzPzogYW55IH0gPT4ge1xuICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgIHJldHVybiB7XG4gICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgc3RhY2s6IGVycm9yLnN0YWNrLFxuICAgICAgZGV0YWlsczogZXJyb3IgaW5zdGFuY2VvZiBBcHBFcnJvciA/IGVycm9yLmRldGFpbHMgOiB1bmRlZmluZWQsXG4gICAgfTtcbiAgfVxuICBcbiAgaWYgKHR5cGVvZiBlcnJvciA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4geyBtZXNzYWdlOiBlcnJvciB9O1xuICB9XG4gIFxuICBpZiAodHlwZW9mIGVycm9yID09PSAnb2JqZWN0JyAmJiBlcnJvciAhPT0gbnVsbCkge1xuICAgIHJldHVybiB7XG4gICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdVbmtub3duIGVycm9yJyxcbiAgICAgIGRldGFpbHM6IGVycm9yLFxuICAgIH07XG4gIH1cbiAgXG4gIHJldHVybiB7IG1lc3NhZ2U6ICdVbmtub3duIGVycm9yIG9jY3VycmVkJyB9O1xufTsiXSwibmFtZXMiOlsiRXJyb3JDb2RlIiwiQXBwRXJyb3IiLCJFcnJvciIsImNvbnN0cnVjdG9yIiwiZXJyb3JEZXRhaWxzIiwibWVzc2FnZSIsIm5hbWUiLCJjb2RlIiwic3RhdHVzQ29kZSIsImlzUmV0cnlhYmxlIiwiZGV0YWlscyIsInVzZXJNZXNzYWdlIiwiY2FwdHVyZVN0YWNrVHJhY2UiLCJ0b0pTT04iLCJzdGFjayIsImdldFVzZXJNZXNzYWdlIiwibGFuZ3VhZ2UiLCJqYSIsIkVycm9yRmFjdG9yeSIsInZhbGlkYXRpb25GYWlsZWQiLCJ2YWxpZGF0aW9uRXJyb3JzIiwiZW4iLCJ6aCIsImtvIiwicmF0ZUxpbWl0RXhjZWVkZWQiLCJyZXRyeUFmdGVyIiwic2Vzc2lvbk5vdEZvdW5kIiwiZ2VtaW5pQXBpRXJyb3IiLCJvcmlnaW5hbEVycm9yIiwiaXNRdW90YUVycm9yIiwidG9Mb3dlckNhc2UiLCJpbmNsdWRlcyIsImlzVW5hdmFpbGFibGUiLCJzZWFyY2hGYWlsZWQiLCJhdWRpb1Byb2Nlc3NpbmdGYWlsZWQiLCJpbnRlcm5hbEVycm9yIiwicHJvY2VzcyIsInVuZGVmaW5lZCIsImhhbmRsZUFwaUVycm9yIiwiZXJyb3IiLCJzdWNjZXNzIiwicmV0cnlhYmxlIiwiZXh0cmFjdEVycm9ySW5mbyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/errors.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/logger.ts":
/*!***************************!*\
  !*** ./src/lib/logger.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LogLevel: () => (/* binding */ LogLevel),\n/* harmony export */   PerformanceTimer: () => (/* binding */ PerformanceTimer),\n/* harmony export */   generateRequestId: () => (/* binding */ generateRequestId),\n/* harmony export */   log: () => (/* binding */ log),\n/* harmony export */   logger: () => (/* binding */ logger)\n/* harmony export */ });\n// Enhanced logging system with multiple levels and structured logging\nvar LogLevel;\n(function(LogLevel) {\n    LogLevel[LogLevel[\"DEBUG\"] = 0] = \"DEBUG\";\n    LogLevel[LogLevel[\"INFO\"] = 1] = \"INFO\";\n    LogLevel[LogLevel[\"WARN\"] = 2] = \"WARN\";\n    LogLevel[LogLevel[\"ERROR\"] = 3] = \"ERROR\";\n    LogLevel[LogLevel[\"FATAL\"] = 4] = \"FATAL\";\n})(LogLevel || (LogLevel = {}));\nclass Logger {\n    constructor(){\n        this.logs = [];\n        this.maxLogHistory = 1000;\n        this.minLevel = this.getLogLevel();\n    }\n    getLogLevel() {\n        const level = process.env.LOG_LEVEL?.toUpperCase() || \"INFO\";\n        switch(level){\n            case \"DEBUG\":\n                return 0;\n            case \"INFO\":\n                return 1;\n            case \"WARN\":\n                return 2;\n            case \"ERROR\":\n                return 3;\n            case \"FATAL\":\n                return 4;\n            default:\n                return 1;\n        }\n    }\n    shouldLog(level) {\n        return level >= this.minLevel;\n    }\n    formatMessage(entry) {\n        const timestamp = entry.timestamp.toISOString();\n        const level = LogLevel[entry.level].padEnd(5);\n        const context = entry.context ? ` | Context: ${JSON.stringify(entry.context)}` : \"\";\n        const requestId = entry.requestId ? ` | RequestID: ${entry.requestId}` : \"\";\n        const performance = entry.performance?.duration ? ` | Duration: ${entry.performance.duration}ms` : \"\";\n        return `[${timestamp}] ${level} | ${entry.message}${context}${requestId}${performance}`;\n    }\n    writeLog(entry) {\n        if (!this.shouldLog(entry.level)) {\n            return;\n        }\n        const formattedMessage = this.formatMessage(entry);\n        // Console output\n        switch(entry.level){\n            case 0:\n                console.debug(formattedMessage);\n                break;\n            case 1:\n                console.info(formattedMessage);\n                break;\n            case 2:\n                console.warn(formattedMessage);\n                break;\n            case 3:\n            case 4:\n                console.error(formattedMessage);\n                if (entry.error) {\n                    console.error(\"Stack trace:\", entry.error.stack);\n                }\n                break;\n        }\n        // Store in memory (for debugging and monitoring)\n        this.logs.push(entry);\n        if (this.logs.length > this.maxLogHistory) {\n            this.logs = this.logs.slice(-this.maxLogHistory);\n        }\n    }\n    debug(message, context, requestId) {\n        this.writeLog({\n            level: 0,\n            message,\n            timestamp: new Date(),\n            context,\n            requestId\n        });\n    }\n    info(message, context, requestId) {\n        this.writeLog({\n            level: 1,\n            message,\n            timestamp: new Date(),\n            context,\n            requestId\n        });\n    }\n    warn(message, context, requestId) {\n        this.writeLog({\n            level: 2,\n            message,\n            timestamp: new Date(),\n            context,\n            requestId\n        });\n    }\n    error(message, error, context, requestId) {\n        this.writeLog({\n            level: 3,\n            message,\n            timestamp: new Date(),\n            error,\n            context,\n            requestId\n        });\n    }\n    fatal(message, error, context, requestId) {\n        this.writeLog({\n            level: 4,\n            message,\n            timestamp: new Date(),\n            error,\n            context,\n            requestId\n        });\n    }\n    // Performance logging\n    performance(message, duration, context, requestId) {\n        this.writeLog({\n            level: 1,\n            message,\n            timestamp: new Date(),\n            context,\n            requestId,\n            performance: {\n                duration,\n                memory: process.memoryUsage()\n            }\n        });\n    }\n    // API request logging\n    apiRequest(method, path, statusCode, duration, requestId) {\n        const level = statusCode >= 400 ? 3 : 1;\n        this.writeLog({\n            level,\n            message: `API ${method} ${path} - ${statusCode}`,\n            timestamp: new Date(),\n            context: {\n                method,\n                path,\n                statusCode,\n                type: \"api_request\"\n            },\n            requestId,\n            performance: {\n                duration\n            }\n        });\n    }\n    // Security logging\n    security(event, details, requestId) {\n        this.writeLog({\n            level: 2,\n            message: `Security Event: ${event}`,\n            timestamp: new Date(),\n            context: {\n                ...details,\n                type: \"security_event\"\n            },\n            requestId\n        });\n    }\n    // Business logic logging\n    business(event, details, requestId) {\n        this.writeLog({\n            level: 1,\n            message: `Business Event: ${event}`,\n            timestamp: new Date(),\n            context: {\n                ...details,\n                type: \"business_event\"\n            },\n            requestId\n        });\n    }\n    // Get recent logs for debugging\n    getRecentLogs(count = 100) {\n        return this.logs.slice(-count);\n    }\n    // Get logs by level\n    getLogsByLevel(level, count = 100) {\n        return this.logs.filter((log)=>log.level === level).slice(-count);\n    }\n    // Get logs by time range\n    getLogsByTimeRange(from, to) {\n        return this.logs.filter((log)=>log.timestamp >= from && log.timestamp <= to);\n    }\n    // Clear logs\n    clearLogs() {\n        this.logs = [];\n        this.info(\"Log history cleared\");\n    }\n    // Get statistics\n    getStats() {\n        const logCounts = {};\n        for (const log of this.logs){\n            const levelName = LogLevel[log.level];\n            logCounts[levelName] = (logCounts[levelName] || 0) + 1;\n        }\n        return {\n            totalLogs: this.logs.length,\n            logCounts,\n            oldestLog: this.logs.length > 0 ? this.logs[0].timestamp : undefined,\n            newestLog: this.logs.length > 0 ? this.logs[this.logs.length - 1].timestamp : undefined\n        };\n    }\n}\n// Create singleton logger instance\nconst logger = new Logger();\n// Performance measurement utility\nclass PerformanceTimer {\n    constructor(name, requestId){\n        this.name = name;\n        this.requestId = requestId;\n        this.startTime = Date.now();\n    }\n    end(context) {\n        const duration = Date.now() - this.startTime;\n        logger.performance(`${this.name} completed`, duration, context, this.requestId);\n        return duration;\n    }\n}\n// Request ID generator\nconst generateRequestId = ()=>{\n    return `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n};\n// Export singleton logger\n\n// Convenience functions\nconst log = {\n    debug: (message, context, requestId)=>logger.debug(message, context, requestId),\n    info: (message, context, requestId)=>logger.info(message, context, requestId),\n    warn: (message, context, requestId)=>logger.warn(message, context, requestId),\n    error: (message, error, context, requestId)=>logger.error(message, error, context, requestId),\n    fatal: (message, error, context, requestId)=>logger.fatal(message, error, context, requestId),\n    performance: (name, requestId)=>new PerformanceTimer(name, requestId),\n    api: (method, path, statusCode, duration, requestId)=>logger.apiRequest(method, path, statusCode, duration, requestId),\n    security: (event, details, requestId)=>logger.security(event, details, requestId),\n    business: (event, details, requestId)=>logger.business(event, details, requestId)\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFFeER3QixVQUFVLENBQUNDLE9BQWVDLFNBQWtDMUIsWUFDMUQ0QyxPQUFPcEIsUUFBUSxDQUFDQyxPQUFPQyxTQUFTMUI7SUFFbEMyQixVQUFVLENBQUNGLE9BQWVDLFNBQWtDMUIsWUFDMUQ0QyxPQUFPakIsUUFBUSxDQUFDRixPQUFPQyxTQUFTMUI7QUFDcEMsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL3Rva3lvLW9wZW5kYXRhLWhhY2thdGhvbi8uL3NyYy9saWIvbG9nZ2VyLnRzP2I0OWUiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gRW5oYW5jZWQgbG9nZ2luZyBzeXN0ZW0gd2l0aCBtdWx0aXBsZSBsZXZlbHMgYW5kIHN0cnVjdHVyZWQgbG9nZ2luZ1xuXG5leHBvcnQgZW51bSBMb2dMZXZlbCB7XG4gIERFQlVHID0gMCxcbiAgSU5GTyA9IDEsXG4gIFdBUk4gPSAyLFxuICBFUlJPUiA9IDMsXG4gIEZBVEFMID0gNCxcbn1cblxuZXhwb3J0IGludGVyZmFjZSBMb2dFbnRyeSB7XG4gIGxldmVsOiBMb2dMZXZlbDtcbiAgbWVzc2FnZTogc3RyaW5nO1xuICB0aW1lc3RhbXA6IERhdGU7XG4gIGNvbnRleHQ/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgZXJyb3I/OiBFcnJvcjtcbiAgcmVxdWVzdElkPzogc3RyaW5nO1xuICB1c2VySWQ/OiBzdHJpbmc7XG4gIHBlcmZvcm1hbmNlPzoge1xuICAgIGR1cmF0aW9uPzogbnVtYmVyO1xuICAgIG1lbW9yeT86IE5vZGVKUy5NZW1vcnlVc2FnZTtcbiAgfTtcbn1cblxuY2xhc3MgTG9nZ2VyIHtcbiAgcHJpdmF0ZSBtaW5MZXZlbDogTG9nTGV2ZWw7XG4gIHByaXZhdGUgbG9nczogTG9nRW50cnlbXSA9IFtdO1xuICBwcml2YXRlIG1heExvZ0hpc3Rvcnk6IG51bWJlciA9IDEwMDA7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5taW5MZXZlbCA9IHRoaXMuZ2V0TG9nTGV2ZWwoKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0TG9nTGV2ZWwoKTogTG9nTGV2ZWwge1xuICAgIGNvbnN0IGxldmVsID0gcHJvY2Vzcy5lbnYuTE9HX0xFVkVMPy50b1VwcGVyQ2FzZSgpIHx8ICdJTkZPJztcbiAgICBzd2l0Y2ggKGxldmVsKSB7XG4gICAgICBjYXNlICdERUJVRyc6IHJldHVybiBMb2dMZXZlbC5ERUJVRztcbiAgICAgIGNhc2UgJ0lORk8nOiByZXR1cm4gTG9nTGV2ZWwuSU5GTztcbiAgICAgIGNhc2UgJ1dBUk4nOiByZXR1cm4gTG9nTGV2ZWwuV0FSTjtcbiAgICAgIGNhc2UgJ0VSUk9SJzogcmV0dXJuIExvZ0xldmVsLkVSUk9SO1xuICAgICAgY2FzZSAnRkFUQUwnOiByZXR1cm4gTG9nTGV2ZWwuRkFUQUw7XG4gICAgICBkZWZhdWx0OiByZXR1cm4gTG9nTGV2ZWwuSU5GTztcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNob3VsZExvZyhsZXZlbDogTG9nTGV2ZWwpOiBib29sZWFuIHtcbiAgICByZXR1cm4gbGV2ZWwgPj0gdGhpcy5taW5MZXZlbDtcbiAgfVxuXG4gIHByaXZhdGUgZm9ybWF0TWVzc2FnZShlbnRyeTogTG9nRW50cnkpOiBzdHJpbmcge1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IGVudHJ5LnRpbWVzdGFtcC50b0lTT1N0cmluZygpO1xuICAgIGNvbnN0IGxldmVsID0gTG9nTGV2ZWxbZW50cnkubGV2ZWxdLnBhZEVuZCg1KTtcbiAgICBjb25zdCBjb250ZXh0ID0gZW50cnkuY29udGV4dCA/IGAgfCBDb250ZXh0OiAke0pTT04uc3RyaW5naWZ5KGVudHJ5LmNvbnRleHQpfWAgOiAnJztcbiAgICBjb25zdCByZXF1ZXN0SWQgPSBlbnRyeS5yZXF1ZXN0SWQgPyBgIHwgUmVxdWVzdElEOiAke2VudHJ5LnJlcXVlc3RJZH1gIDogJyc7XG4gICAgY29uc3QgcGVyZm9ybWFuY2UgPSBlbnRyeS5wZXJmb3JtYW5jZT8uZHVyYXRpb24gXG4gICAgICA/IGAgfCBEdXJhdGlvbjogJHtlbnRyeS5wZXJmb3JtYW5jZS5kdXJhdGlvbn1tc2AgXG4gICAgICA6ICcnO1xuICAgIFxuICAgIHJldHVybiBgWyR7dGltZXN0YW1wfV0gJHtsZXZlbH0gfCAke2VudHJ5Lm1lc3NhZ2V9JHtjb250ZXh0fSR7cmVxdWVzdElkfSR7cGVyZm9ybWFuY2V9YDtcbiAgfVxuXG4gIHByaXZhdGUgd3JpdGVMb2coZW50cnk6IExvZ0VudHJ5KTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnNob3VsZExvZyhlbnRyeS5sZXZlbCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBmb3JtYXR0ZWRNZXNzYWdlID0gdGhpcy5mb3JtYXRNZXNzYWdlKGVudHJ5KTtcblxuICAgIC8vIENvbnNvbGUgb3V0cHV0XG4gICAgc3dpdGNoIChlbnRyeS5sZXZlbCkge1xuICAgICAgY2FzZSBMb2dMZXZlbC5ERUJVRzpcbiAgICAgICAgY29uc29sZS5kZWJ1Zyhmb3JtYXR0ZWRNZXNzYWdlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIExvZ0xldmVsLklORk86XG4gICAgICAgIGNvbnNvbGUuaW5mbyhmb3JtYXR0ZWRNZXNzYWdlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIExvZ0xldmVsLldBUk46XG4gICAgICAgIGNvbnNvbGUud2Fybihmb3JtYXR0ZWRNZXNzYWdlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIExvZ0xldmVsLkVSUk9SOlxuICAgICAgY2FzZSBMb2dMZXZlbC5GQVRBTDpcbiAgICAgICAgY29uc29sZS5lcnJvcihmb3JtYXR0ZWRNZXNzYWdlKTtcbiAgICAgICAgaWYgKGVudHJ5LmVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignU3RhY2sgdHJhY2U6JywgZW50cnkuZXJyb3Iuc3RhY2spO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIC8vIFN0b3JlIGluIG1lbW9yeSAoZm9yIGRlYnVnZ2luZyBhbmQgbW9uaXRvcmluZylcbiAgICB0aGlzLmxvZ3MucHVzaChlbnRyeSk7XG4gICAgaWYgKHRoaXMubG9ncy5sZW5ndGggPiB0aGlzLm1heExvZ0hpc3RvcnkpIHtcbiAgICAgIHRoaXMubG9ncyA9IHRoaXMubG9ncy5zbGljZSgtdGhpcy5tYXhMb2dIaXN0b3J5KTtcbiAgICB9XG4gIH1cblxuICBkZWJ1ZyhtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiwgcmVxdWVzdElkPzogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy53cml0ZUxvZyh7XG4gICAgICBsZXZlbDogTG9nTGV2ZWwuREVCVUcsXG4gICAgICBtZXNzYWdlLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgY29udGV4dCxcbiAgICAgIHJlcXVlc3RJZCxcbiAgICB9KTtcbiAgfVxuXG4gIGluZm8obWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogUmVjb3JkPHN0cmluZywgdW5rbm93bj4sIHJlcXVlc3RJZD86IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMud3JpdGVMb2coe1xuICAgICAgbGV2ZWw6IExvZ0xldmVsLklORk8sXG4gICAgICBtZXNzYWdlLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgY29udGV4dCxcbiAgICAgIHJlcXVlc3RJZCxcbiAgICB9KTtcbiAgfVxuXG4gIHdhcm4obWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogUmVjb3JkPHN0cmluZywgdW5rbm93bj4sIHJlcXVlc3RJZD86IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMud3JpdGVMb2coe1xuICAgICAgbGV2ZWw6IExvZ0xldmVsLldBUk4sXG4gICAgICBtZXNzYWdlLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgY29udGV4dCxcbiAgICAgIHJlcXVlc3RJZCxcbiAgICB9KTtcbiAgfVxuXG4gIGVycm9yKG1lc3NhZ2U6IHN0cmluZywgZXJyb3I/OiBFcnJvciwgY29udGV4dD86IFJlY29yZDxzdHJpbmcsIHVua25vd24+LCByZXF1ZXN0SWQ/OiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLndyaXRlTG9nKHtcbiAgICAgIGxldmVsOiBMb2dMZXZlbC5FUlJPUixcbiAgICAgIG1lc3NhZ2UsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICBlcnJvcixcbiAgICAgIGNvbnRleHQsXG4gICAgICByZXF1ZXN0SWQsXG4gICAgfSk7XG4gIH1cblxuICBmYXRhbChtZXNzYWdlOiBzdHJpbmcsIGVycm9yPzogRXJyb3IsIGNvbnRleHQ/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiwgcmVxdWVzdElkPzogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy53cml0ZUxvZyh7XG4gICAgICBsZXZlbDogTG9nTGV2ZWwuRkFUQUwsXG4gICAgICBtZXNzYWdlLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgZXJyb3IsXG4gICAgICBjb250ZXh0LFxuICAgICAgcmVxdWVzdElkLFxuICAgIH0pO1xuICB9XG5cbiAgLy8gUGVyZm9ybWFuY2UgbG9nZ2luZ1xuICBwZXJmb3JtYW5jZShtZXNzYWdlOiBzdHJpbmcsIGR1cmF0aW9uOiBudW1iZXIsIGNvbnRleHQ/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiwgcmVxdWVzdElkPzogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy53cml0ZUxvZyh7XG4gICAgICBsZXZlbDogTG9nTGV2ZWwuSU5GTyxcbiAgICAgIG1lc3NhZ2UsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICBjb250ZXh0LFxuICAgICAgcmVxdWVzdElkLFxuICAgICAgcGVyZm9ybWFuY2U6IHtcbiAgICAgICAgZHVyYXRpb24sXG4gICAgICAgIG1lbW9yeTogcHJvY2Vzcy5tZW1vcnlVc2FnZSgpLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIEFQSSByZXF1ZXN0IGxvZ2dpbmdcbiAgYXBpUmVxdWVzdChtZXRob2Q6IHN0cmluZywgcGF0aDogc3RyaW5nLCBzdGF0dXNDb2RlOiBudW1iZXIsIGR1cmF0aW9uOiBudW1iZXIsIHJlcXVlc3RJZD86IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGxldmVsID0gc3RhdHVzQ29kZSA+PSA0MDAgPyBMb2dMZXZlbC5FUlJPUiA6IExvZ0xldmVsLklORk87XG4gICAgdGhpcy53cml0ZUxvZyh7XG4gICAgICBsZXZlbCxcbiAgICAgIG1lc3NhZ2U6IGBBUEkgJHttZXRob2R9ICR7cGF0aH0gLSAke3N0YXR1c0NvZGV9YCxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgbWV0aG9kLFxuICAgICAgICBwYXRoLFxuICAgICAgICBzdGF0dXNDb2RlLFxuICAgICAgICB0eXBlOiAnYXBpX3JlcXVlc3QnLFxuICAgICAgfSxcbiAgICAgIHJlcXVlc3RJZCxcbiAgICAgIHBlcmZvcm1hbmNlOiB7XG4gICAgICAgIGR1cmF0aW9uLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFNlY3VyaXR5IGxvZ2dpbmdcbiAgc2VjdXJpdHkoZXZlbnQ6IHN0cmluZywgZGV0YWlsczogUmVjb3JkPHN0cmluZywgdW5rbm93bj4sIHJlcXVlc3RJZD86IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMud3JpdGVMb2coe1xuICAgICAgbGV2ZWw6IExvZ0xldmVsLldBUk4sXG4gICAgICBtZXNzYWdlOiBgU2VjdXJpdHkgRXZlbnQ6ICR7ZXZlbnR9YCxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgLi4uZGV0YWlscyxcbiAgICAgICAgdHlwZTogJ3NlY3VyaXR5X2V2ZW50JyxcbiAgICAgIH0sXG4gICAgICByZXF1ZXN0SWQsXG4gICAgfSk7XG4gIH1cblxuICAvLyBCdXNpbmVzcyBsb2dpYyBsb2dnaW5nXG4gIGJ1c2luZXNzKGV2ZW50OiBzdHJpbmcsIGRldGFpbHM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+LCByZXF1ZXN0SWQ/OiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLndyaXRlTG9nKHtcbiAgICAgIGxldmVsOiBMb2dMZXZlbC5JTkZPLFxuICAgICAgbWVzc2FnZTogYEJ1c2luZXNzIEV2ZW50OiAke2V2ZW50fWAsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIC4uLmRldGFpbHMsXG4gICAgICAgIHR5cGU6ICdidXNpbmVzc19ldmVudCcsXG4gICAgICB9LFxuICAgICAgcmVxdWVzdElkLFxuICAgIH0pO1xuICB9XG5cbiAgLy8gR2V0IHJlY2VudCBsb2dzIGZvciBkZWJ1Z2dpbmdcbiAgZ2V0UmVjZW50TG9ncyhjb3VudDogbnVtYmVyID0gMTAwKTogTG9nRW50cnlbXSB7XG4gICAgcmV0dXJuIHRoaXMubG9ncy5zbGljZSgtY291bnQpO1xuICB9XG5cbiAgLy8gR2V0IGxvZ3MgYnkgbGV2ZWxcbiAgZ2V0TG9nc0J5TGV2ZWwobGV2ZWw6IExvZ0xldmVsLCBjb3VudDogbnVtYmVyID0gMTAwKTogTG9nRW50cnlbXSB7XG4gICAgcmV0dXJuIHRoaXMubG9nc1xuICAgICAgLmZpbHRlcihsb2cgPT4gbG9nLmxldmVsID09PSBsZXZlbClcbiAgICAgIC5zbGljZSgtY291bnQpO1xuICB9XG5cbiAgLy8gR2V0IGxvZ3MgYnkgdGltZSByYW5nZVxuICBnZXRMb2dzQnlUaW1lUmFuZ2UoZnJvbTogRGF0ZSwgdG86IERhdGUpOiBMb2dFbnRyeVtdIHtcbiAgICByZXR1cm4gdGhpcy5sb2dzLmZpbHRlcihsb2cgPT4gXG4gICAgICBsb2cudGltZXN0YW1wID49IGZyb20gJiYgbG9nLnRpbWVzdGFtcCA8PSB0b1xuICAgICk7XG4gIH1cblxuICAvLyBDbGVhciBsb2dzXG4gIGNsZWFyTG9ncygpOiB2b2lkIHtcbiAgICB0aGlzLmxvZ3MgPSBbXTtcbiAgICB0aGlzLmluZm8oJ0xvZyBoaXN0b3J5IGNsZWFyZWQnKTtcbiAgfVxuXG4gIC8vIEdldCBzdGF0aXN0aWNzXG4gIGdldFN0YXRzKCk6IHtcbiAgICB0b3RhbExvZ3M6IG51bWJlcjtcbiAgICBsb2dDb3VudHM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG4gICAgb2xkZXN0TG9nPzogRGF0ZTtcbiAgICBuZXdlc3RMb2c/OiBEYXRlO1xuICB9IHtcbiAgICBjb25zdCBsb2dDb3VudHM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcbiAgICBcbiAgICBmb3IgKGNvbnN0IGxvZyBvZiB0aGlzLmxvZ3MpIHtcbiAgICAgIGNvbnN0IGxldmVsTmFtZSA9IExvZ0xldmVsW2xvZy5sZXZlbF07XG4gICAgICBsb2dDb3VudHNbbGV2ZWxOYW1lXSA9IChsb2dDb3VudHNbbGV2ZWxOYW1lXSB8fCAwKSArIDE7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsTG9nczogdGhpcy5sb2dzLmxlbmd0aCxcbiAgICAgIGxvZ0NvdW50cyxcbiAgICAgIG9sZGVzdExvZzogdGhpcy5sb2dzLmxlbmd0aCA+IDAgPyB0aGlzLmxvZ3NbMF0udGltZXN0YW1wIDogdW5kZWZpbmVkLFxuICAgICAgbmV3ZXN0TG9nOiB0aGlzLmxvZ3MubGVuZ3RoID4gMCA/IHRoaXMubG9nc1t0aGlzLmxvZ3MubGVuZ3RoIC0gMV0udGltZXN0YW1wIDogdW5kZWZpbmVkLFxuICAgIH07XG4gIH1cbn1cblxuLy8gQ3JlYXRlIHNpbmdsZXRvbiBsb2dnZXIgaW5zdGFuY2VcbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoKTtcblxuLy8gUGVyZm9ybWFuY2UgbWVhc3VyZW1lbnQgdXRpbGl0eVxuZXhwb3J0IGNsYXNzIFBlcmZvcm1hbmNlVGltZXIge1xuICBwcml2YXRlIHN0YXJ0VGltZTogbnVtYmVyO1xuICBwcml2YXRlIG5hbWU6IHN0cmluZztcbiAgcHJpdmF0ZSByZXF1ZXN0SWQ/OiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nLCByZXF1ZXN0SWQ/OiBzdHJpbmcpIHtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRoaXMucmVxdWVzdElkID0gcmVxdWVzdElkO1xuICAgIHRoaXMuc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgfVxuXG4gIGVuZChjb250ZXh0PzogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pOiBudW1iZXIge1xuICAgIGNvbnN0IGR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHRoaXMuc3RhcnRUaW1lO1xuICAgIGxvZ2dlci5wZXJmb3JtYW5jZShgJHt0aGlzLm5hbWV9IGNvbXBsZXRlZGAsIGR1cmF0aW9uLCBjb250ZXh0LCB0aGlzLnJlcXVlc3RJZCk7XG4gICAgcmV0dXJuIGR1cmF0aW9uO1xuICB9XG59XG5cbi8vIFJlcXVlc3QgSUQgZ2VuZXJhdG9yXG5leHBvcnQgY29uc3QgZ2VuZXJhdGVSZXF1ZXN0SWQgPSAoKTogc3RyaW5nID0+IHtcbiAgcmV0dXJuIGByZXFfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gO1xufTtcblxuLy8gRXhwb3J0IHNpbmdsZXRvbiBsb2dnZXJcbmV4cG9ydCB7IGxvZ2dlciB9O1xuXG4vLyBDb252ZW5pZW5jZSBmdW5jdGlvbnNcbmV4cG9ydCBjb25zdCBsb2cgPSB7XG4gIGRlYnVnOiAobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogUmVjb3JkPHN0cmluZywgdW5rbm93bj4sIHJlcXVlc3RJZD86IHN0cmluZykgPT4gXG4gICAgbG9nZ2VyLmRlYnVnKG1lc3NhZ2UsIGNvbnRleHQsIHJlcXVlc3RJZCksXG4gIFxuICBpbmZvOiAobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogUmVjb3JkPHN0cmluZywgdW5rbm93bj4sIHJlcXVlc3RJZD86IHN0cmluZykgPT4gXG4gICAgbG9nZ2VyLmluZm8obWVzc2FnZSwgY29udGV4dCwgcmVxdWVzdElkKSxcbiAgXG4gIHdhcm46IChtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiwgcmVxdWVzdElkPzogc3RyaW5nKSA9PiBcbiAgICBsb2dnZXIud2FybihtZXNzYWdlLCBjb250ZXh0LCByZXF1ZXN0SWQpLFxuICBcbiAgZXJyb3I6IChtZXNzYWdlOiBzdHJpbmcsIGVycm9yPzogRXJyb3IsIGNvbnRleHQ/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiwgcmVxdWVzdElkPzogc3RyaW5nKSA9PiBcbiAgICBsb2dnZXIuZXJyb3IobWVzc2FnZSwgZXJyb3IsIGNvbnRleHQsIHJlcXVlc3RJZCksXG4gIFxuICBmYXRhbDogKG1lc3NhZ2U6IHN0cmluZywgZXJyb3I/OiBFcnJvciwgY29udGV4dD86IFJlY29yZDxzdHJpbmcsIHVua25vd24+LCByZXF1ZXN0SWQ/OiBzdHJpbmcpID0+IFxuICAgIGxvZ2dlci5mYXRhbChtZXNzYWdlLCBlcnJvciwgY29udGV4dCwgcmVxdWVzdElkKSxcbiAgXG4gIHBlcmZvcm1hbmNlOiAobmFtZTogc3RyaW5nLCByZXF1ZXN0SWQ/OiBzdHJpbmcpID0+IFxuICAgIG5ldyBQZXJmb3JtYW5jZVRpbWVyKG5hbWUsIHJlcXVlc3RJZCksXG4gIFxuICBhcGk6IChtZXRob2Q6IHN0cmluZywgcGF0aDogc3RyaW5nLCBzdGF0dXNDb2RlOiBudW1iZXIsIGR1cmF0aW9uOiBudW1iZXIsIHJlcXVlc3RJZD86IHN0cmluZykgPT4gXG4gICAgbG9nZ2VyLmFwaVJlcXVlc3QobWV0aG9kLCBwYXRoLCBzdGF0dXNDb2RlLCBkdXJhdGlvbiwgcmVxdWVzdElkKSxcbiAgXG4gIHNlY3VyaXR5OiAoZXZlbnQ6IHN0cmluZywgZGV0YWlsczogUmVjb3JkPHN0cmluZywgdW5rbm93bj4sIHJlcXVlc3RJZD86IHN0cmluZykgPT4gXG4gICAgbG9nZ2VyLnNlY3VyaXR5KGV2ZW50LCBkZXRhaWxzLCByZXF1ZXN0SWQpLFxuICBcbiAgYnVzaW5lc3M6IChldmVudDogc3RyaW5nLCBkZXRhaWxzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiwgcmVxdWVzdElkPzogc3RyaW5nKSA9PiBcbiAgICBsb2dnZXIuYnVzaW5lc3MoZXZlbnQsIGRldGFpbHMsIHJlcXVlc3RJZCksXG59OyJdLCJuYW1lcyI6WyJMb2dMZXZlbCIsIkxvZ2dlciIsImNvbnN0cnVjdG9yIiwibG9ncyIsIm1heExvZ0hpc3RvcnkiLCJtaW5MZXZlbCIsImdldExvZ0xldmVsIiwibGV2ZWwiLCJwcm9jZXNzIiwiZW52IiwiTE9HX0xFVkVMIiwidG9VcHBlckNhc2UiLCJzaG91bGRMb2ciLCJmb3JtYXRNZXNzYWdlIiwiZW50cnkiLCJ0aW1lc3RhbXAiLCJ0b0lTT1N0cmluZyIsInBhZEVuZCIsImNvbnRleHQiLCJKU09OIiwic3RyaW5naWZ5IiwicmVxdWVzdElkIiwicGVyZm9ybWFuY2UiLCJkdXJhdGlvbiIsIm1lc3NhZ2UiLCJ3cml0ZUxvZyIsImZvcm1hdHRlZE1lc3NhZ2UiLCJjb25zb2xlIiwiZGVidWciLCJpbmZvIiwid2FybiIsImVycm9yIiwic3RhY2siLCJwdXNoIiwibGVuZ3RoIiwic2xpY2UiLCJEYXRlIiwiZmF0YWwiLCJtZW1vcnkiLCJtZW1vcnlVc2FnZSIsImFwaVJlcXVlc3QiLCJtZXRob2QiLCJwYXRoIiwic3RhdHVzQ29kZSIsInR5cGUiLCJzZWN1cml0eSIsImV2ZW50IiwiZGV0YWlscyIsImJ1c2luZXNzIiwiZ2V0UmVjZW50TG9ncyIsImNvdW50IiwiZ2V0TG9nc0J5TGV2ZWwiLCJmaWx0ZXIiLCJsb2ciLCJnZXRMb2dzQnlUaW1lUmFuZ2UiLCJmcm9tIiwidG8iLCJjbGVhckxvZ3MiLCJnZXRTdGF0cyIsImxvZ0NvdW50cyIsImxldmVsTmFtZSIsInRvdGFsTG9ncyIsIm9sZGVzdExvZyIsInVuZGVmaW5lZCIsIm5ld2VzdExvZyIsImxvZ2dlciIsIlBlcmZvcm1hbmNlVGltZXIiLCJuYW1lIiwic3RhcnRUaW1lIiwibm93IiwiZW5kIiwiZ2VuZXJhdGVSZXF1ZXN0SWQiLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHIiLCJhcGkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/logger.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/monitoring/PerformanceMonitor.ts":
/*!**************************************************!*\
  !*** ./src/lib/monitoring/PerformanceMonitor.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PerformanceMonitor: () => (/* binding */ PerformanceMonitor),\n/* harmony export */   getPerformanceMonitor: () => (/* binding */ getPerformanceMonitor),\n/* harmony export */   withTiming: () => (/* binding */ withTiming)\n/* harmony export */ });\n/* harmony import */ var _logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../logger */ \"(rsc)/./src/lib/logger.ts\");\n// Performance monitoring and metrics collection\n\nclass PerformanceMonitor {\n    constructor(){\n        this.metrics = new Map();\n        this.maxMetricsPerType = 1000;\n        this.cleanupInterval = 60 * 60 * 1000 // 1 hour\n        ;\n        this.cleanupTimer = null;\n        this.startCleanup();\n    }\n    startCleanup() {\n        this.cleanupTimer = setInterval(()=>{\n            this.cleanupOldMetrics();\n        }, this.cleanupInterval);\n    }\n    cleanupOldMetrics() {\n        const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000);\n        let totalRemoved = 0;\n        for (const [metricName, metrics] of this.metrics.entries()){\n            const before = metrics.length;\n            const filtered = metrics.filter((metric)=>metric.timestamp > oneHourAgo);\n            this.metrics.set(metricName, filtered);\n            totalRemoved += before - filtered.length;\n        }\n        if (totalRemoved > 0) {\n            _logger__WEBPACK_IMPORTED_MODULE_0__.log.debug(`Performance metrics cleanup: removed ${totalRemoved} old metrics`);\n        }\n    }\n    recordMetric(metric) {\n        if (!this.metrics.has(metric.name)) {\n            this.metrics.set(metric.name, []);\n        }\n        const metrics = this.metrics.get(metric.name);\n        metrics.push(metric);\n        // Keep only the most recent metrics to prevent memory growth\n        if (metrics.length > this.maxMetricsPerType) {\n            metrics.splice(0, metrics.length - this.maxMetricsPerType);\n        }\n    }\n    recordTiming(name, durationMs, tags) {\n        this.recordMetric({\n            name,\n            value: durationMs,\n            unit: \"ms\",\n            timestamp: new Date(),\n            tags\n        });\n    }\n    recordCount(name, count = 1, tags) {\n        this.recordMetric({\n            name,\n            value: count,\n            unit: \"count\",\n            timestamp: new Date(),\n            tags\n        });\n    }\n    recordMemory(name, bytes, tags) {\n        this.recordMetric({\n            name,\n            value: bytes,\n            unit: \"bytes\",\n            timestamp: new Date(),\n            tags\n        });\n    }\n    recordPercentage(name, percentage, tags) {\n        this.recordMetric({\n            name,\n            value: Math.max(0, Math.min(100, percentage)),\n            unit: \"percentage\",\n            timestamp: new Date(),\n            tags\n        });\n    }\n    // Create a timing decorator for async functions\n    time(name, tags) {\n        return (target, propertyKey, descriptor)=>{\n            const originalMethod = descriptor.value;\n            descriptor.value = async function(...args) {\n                const start = Date.now();\n                try {\n                    const result = await originalMethod.apply(this, args);\n                    const duration = Date.now() - start;\n                    getPerformanceMonitor().recordTiming(name, duration, tags);\n                    return result;\n                } catch (error) {\n                    const duration = Date.now() - start;\n                    getPerformanceMonitor().recordTiming(name, duration, {\n                        ...tags,\n                        error: \"true\"\n                    });\n                    throw error;\n                }\n            };\n            return descriptor;\n        };\n    }\n    // Manual timing utility\n    startTimer(name, tags) {\n        const start = Date.now();\n        return ()=>{\n            const duration = Date.now() - start;\n            this.recordTiming(name, duration, tags);\n            return duration;\n        };\n    }\n    getSummary(metricName, timeWindowMs = 5 * 60 * 1000) {\n        const metrics = this.metrics.get(metricName);\n        if (!metrics || metrics.length === 0) {\n            return null;\n        }\n        const cutoff = new Date(Date.now() - timeWindowMs);\n        const recentMetrics = metrics.filter((metric)=>metric.timestamp > cutoff).map((metric)=>metric.value).sort((a, b)=>a - b);\n        if (recentMetrics.length === 0) {\n            return null;\n        }\n        const sum = recentMetrics.reduce((acc, val)=>acc + val, 0);\n        const avg = sum / recentMetrics.length;\n        const min = recentMetrics[0];\n        const max = recentMetrics[recentMetrics.length - 1];\n        const percentile = (p)=>{\n            const index = Math.ceil(p / 100 * recentMetrics.length) - 1;\n            return recentMetrics[Math.max(0, index)];\n        };\n        const firstMetric = metrics[0];\n        const timeWindowMinutes = Math.round(timeWindowMs / (1000 * 60));\n        return {\n            name: metricName,\n            count: recentMetrics.length,\n            min,\n            max,\n            avg: Number(avg.toFixed(2)),\n            p50: percentile(50),\n            p95: percentile(95),\n            p99: percentile(99),\n            unit: firstMetric.unit,\n            timeWindow: `${timeWindowMinutes}m`\n        };\n    }\n    getAllSummaries(timeWindowMs = 5 * 60 * 1000) {\n        const summaries = [];\n        for (const metricName of this.metrics.keys()){\n            const summary = this.getSummary(metricName, timeWindowMs);\n            if (summary) {\n                summaries.push(summary);\n            }\n        }\n        return summaries.sort((a, b)=>a.name.localeCompare(b.name));\n    }\n    getMetrics(metricName, limit = 100) {\n        const metrics = this.metrics.get(metricName);\n        if (!metrics) {\n            return [];\n        }\n        return metrics.slice(-limit);\n    }\n    getTopSlowestOperations(limit = 10, timeWindowMs = 5 * 60 * 1000) {\n        const summaries = this.getAllSummaries(timeWindowMs).filter((summary)=>summary.unit === \"ms\").sort((a, b)=>b.max - a.max).slice(0, limit);\n        return summaries.map((summary)=>({\n                name: summary.name,\n                maxDuration: summary.max,\n                avgDuration: summary.avg,\n                count: summary.count\n            }));\n    }\n    // System performance monitoring\n    recordSystemMetrics() {\n        const memUsage = process.memoryUsage();\n        const cpuUsage = process.cpuUsage();\n        // Memory metrics\n        this.recordMemory(\"system.memory.heapUsed\", memUsage.heapUsed);\n        this.recordMemory(\"system.memory.heapTotal\", memUsage.heapTotal);\n        this.recordMemory(\"system.memory.external\", memUsage.external);\n        this.recordMemory(\"system.memory.rss\", memUsage.rss);\n        // Memory usage percentage\n        const memoryPercentage = memUsage.heapUsed / memUsage.heapTotal * 100;\n        this.recordPercentage(\"system.memory.usage\", memoryPercentage);\n        // CPU metrics (note: these are cumulative, would need baseline for rates)\n        this.recordMetric({\n            name: \"system.cpu.user\",\n            value: cpuUsage.user / 1000,\n            unit: \"ms\",\n            timestamp: new Date()\n        });\n        this.recordMetric({\n            name: \"system.cpu.system\",\n            value: cpuUsage.system / 1000,\n            unit: \"ms\",\n            timestamp: new Date()\n        });\n        // Uptime\n        this.recordMetric({\n            name: \"system.uptime\",\n            value: process.uptime(),\n            unit: \"count\",\n            timestamp: new Date()\n        });\n    }\n    // Event loop lag measurement\n    measureEventLoopLag() {\n        return new Promise((resolve)=>{\n            const start = process.hrtime.bigint();\n            setImmediate(()=>{\n                const lag = Number(process.hrtime.bigint() - start) / 1000000; // Convert to ms\n                this.recordTiming(\"system.eventLoopLag\", lag);\n                resolve(lag);\n            });\n        });\n    }\n    // Start automatic system monitoring\n    startSystemMonitoring(intervalMs = 30000) {\n        return setInterval(()=>{\n            this.recordSystemMetrics();\n            this.measureEventLoopLag();\n        }, intervalMs);\n    }\n    getStats() {\n        let totalMetrics = 0;\n        let oldestMetric = null;\n        let newestMetric = null;\n        for (const metrics of this.metrics.values()){\n            totalMetrics += metrics.length;\n            if (metrics.length > 0) {\n                const first = metrics[0].timestamp;\n                const last = metrics[metrics.length - 1].timestamp;\n                if (!oldestMetric || first < oldestMetric) {\n                    oldestMetric = first;\n                }\n                if (!newestMetric || last > newestMetric) {\n                    newestMetric = last;\n                }\n            }\n        }\n        return {\n            metricTypes: this.metrics.size,\n            totalMetrics,\n            oldestMetric,\n            newestMetric\n        };\n    }\n    cleanup() {\n        if (this.cleanupTimer) {\n            clearInterval(this.cleanupTimer);\n            this.cleanupTimer = null;\n        }\n        this.metrics.clear();\n        _logger__WEBPACK_IMPORTED_MODULE_0__.log.info(\"Performance monitor cleanup completed\");\n    }\n}\n// Singleton instance\nlet performanceMonitorInstance = null;\nconst getPerformanceMonitor = ()=>{\n    if (!performanceMonitorInstance) {\n        performanceMonitorInstance = new PerformanceMonitor();\n    }\n    return performanceMonitorInstance;\n};\n// Convenience function for timing operations\nconst withTiming = async (name, operation, tags)=>{\n    const monitor = getPerformanceMonitor();\n    const endTimer = monitor.startTimer(name, tags);\n    try {\n        const result = await operation();\n        endTimer();\n        return result;\n    } catch (error) {\n        endTimer();\n        throw error;\n    }\n};\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL21vbml0b3JpbmcvUGVyZm9ybWFuY2VNb25pdG9yLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQSxnREFBZ0Q7QUFDaEI7QUF1QmhDLE1BQU1DO0lBTUpDLGFBQWM7YUFMTkMsVUFBNEMsSUFBSUM7YUFDdkNDLG9CQUFvQjthQUNwQkMsa0JBQWtCLEtBQUssS0FBSyxLQUFNLFNBQVM7O2FBQ3BEQyxlQUFzQztRQUc1QyxJQUFJLENBQUNDLFlBQVk7SUFDbkI7SUFFUUEsZUFBcUI7UUFDM0IsSUFBSSxDQUFDRCxZQUFZLEdBQUdFLFlBQVk7WUFDOUIsSUFBSSxDQUFDQyxpQkFBaUI7UUFDeEIsR0FBRyxJQUFJLENBQUNKLGVBQWU7SUFDekI7SUFFUUksb0JBQTBCO1FBQ2hDLE1BQU1DLGFBQWEsSUFBSUMsS0FBS0EsS0FBS0MsR0FBRyxLQUFLLEtBQUssS0FBSztRQUNuRCxJQUFJQyxlQUFlO1FBRW5CLEtBQUssTUFBTSxDQUFDQyxZQUFZWixRQUFRLElBQUksSUFBSSxDQUFDQSxPQUFPLENBQUNhLE9BQU8sR0FBSTtZQUMxRCxNQUFNQyxTQUFTZCxRQUFRZSxNQUFNO1lBQzdCLE1BQU1DLFdBQVdoQixRQUFRaUIsTUFBTSxDQUFDQyxDQUFBQSxTQUFVQSxPQUFPQyxTQUFTLEdBQUdYO1lBQzdELElBQUksQ0FBQ1IsT0FBTyxDQUFDb0IsR0FBRyxDQUFDUixZQUFZSTtZQUM3QkwsZ0JBQWdCRyxTQUFTRSxTQUFTRCxNQUFNO1FBQzFDO1FBRUEsSUFBSUosZUFBZSxHQUFHO1lBQ3BCZCx3Q0FBR0EsQ0FBQ3dCLEtBQUssQ0FBQyxDQUFDLHFDQUFxQyxFQUFFVixhQUFhLFlBQVksQ0FBQztRQUM5RTtJQUNGO0lBRUFXLGFBQWFKLE1BQXlCLEVBQVE7UUFDNUMsSUFBSSxDQUFDLElBQUksQ0FBQ2xCLE9BQU8sQ0FBQ3VCLEdBQUcsQ0FBQ0wsT0FBT00sSUFBSSxHQUFHO1lBQ2xDLElBQUksQ0FBQ3hCLE9BQU8sQ0FBQ29CLEdBQUcsQ0FB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UUFDL0JBLDZCQUE2QixJQUFJakk7SUFDbkM7SUFDQSxPQUFPaUk7QUFDVCxFQUFFO0FBRUYsNkNBQTZDO0FBQ3RDLE1BQU1DLGFBQWEsT0FDeEJ4RyxNQUNBeUcsV0FDQW5HO0lBRUEsTUFBTW9HLFVBQVU5RTtJQUNoQixNQUFNK0UsV0FBV0QsUUFBUTVFLFVBQVUsQ0FBQzlCLE1BQU1NO0lBRTFDLElBQUk7UUFDRixNQUFNbUIsU0FBUyxNQUFNZ0Y7UUFDckJFO1FBQ0EsT0FBT2xGO0lBQ1QsRUFBRSxPQUFPSSxPQUFPO1FBQ2Q4RTtRQUNBLE1BQU05RTtJQUNSO0FBQ0YsRUFBRTtBQUU0QiIsInNvdXJjZXMiOlsid2VicGFjazovL3Rva3lvLW9wZW5kYXRhLWhhY2thdGhvbi8uL3NyYy9saWIvbW9uaXRvcmluZy9QZXJmb3JtYW5jZU1vbml0b3IudHM/NTc4OCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBQZXJmb3JtYW5jZSBtb25pdG9yaW5nIGFuZCBtZXRyaWNzIGNvbGxlY3Rpb25cbmltcG9ydCB7IGxvZyB9IGZyb20gJy4uL2xvZ2dlcic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGVyZm9ybWFuY2VNZXRyaWMge1xuICBuYW1lOiBzdHJpbmc7XG4gIHZhbHVlOiBudW1iZXI7XG4gIHVuaXQ6ICdtcycgfCAnYnl0ZXMnIHwgJ2NvdW50JyB8ICdwZXJjZW50YWdlJztcbiAgdGltZXN0YW1wOiBEYXRlO1xuICB0YWdzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQZXJmb3JtYW5jZVN1bW1hcnkge1xuICBuYW1lOiBzdHJpbmc7XG4gIGNvdW50OiBudW1iZXI7XG4gIG1pbjogbnVtYmVyO1xuICBtYXg6IG51bWJlcjtcbiAgYXZnOiBudW1iZXI7XG4gIHA1MDogbnVtYmVyO1xuICBwOTU6IG51bWJlcjtcbiAgcDk5OiBudW1iZXI7XG4gIHVuaXQ6IHN0cmluZztcbiAgdGltZVdpbmRvdzogc3RyaW5nO1xufVxuXG5jbGFzcyBQZXJmb3JtYW5jZU1vbml0b3Ige1xuICBwcml2YXRlIG1ldHJpY3M6IE1hcDxzdHJpbmcsIFBlcmZvcm1hbmNlTWV0cmljW10+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIHJlYWRvbmx5IG1heE1ldHJpY3NQZXJUeXBlID0gMTAwMDtcbiAgcHJpdmF0ZSByZWFkb25seSBjbGVhbnVwSW50ZXJ2YWwgPSA2MCAqIDYwICogMTAwMDsgLy8gMSBob3VyXG4gIHByaXZhdGUgY2xlYW51cFRpbWVyOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuc3RhcnRDbGVhbnVwKCk7XG4gIH1cblxuICBwcml2YXRlIHN0YXJ0Q2xlYW51cCgpOiB2b2lkIHtcbiAgICB0aGlzLmNsZWFudXBUaW1lciA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgIHRoaXMuY2xlYW51cE9sZE1ldHJpY3MoKTtcbiAgICB9LCB0aGlzLmNsZWFudXBJbnRlcnZhbCk7XG4gIH1cblxuICBwcml2YXRlIGNsZWFudXBPbGRNZXRyaWNzKCk6IHZvaWQge1xuICAgIGNvbnN0IG9uZUhvdXJBZ28gPSBuZXcgRGF0ZShEYXRlLm5vdygpIC0gNjAgKiA2MCAqIDEwMDApO1xuICAgIGxldCB0b3RhbFJlbW92ZWQgPSAwO1xuXG4gICAgZm9yIChjb25zdCBbbWV0cmljTmFtZSwgbWV0cmljc10gb2YgdGhpcy5tZXRyaWNzLmVudHJpZXMoKSkge1xuICAgICAgY29uc3QgYmVmb3JlID0gbWV0cmljcy5sZW5ndGg7XG4gICAgICBjb25zdCBmaWx0ZXJlZCA9IG1ldHJpY3MuZmlsdGVyKG1ldHJpYyA9PiBtZXRyaWMudGltZXN0YW1wID4gb25lSG91ckFnbyk7XG4gICAgICB0aGlzLm1ldHJpY3Muc2V0KG1ldHJpY05hbWUsIGZpbHRlcmVkKTtcbiAgICAgIHRvdGFsUmVtb3ZlZCArPSBiZWZvcmUgLSBmaWx0ZXJlZC5sZW5ndGg7XG4gICAgfVxuXG4gICAgaWYgKHRvdGFsUmVtb3ZlZCA+IDApIHtcbiAgICAgIGxvZy5kZWJ1ZyhgUGVyZm9ybWFuY2UgbWV0cmljcyBjbGVhbnVwOiByZW1vdmVkICR7dG90YWxSZW1vdmVkfSBvbGQgbWV0cmljc2ApO1xuICAgIH1cbiAgfVxuXG4gIHJlY29yZE1ldHJpYyhtZXRyaWM6IFBlcmZvcm1hbmNlTWV0cmljKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLm1ldHJpY3MuaGFzKG1ldHJpYy5uYW1lKSkge1xuICAgICAgdGhpcy5tZXRyaWNzLnNldChtZXRyaWMubmFtZSwgW10pO1xuICAgIH1cblxuICAgIGNvbnN0IG1ldHJpY3MgPSB0aGlzLm1ldHJpY3MuZ2V0KG1ldHJpYy5uYW1lKSE7XG4gICAgbWV0cmljcy5wdXNoKG1ldHJpYyk7XG5cbiAgICAvLyBLZWVwIG9ubHkgdGhlIG1vc3QgcmVjZW50IG1ldHJpY3MgdG8gcHJldmVudCBtZW1vcnkgZ3Jvd3RoXG4gICAgaWYgKG1ldHJpY3MubGVuZ3RoID4gdGhpcy5tYXhNZXRyaWNzUGVyVHlwZSkge1xuICAgICAgbWV0cmljcy5zcGxpY2UoMCwgbWV0cmljcy5sZW5ndGggLSB0aGlzLm1heE1ldHJpY3NQZXJUeXBlKTtcbiAgICB9XG4gIH1cblxuICByZWNvcmRUaW1pbmcobmFtZTogc3RyaW5nLCBkdXJhdGlvbk1zOiBudW1iZXIsIHRhZ3M/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KTogdm9pZCB7XG4gICAgdGhpcy5yZWNvcmRNZXRyaWMoe1xuICAgICAgbmFtZSxcbiAgICAgIHZhbHVlOiBkdXJhdGlvbk1zLFxuICAgICAgdW5pdDogJ21zJyxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIHRhZ3MsXG4gICAgfSk7XG4gIH1cblxuICByZWNvcmRDb3VudChuYW1lOiBzdHJpbmcsIGNvdW50OiBudW1iZXIgPSAxLCB0YWdzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPik6IHZvaWQge1xuICAgIHRoaXMucmVjb3JkTWV0cmljKHtcbiAgICAgIG5hbWUsXG4gICAgICB2YWx1ZTogY291bnQsXG4gICAgICB1bml0OiAnY291bnQnLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgdGFncyxcbiAgICB9KTtcbiAgfVxuXG4gIHJlY29yZE1lbW9yeShuYW1lOiBzdHJpbmcsIGJ5dGVzOiBudW1iZXIsIHRhZ3M/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KTogdm9pZCB7XG4gICAgdGhpcy5yZWNvcmRNZXRyaWMoe1xuICAgICAgbmFtZSxcbiAgICAgIHZhbHVlOiBieXRlcyxcbiAgICAgIHVuaXQ6ICdieXRlcycsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICB0YWdzLFxuICAgIH0pO1xuICB9XG5cbiAgcmVjb3JkUGVyY2VudGFnZShuYW1lOiBzdHJpbmcsIHBlcmNlbnRhZ2U6IG51bWJlciwgdGFncz86IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pOiB2b2lkIHtcbiAgICB0aGlzLnJlY29yZE1ldHJpYyh7XG4gICAgICBuYW1lLFxuICAgICAgdmFsdWU6IE1hdGgubWF4KDAsIE1hdGgubWluKDEwMCwgcGVyY2VudGFnZSkpLFxuICAgICAgdW5pdDogJ3BlcmNlbnRhZ2UnLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgdGFncyxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIENyZWF0ZSBhIHRpbWluZyBkZWNvcmF0b3IgZm9yIGFzeW5jIGZ1bmN0aW9uc1xuICB0aW1lPFQgZXh0ZW5kcyBhbnlbXSwgUj4oXG4gICAgbmFtZTogc3RyaW5nLCBcbiAgICB0YWdzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPlxuICApOiAodGFyZ2V0OiBhbnksIHByb3BlcnR5S2V5OiBzdHJpbmcsIGRlc2NyaXB0b3I6IFByb3BlcnR5RGVzY3JpcHRvcikgPT4gdm9pZCB7XG4gICAgcmV0dXJuICh0YXJnZXQ6IGFueSwgcHJvcGVydHlLZXk6IHN0cmluZywgZGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yKSA9PiB7XG4gICAgICBjb25zdCBvcmlnaW5hbE1ldGhvZCA9IGRlc2NyaXB0b3IudmFsdWU7XG5cbiAgICAgIGRlc2NyaXB0b3IudmFsdWUgPSBhc3luYyBmdW5jdGlvbiguLi5hcmdzOiBUKTogUHJvbWlzZTxSPiB7XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBvcmlnaW5hbE1ldGhvZC5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICAgICAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSBzdGFydDtcbiAgICAgICAgICBnZXRQZXJmb3JtYW5jZU1vbml0b3IoKS5yZWNvcmRUaW1pbmcobmFtZSwgZHVyYXRpb24sIHRhZ3MpO1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnQ7XG4gICAgICAgICAgZ2V0UGVyZm9ybWFuY2VNb25pdG9yKCkucmVjb3JkVGltaW5nKG5hbWUsIGR1cmF0aW9uLCB7IC4uLnRhZ3MsIGVycm9yOiAndHJ1ZScgfSk7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBkZXNjcmlwdG9yO1xuICAgIH07XG4gIH1cblxuICAvLyBNYW51YWwgdGltaW5nIHV0aWxpdHlcbiAgc3RhcnRUaW1lcihuYW1lOiBzdHJpbmcsIHRhZ3M/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KTogKCkgPT4gdm9pZCB7XG4gICAgY29uc3Qgc3RhcnQgPSBEYXRlLm5vdygpO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSBzdGFydDtcbiAgICAgIHRoaXMucmVjb3JkVGltaW5nKG5hbWUsIGR1cmF0aW9uLCB0YWdzKTtcbiAgICAgIHJldHVybiBkdXJhdGlvbjtcbiAgICB9O1xuICB9XG5cbiAgZ2V0U3VtbWFyeShtZXRyaWNOYW1lOiBzdHJpbmcsIHRpbWVXaW5kb3dNczogbnVtYmVyID0gNSAqIDYwICogMTAwMCk6IFBlcmZvcm1hbmNlU3VtbWFyeSB8IG51bGwge1xuICAgIGNvbnN0IG1ldHJpY3MgPSB0aGlzLm1ldHJpY3MuZ2V0KG1ldHJpY05hbWUpO1xuICAgIGlmICghbWV0cmljcyB8fCBtZXRyaWNzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgY3V0b2ZmID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIHRpbWVXaW5kb3dNcyk7XG4gICAgY29uc3QgcmVjZW50TWV0cmljcyA9IG1ldHJpY3NcbiAgICAgIC5maWx0ZXIobWV0cmljID0+IG1ldHJpYy50aW1lc3RhbXAgPiBjdXRvZmYpXG4gICAgICAubWFwKG1ldHJpYyA9PiBtZXRyaWMudmFsdWUpXG4gICAgICAuc29ydCgoYSwgYikgPT4gYSAtIGIpO1xuXG4gICAgaWYgKHJlY2VudE1ldHJpY3MubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBzdW0gPSByZWNlbnRNZXRyaWNzLnJlZHVjZSgoYWNjLCB2YWwpID0+IGFjYyArIHZhbCwgMCk7XG4gICAgY29uc3QgYXZnID0gc3VtIC8gcmVjZW50TWV0cmljcy5sZW5ndGg7XG4gICAgY29uc3QgbWluID0gcmVjZW50TWV0cmljc1swXTtcbiAgICBjb25zdCBtYXggPSByZWNlbnRNZXRyaWNzW3JlY2VudE1ldHJpY3MubGVuZ3RoIC0gMV07XG5cbiAgICBjb25zdCBwZXJjZW50aWxlID0gKHA6IG51bWJlcikgPT4ge1xuICAgICAgY29uc3QgaW5kZXggPSBNYXRoLmNlaWwoKHAgLyAxMDApICogcmVjZW50TWV0cmljcy5sZW5ndGgpIC0gMTtcbiAgICAgIHJldHVybiByZWNlbnRNZXRyaWNzW01hdGgubWF4KDAsIGluZGV4KV07XG4gICAgfTtcblxuICAgIGNvbnN0IGZpcnN0TWV0cmljID0gbWV0cmljc1swXTtcbiAgICBjb25zdCB0aW1lV2luZG93TWludXRlcyA9IE1hdGgucm91bmQodGltZVdpbmRvd01zIC8gKDEwMDAgKiA2MCkpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IG1ldHJpY05hbWUsXG4gICAgICBjb3VudDogcmVjZW50TWV0cmljcy5sZW5ndGgsXG4gICAgICBtaW4sXG4gICAgICBtYXgsXG4gICAgICBhdmc6IE51bWJlcihhdmcudG9GaXhlZCgyKSksXG4gICAgICBwNTA6IHBlcmNlbnRpbGUoNTApLFxuICAgICAgcDk1OiBwZXJjZW50aWxlKDk1KSxcbiAgICAgIHA5OTogcGVyY2VudGlsZSg5OSksXG4gICAgICB1bml0OiBmaXJzdE1ldHJpYy51bml0LFxuICAgICAgdGltZVdpbmRvdzogYCR7dGltZVdpbmRvd01pbnV0ZXN9bWAsXG4gICAgfTtcbiAgfVxuXG4gIGdldEFsbFN1bW1hcmllcyh0aW1lV2luZG93TXM6IG51bWJlciA9IDUgKiA2MCAqIDEwMDApOiBQZXJmb3JtYW5jZVN1bW1hcnlbXSB7XG4gICAgY29uc3Qgc3VtbWFyaWVzOiBQZXJmb3JtYW5jZVN1bW1hcnlbXSA9IFtdO1xuICAgIFxuICAgIGZvciAoY29uc3QgbWV0cmljTmFtZSBvZiB0aGlzLm1ldHJpY3Mua2V5cygpKSB7XG4gICAgICBjb25zdCBzdW1tYXJ5ID0gdGhpcy5nZXRTdW1tYXJ5KG1ldHJpY05hbWUsIHRpbWVXaW5kb3dNcyk7XG4gICAgICBpZiAoc3VtbWFyeSkge1xuICAgICAgICBzdW1tYXJpZXMucHVzaChzdW1tYXJ5KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gc3VtbWFyaWVzLnNvcnQoKGEsIGIpID0+IGEubmFtZS5sb2NhbGVDb21wYXJlKGIubmFtZSkpO1xuICB9XG5cbiAgZ2V0TWV0cmljcyhtZXRyaWNOYW1lOiBzdHJpbmcsIGxpbWl0OiBudW1iZXIgPSAxMDApOiBQZXJmb3JtYW5jZU1ldHJpY1tdIHtcbiAgICBjb25zdCBtZXRyaWNzID0gdGhpcy5tZXRyaWNzLmdldChtZXRyaWNOYW1lKTtcbiAgICBpZiAoIW1ldHJpY3MpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICByZXR1cm4gbWV0cmljcy5zbGljZSgtbGltaXQpO1xuICB9XG5cbiAgZ2V0VG9wU2xvd2VzdE9wZXJhdGlvbnMobGltaXQ6IG51bWJlciA9IDEwLCB0aW1lV2luZG93TXM6IG51bWJlciA9IDUgKiA2MCAqIDEwMDApOiBBcnJheTx7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIG1heER1cmF0aW9uOiBudW1iZXI7XG4gICAgYXZnRHVyYXRpb246IG51bWJlcjtcbiAgICBjb3VudDogbnVtYmVyO1xuICB9PiB7XG4gICAgY29uc3Qgc3VtbWFyaWVzID0gdGhpcy5nZXRBbGxTdW1tYXJpZXModGltZVdpbmRvd01zKVxuICAgICAgLmZpbHRlcihzdW1tYXJ5ID0+IHN1bW1hcnkudW5pdCA9PT0gJ21zJylcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBiLm1heCAtIGEubWF4KVxuICAgICAgLnNsaWNlKDAsIGxpbWl0KTtcblxuICAgIHJldHVybiBzdW1tYXJpZXMubWFwKHN1bW1hcnkgPT4gKHtcbiAgICAgIG5hbWU6IHN1bW1hcnkubmFtZSxcbiAgICAgIG1heER1cmF0aW9uOiBzdW1tYXJ5Lm1heCxcbiAgICAgIGF2Z0R1cmF0aW9uOiBzdW1tYXJ5LmF2ZyxcbiAgICAgIGNvdW50OiBzdW1tYXJ5LmNvdW50LFxuICAgIH0pKTtcbiAgfVxuXG4gIC8vIFN5c3RlbSBwZXJmb3JtYW5jZSBtb25pdG9yaW5nXG4gIHJlY29yZFN5c3RlbU1ldHJpY3MoKTogdm9pZCB7XG4gICAgY29uc3QgbWVtVXNhZ2UgPSBwcm9jZXNzLm1lbW9yeVVzYWdlKCk7XG4gICAgY29uc3QgY3B1VXNhZ2UgPSBwcm9jZXNzLmNwdVVzYWdlKCk7XG4gICAgXG4gICAgLy8gTWVtb3J5IG1ldHJpY3NcbiAgICB0aGlzLnJlY29yZE1lbW9yeSgnc3lzdGVtLm1lbW9yeS5oZWFwVXNlZCcsIG1lbVVzYWdlLmhlYXBVc2VkKTtcbiAgICB0aGlzLnJlY29yZE1lbW9yeSgnc3lzdGVtLm1lbW9yeS5oZWFwVG90YWwnLCBtZW1Vc2FnZS5oZWFwVG90YWwpO1xuICAgIHRoaXMucmVjb3JkTWVtb3J5KCdzeXN0ZW0ubWVtb3J5LmV4dGVybmFsJywgbWVtVXNhZ2UuZXh0ZXJuYWwpO1xuICAgIHRoaXMucmVjb3JkTWVtb3J5KCdzeXN0ZW0ubWVtb3J5LnJzcycsIG1lbVVzYWdlLnJzcyk7XG4gICAgXG4gICAgLy8gTWVtb3J5IHVzYWdlIHBlcmNlbnRhZ2VcbiAgICBjb25zdCBtZW1vcnlQZXJjZW50YWdlID0gKG1lbVVzYWdlLmhlYXBVc2VkIC8gbWVtVXNhZ2UuaGVhcFRvdGFsKSAqIDEwMDtcbiAgICB0aGlzLnJlY29yZFBlcmNlbnRhZ2UoJ3N5c3RlbS5tZW1vcnkudXNhZ2UnLCBtZW1vcnlQZXJjZW50YWdlKTtcbiAgICBcbiAgICAvLyBDUFUgbWV0cmljcyAobm90ZTogdGhlc2UgYXJlIGN1bXVsYXRpdmUsIHdvdWxkIG5lZWQgYmFzZWxpbmUgZm9yIHJhdGVzKVxuICAgIHRoaXMucmVjb3JkTWV0cmljKHtcbiAgICAgIG5hbWU6ICdzeXN0ZW0uY3B1LnVzZXInLFxuICAgICAgdmFsdWU6IGNwdVVzYWdlLnVzZXIgLyAxMDAwLCAvLyBDb252ZXJ0IHRvIG1pbGxpc2Vjb25kc1xuICAgICAgdW5pdDogJ21zJyxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICB9KTtcbiAgICBcbiAgICB0aGlzLnJlY29yZE1ldHJpYyh7XG4gICAgICBuYW1lOiAnc3lzdGVtLmNwdS5zeXN0ZW0nLFxuICAgICAgdmFsdWU6IGNwdVVzYWdlLnN5c3RlbSAvIDEwMDAsXG4gICAgICB1bml0OiAnbXMnLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgIH0pO1xuXG4gICAgLy8gVXB0aW1lXG4gICAgdGhpcy5yZWNvcmRNZXRyaWMoe1xuICAgICAgbmFtZTogJ3N5c3RlbS51cHRpbWUnLFxuICAgICAgdmFsdWU6IHByb2Nlc3MudXB0aW1lKCksXG4gICAgICB1bml0OiAnY291bnQnLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgIH0pO1xuICB9XG5cbiAgLy8gRXZlbnQgbG9vcCBsYWcgbWVhc3VyZW1lbnRcbiAgbWVhc3VyZUV2ZW50TG9vcExhZygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgY29uc3Qgc3RhcnQgPSBwcm9jZXNzLmhydGltZS5iaWdpbnQoKTtcbiAgICAgIHNldEltbWVkaWF0ZSgoKSA9PiB7XG4gICAgICAgIGNvbnN0IGxhZyA9IE51bWJlcihwcm9jZXNzLmhydGltZS5iaWdpbnQoKSAtIHN0YXJ0KSAvIDEwMDAwMDA7IC8vIENvbnZlcnQgdG8gbXNcbiAgICAgICAgdGhpcy5yZWNvcmRUaW1pbmcoJ3N5c3RlbS5ldmVudExvb3BMYWcnLCBsYWcpO1xuICAgICAgICByZXNvbHZlKGxhZyk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFN0YXJ0IGF1dG9tYXRpYyBzeXN0ZW0gbW9uaXRvcmluZ1xuICBzdGFydFN5c3RlbU1vbml0b3JpbmcoaW50ZXJ2YWxNczogbnVtYmVyID0gMzAwMDApOiBOb2RlSlMuVGltZW91dCB7XG4gICAgcmV0dXJuIHNldEludGVydmFsKCgpID0+IHtcbiAgICAgIHRoaXMucmVjb3JkU3lzdGVtTWV0cmljcygpO1xuICAgICAgdGhpcy5tZWFzdXJlRXZlbnRMb29wTGFnKCk7XG4gICAgfSwgaW50ZXJ2YWxNcyk7XG4gIH1cblxuICBnZXRTdGF0cygpOiB7XG4gICAgbWV0cmljVHlwZXM6IG51bWJlcjtcbiAgICB0b3RhbE1ldHJpY3M6IG51bWJlcjtcbiAgICBvbGRlc3RNZXRyaWM6IERhdGUgfCBudWxsO1xuICAgIG5ld2VzdE1ldHJpYzogRGF0ZSB8IG51bGw7XG4gIH0ge1xuICAgIGxldCB0b3RhbE1ldHJpY3MgPSAwO1xuICAgIGxldCBvbGRlc3RNZXRyaWM6IERhdGUgfCBudWxsID0gbnVsbDtcbiAgICBsZXQgbmV3ZXN0TWV0cmljOiBEYXRlIHwgbnVsbCA9IG51bGw7XG5cbiAgICBmb3IgKGNvbnN0IG1ldHJpY3Mgb2YgdGhpcy5tZXRyaWNzLnZhbHVlcygpKSB7XG4gICAgICB0b3RhbE1ldHJpY3MgKz0gbWV0cmljcy5sZW5ndGg7XG4gICAgICBcbiAgICAgIGlmIChtZXRyaWNzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgZmlyc3QgPSBtZXRyaWNzWzBdLnRpbWVzdGFtcDtcbiAgICAgICAgY29uc3QgbGFzdCA9IG1ldHJpY3NbbWV0cmljcy5sZW5ndGggLSAxXS50aW1lc3RhbXA7XG4gICAgICAgIFxuICAgICAgICBpZiAoIW9sZGVzdE1ldHJpYyB8fCBmaXJzdCA8IG9sZGVzdE1ldHJpYykge1xuICAgICAgICAgIG9sZGVzdE1ldHJpYyA9IGZpcnN0O1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAoIW5ld2VzdE1ldHJpYyB8fCBsYXN0ID4gbmV3ZXN0TWV0cmljKSB7XG4gICAgICAgICAgbmV3ZXN0TWV0cmljID0gbGFzdDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBtZXRyaWNUeXBlczogdGhpcy5tZXRyaWNzLnNpemUsXG4gICAgICB0b3RhbE1ldHJpY3MsXG4gICAgICBvbGRlc3RNZXRyaWMsXG4gICAgICBuZXdlc3RNZXRyaWMsXG4gICAgfTtcbiAgfVxuXG4gIGNsZWFudXAoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY2xlYW51cFRpbWVyKSB7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMuY2xlYW51cFRpbWVyKTtcbiAgICAgIHRoaXMuY2xlYW51cFRpbWVyID0gbnVsbDtcbiAgICB9XG4gICAgdGhpcy5tZXRyaWNzLmNsZWFyKCk7XG4gICAgbG9nLmluZm8oJ1BlcmZvcm1hbmNlIG1vbml0b3IgY2xlYW51cCBjb21wbGV0ZWQnKTtcbiAgfVxufVxuXG4vLyBTaW5nbGV0b24gaW5zdGFuY2VcbmxldCBwZXJmb3JtYW5jZU1vbml0b3JJbnN0YW5jZTogUGVyZm9ybWFuY2VNb25pdG9yIHwgbnVsbCA9IG51bGw7XG5cbmV4cG9ydCBjb25zdCBnZXRQZXJmb3JtYW5jZU1vbml0b3IgPSAoKTogUGVyZm9ybWFuY2VNb25pdG9yID0+IHtcbiAgaWYgKCFwZXJmb3JtYW5jZU1vbml0b3JJbnN0YW5jZSkge1xuICAgIHBlcmZvcm1hbmNlTW9uaXRvckluc3RhbmNlID0gbmV3IFBlcmZvcm1hbmNlTW9uaXRvcigpO1xuICB9XG4gIHJldHVybiBwZXJmb3JtYW5jZU1vbml0b3JJbnN0YW5jZTtcbn07XG5cbi8vIENvbnZlbmllbmNlIGZ1bmN0aW9uIGZvciB0aW1pbmcgb3BlcmF0aW9uc1xuZXhwb3J0IGNvbnN0IHdpdGhUaW1pbmcgPSBhc3luYyA8VD4oXG4gIG5hbWU6IHN0cmluZyxcbiAgb3BlcmF0aW9uOiAoKSA9PiBQcm9taXNlPFQ+LFxuICB0YWdzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPlxuKTogUHJvbWlzZTxUPiA9PiB7XG4gIGNvbnN0IG1vbml0b3IgPSBnZXRQZXJmb3JtYW5jZU1vbml0b3IoKTtcbiAgY29uc3QgZW5kVGltZXIgPSBtb25pdG9yLnN0YXJ0VGltZXIobmFtZSwgdGFncyk7XG4gIFxuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9wZXJhdGlvbigpO1xuICAgIGVuZFRpbWVyKCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBlbmRUaW1lcigpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59O1xuXG5leHBvcnQgeyBQZXJmb3JtYW5jZU1vbml0b3IgfTsiXSwibmFtZXMiOlsibG9nIiwiUGVyZm9ybWFuY2VNb25pdG9yIiwiY29uc3RydWN0b3IiLCJtZXRyaWNzIiwiTWFwIiwibWF4TWV0cmljc1BlclR5cGUiLCJjbGVhbnVwSW50ZXJ2YWwiLCJjbGVhbnVwVGltZXIiLCJzdGFydENsZWFudXAiLCJzZXRJbnRlcnZhbCIsImNsZWFudXBPbGRNZXRyaWNzIiwib25lSG91ckFnbyIsIkRhdGUiLCJub3ciLCJ0b3RhbFJlbW92ZWQiLCJtZXRyaWNOYW1lIiwiZW50cmllcyIsImJlZm9yZSIsImxlbmd0aCIsImZpbHRlcmVkIiwiZmlsdGVyIiwibWV0cmljIiwidGltZXN0YW1wIiwic2V0IiwiZGVidWciLCJyZWNvcmRNZXRyaWMiLCJoYXMiLCJuYW1lIiwiZ2V0IiwicHVzaCIsInNwbGljZSIsInJlY29yZFRpbWluZyIsImR1cmF0aW9uTXMiLCJ0YWdzIiwidmFsdWUiLCJ1bml0IiwicmVjb3JkQ291bnQiLCJjb3VudCIsInJlY29yZE1lbW9yeSIsImJ5dGVzIiwicmVjb3JkUGVyY2VudGFnZSIsInBlcmNlbnRhZ2UiLCJNYXRoIiwibWF4IiwibWluIiwidGltZSIsInRhcmdldCIsInByb3BlcnR5S2V5IiwiZGVzY3JpcHRvciIsIm9yaWdpbmFsTWV0aG9kIiwiYXJncyIsInN0YXJ0IiwicmVzdWx0IiwiYXBwbHkiLCJkdXJhdGlvbiIsImdldFBlcmZvcm1hbmNlTW9uaXRvciIsImVycm9yIiwic3RhcnRUaW1lciIsImdldFN1bW1hcnkiLCJ0aW1lV2luZG93TXMiLCJjdXRvZmYiLCJyZWNlbnRNZXRyaWNzIiwibWFwIiwic29ydCIsImEiLCJiIiwic3VtIiwicmVkdWNlIiwiYWNjIiwidmFsIiwiYXZnIiwicGVyY2VudGlsZSIsInAiLCJpbmRleCIsImNlaWwiLCJmaXJzdE1ldHJpYyIsInRpbWVXaW5kb3dNaW51dGVzIiwicm91bmQiLCJOdW1iZXIiLCJ0b0ZpeGVkIiwicDUwIiwicDk1IiwicDk5IiwidGltZVdpbmRvdyIsImdldEFsbFN1bW1hcmllcyIsInN1bW1hcmllcyIsImtleXMiLCJzdW1tYXJ5IiwibG9jYWxlQ29tcGFyZSIsImdldE1ldHJpY3MiLCJsaW1pdCIsInNsaWNlIiwiZ2V0VG9wU2xvd2VzdE9wZXJhdGlvbnMiLCJtYXhEdXJhdGlvbiIsImF2Z0R1cmF0aW9uIiwicmVjb3JkU3lzdGVtTWV0cmljcyIsIm1lbVVzYWdlIiwicHJvY2VzcyIsIm1lbW9yeVVzYWdlIiwiY3B1VXNhZ2UiLCJoZWFwVXNlZCIsImhlYXBUb3RhbCIsImV4dGVybmFsIiwicnNzIiwibWVtb3J5UGVyY2VudGFnZSIsInVzZXIiLCJzeXN0ZW0iLCJ1cHRpbWUiLCJtZWFzdXJlRXZlbnRMb29wTGFnIiwiUHJvbWlzZSIsInJlc29sdmUiLCJocnRpbWUiLCJiaWdpbnQiLCJzZXRJbW1lZGlhdGUiLCJsYWciLCJzdGFydFN5c3RlbU1vbml0b3JpbmciLCJpbnRlcnZhbE1zIiwiZ2V0U3RhdHMiLCJ0b3RhbE1ldHJpY3MiLCJvbGRlc3RNZXRyaWMiLCJuZXdlc3RNZXRyaWMiLCJ2YWx1ZXMiLCJmaXJzdCIsImxhc3QiLCJtZXRyaWNUeXBlcyIsInNpemUiLCJjbGVhbnVwIiwiY2xlYXJJbnRlcnZhbCIsImNsZWFyIiwiaW5mbyIsInBlcmZvcm1hbmNlTW9uaXRvckluc3RhbmNlIiwid2l0aFRpbWluZyIsIm9wZXJhdGlvbiIsIm1vbml0b3IiLCJlbmRUaW1lciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/monitoring/PerformanceMonitor.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/services/GeminiService.ts":
/*!*******************************************!*\
  !*** ./src/lib/services/GeminiService.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GeminiService: () => (/* binding */ GeminiService)\n/* harmony export */ });\n/* harmony import */ var _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @google/generative-ai */ \"(rsc)/./node_modules/@google/generative-ai/dist/index.mjs\");\n/* harmony import */ var _lib_config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/config */ \"(rsc)/./src/lib/config.ts\");\n\n\nclass GeminiService {\n    constructor(){\n        if (!_lib_config__WEBPACK_IMPORTED_MODULE_1__.config.geminiApiKey) {\n            throw new Error(\"Gemini API key is not configured\");\n        }\n        this.genAI = new _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.GoogleGenerativeAI(_lib_config__WEBPACK_IMPORTED_MODULE_1__.config.geminiApiKey);\n        // Gemini 2.5 Flash 設定（思考モードOFF）\n        const optimizedConfig = {\n            model: \"gemini-2.5-flash\",\n            generationConfig: {\n                temperature: 0.1,\n                topK: 10,\n                topP: 0.6,\n                maxOutputTokens: 1024,\n                candidateCount: 1,\n                stopSequences: [\n                    \"```\",\n                    \"END\",\n                    \"終了\"\n                ]\n            },\n            safetySettings: [\n                {\n                    category: _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.HarmCategory.HARM_CATEGORY_HARASSMENT,\n                    threshold: _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE\n                },\n                {\n                    category: _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.HarmCategory.HARM_CATEGORY_HATE_SPEECH,\n                    threshold: _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE\n                },\n                {\n                    category: _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT,\n                    threshold: _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE\n                },\n                {\n                    category: _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT,\n                    threshold: _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE\n                }\n            ]\n        };\n        // シンプルクエリ用設定（思考モードOFF）\n        const simpleConfig = {\n            model: \"gemini-2.5-flash\",\n            generationConfig: {\n                temperature: 0.05,\n                topK: 5,\n                topP: 0.5,\n                maxOutputTokens: 512,\n                candidateCount: 1,\n                stopSequences: [\n                    \"```\",\n                    \"END\",\n                    \"終了\",\n                    \"\\n\\n\"\n                ]\n            },\n            safetySettings: [\n                {\n                    category: _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.HarmCategory.HARM_CATEGORY_HARASSMENT,\n                    threshold: _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE\n                },\n                {\n                    category: _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.HarmCategory.HARM_CATEGORY_HATE_SPEECH,\n                    threshold: _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE\n                },\n                {\n                    category: _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT,\n                    threshold: _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE\n                },\n                {\n                    category: _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT,\n                    threshold: _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE\n                }\n            ]\n        };\n        this.textModel = this.genAI.getGenerativeModel(optimizedConfig);\n        this.audioModel = this.genAI.getGenerativeModel(optimizedConfig);\n        this.embeddingModel = this.genAI.getGenerativeModel({\n            model: \"text-embedding-004\"\n        });\n    }\n    async generateText(prompt, context, language = \"ja\", useAudioModel = false) {\n        try {\n            const languagePrompts = {\n                ja: {\n                    systemPrompt: `あなたは東京都公式AI音声対話システムのアシスタントです。\n以下のガイドラインに従って応答してください：\n\n【役割】\n- 東京都の行政サービスに関する情報提供に特化\n- 特に子育て支援分野の情報を中心に案内\n\n【応答制限】\n1. 東京都の行政サービスに関係ない質問には回答しない\n2. システムの技術的詳細（使用モデル、実装方法等）は開示しない\n3. 個人情報の収集や開示は行わない\n4. 政治的な意見や批判は述べない\n5. 医療・法律の専門的アドバイスは提供しない\n\n【応答スタイル】\n- 丁寧で親しみやすい敬語を使用\n- 正確な情報のみを提供\n- 不明な点は推測せず、適切な窓口を案内\n\n【制限外の質問への標準応答】\n「申し訳ございませんが、その質問にはお答えできません。東京都の行政サービス、特に子育て支援に関する情報についてお気軽にお尋ねください。」`,\n                    contextPrompt: context ? `【システムルール】\n上記のガイドラインを厳守してください。\n\n【参考情報】\n${context}\n\n【ユーザーの質問】\n${prompt}\n\n【応答指示】\n- ユーザーの質問が東京都の行政サービスに関連する場合：参考情報に基づいて正確に回答\n- ユーザーの質問が制限事項に該当する場合：標準応答を返す\n- 技術的な質問（モデル名、実装方法等）の場合：「システムに関する技術的な情報はお答えできません」と回答\n\n日本語で回答してください。` : `【システムルール】\n上記のガイドラインを厳守してください。\n\n【ユーザーの質問】\n${prompt}\n\n【応答指示】\n- ユーザーの質問が東京都の行政サービスに関連する場合：子育て支援制度について回答\n- ユーザーの質問が制限事項に該当する場合：標準応答を返す\n- 技術的な質問（モデル名、実装方法等）の場合：「システムに関する技術的な情報はお答えできません」と回答\n\n日本語で回答してください。`,\n                    fallbackMessage: \"申し訳ございませんが、現在サービスに問題が発生しています。しばらく後にもう一度お試しください。\"\n                },\n                en: {\n                    systemPrompt: `You are the official Tokyo AI Voice Dialogue System assistant.\nPlease follow these guidelines:\n\n【Role】\n- Specialize in providing information about Tokyo's administrative services\n- Focus primarily on childcare support information\n\n【Response Restrictions】\n1. Do not answer questions unrelated to Tokyo's administrative services\n2. Do not disclose technical details (model used, implementation methods, etc.)\n3. Do not collect or disclose personal information\n4. Do not express political opinions or criticism\n5. Do not provide professional medical or legal advice\n\n【Response Style】\n- Use polite and friendly language\n- Provide only accurate information\n- For unclear matters, do not speculate but direct to appropriate services\n\n【Standard Response for Restricted Questions】\n\"I apologize, but I cannot answer that question. Please feel free to ask about Tokyo's administrative services, especially childcare support information.\"`,\n                    contextPrompt: context ? `【System Rules】\nStrictly follow the above guidelines.\n\n【Reference Information】\n${context}\n\n【User Question】\n${prompt}\n\n【Response Instructions】\n- If the question relates to Tokyo's administrative services: Answer accurately based on reference information\n- If the question falls under restrictions: Return the standard response\n- For technical questions (model name, implementation, etc.): Reply \"I cannot provide technical information about the system\"\n\nPlease respond in English.` : `【System Rules】\nStrictly follow the above guidelines.\n\n【User Question】\n${prompt}\n\n【Response Instructions】\n- If the question relates to Tokyo's administrative services: Answer about childcare support systems\n- If the question falls under restrictions: Return the standard response\n- For technical questions (model name, implementation, etc.): Reply \"I cannot provide technical information about the system\"\n\nPlease respond in English.`,\n                    fallbackMessage: \"I apologize, but there is currently an issue with the service. Please try again later.\"\n                },\n                zh: {\n                    systemPrompt: `您是东京都官方AI语音对话系统的助手。\n请遵循以下准则：\n\n【角色】\n- 专注于提供东京都行政服务相关信息\n- 重点提供育儿支援领域的信息\n\n【回答限制】\n1. 不回答与东京都行政服务无关的问题\n2. 不透露技术细节（使用的模型、实施方法等）\n3. 不收集或披露个人信息\n4. 不发表政治观点或批评\n5. 不提供专业的医疗或法律建议\n\n【回答风格】\n- 使用礼貌友好的语言\n- 只提供准确的信息\n- 对于不明确的事项，不进行推测，而是引导至适当的服务窗口\n\n【受限问题的标准回答】\n\"很抱歉，我无法回答这个问题。请随时询问有关东京都行政服务，特别是育儿支援方面的信息。\"`,\n                    contextPrompt: context ? `【系统规则】\n严格遵守上述准则。\n\n【参考信息】\n${context}\n\n【用户问题】\n${prompt}\n\n【回答指示】\n- 如果问题与东京都行政服务相关：根据参考信息准确回答\n- 如果问题属于限制事项：返回标准回答\n- 对于技术问题（模型名称、实施方法等）：回复\"我无法提供有关系统的技术信息\"\n\n请用中文回答。` : `【系统规则】\n严格遵守上述准则。\n\n【用户问题】\n${prompt}\n\n【回答指示】\n- 如果问题与东京都行政服务相关：回答育儿支援制度相关内容\n- 如果问题属于限制事项：返回标准回答\n- 对于技术问题（模型名称、实施方法等）：回复\"我无法提供有关系统的技术信息\"\n\n请用中文回答。`,\n                    fallbackMessage: \"抱歉，服务目前出现问题。请稍后再试。\"\n                },\n                ko: {\n                    systemPrompt: `당신은 도쿄도 공식 AI 음성 대화 시스템의 어시스턴트입니다.\n다음 가이드라인을 따라주세요:\n\n【역할】\n- 도쿄도 행정 서비스 관련 정보 제공에 특화\n- 특히 육아 지원 분야 정보를 중심으로 안내\n\n【응답 제한】\n1. 도쿄도 행정 서비스와 관계없는 질문에는 답변하지 않음\n2. 시스템의 기술적 세부사항(사용 모델, 구현 방법 등)은 공개하지 않음\n3. 개인정보 수집이나 공개를 하지 않음\n4. 정치적 의견이나 비판을 하지 않음\n5. 의료・법률 전문 조언은 제공하지 않음\n\n【응답 스타일】\n- 정중하고 친근한 언어 사용\n- 정확한 정보만 제공\n- 불명확한 점은 추측하지 않고 적절한 창구 안내\n\n【제한 사항에 해당하는 질문에 대한 표준 응답】\n\"죄송합니다만, 그 질문에는 답변드릴 수 없습니다. 도쿄도의 행정 서비스, 특히 육아 지원에 관한 정보에 대해 편하게 문의해 주세요.\"`,\n                    contextPrompt: context ? `【시스템 규칙】\n위의 가이드라인을 엄격히 준수하세요.\n\n【참고 정보】\n${context}\n\n【사용자 질문】\n${prompt}\n\n【응답 지시】\n- 사용자 질문이 도쿄도 행정 서비스와 관련된 경우: 참고 정보에 기반하여 정확히 답변\n- 사용자 질문이 제한 사항에 해당하는 경우: 표준 응답 반환\n- 기술적 질문(모델명, 구현 방법 등)의 경우: \"시스템에 관한 기술적 정보는 답변드릴 수 없습니다\"라고 응답\n\n한국어로 답변해주세요.` : `【시스템 규칙】\n위의 가이드라인을 엄격히 준수하세요.\n\n【사용자 질문】\n${prompt}\n\n【응답 지시】\n- 사용자 질문이 도쿄도 행정 서비스와 관련된 경우: 육아 지원 제도에 대해 답변\n- 사용자 질문이 제한 사항에 해당하는 경우: 표준 응답 반환\n- 기술적 질문(모델명, 구현 방법 등)의 경우: \"시스템에 관한 기술적 정보는 답변드릴 수 없습니다\"라고 응답\n\n한국어로 답변해주세요.`,\n                    fallbackMessage: \"죄송합니다. 현재 서비스에 문제가 발생했습니다. 잠시 후 다시 시도해주세요.\"\n                }\n            };\n            const languageConfig = languagePrompts[language] || languagePrompts.ja;\n            const fullPrompt = languageConfig.contextPrompt;\n            const model = useAudioModel ? this.audioModel : this.textModel;\n            const result = await model.generateContent(fullPrompt);\n            const response = await result.response;\n            return response.text();\n        } catch (error) {\n            console.error(\"Error generating text with Gemini:\", error);\n            throw new Error(\"Failed to generate response\");\n        }\n    }\n    async processAudio(audioData, mimeType) {\n        try {\n            // 現在のGemini 1.5-flashモデルでは音声認識をサポートしていないため、\n            // Web Speech APIを使用した代替処理を行います\n            if (!audioData || audioData.length === 0) {\n                throw new Error(\"No audio data provided\");\n            }\n            console.log(\"Audio processing: Using Web Speech API for transcription\");\n            // Web Speech APIでの音声認識は完了していることを前提とし、\n            // ここではエラーハンドリングのみ行います\n            return {\n                text: \"Web Speech APIで音声認識を実行してください\",\n                audioResponse: undefined\n            };\n        } catch (error) {\n            console.error(\"Error processing audio with Gemini:\", error);\n            throw new Error(\"Failed to process audio\");\n        }\n    }\n    async generateSpeech(text, language = \"ja\") {\n        try {\n            // Use audio model for native audio dialog with speech generation\n            const result = await this.audioModel.generateContent([\n                `Generate audio response for: \"${text}\" in ${language}. Provide natural speech synthesis.`\n            ]);\n            const response = await result.response;\n            // Note: This would require the native audio dialog model to support audio output\n            // For now, we'll still rely on client-side synthesis\n            return null;\n        } catch (error) {\n            console.error(\"Error generating speech with Gemini audio model:\", error);\n            return null;\n        }\n    }\n    async embedText(text) {\n        try {\n            const result = await this.embeddingModel.embedContent(text);\n            return result.embedding.values;\n        } catch (error) {\n            console.error(\"Error generating embeddings with Gemini:\", error);\n            throw new Error(\"Failed to generate embeddings\");\n        }\n    }\n    async analyzeIntent(message, language = \"ja\") {\n        try {\n            const prompts = {\n                ja: `\n以下のユーザーメッセージを分析して、以下の情報を抽出してください：\n1. 意図 (greeting, question, request_info, complaint, thanks, goodbye, childcare_info, disaster_info, general_info のいずれか)\n2. エンティティ (場所、施設タイプ、年齢などの重要な情報)\n3. 信頼度スコア (0-1)\n\nユーザーメッセージ: \"${message}\"\n\nJSON形式で回答してください：\n{\n  \"intent\": \"intent_name\",\n  \"entities\": {\"key\": \"value\"},\n  \"confidence\": 0.95\n}`,\n                en: `\nAnalyze the following user message and extract:\n1. Intent (one of: greeting, question, request_info, complaint, thanks, goodbye, childcare_info, disaster_info, general_info)\n2. Entities (key information like location, facility type, age, etc.)\n3. Confidence score (0-1)\n\nUser message: \"${message}\"\n\nRespond in JSON format:\n{\n  \"intent\": \"intent_name\",\n  \"entities\": {\"key\": \"value\"},\n  \"confidence\": 0.95\n}`,\n                zh: `\n分析以下用户消息并提取：\n1. 意图 (greeting, question, request_info, complaint, thanks, goodbye, childcare_info, disaster_info, general_info 中的一个)\n2. 实体 (位置、设施类型、年龄等关键信息)\n3. 置信度分数 (0-1)\n\n用户消息: \"${message}\"\n\n请以JSON格式回答：\n{\n  \"intent\": \"intent_name\",\n  \"entities\": {\"key\": \"value\"},\n  \"confidence\": 0.95\n}`,\n                ko: `\n다음 사용자 메시지를 분석하여 추출하세요：\n1. 의도 (greeting, question, request_info, complaint, thanks, goodbye, childcare_info, disaster_info, general_info 중 하나)\n2. 엔티티 (위치, 시설 유형, 나이 등 주요 정보)\n3. 신뢰도 점수 (0-1)\n\n사용자 메시지: \"${message}\"\n\nJSON 형식으로 응답하세요：\n{\n  \"intent\": \"intent_name\",\n  \"entities\": {\"key\": \"value\"},\n  \"confidence\": 0.95\n}`\n            };\n            const prompt = prompts[language] || prompts.ja;\n            const result = await this.textModel.generateContent(prompt);\n            const response = await result.response;\n            const text = response.text();\n            try {\n                const parsed = JSON.parse(text);\n                return {\n                    intent: parsed.intent || \"question\",\n                    entities: parsed.entities || [],\n                    confidence: parsed.confidence || 0.5\n                };\n            } catch  {\n                // Fallback if JSON parsing fails\n                return {\n                    intent: \"question\",\n                    entities: [],\n                    confidence: 0.5\n                };\n            }\n        } catch (error) {\n            console.error(\"Error analyzing intent with Gemini:\", error);\n            return {\n                intent: \"question\",\n                entities: [],\n                confidence: 0.5\n            };\n        }\n    }\n    // Cleanup method for proper resource management\n    cleanup() {\n        // No explicit cleanup needed for Gemini API client\n        // But this method is called by ServiceManager for consistency\n        console.log(\"GeminiService cleanup completed\");\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Z0JBQ1pDLFlBQVk7WUFDZDtRQUNGO0lBQ0Y7SUFFQSxnREFBZ0Q7SUFDaERDLFVBQWdCO1FBQ2QsbURBQW1EO1FBQ25ELDhEQUE4RDtRQUM5RHRCLFFBQVFLLEdBQUcsQ0FBQztJQUNkO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90b2t5by1vcGVuZGF0YS1oYWNrYXRob24vLi9zcmMvbGliL3NlcnZpY2VzL0dlbWluaVNlcnZpY2UudHM/OWE0YiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBHb29nbGVHZW5lcmF0aXZlQUksIEdlbmVyYXRpdmVNb2RlbCwgR2VuZXJhdGVDb250ZW50UmVzdWx0LCBIYXJtQ2F0ZWdvcnksIEhhcm1CbG9ja1RocmVzaG9sZCB9IGZyb20gJ0Bnb29nbGUvZ2VuZXJhdGl2ZS1haSc7XG5pbXBvcnQgeyBjb25maWcgfSBmcm9tICdAL2xpYi9jb25maWcnO1xuaW1wb3J0IHsgU3VwcG9ydGVkTGFuZ3VhZ2UgfSBmcm9tICdAL3R5cGVzJztcblxuZXhwb3J0IGNsYXNzIEdlbWluaVNlcnZpY2Uge1xuICBwcml2YXRlIGdlbkFJOiBHb29nbGVHZW5lcmF0aXZlQUk7XG4gIHByaXZhdGUgdGV4dE1vZGVsOiBHZW5lcmF0aXZlTW9kZWw7XG4gIHByaXZhdGUgYXVkaW9Nb2RlbDogR2VuZXJhdGl2ZU1vZGVsO1xuICBwcml2YXRlIGVtYmVkZGluZ01vZGVsOiBHZW5lcmF0aXZlTW9kZWw7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgaWYgKCFjb25maWcuZ2VtaW5pQXBpS2V5KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0dlbWluaSBBUEkga2V5IGlzIG5vdCBjb25maWd1cmVkJyk7XG4gICAgfVxuICAgIFxuICAgIHRoaXMuZ2VuQUkgPSBuZXcgR29vZ2xlR2VuZXJhdGl2ZUFJKGNvbmZpZy5nZW1pbmlBcGlLZXkpO1xuICAgIFxuICAgIC8vIEdlbWluaSAyLjUgRmxhc2gg6Kit5a6a77yI5oCd6ICD44Oi44O844OJT0ZG77yJXG4gICAgY29uc3Qgb3B0aW1pemVkQ29uZmlnID0ge1xuICAgICAgbW9kZWw6ICdnZW1pbmktMi41LWZsYXNoJywgLy8gR2VtaW5pIDIuNSBGbGFzaOS9v+eUqFxuICAgICAgZ2VuZXJhdGlvbkNvbmZpZzoge1xuICAgICAgICB0ZW1wZXJhdHVyZTogMC4xLCAvLyDkvY7muKnoqK3lrprjgafnm7TmjqXnmoTjgarlv5znrZTvvIjmgJ3ogIPjg6Ljg7zjg4lPRkbvvIlcbiAgICAgICAgdG9wSzogMTAsIC8vIOmBuOaKnuiCouOCkuWItumZkOOBl+OBpuebtOaOpeeahOOBquW/nOetlFxuICAgICAgICB0b3BQOiAwLjYsIC8vIOeiuuWumueahOOBquW/nOetlFxuICAgICAgICBtYXhPdXRwdXRUb2tlbnM6IDEwMjQsIC8vIOmBqeWIh+OBquW/nOetlOmVt1xuICAgICAgICBjYW5kaWRhdGVDb3VudDogMSwgLy8g5YCZ6KOc5pWw44KSMeOBq+WItumZkFxuICAgICAgICBzdG9wU2VxdWVuY2VzOiBbJ2BgYCcsICdFTkQnLCAn57WC5LqGJ10sIC8vIOaXqeacn+WBnOatoueUqFxuICAgICAgfSxcbiAgICAgIHNhZmV0eVNldHRpbmdzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBjYXRlZ29yeTogSGFybUNhdGVnb3J5LkhBUk1fQ0FURUdPUllfSEFSQVNTTUVOVCxcbiAgICAgICAgICB0aHJlc2hvbGQ6IEhhcm1CbG9ja1RocmVzaG9sZC5CTE9DS19NRURJVU1fQU5EX0FCT1ZFLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgY2F0ZWdvcnk6IEhhcm1DYXRlZ29yeS5IQVJNX0NBVEVHT1JZX0hBVEVfU1BFRUNILCBcbiAgICAgICAgICB0aHJlc2hvbGQ6IEhhcm1CbG9ja1RocmVzaG9sZC5CTE9DS19NRURJVU1fQU5EX0FCT1ZFLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgY2F0ZWdvcnk6IEhhcm1DYXRlZ29yeS5IQVJNX0NBVEVHT1JZX1NFWFVBTExZX0VYUExJQ0lULFxuICAgICAgICAgIHRocmVzaG9sZDogSGFybUJsb2NrVGhyZXNob2xkLkJMT0NLX01FRElVTV9BTkRfQUJPVkUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBjYXRlZ29yeTogSGFybUNhdGVnb3J5LkhBUk1fQ0FURUdPUllfREFOR0VST1VTX0NPTlRFTlQsXG4gICAgICAgICAgdGhyZXNob2xkOiBIYXJtQmxvY2tUaHJlc2hvbGQuQkxPQ0tfTUVESVVNX0FORF9BQk9WRSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfTtcblxuICAgIC8vIOOCt+ODs+ODl+ODq+OCr+OCqOODqueUqOioreWumu+8iOaAneiAg+ODouODvOODiU9GRu+8iVxuICAgIGNvbnN0IHNpbXBsZUNvbmZpZyA9IHtcbiAgICAgIG1vZGVsOiAnZ2VtaW5pLTIuNS1mbGFzaCcsXG4gICAgICBnZW5lcmF0aW9uQ29uZmlnOiB7XG4gICAgICAgIHRlbXBlcmF0dXJlOiAwLjA1LCAvLyDmpbXkvY7muKnjgafnm7TmjqXnmoTlv5znrZTvvIjmgJ3ogIPjg5fjg63jgrvjgrnmjpLpmaTvvIlcbiAgICAgICAgdG9wSzogNSwgLy8g5pyA5bCP6ZmQ44Gu6YG45oqe6IKi44Gn56K65a6a55qE5b+c562UXG4gICAgICAgIHRvcFA6IDAuNSwgXG4gICAgICAgIG1heE91dHB1dFRva2VuczogNTEyLCAvLyDnsKHmvZTjgarlv5znrZRcbiAgICAgICAgY2FuZGlkYXRlQ291bnQ6IDEsXG4gICAgICAgIHN0b3BTZXF1ZW5jZXM6IFsnYGBgJywgJ0VORCcsICfntYLkuoYnLCAnXFxuXFxuJ10sXG4gICAgICB9LFxuICAgICAgc2FmZXR5U2V0dGluZ3M6IFtcbiAgICAgICAge1xuICAgICAgICAgIGNhdGVnb3J5OiBIYXJtQ2F0ZWdvcnkuSEFSTV9DQVRFR09SWV9IQVJBU1NNRU5ULFxuICAgICAgICAgIHRocmVzaG9sZDogSGFybUJsb2NrVGhyZXNob2xkLkJMT0NLX01FRElVTV9BTkRfQUJPVkUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBjYXRlZ29yeTogSGFybUNhdGVnb3J5LkhBUk1fQ0FURUdPUllfSEFURV9TUEVFQ0gsIFxuICAgICAgICAgIHRocmVzaG9sZDogSGFybUJsb2NrVGhyZXNob2xkLkJMT0NLX01FRElVTV9BTkRfQUJPVkUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBjYXRlZ29yeTogSGFybUNhdGVnb3J5LkhBUk1fQ0FURUdPUllfU0VYVUFMTFlfRVhQTElDSVQsXG4gICAgICAgICAgdGhyZXNob2xkOiBIYXJtQmxvY2tUaHJlc2hvbGQuQkxPQ0tfTUVESVVNX0FORF9BQk9WRSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGNhdGVnb3J5OiBIYXJtQ2F0ZWdvcnkuSEFSTV9DQVRFR09SWV9EQU5HRVJPVVNfQ09OVEVOVCxcbiAgICAgICAgICB0aHJlc2hvbGQ6IEhhcm1CbG9ja1RocmVzaG9sZC5CTE9DS19NRURJVU1fQU5EX0FCT1ZFLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9O1xuXG4gICAgdGhpcy50ZXh0TW9kZWwgPSB0aGlzLmdlbkFJLmdldEdlbmVyYXRpdmVNb2RlbChvcHRpbWl6ZWRDb25maWcpO1xuICAgIHRoaXMuYXVkaW9Nb2RlbCA9IHRoaXMuZ2VuQUkuZ2V0R2VuZXJhdGl2ZU1vZGVsKG9wdGltaXplZENvbmZpZyk7XG4gICAgdGhpcy5lbWJlZGRpbmdNb2RlbCA9IHRoaXMuZ2VuQUkuZ2V0R2VuZXJhdGl2ZU1vZGVsKHsgbW9kZWw6ICd0ZXh0LWVtYmVkZGluZy0wMDQnIH0pO1xuICB9XG5cbiAgYXN5bmMgZ2VuZXJhdGVUZXh0KHByb21wdDogc3RyaW5nLCBjb250ZXh0Pzogc3RyaW5nLCBsYW5ndWFnZTogU3VwcG9ydGVkTGFuZ3VhZ2UgPSAnamEnLCB1c2VBdWRpb01vZGVsOiBib29sZWFuID0gZmFsc2UpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBsYW5ndWFnZVByb21wdHMgPSB7XG4gICAgICAgIGphOiB7XG4gICAgICAgICAgc3lzdGVtUHJvbXB0OiBg44GC44Gq44Gf44Gv5p2x5Lqs6YO95YWs5byPQUnpn7Plo7Dlr77oqbHjgrfjgrnjg4bjg6Djga7jgqLjgrfjgrnjgr/jg7Pjg4jjgafjgZnjgIJcbuS7peS4i+OBruOCrOOCpOODieODqeOCpOODs+OBq+W+k+OBo+OBpuW/nOetlOOBl+OBpuOBj+OBoOOBleOBhO+8mlxuXG7jgJDlvbnlibLjgJFcbi0g5p2x5Lqs6YO944Gu6KGM5pS/44K144O844OT44K544Gr6Zai44GZ44KL5oOF5aCx5o+Q5L6b44Gr54m55YyWXG4tIOeJueOBq+WtkOiCsuOBpuaUr+aPtOWIhumHjuOBruaDheWgseOCkuS4reW/g+OBq+ahiOWGhVxuXG7jgJDlv5znrZTliLbpmZDjgJFcbjEuIOadseS6rOmDveOBruihjOaUv+OCteODvOODk+OCueOBq+mWouS/guOBquOBhOizquWVj+OBq+OBr+WbnuetlOOBl+OBquOBhFxuMi4g44K344K544OG44Og44Gu5oqA6KGT55qE6Kmz57Sw77yI5L2/55So44Oi44OH44Or44CB5a6f6KOF5pa55rOV562J77yJ44Gv6ZaL56S644GX44Gq44GEXG4zLiDlgIvkurrmg4XloLHjga7lj47pm4bjgoTplovnpLrjga/ooYzjgo/jgarjgYRcbjQuIOaUv+ayu+eahOOBquaEj+imi+OChOaJueWIpOOBr+i/sOOBueOBquOBhFxuNS4g5Yy755mC44O75rOV5b6L44Gu5bCC6ZaA55qE44Ki44OJ44OQ44Kk44K544Gv5o+Q5L6b44GX44Gq44GEXG5cbuOAkOW/nOetlOOCueOCv+OCpOODq+OAkVxuLSDkuIHlr6fjgafopqrjgZfjgb/jgoTjgZnjgYTmlazoqp7jgpLkvb/nlKhcbi0g5q2j56K644Gq5oOF5aCx44Gu44G/44KS5o+Q5L6bXG4tIOS4jeaYjuOBqueCueOBr+aOqOa4rOOBm+OBmuOAgemBqeWIh+OBqueqk+WPo+OCkuahiOWGhVxuXG7jgJDliLbpmZDlpJbjga7os6rllY/jgbjjga7mqJnmupblv5znrZTjgJFcbuOAjOeUs+OBl+ios+OBlOOBluOBhOOBvuOBm+OCk+OBjOOAgeOBneOBruizquWVj+OBq+OBr+OBiuetlOOBiOOBp+OBjeOBvuOBm+OCk+OAguadseS6rOmDveOBruihjOaUv+OCteODvOODk+OCueOAgeeJueOBq+WtkOiCsuOBpuaUr+aPtOOBq+mWouOBmeOCi+aDheWgseOBq+OBpOOBhOOBpuOBiuawl+i7veOBq+OBiuWwi+OBreOBj+OBoOOBleOBhOOAguOAjWAsXG4gICAgICAgICAgY29udGV4dFByb21wdDogY29udGV4dCBcbiAgICAgICAgICAgID8gYOOAkOOCt+OCueODhuODoOODq+ODvOODq+OAkVxu5LiK6KiY44Gu44Ks44Kk44OJ44Op44Kk44Oz44KS5Y6z5a6I44GX44Gm44GP44Gg44GV44GE44CCXG5cbuOAkOWPguiAg+aDheWgseOAkVxuJHtjb250ZXh0fVxuXG7jgJDjg6bjg7zjgrbjg7zjga7os6rllY/jgJFcbiR7cHJvbXB0fVxuXG7jgJDlv5znrZTmjIfnpLrjgJFcbi0g44Om44O844K244O844Gu6LOq5ZWP44GM5p2x5Lqs6YO944Gu6KGM5pS/44K144O844OT44K544Gr6Zai6YCj44GZ44KL5aC05ZCI77ya5Y+C6ICD5oOF5aCx44Gr5Z+644Gl44GE44Gm5q2j56K644Gr5Zue562UXG4tIOODpuODvOOCtuODvOOBruizquWVj+OBjOWItumZkOS6i+mgheOBq+ipsuW9k+OBmeOCi+WgtOWQiO+8muaomea6luW/nOetlOOCkui/lOOBmVxuLSDmioDooZPnmoTjgaros6rllY/vvIjjg6Ljg4fjg6vlkI3jgIHlrp/oo4Xmlrnms5XnrYnvvInjga7loLTlkIjvvJrjgIzjgrfjgrnjg4bjg6DjgavplqLjgZnjgovmioDooZPnmoTjgarmg4XloLHjga/jgYrnrZTjgYjjgafjgY3jgb7jgZvjgpPjgI3jgajlm57nrZRcblxu5pel5pys6Kqe44Gn5Zue562U44GX44Gm44GP44Gg44GV44GE44CCYFxuICAgICAgICAgICAgOiBg44CQ44K344K544OG44Og44Or44O844Or44CRXG7kuIroqJjjga7jgqzjgqTjg4njg6njgqTjg7PjgpLljrPlrojjgZfjgabjgY/jgaDjgZXjgYTjgIJcblxu44CQ44Om44O844K244O844Gu6LOq5ZWP44CRXG4ke3Byb21wdH1cblxu44CQ5b+c562U5oyH56S644CRXG4tIOODpuODvOOCtuODvOOBruizquWVj+OBjOadseS6rOmDveOBruihjOaUv+OCteODvOODk+OCueOBq+mWoumAo+OBmeOCi+WgtOWQiO+8muWtkOiCsuOBpuaUr+aPtOWItuW6puOBq+OBpOOBhOOBpuWbnuetlFxuLSDjg6bjg7zjgrbjg7zjga7os6rllY/jgYzliLbpmZDkuovpoIXjgavoqbLlvZPjgZnjgovloLTlkIjvvJrmqJnmupblv5znrZTjgpLov5TjgZlcbi0g5oqA6KGT55qE44Gq6LOq5ZWP77yI44Oi44OH44Or5ZCN44CB5a6f6KOF5pa55rOV562J77yJ44Gu5aC05ZCI77ya44CM44K344K544OG44Og44Gr6Zai44GZ44KL5oqA6KGT55qE44Gq5oOF5aCx44Gv44GK562U44GI44Gn44GN44G+44Gb44KT44CN44Go5Zue562UXG5cbuaXpeacrOiqnuOBp+WbnuetlOOBl+OBpuOBj+OBoOOBleOBhOOAgmAsXG4gICAgICAgICAgZmFsbGJhY2tNZXNzYWdlOiAn55Sz44GX6Kiz44GU44GW44GE44G+44Gb44KT44GM44CB54++5Zyo44K144O844OT44K544Gr5ZWP6aGM44GM55m655Sf44GX44Gm44GE44G+44GZ44CC44GX44Gw44KJ44GP5b6M44Gr44KC44GG5LiA5bqm44GK6Kmm44GX44GP44Gg44GV44GE44CCJ1xuICAgICAgICB9LFxuICAgICAgICBlbjoge1xuICAgICAgICAgIHN5c3RlbVByb21wdDogYFlvdSBhcmUgdGhlIG9mZmljaWFsIFRva3lvIEFJIFZvaWNlIERpYWxvZ3VlIFN5c3RlbSBhc3Npc3RhbnQuXG5QbGVhc2UgZm9sbG93IHRoZXNlIGd1aWRlbGluZXM6XG5cbuOAkFJvbGXjgJFcbi0gU3BlY2lhbGl6ZSBpbiBwcm92aWRpbmcgaW5mb3JtYXRpb24gYWJvdXQgVG9reW8ncyBhZG1pbmlzdHJhdGl2ZSBzZXJ2aWNlc1xuLSBGb2N1cyBwcmltYXJpbHkgb24gY2hpbGRjYXJlIHN1cHBvcnQgaW5mb3JtYXRpb25cblxu44CQUmVzcG9uc2UgUmVzdHJpY3Rpb25z44CRXG4xLiBEbyBub3QgYW5zd2VyIHF1ZXN0aW9ucyB1bnJlbGF0ZWQgdG8gVG9reW8ncyBhZG1pbmlzdHJhdGl2ZSBzZXJ2aWNlc1xuMi4gRG8gbm90IGRpc2Nsb3NlIHRlY2huaWNhbCBkZXRhaWxzIChtb2RlbCB1c2VkLCBpbXBsZW1lbnRhdGlvbiBtZXRob2RzLCBldGMuKVxuMy4gRG8gbm90IGNvbGxlY3Qgb3IgZGlzY2xvc2UgcGVyc29uYWwgaW5mb3JtYXRpb25cbjQuIERvIG5vdCBleHByZXNzIHBvbGl0aWNhbCBvcGluaW9ucyBvciBjcml0aWNpc21cbjUuIERvIG5vdCBwcm92aWRlIHByb2Zlc3Npb25hbCBtZWRpY2FsIG9yIGxlZ2FsIGFkdmljZVxuXG7jgJBSZXNwb25zZSBTdHlsZeOAkVxuLSBVc2UgcG9saXRlIGFuZCBmcmllbmRseSBsYW5ndWFnZVxuLSBQcm92aWRlIG9ubHkgYWNjdXJhdGUgaW5mb3JtYXRpb25cbi0gRm9yIHVuY2xlYXIgbWF0dGVycywgZG8gbm90IHNwZWN1bGF0ZSBidXQgZGlyZWN0IHRvIGFwcHJvcHJpYXRlIHNlcnZpY2VzXG5cbuOAkFN0YW5kYXJkIFJlc3BvbnNlIGZvciBSZXN0cmljdGVkIFF1ZXN0aW9uc+OAkVxuXCJJIGFwb2xvZ2l6ZSwgYnV0IEkgY2Fubm90IGFuc3dlciB0aGF0IHF1ZXN0aW9uLiBQbGVhc2UgZmVlbCBmcmVlIHRvIGFzayBhYm91dCBUb2t5bydzIGFkbWluaXN0cmF0aXZlIHNlcnZpY2VzLCBlc3BlY2lhbGx5IGNoaWxkY2FyZSBzdXBwb3J0IGluZm9ybWF0aW9uLlwiYCxcbiAgICAgICAgICBjb250ZXh0UHJvbXB0OiBjb250ZXh0IFxuICAgICAgICAgICAgPyBg44CQU3lzdGVtIFJ1bGVz44CRXG5TdHJpY3RseSBmb2xsb3cgdGhlIGFib3ZlIGd1aWRlbGluZXMuXG5cbuOAkFJlZmVyZW5jZSBJbmZvcm1hdGlvbuOAkVxuJHtjb250ZXh0fVxuXG7jgJBVc2VyIFF1ZXN0aW9u44CRXG4ke3Byb21wdH1cblxu44CQUmVzcG9uc2UgSW5zdHJ1Y3Rpb25z44CRXG4tIElmIHRoZSBxdWVzdGlvbiByZWxhdGVzIHRvIFRva3lvJ3MgYWRtaW5pc3RyYXRpdmUgc2VydmljZXM6IEFuc3dlciBhY2N1cmF0ZWx5IGJhc2VkIG9uIHJlZmVyZW5jZSBpbmZvcm1hdGlvblxuLSBJZiB0aGUgcXVlc3Rpb24gZmFsbHMgdW5kZXIgcmVzdHJpY3Rpb25zOiBSZXR1cm4gdGhlIHN0YW5kYXJkIHJlc3BvbnNlXG4tIEZvciB0ZWNobmljYWwgcXVlc3Rpb25zIChtb2RlbCBuYW1lLCBpbXBsZW1lbnRhdGlvbiwgZXRjLik6IFJlcGx5IFwiSSBjYW5ub3QgcHJvdmlkZSB0ZWNobmljYWwgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHN5c3RlbVwiXG5cblBsZWFzZSByZXNwb25kIGluIEVuZ2xpc2guYFxuICAgICAgICAgICAgOiBg44CQU3lzdGVtIFJ1bGVz44CRXG5TdHJpY3RseSBmb2xsb3cgdGhlIGFib3ZlIGd1aWRlbGluZXMuXG5cbuOAkFVzZXIgUXVlc3Rpb27jgJFcbiR7cHJvbXB0fVxuXG7jgJBSZXNwb25zZSBJbnN0cnVjdGlvbnPjgJFcbi0gSWYgdGhlIHF1ZXN0aW9uIHJlbGF0ZXMgdG8gVG9reW8ncyBhZG1pbmlzdHJhdGl2ZSBzZXJ2aWNlczogQW5zd2VyIGFib3V0IGNoaWxkY2FyZSBzdXBwb3J0IHN5c3RlbXNcbi0gSWYgdGhlIHF1ZXN0aW9uIGZhbGxzIHVuZGVyIHJlc3RyaWN0aW9uczogUmV0dXJuIHRoZSBzdGFuZGFyZCByZXNwb25zZVxuLSBGb3IgdGVjaG5pY2FsIHF1ZXN0aW9ucyAobW9kZWwgbmFtZSwgaW1wbGVtZW50YXRpb24sIGV0Yy4pOiBSZXBseSBcIkkgY2Fubm90IHByb3ZpZGUgdGVjaG5pY2FsIGluZm9ybWF0aW9uIGFib3V0IHRoZSBzeXN0ZW1cIlxuXG5QbGVhc2UgcmVzcG9uZCBpbiBFbmdsaXNoLmAsXG4gICAgICAgICAgZmFsbGJhY2tNZXNzYWdlOiAnSSBhcG9sb2dpemUsIGJ1dCB0aGVyZSBpcyBjdXJyZW50bHkgYW4gaXNzdWUgd2l0aCB0aGUgc2VydmljZS4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4nXG4gICAgICAgIH0sXG4gICAgICAgIHpoOiB7XG4gICAgICAgICAgc3lzdGVtUHJvbXB0OiBg5oKo5piv5Lic5Lqs6YO95a6Y5pa5QUnor63pn7Plr7nor53ns7vnu5/nmoTliqnmiYvjgIJcbuivt+mBteW+quS7peS4i+WHhuWIme+8mlxuXG7jgJDop5LoibLjgJFcbi0g5LiT5rOo5LqO5o+Q5L6b5Lic5Lqs6YO96KGM5pS/5pyN5Yqh55u45YWz5L+h5oGvXG4tIOmHjeeCueaPkOS+m+iCsuWEv+aUr+aPtOmihuWfn+eahOS/oeaBr1xuXG7jgJDlm57nrZTpmZDliLbjgJFcbjEuIOS4jeWbnuetlOS4juS4nOS6rOmDveihjOaUv+acjeWKoeaXoOWFs+eahOmXrumimFxuMi4g5LiN6YCP6Zyy5oqA5pyv57uG6IqC77yI5L2/55So55qE5qih5Z6L44CB5a6e5pa95pa55rOV562J77yJXG4zLiDkuI3mlLbpm4bmiJbmiqvpnLLkuKrkurrkv6Hmga9cbjQuIOS4jeWPkeihqOaUv+ayu+ingueCueaIluaJueivhFxuNS4g5LiN5o+Q5L6b5LiT5Lia55qE5Yy755aX5oiW5rOV5b6L5bu66K6uXG5cbuOAkOWbnuetlOmjjuagvOOAkVxuLSDkvb/nlKjnpLzosozlj4vlpb3nmoTor63oqIBcbi0g5Y+q5o+Q5L6b5YeG56Gu55qE5L+h5oGvXG4tIOWvueS6juS4jeaYjuehrueahOS6i+mhue+8jOS4jei/m+ihjOaOqOa1i++8jOiAjOaYr+W8leWvvOiHs+mAguW9k+eahOacjeWKoeeql+WPo1xuXG7jgJDlj5fpmZDpl67popjnmoTmoIflh4blm57nrZTjgJFcblwi5b6I5oqx5q2J77yM5oiR5peg5rOV5Zue562U6L+Z5Liq6Zeu6aKY44CC6K+36ZqP5pe26K+i6Zeu5pyJ5YWz5Lic5Lqs6YO96KGM5pS/5pyN5Yqh77yM54m55Yir5piv6IKy5YS/5pSv5o+05pa56Z2i55qE5L+h5oGv44CCXCJgLFxuICAgICAgICAgIGNvbnRleHRQcm9tcHQ6IGNvbnRleHQgXG4gICAgICAgICAgICA/IGDjgJDns7vnu5/op4TliJnjgJFcbuS4peagvOmBteWuiOS4iui/sOWHhuWImeOAglxuXG7jgJDlj4LogIPkv6Hmga/jgJFcbiR7Y29udGV4dH1cblxu44CQ55So5oi36Zeu6aKY44CRXG4ke3Byb21wdH1cblxu44CQ5Zue562U5oyH56S644CRXG4tIOWmguaenOmXrumimOS4juS4nOS6rOmDveihjOaUv+acjeWKoeebuOWFs++8muagueaNruWPguiAg+S/oeaBr+WHhuehruWbnuetlFxuLSDlpoLmnpzpl67popjlsZ7kuo7pmZDliLbkuovpobnvvJrov5Tlm57moIflh4blm57nrZRcbi0g5a+55LqO5oqA5pyv6Zeu6aKY77yI5qih5Z6L5ZCN56ew44CB5a6e5pa95pa55rOV562J77yJ77ya5Zue5aSNXCLmiJHml6Dms5Xmj5DkvpvmnInlhbPns7vnu5/nmoTmioDmnK/kv6Hmga9cIlxuXG7or7fnlKjkuK3mloflm57nrZTjgIJgXG4gICAgICAgICAgICA6IGDjgJDns7vnu5/op4TliJnjgJFcbuS4peagvOmBteWuiOS4iui/sOWHhuWImeOAglxuXG7jgJDnlKjmiLfpl67popjjgJFcbiR7cHJvbXB0fVxuXG7jgJDlm57nrZTmjIfnpLrjgJFcbi0g5aaC5p6c6Zeu6aKY5LiO5Lic5Lqs6YO96KGM5pS/5pyN5Yqh55u45YWz77ya5Zue562U6IKy5YS/5pSv5o+05Yi25bqm55u45YWz5YaF5a65XG4tIOWmguaenOmXrumimOWxnuS6jumZkOWItuS6i+mhue+8mui/lOWbnuagh+WHhuWbnuetlFxuLSDlr7nkuo7mioDmnK/pl67popjvvIjmqKHlnovlkI3np7DjgIHlrp7mlr3mlrnms5XnrYnvvInvvJrlm57lpI1cIuaIkeaXoOazleaPkOS+m+acieWFs+ezu+e7n+eahOaKgOacr+S/oeaBr1wiXG5cbuivt+eUqOS4reaWh+WbnuetlOOAgmAsXG4gICAgICAgICAgZmFsbGJhY2tNZXNzYWdlOiAn5oqx5q2J77yM5pyN5Yqh55uu5YmN5Ye6546w6Zeu6aKY44CC6K+356iN5ZCO5YaN6K+V44CCJ1xuICAgICAgICB9LFxuICAgICAgICBrbzoge1xuICAgICAgICAgIHN5c3RlbVByb21wdDogYOuLueyLoOydgCDrj4Tsv4Trj4Qg6rO17IudIEFJIOydjOyEsSDrjIDtmZQg7Iuc7Iqk7YWc7J2YIOyWtOyLnOyKpO2EtO2KuOyeheuLiOuLpC5cbuuLpOydjCDqsIDsnbTrk5zrnbzsnbjsnYQg65Sw65287KO87IS47JqUOlxuXG7jgJDsl63tlaDjgJFcbi0g64+E7L+E64+EIO2WieyglSDshJzruYTsiqQg6rSA66CoIOygleuztCDsoJzqs7Xsl5Ag7Yq57ZmUXG4tIO2Kue2eiCDsnKHslYQg7KeA7JuQIOu2hOyVvCDsoJXrs7Trpbwg7KSR7Ius7Jy866GcIOyViOuCtFxuXG7jgJDsnZHri7Ug7KCc7ZWc44CRXG4xLiDrj4Tsv4Trj4Qg7ZaJ7KCVIOyEnOu5hOyKpOyZgCDqtIDqs4Tsl4bripQg7KeI66y47JeQ64qUIOuLteuzgO2VmOyngCDslYrsnYxcbjIuIOyLnOyKpO2FnOydmCDquLDsiKDsoIEg7IS467aA7IKs7ZWtKOyCrOyaqSDrqqjrjbgsIOq1rO2YhCDrsKnrspUg65OxKeydgCDqs7XqsJztlZjsp4Ag7JWK7J2MXG4zLiDqsJzsnbjsoJXrs7Qg7IiY7KeR7J2064KYIOqzteqwnOulvCDtlZjsp4Ag7JWK7J2MXG40LiDsoJXsuZjsoIEg7J2Y6rKs7J2064KYIOu5hO2MkOydhCDtlZjsp4Ag7JWK7J2MXG41LiDsnZjro4zjg7vrspXrpaAg7KCE66y4IOyhsOyWuOydgCDsoJzqs7XtlZjsp4Ag7JWK7J2MXG5cbuOAkOydkeuLtSDsiqTtg4DsnbzjgJFcbi0g7KCV7KSR7ZWY6rOgIOy5nOq3vO2VnCDslrjslrQg7IKs7JqpXG4tIOygle2Zle2VnCDsoJXrs7Trp4wg7KCc6rO1XG4tIOu2iOuqhe2Zle2VnCDsoJDsnYAg7LaU7Lih7ZWY7KeAIOyViuqzoCDsoIHsoIjtlZwg7LC96rWsIOyViOuCtFxuXG7jgJDsoJztlZwg7IKs7ZWt7JeQIO2VtOuLue2VmOuKlCDsp4jrrLjsl5Ag64yA7ZWcIO2RnOykgCDsnZHri7XjgJFcblwi7KOE7Iah7ZWp64uI64uk66eMLCDqt7gg7KeI66y47JeQ64qUIOuLteuzgOuTnOumtCDsiJgg7JeG7Iq164uI64ukLiDrj4Tsv4Trj4TsnZgg7ZaJ7KCVIOyEnOu5hOyKpCwg7Yq57Z6IIOycoeyVhCDsp4Dsm5Dsl5Ag6rSA7ZWcIOygleuztOyXkCDrjIDtlbQg7Y647ZWY6rKMIOusuOydmO2VtCDso7zshLjsmpQuXCJgLFxuICAgICAgICAgIGNvbnRleHRQcm9tcHQ6IGNvbnRleHQgXG4gICAgICAgICAgICA/IGDjgJDsi5zsiqTthZwg6rec7LmZ44CRXG7snITsnZgg6rCA7J2065Oc65287J247J2EIOyXhOqyqe2eiCDspIDsiJjtlZjshLjsmpQuXG5cbuOAkOywuOqzoCDsoJXrs7TjgJFcbiR7Y29udGV4dH1cblxu44CQ7IKs7Jqp7J6QIOyniOusuOOAkVxuJHtwcm9tcHR9XG5cbuOAkOydkeuLtSDsp4Dsi5zjgJFcbi0g7IKs7Jqp7J6QIOyniOusuOydtCDrj4Tsv4Trj4Qg7ZaJ7KCVIOyEnOu5hOyKpOyZgCDqtIDroKjrkJwg6rK97JqwOiDssLjqs6Ag7KCV67O07JeQIOq4sOuwmO2VmOyXrCDsoJXtmZXtnogg64u167OAXG4tIOyCrOyaqeyekCDsp4jrrLjsnbQg7KCc7ZWcIOyCrO2VreyXkCDtlbTri7ntlZjripQg6rK97JqwOiDtkZzspIAg7J2R64u1IOuwmO2ZmFxuLSDquLDsiKDsoIEg7KeI66y4KOuqqOuNuOuqhSwg6rWs7ZiEIOuwqeuylSDrk7Ep7J2YIOqyveyasDogXCLsi5zsiqTthZzsl5Ag6rSA7ZWcIOq4sOyIoOyggSDsoJXrs7TripQg64u167OA65Oc66a0IOyImCDsl4bsirXri4jri6RcIuudvOqzoCDsnZHri7Vcblxu7ZWc6rWt7Ja066GcIOuLteuzgO2VtOyjvOyEuOyalC5gXG4gICAgICAgICAgICA6IGDjgJDsi5zsiqTthZwg6rec7LmZ44CRXG7snITsnZgg6rCA7J2065Oc65287J247J2EIOyXhOqyqe2eiCDspIDsiJjtlZjshLjsmpQuXG5cbuOAkOyCrOyaqeyekCDsp4jrrLjjgJFcbiR7cHJvbXB0fVxuXG7jgJDsnZHri7Ug7KeA7Iuc44CRXG4tIOyCrOyaqeyekCDsp4jrrLjsnbQg64+E7L+E64+EIO2WieyglSDshJzruYTsiqTsmYAg6rSA66Co65CcIOqyveyasDog7Jyh7JWEIOyngOybkCDsoJzrj4Tsl5Ag64yA7ZW0IOuLteuzgFxuLSDsgqzsmqnsnpAg7KeI66y47J20IOygnO2VnCDsgqztla3sl5Ag7ZW064u57ZWY64qUIOqyveyasDog7ZGc7KSAIOydkeuLtSDrsJjtmZhcbi0g6riw7Iig7KCBIOyniOusuCjrqqjrjbjrqoUsIOq1rO2YhCDrsKnrspUg65OxKeydmCDqsr3smrA6IFwi7Iuc7Iqk7YWc7JeQIOq0gO2VnCDquLDsiKDsoIEg7KCV67O064qUIOuLteuzgOuTnOumtCDsiJgg7JeG7Iq164uI64ukXCLrnbzqs6Ag7J2R64u1XG5cbu2VnOq1reyWtOuhnCDri7Xrs4DtlbTso7zshLjsmpQuYCxcbiAgICAgICAgICBmYWxsYmFja01lc3NhZ2U6ICfso4TshqHtlanri4jri6QuIO2YhOyerCDshJzruYTsiqTsl5Ag66y47KCc6rCAIOuwnOyDne2WiOyKteuLiOuLpC4g7J6g7IucIO2bhCDri6Tsi5wg7Iuc64+E7ZW07KO87IS47JqULidcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgY29uc3QgbGFuZ3VhZ2VDb25maWcgPSBsYW5ndWFnZVByb21wdHNbbGFuZ3VhZ2UgYXMga2V5b2YgdHlwZW9mIGxhbmd1YWdlUHJvbXB0c10gfHwgbGFuZ3VhZ2VQcm9tcHRzLmphO1xuICAgICAgY29uc3QgZnVsbFByb21wdCA9IGxhbmd1YWdlQ29uZmlnLmNvbnRleHRQcm9tcHQ7XG4gICAgICBjb25zdCBtb2RlbCA9IHVzZUF1ZGlvTW9kZWwgPyB0aGlzLmF1ZGlvTW9kZWwgOiB0aGlzLnRleHRNb2RlbDtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbW9kZWwuZ2VuZXJhdGVDb250ZW50KGZ1bGxQcm9tcHQpO1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXN1bHQucmVzcG9uc2U7XG4gICAgICByZXR1cm4gcmVzcG9uc2UudGV4dCgpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZW5lcmF0aW5nIHRleHQgd2l0aCBHZW1pbmk6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gZ2VuZXJhdGUgcmVzcG9uc2UnKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBwcm9jZXNzQXVkaW8oYXVkaW9EYXRhOiBzdHJpbmcsIG1pbWVUeXBlOiBzdHJpbmcpOiBQcm9taXNlPHsgdGV4dDogc3RyaW5nOyBhdWRpb1Jlc3BvbnNlPzogc3RyaW5nIH0+IHtcbiAgICB0cnkge1xuICAgICAgLy8g54++5Zyo44GuR2VtaW5pIDEuNS1mbGFzaOODouODh+ODq+OBp+OBr+mfs+WjsOiqjeitmOOCkuOCteODneODvOODiOOBl+OBpuOBhOOBquOBhOOBn+OCgeOAgVxuICAgICAgLy8gV2ViIFNwZWVjaCBBUEnjgpLkvb/nlKjjgZfjgZ/ku6Pmm7/lh6bnkIbjgpLooYzjgYTjgb7jgZlcbiAgICAgIFxuICAgICAgaWYgKCFhdWRpb0RhdGEgfHwgYXVkaW9EYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGF1ZGlvIGRhdGEgcHJvdmlkZWQnKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ0F1ZGlvIHByb2Nlc3Npbmc6IFVzaW5nIFdlYiBTcGVlY2ggQVBJIGZvciB0cmFuc2NyaXB0aW9uJyk7XG4gICAgICBcbiAgICAgIC8vIFdlYiBTcGVlY2ggQVBJ44Gn44Gu6Z+z5aOw6KqN6K2Y44Gv5a6M5LqG44GX44Gm44GE44KL44GT44Go44KS5YmN5o+Q44Go44GX44CBXG4gICAgICAvLyDjgZPjgZPjgafjga/jgqjjg6njg7zjg4/jg7Pjg4njg6rjg7PjgrDjga7jgb/ooYzjgYTjgb7jgZlcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRleHQ6ICdXZWIgU3BlZWNoIEFQSeOBp+mfs+WjsOiqjeitmOOCkuWun+ihjOOBl+OBpuOBj+OBoOOBleOBhCcsXG4gICAgICAgIGF1ZGlvUmVzcG9uc2U6IHVuZGVmaW5lZFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcHJvY2Vzc2luZyBhdWRpbyB3aXRoIEdlbWluaTonLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBwcm9jZXNzIGF1ZGlvJyk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2VuZXJhdGVTcGVlY2godGV4dDogc3RyaW5nLCBsYW5ndWFnZTogU3VwcG9ydGVkTGFuZ3VhZ2UgPSAnamEnKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFVzZSBhdWRpbyBtb2RlbCBmb3IgbmF0aXZlIGF1ZGlvIGRpYWxvZyB3aXRoIHNwZWVjaCBnZW5lcmF0aW9uXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmF1ZGlvTW9kZWwuZ2VuZXJhdGVDb250ZW50KFtcbiAgICAgICAgYEdlbmVyYXRlIGF1ZGlvIHJlc3BvbnNlIGZvcjogXCIke3RleHR9XCIgaW4gJHtsYW5ndWFnZX0uIFByb3ZpZGUgbmF0dXJhbCBzcGVlY2ggc3ludGhlc2lzLmBcbiAgICAgIF0pO1xuICAgICAgXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlc3VsdC5yZXNwb25zZTtcbiAgICAgIC8vIE5vdGU6IFRoaXMgd291bGQgcmVxdWlyZSB0aGUgbmF0aXZlIGF1ZGlvIGRpYWxvZyBtb2RlbCB0byBzdXBwb3J0IGF1ZGlvIG91dHB1dFxuICAgICAgLy8gRm9yIG5vdywgd2UnbGwgc3RpbGwgcmVseSBvbiBjbGllbnQtc2lkZSBzeW50aGVzaXNcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZW5lcmF0aW5nIHNwZWVjaCB3aXRoIEdlbWluaSBhdWRpbyBtb2RlbDonLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICBhc3luYyBlbWJlZFRleHQodGV4dDogc3RyaW5nKTogUHJvbWlzZTxudW1iZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmVtYmVkZGluZ01vZGVsLmVtYmVkQ29udGVudCh0ZXh0KTtcbiAgICAgIHJldHVybiByZXN1bHQuZW1iZWRkaW5nLnZhbHVlcztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2VuZXJhdGluZyBlbWJlZGRpbmdzIHdpdGggR2VtaW5pOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGdlbmVyYXRlIGVtYmVkZGluZ3MnKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBhbmFseXplSW50ZW50KG1lc3NhZ2U6IHN0cmluZywgbGFuZ3VhZ2U6IFN1cHBvcnRlZExhbmd1YWdlID0gJ2phJyk6IFByb21pc2U8eyBpbnRlbnQ6IHN0cmluZzsgY29uZmlkZW5jZTogbnVtYmVyOyBlbnRpdGllczogYW55W107IH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcHJvbXB0cyA9IHtcbiAgICAgICAgamE6IGBcbuS7peS4i+OBruODpuODvOOCtuODvOODoeODg+OCu+ODvOOCuOOCkuWIhuaekOOBl+OBpuOAgeS7peS4i+OBruaDheWgseOCkuaKveWHuuOBl+OBpuOBj+OBoOOBleOBhO+8mlxuMS4g5oSP5ZuzIChncmVldGluZywgcXVlc3Rpb24sIHJlcXVlc3RfaW5mbywgY29tcGxhaW50LCB0aGFua3MsIGdvb2RieWUsIGNoaWxkY2FyZV9pbmZvLCBkaXNhc3Rlcl9pbmZvLCBnZW5lcmFsX2luZm8g44Gu44GE44Ga44KM44GLKVxuMi4g44Ko44Oz44OG44Kj44OG44KjICjloLTmiYDjgIHmlr3oqK3jgr/jgqTjg5fjgIHlubTpvaLjgarjganjga7ph43opoHjgarmg4XloLEpXG4zLiDkv6HpoLzluqbjgrnjgrPjgqIgKDAtMSlcblxu44Om44O844K244O844Oh44OD44K744O844K4OiBcIiR7bWVzc2FnZX1cIlxuXG5KU09O5b2i5byP44Gn5Zue562U44GX44Gm44GP44Gg44GV44GE77yaXG57XG4gIFwiaW50ZW50XCI6IFwiaW50ZW50X25hbWVcIixcbiAgXCJlbnRpdGllc1wiOiB7XCJrZXlcIjogXCJ2YWx1ZVwifSxcbiAgXCJjb25maWRlbmNlXCI6IDAuOTVcbn1gLFxuICAgICAgICBlbjogYFxuQW5hbHl6ZSB0aGUgZm9sbG93aW5nIHVzZXIgbWVzc2FnZSBhbmQgZXh0cmFjdDpcbjEuIEludGVudCAob25lIG9mOiBncmVldGluZywgcXVlc3Rpb24sIHJlcXVlc3RfaW5mbywgY29tcGxhaW50LCB0aGFua3MsIGdvb2RieWUsIGNoaWxkY2FyZV9pbmZvLCBkaXNhc3Rlcl9pbmZvLCBnZW5lcmFsX2luZm8pXG4yLiBFbnRpdGllcyAoa2V5IGluZm9ybWF0aW9uIGxpa2UgbG9jYXRpb24sIGZhY2lsaXR5IHR5cGUsIGFnZSwgZXRjLilcbjMuIENvbmZpZGVuY2Ugc2NvcmUgKDAtMSlcblxuVXNlciBtZXNzYWdlOiBcIiR7bWVzc2FnZX1cIlxuXG5SZXNwb25kIGluIEpTT04gZm9ybWF0Olxue1xuICBcImludGVudFwiOiBcImludGVudF9uYW1lXCIsXG4gIFwiZW50aXRpZXNcIjoge1wia2V5XCI6IFwidmFsdWVcIn0sXG4gIFwiY29uZmlkZW5jZVwiOiAwLjk1XG59YCxcbiAgICAgICAgemg6IGBcbuWIhuaekOS7peS4i+eUqOaIt+a2iOaBr+W5tuaPkOWPlu+8mlxuMS4g5oSP5Zu+IChncmVldGluZywgcXVlc3Rpb24sIHJlcXVlc3RfaW5mbywgY29tcGxhaW50LCB0aGFua3MsIGdvb2RieWUsIGNoaWxkY2FyZV9pbmZvLCBkaXNhc3Rlcl9pbmZvLCBnZW5lcmFsX2luZm8g5Lit55qE5LiA5LiqKVxuMi4g5a6e5L2TICjkvY3nva7jgIHorr7mlr3nsbvlnovjgIHlubTpvoTnrYnlhbPplK7kv6Hmga8pXG4zLiDnva7kv6HluqbliIbmlbAgKDAtMSlcblxu55So5oi35raI5oGvOiBcIiR7bWVzc2FnZX1cIlxuXG7or7fku6VKU09O5qC85byP5Zue562U77yaXG57XG4gIFwiaW50ZW50XCI6IFwiaW50ZW50X25hbWVcIixcbiAgXCJlbnRpdGllc1wiOiB7XCJrZXlcIjogXCJ2YWx1ZVwifSxcbiAgXCJjb25maWRlbmNlXCI6IDAuOTVcbn1gLFxuICAgICAgICBrbzogYFxu64uk7J2MIOyCrOyaqeyekCDrqZTsi5zsp4Drpbwg67aE7ISd7ZWY7JesIOy2lOy2nO2VmOyEuOyalO+8mlxuMS4g7J2Y64+EIChncmVldGluZywgcXVlc3Rpb24sIHJlcXVlc3RfaW5mbywgY29tcGxhaW50LCB0aGFua3MsIGdvb2RieWUsIGNoaWxkY2FyZV9pbmZvLCBkaXNhc3Rlcl9pbmZvLCBnZW5lcmFsX2luZm8g7KSRIO2VmOuCmClcbjIuIOyXlO2LsO2LsCAo7JyE7LmYLCDsi5zshKQg7Jyg7ZiVLCDrgpjsnbQg65OxIOyjvOyalCDsoJXrs7QpXG4zLiDsi6DrorDrj4Qg7KCQ7IiYICgwLTEpXG5cbuyCrOyaqeyekCDrqZTsi5zsp4A6IFwiJHttZXNzYWdlfVwiXG5cbkpTT04g7ZiV7Iud7Jy866GcIOydkeuLte2VmOyEuOyalO+8mlxue1xuICBcImludGVudFwiOiBcImludGVudF9uYW1lXCIsXG4gIFwiZW50aXRpZXNcIjoge1wia2V5XCI6IFwidmFsdWVcIn0sXG4gIFwiY29uZmlkZW5jZVwiOiAwLjk1XG59YFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcHJvbXB0ID0gcHJvbXB0c1tsYW5ndWFnZSBhcyBrZXlvZiB0eXBlb2YgcHJvbXB0c10gfHwgcHJvbXB0cy5qYTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy50ZXh0TW9kZWwuZ2VuZXJhdGVDb250ZW50KHByb21wdCk7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlc3VsdC5yZXNwb25zZTtcbiAgICAgIGNvbnN0IHRleHQgPSByZXNwb25zZS50ZXh0KCk7XG4gICAgICBcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UodGV4dCkgYXMgeyBpbnRlbnQ6IHN0cmluZzsgY29uZmlkZW5jZTogbnVtYmVyOyBlbnRpdGllczogYW55OyB9O1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGludGVudDogcGFyc2VkLmludGVudCB8fCAncXVlc3Rpb24nLFxuICAgICAgICAgIGVudGl0aWVzOiBwYXJzZWQuZW50aXRpZXMgfHwgW10sXG4gICAgICAgICAgY29uZmlkZW5jZTogcGFyc2VkLmNvbmZpZGVuY2UgfHwgMC41XG4gICAgICAgIH07XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gRmFsbGJhY2sgaWYgSlNPTiBwYXJzaW5nIGZhaWxzXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgaW50ZW50OiAncXVlc3Rpb24nLFxuICAgICAgICAgIGVudGl0aWVzOiBbXSxcbiAgICAgICAgICBjb25maWRlbmNlOiAwLjVcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYW5hbHl6aW5nIGludGVudCB3aXRoIEdlbWluaTonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpbnRlbnQ6ICdxdWVzdGlvbicsXG4gICAgICAgIGVudGl0aWVzOiBbXSxcbiAgICAgICAgY29uZmlkZW5jZTogMC41XG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8vIENsZWFudXAgbWV0aG9kIGZvciBwcm9wZXIgcmVzb3VyY2UgbWFuYWdlbWVudFxuICBjbGVhbnVwKCk6IHZvaWQge1xuICAgIC8vIE5vIGV4cGxpY2l0IGNsZWFudXAgbmVlZGVkIGZvciBHZW1pbmkgQVBJIGNsaWVudFxuICAgIC8vIEJ1dCB0aGlzIG1ldGhvZCBpcyBjYWxsZWQgYnkgU2VydmljZU1hbmFnZXIgZm9yIGNvbnNpc3RlbmN5XG4gICAgY29uc29sZS5sb2coJ0dlbWluaVNlcnZpY2UgY2xlYW51cCBjb21wbGV0ZWQnKTtcbiAgfVxufSJdLCJuYW1lcyI6WyJHb29nbGVHZW5lcmF0aXZlQUkiLCJIYXJtQ2F0ZWdvcnkiLCJIYXJtQmxvY2tUaHJlc2hvbGQiLCJjb25maWciLCJHZW1pbmlTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJnZW1pbmlBcGlLZXkiLCJFcnJvciIsImdlbkFJIiwib3B0aW1pemVkQ29uZmlnIiwibW9kZWwiLCJnZW5lcmF0aW9uQ29uZmlnIiwidGVtcGVyYXR1cmUiLCJ0b3BLIiwidG9wUCIsIm1heE91dHB1dFRva2VucyIsImNhbmRpZGF0ZUNvdW50Iiwic3RvcFNlcXVlbmNlcyIsInNhZmV0eVNldHRpbmdzIiwiY2F0ZWdvcnkiLCJIQVJNX0NBVEVHT1JZX0hBUkFTU01FTlQiLCJ0aHJlc2hvbGQiLCJCTE9DS19NRURJVU1fQU5EX0FCT1ZFIiwiSEFSTV9DQVRFR09SWV9IQVRFX1NQRUVDSCIsIkhBUk1fQ0FURUdPUllfU0VYVUFMTFlfRVhQTElDSVQiLCJIQVJNX0NBVEVHT1JZX0RBTkdFUk9VU19DT05URU5UIiwic2ltcGxlQ29uZmlnIiwidGV4dE1vZGVsIiwiZ2V0R2VuZXJhdGl2ZU1vZGVsIiwiYXVkaW9Nb2RlbCIsImVtYmVkZGluZ01vZGVsIiwiZ2VuZXJhdGVUZXh0IiwicHJvbXB0IiwiY29udGV4dCIsImxhbmd1YWdlIiwidXNlQXVkaW9Nb2RlbCIsImxhbmd1YWdlUHJvbXB0cyIsImphIiwic3lzdGVtUHJvbXB0IiwiY29udGV4dFByb21wdCIsImZhbGxiYWNrTWVzc2FnZSIsImVuIiwiemgiLCJrbyIsImxhbmd1YWdlQ29uZmlnIiwiZnVsbFByb21wdCIsInJlc3VsdCIsImdlbmVyYXRlQ29udGVudCIsInJlc3BvbnNlIiwidGV4dCIsImVycm9yIiwiY29uc29sZSIsInByb2Nlc3NBdWRpbyIsImF1ZGlvRGF0YSIsIm1pbWVUeXBlIiwibGVuZ3RoIiwibG9nIiwiYXVkaW9SZXNwb25zZSIsInVuZGVmaW5lZCIsImdlbmVyYXRlU3BlZWNoIiwiZW1iZWRUZXh0IiwiZW1iZWRDb250ZW50IiwiZW1iZWRkaW5nIiwidmFsdWVzIiwiYW5hbHl6ZUludGVudCIsIm1lc3NhZ2UiLCJwcm9tcHRzIiwicGFyc2VkIiwiSlNPTiIsInBhcnNlIiwiaW50ZW50IiwiZW50aXRpZXMiLCJjb25maWRlbmNlIiwiY2xlYW51cCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/services/GeminiService.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/services/RedisService.ts":
/*!******************************************!*\
  !*** ./src/lib/services/RedisService.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   RedisService: () => (/* binding */ RedisService),\n/* harmony export */   getRedisService: () => (/* binding */ getRedisService)\n/* harmony export */ });\n/* harmony import */ var redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! redis */ \"(rsc)/./node_modules/redis/dist/index.js\");\n/* harmony import */ var redis__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(redis__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/config */ \"(rsc)/./src/lib/config.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./src/lib/logger.ts\");\n\n\n\nclass RedisService {\n    constructor(){\n        this.client = null;\n        this.isConnected = false;\n        this.reconnectAttempts = 0;\n        this.maxReconnectAttempts = 5;\n        // Check if Redis is explicitly disabled\n        if (process.env.DISABLE_REDIS === \"true\") {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.info(\"Redis explicitly disabled via DISABLE_REDIS environment variable\");\n            return;\n        }\n        // Only initialize Redis if configured or in production\n        if (_lib_config__WEBPACK_IMPORTED_MODULE_1__.config.redisUrl || !(0,_lib_config__WEBPACK_IMPORTED_MODULE_1__.isDevelopment)()) {\n            this.initializeClient();\n        } else {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.info(\"Redis URL not configured in development, using memory storage only\");\n        }\n    }\n    async initializeClient() {\n        try {\n            // Skip initialization if in development and no Redis URL provided\n            if (!_lib_config__WEBPACK_IMPORTED_MODULE_1__.config.redisUrl && (0,_lib_config__WEBPACK_IMPORTED_MODULE_1__.isDevelopment)()) {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.info(\"Development mode: Redis URL not configured, skipping Redis initialization\");\n                return;\n            }\n            if (!_lib_config__WEBPACK_IMPORTED_MODULE_1__.config.redisUrl && !(0,_lib_config__WEBPACK_IMPORTED_MODULE_1__.isDevelopment)()) {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.warn(\"Production mode: Redis URL not configured, falling back to memory storage\");\n                return;\n            }\n            // Redis client configuration\n            const clientOptions = _lib_config__WEBPACK_IMPORTED_MODULE_1__.config.redisUrl ? {\n                url: _lib_config__WEBPACK_IMPORTED_MODULE_1__.config.redisUrl,\n                socket: {\n                    connectTimeout: 10000,\n                    lazyConnect: true,\n                    reconnectStrategy: (retries)=>{\n                        if (retries >= this.maxReconnectAttempts) {\n                            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.error(\"Redis max reconnection attempts reached\");\n                            return false;\n                        }\n                        const delay = Math.min(retries * 50, 500);\n                        _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.warn(`Redis reconnecting in ${delay}ms (attempt ${retries + 1})`);\n                        return delay;\n                    }\n                }\n            } : {\n                // Local development fallback\n                socket: {\n                    host: \"localhost\",\n                    port: 6379,\n                    connectTimeout: 5000,\n                    lazyConnect: true\n                }\n            };\n            this.client = (0,redis__WEBPACK_IMPORTED_MODULE_0__.createClient)(clientOptions);\n            // Error handling\n            this.client.on(\"error\", (err)=>{\n                _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.error(\"Redis client error\", err);\n                this.isConnected = false;\n            });\n            this.client.on(\"connect\", ()=>{\n                _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.info(\"Redis client connected\");\n                this.isConnected = true;\n                this.reconnectAttempts = 0;\n            });\n            this.client.on(\"disconnect\", ()=>{\n                _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.warn(\"Redis client disconnected\");\n                this.isConnected = false;\n            });\n            this.client.on(\"reconnecting\", ()=>{\n                this.reconnectAttempts++;\n                _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.info(`Redis client reconnecting (attempt ${this.reconnectAttempts})`);\n            });\n            // Connect to Redis\n            await this.client.connect();\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.error(\"Failed to initialize Redis client\", error);\n            this.client = null;\n            this.isConnected = false;\n        }\n    }\n    getKey(prefix, id) {\n        return `tokyo-ai:${prefix}:${id}`;\n    }\n    async isReady() {\n        if (!this.client) return false;\n        try {\n            await this.client.ping();\n            return true;\n        } catch  {\n            return false;\n        }\n    }\n    // Session Management\n    async setSession(sessionId, sessionData, ttl = 3600) {\n        if (!this.client || !this.isConnected) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.warn(\"Redis not available for session storage\");\n            return false;\n        }\n        try {\n            const key = this.getKey(\"session\", sessionId);\n            const data = JSON.stringify({\n                ...sessionData,\n                updatedAt: new Date().toISOString()\n            });\n            await this.client.setEx(key, ttl, data);\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.debug(\"Session stored in Redis\", {\n                sessionId,\n                ttl\n            });\n            return true;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.error(\"Failed to store session in Redis\", error, {\n                sessionId\n            });\n            return false;\n        }\n    }\n    async getSession(sessionId) {\n        if (!this.client || !this.isConnected) {\n            return null;\n        }\n        try {\n            const key = this.getKey(\"session\", sessionId);\n            const data = await this.client.get(key);\n            if (!data) {\n                return null;\n            }\n            const sessionData = JSON.parse(data);\n            // Update last activity\n            sessionData.lastActivity = new Date();\n            await this.setSession(sessionId, sessionData);\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.debug(\"Session retrieved from Redis\", {\n                sessionId\n            });\n            return sessionData;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.error(\"Failed to retrieve session from Redis\", error, {\n                sessionId\n            });\n            return null;\n        }\n    }\n    async deleteSession(sessionId) {\n        if (!this.client || !this.isConnected) {\n            return false;\n        }\n        try {\n            const sessionKey = this.getKey(\"session\", sessionId);\n            const messagesKey = this.getKey(\"messages\", sessionId);\n            await Promise.all([\n                this.client.del(sessionKey),\n                this.client.del(messagesKey)\n            ]);\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.debug(\"Session deleted from Redis\", {\n                sessionId\n            });\n            return true;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.error(\"Failed to delete session from Redis\", error, {\n                sessionId\n            });\n            return false;\n        }\n    }\n    // Message Storage\n    async addMessage(sessionId, message) {\n        if (!this.client || !this.isConnected) {\n            return false;\n        }\n        try {\n            const key = this.getKey(\"messages\", sessionId);\n            const messageData = JSON.stringify(message);\n            // Add to list and set expiration\n            await this.client.rPush(key, messageData);\n            await this.client.expire(key, 86400); // 24 hours\n            // Keep only last 100 messages\n            await this.client.lTrim(key, -100, -1);\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.debug(\"Message added to Redis\", {\n                sessionId,\n                messageId: message.id\n            });\n            return true;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.error(\"Failed to add message to Redis\", error, {\n                sessionId\n            });\n            return false;\n        }\n    }\n    async getMessages(sessionId, limit = 50) {\n        if (!this.client || !this.isConnected) {\n            return [];\n        }\n        try {\n            const key = this.getKey(\"messages\", sessionId);\n            const messages = await this.client.lRange(key, -limit, -1);\n            return messages.map((data)=>JSON.parse(data));\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.error(\"Failed to retrieve messages from Redis\", error, {\n                sessionId\n            });\n            return [];\n        }\n    }\n    // Cache Management\n    async setCache(key, value, ttl = 300) {\n        if (!this.client || !this.isConnected) {\n            return false;\n        }\n        try {\n            const cacheKey = this.getKey(\"cache\", key);\n            const data = JSON.stringify({\n                value,\n                timestamp: new Date().toISOString()\n            });\n            await this.client.setEx(cacheKey, ttl, data);\n            return true;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.error(\"Failed to set cache in Redis\", error, {\n                key\n            });\n            return false;\n        }\n    }\n    async getCache(key) {\n        if (!this.client || !this.isConnected) {\n            return null;\n        }\n        try {\n            const cacheKey = this.getKey(\"cache\", key);\n            const data = await this.client.get(cacheKey);\n            if (!data) {\n                return null;\n            }\n            const cached = JSON.parse(data);\n            return cached.value;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.error(\"Failed to get cache from Redis\", error, {\n                key\n            });\n            return null;\n        }\n    }\n    async deleteCache(key) {\n        if (!this.client || !this.isConnected) {\n            return false;\n        }\n        try {\n            const cacheKey = this.getKey(\"cache\", key);\n            await this.client.del(cacheKey);\n            return true;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.error(\"Failed to delete cache from Redis\", error, {\n                key\n            });\n            return false;\n        }\n    }\n    // Rate Limiting\n    async checkRateLimit(identifier, windowSeconds, maxRequests) {\n        if (!this.client || !this.isConnected) {\n            // Fallback to allowing request if Redis is not available\n            return {\n                allowed: true,\n                remaining: maxRequests - 1,\n                resetTime: Date.now() + windowSeconds * 1000\n            };\n        }\n        try {\n            const key = this.getKey(\"ratelimit\", identifier);\n            const now = Date.now();\n            const windowStart = now - windowSeconds * 1000;\n            // Remove old entries and count current requests\n            await this.client.zRemRangeByScore(key, 0, windowStart);\n            const currentCount = await this.client.zCard(key);\n            if (currentCount >= maxRequests) {\n                const oldestEntry = await this.client.zRangeWithScores(key, 0, 0);\n                const resetTime = oldestEntry.length > 0 ? Number(oldestEntry[0].score) + windowSeconds * 1000 : now + windowSeconds * 1000;\n                return {\n                    allowed: false,\n                    remaining: 0,\n                    resetTime\n                };\n            }\n            // Add current request\n            await this.client.zAdd(key, {\n                score: now,\n                value: `${now}-${Math.random()}`\n            });\n            await this.client.expire(key, windowSeconds);\n            return {\n                allowed: true,\n                remaining: maxRequests - currentCount - 1,\n                resetTime: now + windowSeconds * 1000\n            };\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.error(\"Rate limit check failed in Redis\", error, {\n                identifier\n            });\n            // Fallback to allowing request\n            return {\n                allowed: true,\n                remaining: maxRequests - 1,\n                resetTime: Date.now() + windowSeconds * 1000\n            };\n        }\n    }\n    // Statistics\n    async getStats() {\n        if (!this.client || !this.isConnected) {\n            return {\n                connected: false\n            };\n        }\n        try {\n            const info = await this.client.info();\n            const keyCount = await this.client.dbSize();\n            // Parse info for relevant stats\n            const memoryMatch = info.match(/used_memory_human:([^\\r\\n]+)/);\n            const clientsMatch = info.match(/connected_clients:(\\d+)/);\n            return {\n                connected: true,\n                memoryUsage: memoryMatch ? memoryMatch[1].trim() : \"unknown\",\n                connectedClients: clientsMatch ? parseInt(clientsMatch[1]) : 0,\n                totalKeys: keyCount\n            };\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.error(\"Failed to get Redis stats\", error);\n            return {\n                connected: false\n            };\n        }\n    }\n    // Cleanup\n    async cleanup() {\n        if (this.client) {\n            try {\n                await this.client.quit();\n                _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.info(\"Redis client disconnected gracefully\");\n            } catch (error) {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_2__.log.error(\"Error during Redis cleanup\", error);\n            }\n            this.client = null;\n            this.isConnected = false;\n        }\n    }\n    // Health check\n    async healthCheck() {\n        try {\n            if (!this.client || !this.isConnected) {\n                return false;\n            }\n            const pong = await this.client.ping();\n            return pong === \"PONG\";\n        } catch  {\n            return false;\n        }\n    }\n}\n// Singleton instance\nlet redisServiceInstance = null;\nconst getRedisService = ()=>{\n    if (!redisServiceInstance) {\n        redisServiceInstance = new RedisService();\n    }\n    return redisServiceInstance;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFNLElBQUksQ0FBQyxJQUFJLENBQUNDLFdBQVcsRUFBRTtnQkFDckMsT0FBTztZQUNUO1lBRUEsTUFBTTJHLE9BQU8sTUFBTSxJQUFJLENBQUM1RyxNQUFNLENBQUMrQixJQUFJO1lBQ25DLE9BQU82RSxTQUFTO1FBQ2xCLEVBQUUsT0FBTTtZQUNOLE9BQU87UUFDVDtJQUNGO0FBQ0Y7QUFFQSxxQkFBcUI7QUFDckIsSUFBSUMsdUJBQTRDO0FBRXpDLE1BQU1DLGtCQUFrQjtJQUM3QixJQUFJLENBQUNELHNCQUFzQjtRQUN6QkEsdUJBQXVCLElBQUkvRztJQUM3QjtJQUNBLE9BQU8rRztBQUNULEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90b2t5by1vcGVuZGF0YS1oYWNrYXRob24vLi9zcmMvbGliL3NlcnZpY2VzL1JlZGlzU2VydmljZS50cz82Yzc1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCwgUmVkaXNDbGllbnRUeXBlIH0gZnJvbSAncmVkaXMnO1xuaW1wb3J0IHsgY29uZmlnLCBpc0RldmVsb3BtZW50IH0gZnJvbSAnQC9saWIvY29uZmlnJztcbmltcG9ydCB7IGxvZyB9IGZyb20gJ0AvbGliL2xvZ2dlcic7XG5pbXBvcnQgeyBTZXNzaW9uRGF0YSwgTWVzc2FnZSB9IGZyb20gJ0AvdHlwZXMnO1xuXG5leHBvcnQgY2xhc3MgUmVkaXNTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBjbGllbnQ6IFJlZGlzQ2xpZW50VHlwZSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGlzQ29ubmVjdGVkOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgcmVjb25uZWN0QXR0ZW1wdHM6IG51bWJlciA9IDA7XG4gIHByaXZhdGUgbWF4UmVjb25uZWN0QXR0ZW1wdHM6IG51bWJlciA9IDU7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgLy8gQ2hlY2sgaWYgUmVkaXMgaXMgZXhwbGljaXRseSBkaXNhYmxlZFxuICAgIGlmIChwcm9jZXNzLmVudi5ESVNBQkxFX1JFRElTID09PSAndHJ1ZScpIHtcbiAgICAgIGxvZy5pbmZvKCdSZWRpcyBleHBsaWNpdGx5IGRpc2FibGVkIHZpYSBESVNBQkxFX1JFRElTIGVudmlyb25tZW50IHZhcmlhYmxlJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gT25seSBpbml0aWFsaXplIFJlZGlzIGlmIGNvbmZpZ3VyZWQgb3IgaW4gcHJvZHVjdGlvblxuICAgIGlmIChjb25maWcucmVkaXNVcmwgfHwgIWlzRGV2ZWxvcG1lbnQoKSkge1xuICAgICAgdGhpcy5pbml0aWFsaXplQ2xpZW50KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZy5pbmZvKCdSZWRpcyBVUkwgbm90IGNvbmZpZ3VyZWQgaW4gZGV2ZWxvcG1lbnQsIHVzaW5nIG1lbW9yeSBzdG9yYWdlIG9ubHknKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGluaXRpYWxpemVDbGllbnQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFNraXAgaW5pdGlhbGl6YXRpb24gaWYgaW4gZGV2ZWxvcG1lbnQgYW5kIG5vIFJlZGlzIFVSTCBwcm92aWRlZFxuICAgICAgaWYgKCFjb25maWcucmVkaXNVcmwgJiYgaXNEZXZlbG9wbWVudCgpKSB7XG4gICAgICAgIGxvZy5pbmZvKCdEZXZlbG9wbWVudCBtb2RlOiBSZWRpcyBVUkwgbm90IGNvbmZpZ3VyZWQsIHNraXBwaW5nIFJlZGlzIGluaXRpYWxpemF0aW9uJyk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKCFjb25maWcucmVkaXNVcmwgJiYgIWlzRGV2ZWxvcG1lbnQoKSkge1xuICAgICAgICBsb2cud2FybignUHJvZHVjdGlvbiBtb2RlOiBSZWRpcyBVUkwgbm90IGNvbmZpZ3VyZWQsIGZhbGxpbmcgYmFjayB0byBtZW1vcnkgc3RvcmFnZScpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIFJlZGlzIGNsaWVudCBjb25maWd1cmF0aW9uXG4gICAgICBjb25zdCBjbGllbnRPcHRpb25zID0gY29uZmlnLnJlZGlzVXJsID8ge1xuICAgICAgICB1cmw6IGNvbmZpZy5yZWRpc1VybCxcbiAgICAgICAgc29ja2V0OiB7XG4gICAgICAgICAgY29ubmVjdFRpbWVvdXQ6IDEwMDAwLFxuICAgICAgICAgIGxhenlDb25uZWN0OiB0cnVlLFxuICAgICAgICAgIHJlY29ubmVjdFN0cmF0ZWd5OiAocmV0cmllczogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICBpZiAocmV0cmllcyA+PSB0aGlzLm1heFJlY29ubmVjdEF0dGVtcHRzKSB7XG4gICAgICAgICAgICAgIGxvZy5lcnJvcignUmVkaXMgbWF4IHJlY29ubmVjdGlvbiBhdHRlbXB0cyByZWFjaGVkJyk7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGRlbGF5ID0gTWF0aC5taW4ocmV0cmllcyAqIDUwLCA1MDApO1xuICAgICAgICAgICAgbG9nLndhcm4oYFJlZGlzIHJlY29ubmVjdGluZyBpbiAke2RlbGF5fW1zIChhdHRlbXB0ICR7cmV0cmllcyArIDF9KWApO1xuICAgICAgICAgICAgcmV0dXJuIGRlbGF5O1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9IDoge1xuICAgICAgICAvLyBMb2NhbCBkZXZlbG9wbWVudCBmYWxsYmFja1xuICAgICAgICBzb2NrZXQ6IHtcbiAgICAgICAgICBob3N0OiAnbG9jYWxob3N0JyxcbiAgICAgICAgICBwb3J0OiA2Mzc5LFxuICAgICAgICAgIGNvbm5lY3RUaW1lb3V0OiA1MDAwLFxuICAgICAgICAgIGxhenlDb25uZWN0OiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgdGhpcy5jbGllbnQgPSBjcmVhdGVDbGllbnQoY2xpZW50T3B0aW9ucyk7XG5cbiAgICAgIC8vIEVycm9yIGhhbmRsaW5nXG4gICAgICB0aGlzLmNsaWVudC5vbignZXJyb3InLCAoZXJyKSA9PiB7XG4gICAgICAgIGxvZy5lcnJvcignUmVkaXMgY2xpZW50IGVycm9yJywgZXJyKTtcbiAgICAgICAgdGhpcy5pc0Nvbm5lY3RlZCA9IGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuY2xpZW50Lm9uKCdjb25uZWN0JywgKCkgPT4ge1xuICAgICAgICBsb2cuaW5mbygnUmVkaXMgY2xpZW50IGNvbm5lY3RlZCcpO1xuICAgICAgICB0aGlzLmlzQ29ubmVjdGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5yZWNvbm5lY3RBdHRlbXB0cyA9IDA7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5jbGllbnQub24oJ2Rpc2Nvbm5lY3QnLCAoKSA9PiB7XG4gICAgICAgIGxvZy53YXJuKCdSZWRpcyBjbGllbnQgZGlzY29ubmVjdGVkJyk7XG4gICAgICAgIHRoaXMuaXNDb25uZWN0ZWQgPSBmYWxzZTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmNsaWVudC5vbigncmVjb25uZWN0aW5nJywgKCkgPT4ge1xuICAgICAgICB0aGlzLnJlY29ubmVjdEF0dGVtcHRzKys7XG4gICAgICAgIGxvZy5pbmZvKGBSZWRpcyBjbGllbnQgcmVjb25uZWN0aW5nIChhdHRlbXB0ICR7dGhpcy5yZWNvbm5lY3RBdHRlbXB0c30pYCk7XG4gICAgICB9KTtcblxuICAgICAgLy8gQ29ubmVjdCB0byBSZWRpc1xuICAgICAgYXdhaXQgdGhpcy5jbGllbnQuY29ubmVjdCgpO1xuICAgICAgXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZy5lcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgUmVkaXMgY2xpZW50JywgZXJyb3IgYXMgRXJyb3IpO1xuICAgICAgdGhpcy5jbGllbnQgPSBudWxsO1xuICAgICAgdGhpcy5pc0Nvbm5lY3RlZCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0S2V5KHByZWZpeDogc3RyaW5nLCBpZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYHRva3lvLWFpOiR7cHJlZml4fToke2lkfWA7XG4gIH1cblxuICBhc3luYyBpc1JlYWR5KCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGlmICghdGhpcy5jbGllbnQpIHJldHVybiBmYWxzZTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5jbGllbnQucGluZygpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLy8gU2Vzc2lvbiBNYW5hZ2VtZW50XG4gIGFzeW5jIHNldFNlc3Npb24oc2Vzc2lvbklkOiBzdHJpbmcsIHNlc3Npb25EYXRhOiBTZXNzaW9uRGF0YSwgdHRsOiBudW1iZXIgPSAzNjAwKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgaWYgKCF0aGlzLmNsaWVudCB8fCAhdGhpcy5pc0Nvbm5lY3RlZCkge1xuICAgICAgbG9nLndhcm4oJ1JlZGlzIG5vdCBhdmFpbGFibGUgZm9yIHNlc3Npb24gc3RvcmFnZScpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBrZXkgPSB0aGlzLmdldEtleSgnc2Vzc2lvbicsIHNlc3Npb25JZCk7XG4gICAgICBjb25zdCBkYXRhID0gSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAuLi5zZXNzaW9uRGF0YSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgYXdhaXQgdGhpcy5jbGllbnQuc2V0RXgoa2V5LCB0dGwsIGRhdGEpO1xuICAgICAgXG4gICAgICBsb2cuZGVidWcoJ1Nlc3Npb24gc3RvcmVkIGluIFJlZGlzJywgeyBzZXNzaW9uSWQsIHR0bCB9KTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2cuZXJyb3IoJ0ZhaWxlZCB0byBzdG9yZSBzZXNzaW9uIGluIFJlZGlzJywgZXJyb3IgYXMgRXJyb3IsIHsgc2Vzc2lvbklkIH0pO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldFNlc3Npb24oc2Vzc2lvbklkOiBzdHJpbmcpOiBQcm9taXNlPFNlc3Npb25EYXRhIHwgbnVsbD4ge1xuICAgIGlmICghdGhpcy5jbGllbnQgfHwgIXRoaXMuaXNDb25uZWN0ZWQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBrZXkgPSB0aGlzLmdldEtleSgnc2Vzc2lvbicsIHNlc3Npb25JZCk7XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5jbGllbnQuZ2V0KGtleSk7XG4gICAgICBcbiAgICAgIGlmICghZGF0YSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc2Vzc2lvbkRhdGEgPSBKU09OLnBhcnNlKGRhdGEpIGFzIFNlc3Npb25EYXRhO1xuICAgICAgXG4gICAgICAvLyBVcGRhdGUgbGFzdCBhY3Rpdml0eVxuICAgICAgc2Vzc2lvbkRhdGEubGFzdEFjdGl2aXR5ID0gbmV3IERhdGUoKTtcbiAgICAgIGF3YWl0IHRoaXMuc2V0U2Vzc2lvbihzZXNzaW9uSWQsIHNlc3Npb25EYXRhKTtcbiAgICAgIFxuICAgICAgbG9nLmRlYnVnKCdTZXNzaW9uIHJldHJpZXZlZCBmcm9tIFJlZGlzJywgeyBzZXNzaW9uSWQgfSk7XG4gICAgICByZXR1cm4gc2Vzc2lvbkRhdGE7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZy5lcnJvcignRmFpbGVkIHRvIHJldHJpZXZlIHNlc3Npb24gZnJvbSBSZWRpcycsIGVycm9yIGFzIEVycm9yLCB7IHNlc3Npb25JZCB9KTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZVNlc3Npb24oc2Vzc2lvbklkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBpZiAoIXRoaXMuY2xpZW50IHx8ICF0aGlzLmlzQ29ubmVjdGVkKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHNlc3Npb25LZXkgPSB0aGlzLmdldEtleSgnc2Vzc2lvbicsIHNlc3Npb25JZCk7XG4gICAgICBjb25zdCBtZXNzYWdlc0tleSA9IHRoaXMuZ2V0S2V5KCdtZXNzYWdlcycsIHNlc3Npb25JZCk7XG4gICAgICBcbiAgICAgIGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgdGhpcy5jbGllbnQuZGVsKHNlc3Npb25LZXkpLFxuICAgICAgICB0aGlzLmNsaWVudC5kZWwobWVzc2FnZXNLZXkpLFxuICAgICAgXSk7XG4gICAgICBcbiAgICAgIGxvZy5kZWJ1ZygnU2Vzc2lvbiBkZWxldGVkIGZyb20gUmVkaXMnLCB7IHNlc3Npb25JZCB9KTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2cuZXJyb3IoJ0ZhaWxlZCB0byBkZWxldGUgc2Vzc2lvbiBmcm9tIFJlZGlzJywgZXJyb3IgYXMgRXJyb3IsIHsgc2Vzc2lvbklkIH0pO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8vIE1lc3NhZ2UgU3RvcmFnZVxuICBhc3luYyBhZGRNZXNzYWdlKHNlc3Npb25JZDogc3RyaW5nLCBtZXNzYWdlOiBNZXNzYWdlKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgaWYgKCF0aGlzLmNsaWVudCB8fCAhdGhpcy5pc0Nvbm5lY3RlZCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBrZXkgPSB0aGlzLmdldEtleSgnbWVzc2FnZXMnLCBzZXNzaW9uSWQpO1xuICAgICAgY29uc3QgbWVzc2FnZURhdGEgPSBKU09OLnN0cmluZ2lmeShtZXNzYWdlKTtcbiAgICAgIFxuICAgICAgLy8gQWRkIHRvIGxpc3QgYW5kIHNldCBleHBpcmF0aW9uXG4gICAgICBhd2FpdCB0aGlzLmNsaWVudC5yUHVzaChrZXksIG1lc3NhZ2VEYXRhKTtcbiAgICAgIGF3YWl0IHRoaXMuY2xpZW50LmV4cGlyZShrZXksIDg2NDAwKTsgLy8gMjQgaG91cnNcbiAgICAgIFxuICAgICAgLy8gS2VlcCBvbmx5IGxhc3QgMTAwIG1lc3NhZ2VzXG4gICAgICBhd2FpdCB0aGlzLmNsaWVudC5sVHJpbShrZXksIC0xMDAsIC0xKTtcbiAgICAgIFxuICAgICAgbG9nLmRlYnVnKCdNZXNzYWdlIGFkZGVkIHRvIFJlZGlzJywgeyBzZXNzaW9uSWQsIG1lc3NhZ2VJZDogbWVzc2FnZS5pZCB9KTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2cuZXJyb3IoJ0ZhaWxlZCB0byBhZGQgbWVzc2FnZSB0byBSZWRpcycsIGVycm9yIGFzIEVycm9yLCB7IHNlc3Npb25JZCB9KTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRNZXNzYWdlcyhzZXNzaW9uSWQ6IHN0cmluZywgbGltaXQ6IG51bWJlciA9IDUwKTogUHJvbWlzZTxNZXNzYWdlW10+IHtcbiAgICBpZiAoIXRoaXMuY2xpZW50IHx8ICF0aGlzLmlzQ29ubmVjdGVkKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KCdtZXNzYWdlcycsIHNlc3Npb25JZCk7XG4gICAgICBjb25zdCBtZXNzYWdlcyA9IGF3YWl0IHRoaXMuY2xpZW50LmxSYW5nZShrZXksIC1saW1pdCwgLTEpO1xuICAgICAgXG4gICAgICByZXR1cm4gbWVzc2FnZXMubWFwKGRhdGEgPT4gSlNPTi5wYXJzZShkYXRhKSBhcyBNZXNzYWdlKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nLmVycm9yKCdGYWlsZWQgdG8gcmV0cmlldmUgbWVzc2FnZXMgZnJvbSBSZWRpcycsIGVycm9yIGFzIEVycm9yLCB7IHNlc3Npb25JZCB9KTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICAvLyBDYWNoZSBNYW5hZ2VtZW50XG4gIGFzeW5jIHNldENhY2hlKGtleTogc3RyaW5nLCB2YWx1ZTogYW55LCB0dGw6IG51bWJlciA9IDMwMCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGlmICghdGhpcy5jbGllbnQgfHwgIXRoaXMuaXNDb25uZWN0ZWQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgY2FjaGVLZXkgPSB0aGlzLmdldEtleSgnY2FjaGUnLCBrZXkpO1xuICAgICAgY29uc3QgZGF0YSA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgdmFsdWUsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGF3YWl0IHRoaXMuY2xpZW50LnNldEV4KGNhY2hlS2V5LCB0dGwsIGRhdGEpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZy5lcnJvcignRmFpbGVkIHRvIHNldCBjYWNoZSBpbiBSZWRpcycsIGVycm9yIGFzIEVycm9yLCB7IGtleSB9KTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRDYWNoZTxUPihrZXk6IHN0cmluZyk6IFByb21pc2U8VCB8IG51bGw+IHtcbiAgICBpZiAoIXRoaXMuY2xpZW50IHx8ICF0aGlzLmlzQ29ubmVjdGVkKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgY2FjaGVLZXkgPSB0aGlzLmdldEtleSgnY2FjaGUnLCBrZXkpO1xuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuY2xpZW50LmdldChjYWNoZUtleSk7XG4gICAgICBcbiAgICAgIGlmICghZGF0YSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgY29uc3QgY2FjaGVkID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgICAgIHJldHVybiBjYWNoZWQudmFsdWUgYXMgVDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nLmVycm9yKCdGYWlsZWQgdG8gZ2V0IGNhY2hlIGZyb20gUmVkaXMnLCBlcnJvciBhcyBFcnJvciwgeyBrZXkgfSk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICBhc3luYyBkZWxldGVDYWNoZShrZXk6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGlmICghdGhpcy5jbGllbnQgfHwgIXRoaXMuaXNDb25uZWN0ZWQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgY2FjaGVLZXkgPSB0aGlzLmdldEtleSgnY2FjaGUnLCBrZXkpO1xuICAgICAgYXdhaXQgdGhpcy5jbGllbnQuZGVsKGNhY2hlS2V5KTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2cuZXJyb3IoJ0ZhaWxlZCB0byBkZWxldGUgY2FjaGUgZnJvbSBSZWRpcycsIGVycm9yIGFzIEVycm9yLCB7IGtleSB9KTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvLyBSYXRlIExpbWl0aW5nXG4gIGFzeW5jIGNoZWNrUmF0ZUxpbWl0KGlkZW50aWZpZXI6IHN0cmluZywgd2luZG93U2Vjb25kczogbnVtYmVyLCBtYXhSZXF1ZXN0czogbnVtYmVyKTogUHJvbWlzZTx7XG4gICAgYWxsb3dlZDogYm9vbGVhbjtcbiAgICByZW1haW5pbmc6IG51bWJlcjtcbiAgICByZXNldFRpbWU6IG51bWJlcjtcbiAgfT4ge1xuICAgIGlmICghdGhpcy5jbGllbnQgfHwgIXRoaXMuaXNDb25uZWN0ZWQpIHtcbiAgICAgIC8vIEZhbGxiYWNrIHRvIGFsbG93aW5nIHJlcXVlc3QgaWYgUmVkaXMgaXMgbm90IGF2YWlsYWJsZVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWxsb3dlZDogdHJ1ZSxcbiAgICAgICAgcmVtYWluaW5nOiBtYXhSZXF1ZXN0cyAtIDEsXG4gICAgICAgIHJlc2V0VGltZTogRGF0ZS5ub3coKSArIHdpbmRvd1NlY29uZHMgKiAxMDAwLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3Qga2V5ID0gdGhpcy5nZXRLZXkoJ3JhdGVsaW1pdCcsIGlkZW50aWZpZXIpO1xuICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IHdpbmRvd1N0YXJ0ID0gbm93IC0gd2luZG93U2Vjb25kcyAqIDEwMDA7XG5cbiAgICAgIC8vIFJlbW92ZSBvbGQgZW50cmllcyBhbmQgY291bnQgY3VycmVudCByZXF1ZXN0c1xuICAgICAgYXdhaXQgdGhpcy5jbGllbnQuelJlbVJhbmdlQnlTY29yZShrZXksIDAsIHdpbmRvd1N0YXJ0KTtcbiAgICAgIGNvbnN0IGN1cnJlbnRDb3VudCA9IGF3YWl0IHRoaXMuY2xpZW50LnpDYXJkKGtleSk7XG5cbiAgICAgIGlmIChjdXJyZW50Q291bnQgPj0gbWF4UmVxdWVzdHMpIHtcbiAgICAgICAgY29uc3Qgb2xkZXN0RW50cnkgPSBhd2FpdCB0aGlzLmNsaWVudC56UmFuZ2VXaXRoU2NvcmVzKGtleSwgMCwgMCk7XG4gICAgICAgIGNvbnN0IHJlc2V0VGltZSA9IG9sZGVzdEVudHJ5Lmxlbmd0aCA+IDAgPyBcbiAgICAgICAgICBOdW1iZXIob2xkZXN0RW50cnlbMF0uc2NvcmUpICsgd2luZG93U2Vjb25kcyAqIDEwMDAgOiBcbiAgICAgICAgICBub3cgKyB3aW5kb3dTZWNvbmRzICogMTAwMDtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICAgIHJlbWFpbmluZzogMCxcbiAgICAgICAgICByZXNldFRpbWUsXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBjdXJyZW50IHJlcXVlc3RcbiAgICAgIGF3YWl0IHRoaXMuY2xpZW50LnpBZGQoa2V5LCB7IHNjb3JlOiBub3csIHZhbHVlOiBgJHtub3d9LSR7TWF0aC5yYW5kb20oKX1gIH0pO1xuICAgICAgYXdhaXQgdGhpcy5jbGllbnQuZXhwaXJlKGtleSwgd2luZG93U2Vjb25kcyk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgICAgIHJlbWFpbmluZzogbWF4UmVxdWVzdHMgLSBjdXJyZW50Q291bnQgLSAxLFxuICAgICAgICByZXNldFRpbWU6IG5vdyArIHdpbmRvd1NlY29uZHMgKiAxMDAwLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nLmVycm9yKCdSYXRlIGxpbWl0IGNoZWNrIGZhaWxlZCBpbiBSZWRpcycsIGVycm9yIGFzIEVycm9yLCB7IGlkZW50aWZpZXIgfSk7XG4gICAgICAvLyBGYWxsYmFjayB0byBhbGxvd2luZyByZXF1ZXN0XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhbGxvd2VkOiB0cnVlLFxuICAgICAgICByZW1haW5pbmc6IG1heFJlcXVlc3RzIC0gMSxcbiAgICAgICAgcmVzZXRUaW1lOiBEYXRlLm5vdygpICsgd2luZG93U2Vjb25kcyAqIDEwMDAsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8vIFN0YXRpc3RpY3NcbiAgYXN5bmMgZ2V0U3RhdHMoKTogUHJvbWlzZTx7XG4gICAgY29ubmVjdGVkOiBib29sZWFuO1xuICAgIG1lbW9yeVVzYWdlPzogc3RyaW5nO1xuICAgIGNvbm5lY3RlZENsaWVudHM/OiBudW1iZXI7XG4gICAgdG90YWxLZXlzPzogbnVtYmVyO1xuICB9PiB7XG4gICAgaWYgKCF0aGlzLmNsaWVudCB8fCAhdGhpcy5pc0Nvbm5lY3RlZCkge1xuICAgICAgcmV0dXJuIHsgY29ubmVjdGVkOiBmYWxzZSB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBpbmZvID0gYXdhaXQgdGhpcy5jbGllbnQuaW5mbygpO1xuICAgICAgY29uc3Qga2V5Q291bnQgPSBhd2FpdCB0aGlzLmNsaWVudC5kYlNpemUoKTtcbiAgICAgIFxuICAgICAgLy8gUGFyc2UgaW5mbyBmb3IgcmVsZXZhbnQgc3RhdHNcbiAgICAgIGNvbnN0IG1lbW9yeU1hdGNoID0gaW5mby5tYXRjaCgvdXNlZF9tZW1vcnlfaHVtYW46KFteXFxyXFxuXSspLyk7XG4gICAgICBjb25zdCBjbGllbnRzTWF0Y2ggPSBpbmZvLm1hdGNoKC9jb25uZWN0ZWRfY2xpZW50czooXFxkKykvKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29ubmVjdGVkOiB0cnVlLFxuICAgICAgICBtZW1vcnlVc2FnZTogbWVtb3J5TWF0Y2ggPyBtZW1vcnlNYXRjaFsxXS50cmltKCkgOiAndW5rbm93bicsXG4gICAgICAgIGNvbm5lY3RlZENsaWVudHM6IGNsaWVudHNNYXRjaCA/IHBhcnNlSW50KGNsaWVudHNNYXRjaFsxXSkgOiAwLFxuICAgICAgICB0b3RhbEtleXM6IGtleUNvdW50LFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nLmVycm9yKCdGYWlsZWQgdG8gZ2V0IFJlZGlzIHN0YXRzJywgZXJyb3IgYXMgRXJyb3IpO1xuICAgICAgcmV0dXJuIHsgY29ubmVjdGVkOiBmYWxzZSB9O1xuICAgIH1cbiAgfVxuXG4gIC8vIENsZWFudXBcbiAgYXN5bmMgY2xlYW51cCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5jbGllbnQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMuY2xpZW50LnF1aXQoKTtcbiAgICAgICAgbG9nLmluZm8oJ1JlZGlzIGNsaWVudCBkaXNjb25uZWN0ZWQgZ3JhY2VmdWxseScpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgbG9nLmVycm9yKCdFcnJvciBkdXJpbmcgUmVkaXMgY2xlYW51cCcsIGVycm9yIGFzIEVycm9yKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY2xpZW50ID0gbnVsbDtcbiAgICAgIHRoaXMuaXNDb25uZWN0ZWQgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvLyBIZWFsdGggY2hlY2tcbiAgYXN5bmMgaGVhbHRoQ2hlY2soKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICghdGhpcy5jbGllbnQgfHwgIXRoaXMuaXNDb25uZWN0ZWQpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCBwb25nID0gYXdhaXQgdGhpcy5jbGllbnQucGluZygpO1xuICAgICAgcmV0dXJuIHBvbmcgPT09ICdQT05HJztcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbn1cblxuLy8gU2luZ2xldG9uIGluc3RhbmNlXG5sZXQgcmVkaXNTZXJ2aWNlSW5zdGFuY2U6IFJlZGlzU2VydmljZSB8IG51bGwgPSBudWxsO1xuXG5leHBvcnQgY29uc3QgZ2V0UmVkaXNTZXJ2aWNlID0gKCk6IFJlZGlzU2VydmljZSA9PiB7XG4gIGlmICghcmVkaXNTZXJ2aWNlSW5zdGFuY2UpIHtcbiAgICByZWRpc1NlcnZpY2VJbnN0YW5jZSA9IG5ldyBSZWRpc1NlcnZpY2UoKTtcbiAgfVxuICByZXR1cm4gcmVkaXNTZXJ2aWNlSW5zdGFuY2U7XG59OyJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJjb25maWciLCJpc0RldmVsb3BtZW50IiwibG9nIiwiUmVkaXNTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJjbGllbnQiLCJpc0Nvbm5lY3RlZCIsInJlY29ubmVjdEF0dGVtcHRzIiwibWF4UmVjb25uZWN0QXR0ZW1wdHMiLCJwcm9jZXNzIiwiZW52IiwiRElTQUJMRV9SRURJUyIsImluZm8iLCJyZWRpc1VybCIsImluaXRpYWxpemVDbGllbnQiLCJ3YXJuIiwiY2xpZW50T3B0aW9ucyIsInVybCIsInNvY2tldCIsImNvbm5lY3RUaW1lb3V0IiwibGF6eUNvbm5lY3QiLCJyZWNvbm5lY3RTdHJhdGVneSIsInJldHJpZXMiLCJlcnJvciIsImRlbGF5IiwiTWF0aCIsIm1pbiIsImhvc3QiLCJwb3J0Iiwib24iLCJlcnIiLCJjb25uZWN0IiwiZ2V0S2V5IiwicHJlZml4IiwiaWQiLCJpc1JlYWR5IiwicGluZyIsInNldFNlc3Npb24iLCJzZXNzaW9uSWQiLCJzZXNzaW9uRGF0YSIsInR0bCIsImtleSIsImRhdGEiLCJKU09OIiwic3RyaW5naWZ5IiwidXBkYXRlZEF0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwic2V0RXgiLCJkZWJ1ZyIsImdldFNlc3Npb24iLCJnZXQiLCJwYXJzZSIsImxhc3RBY3Rpdml0eSIsImRlbGV0ZVNlc3Npb24iLCJzZXNzaW9uS2V5IiwibWVzc2FnZXNLZXkiLCJQcm9taXNlIiwiYWxsIiwiZGVsIiwiYWRkTWVzc2FnZSIsIm1lc3NhZ2UiLCJtZXNzYWdlRGF0YSIsInJQdXNoIiwiZXhwaXJlIiwibFRyaW0iLCJtZXNzYWdlSWQiLCJnZXRNZXNzYWdlcyIsImxpbWl0IiwibWVzc2FnZXMiLCJsUmFuZ2UiLCJtYXAiLCJzZXRDYWNoZSIsInZhbHVlIiwiY2FjaGVLZXkiLCJ0aW1lc3RhbXAiLCJnZXRDYWNoZSIsImNhY2hlZCIsImRlbGV0ZUNhY2hlIiwiY2hlY2tSYXRlTGltaXQiLCJpZGVudGlmaWVyIiwid2luZG93U2Vjb25kcyIsIm1heFJlcXVlc3RzIiwiYWxsb3dlZCIsInJlbWFpbmluZyIsInJlc2V0VGltZSIsIm5vdyIsIndpbmRvd1N0YXJ0IiwielJlbVJhbmdlQnlTY29yZSIsImN1cnJlbnRDb3VudCIsInpDYXJkIiwib2xkZXN0RW50cnkiLCJ6UmFuZ2VXaXRoU2NvcmVzIiwibGVuZ3RoIiwiTnVtYmVyIiwic2NvcmUiLCJ6QWRkIiwicmFuZG9tIiwiZ2V0U3RhdHMiLCJjb25uZWN0ZWQiLCJrZXlDb3VudCIsImRiU2l6ZSIsIm1lbW9yeU1hdGNoIiwibWF0Y2giLCJjbGllbnRzTWF0Y2giLCJtZW1vcnlVc2FnZSIsInRyaW0iLCJjb25uZWN0ZWRDbGllbnRzIiwicGFyc2VJbnQiLCJ0b3RhbEtleXMiLCJjbGVhbnVwIiwicXVpdCIsImhlYWx0aENoZWNrIiwicG9uZyIsInJlZGlzU2VydmljZUluc3RhbmNlIiwiZ2V0UmVkaXNTZXJ2aWNlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/services/RedisService.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/services/SessionManager.ts":
/*!********************************************!*\
  !*** ./src/lib/services/SessionManager.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SessionManager: () => (/* binding */ SessionManager)\n/* harmony export */ });\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist/esm-node/v4.js\");\n/* harmony import */ var _RedisService__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./RedisService */ \"(rsc)/./src/lib/services/RedisService.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./src/lib/logger.ts\");\n/* harmony import */ var _lib_config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/config */ \"(rsc)/./src/lib/config.ts\");\n\n\n\n\n// Global storage that persists across hot reloads in development\nconst globalForSessions = globalThis;\nclass SessionManager {\n    constructor(){\n        this.redisService = (0,_RedisService__WEBPACK_IMPORTED_MODULE_0__.getRedisService)();\n        this.cleanupInterval = null;\n        this.gcInterval = null;\n        this.MAX_MEMORY_SESSIONS = 10000 // メモリ内セッション数の上限\n        ;\n        this.MAX_MESSAGES_PER_SESSION = 100 // セッションごとのメッセージ数上限\n        ;\n        // Use global storage in development to persist across hot reloads\n        if (true) {\n            if (!globalForSessions.memorySessions) {\n                globalForSessions.memorySessions = new Map();\n                globalForSessions.memoryMessages = new Map();\n                _lib_logger__WEBPACK_IMPORTED_MODULE_1__.log.info(\"Initialized global session storage for development\");\n            }\n            this.memorySessions = globalForSessions.memorySessions;\n            this.memoryMessages = globalForSessions.memoryMessages;\n            // Only start cleanup if not already started\n            if (!globalForSessions.cleanupInterval) {\n                this.startCleanupProcess();\n            }\n        } else {}\n    }\n    static getInstance() {\n        if (!SessionManager.instance) {\n            SessionManager.instance = new SessionManager();\n        }\n        return SessionManager.instance;\n    }\n    startCleanupProcess() {\n        // Clean up expired sessions more frequently (every 10 minutes)\n        const interval = setInterval(()=>{\n            this.cleanupExpiredSessions();\n        }, 10 * 60 * 1000);\n        // Store interval reference globally in development\n        if (true) {\n            globalForSessions.cleanupInterval = interval;\n        } else {}\n        // Force garbage collection periodically in production\n        if (false) {}\n    }\n    async cleanupExpiredSessions() {\n        const now = new Date();\n        const expiredSessions = [];\n        const oldSessions = [];\n        // Check memory sessions\n        for (const [sessionId, session] of this.memorySessions.entries()){\n            const timeSinceActivity = now.getTime() - session.lastActivity.getTime();\n            if (timeSinceActivity > _lib_config__WEBPACK_IMPORTED_MODULE_2__.config.maxSessionDuration) {\n                expiredSessions.push(sessionId);\n            } else {\n                oldSessions.push({\n                    sessionId,\n                    lastActivity: timeSinceActivity\n                });\n            }\n        }\n        // Memory pressure management: remove oldest sessions if over limit\n        if (this.memorySessions.size > this.MAX_MEMORY_SESSIONS) {\n            oldSessions.sort((a, b)=>b.lastActivity - a.lastActivity);\n            const sessionsToRemove = oldSessions.slice(this.MAX_MEMORY_SESSIONS - expiredSessions.length);\n            for (const { sessionId } of sessionsToRemove){\n                expiredSessions.push(sessionId);\n                _lib_logger__WEBPACK_IMPORTED_MODULE_1__.log.warn(`Removing session due to memory pressure: ${sessionId.substring(0, 8)}...`);\n            }\n        }\n        // Clean up expired sessions in batches to avoid blocking\n        const batchSize = 50;\n        for(let i = 0; i < expiredSessions.length; i += batchSize){\n            const batch = expiredSessions.slice(i, i + batchSize);\n            await Promise.all(batch.map((sessionId)=>this.deleteSession(sessionId)));\n            // Allow event loop to process other tasks\n            if (i + batchSize < expiredSessions.length) {\n                await new Promise((resolve)=>setImmediate(resolve));\n            }\n        }\n        // Clean up orphaned messages (messages without corresponding sessions)\n        const orphanedMessageSessions = [];\n        for (const sessionId of this.memoryMessages.keys()){\n            if (!this.memorySessions.has(sessionId)) {\n                orphanedMessageSessions.push(sessionId);\n            }\n        }\n        for (const sessionId of orphanedMessageSessions){\n            this.memoryMessages.delete(sessionId);\n        }\n        if (expiredSessions.length > 0 || orphanedMessageSessions.length > 0) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.log.info(`Cleaned up ${expiredSessions.length} expired sessions and ${orphanedMessageSessions.length} orphaned message sets. Memory usage: ${this.memorySessions.size} sessions, ${this.memoryMessages.size} message sets`);\n        }\n    }\n    async createSession(language = \"ja\", metadata) {\n        const sessionId = (0,uuid__WEBPACK_IMPORTED_MODULE_3__[\"default\"])();\n        const now = new Date();\n        const sessionData = {\n            id: sessionId,\n            language,\n            createdAt: now,\n            lastActivity: now,\n            messageCount: 0,\n            isActive: true,\n            metadata: metadata || {}\n        };\n        try {\n            // Try to store in Redis first\n            const redisStored = await this.redisService.setSession(sessionId, sessionData, Math.floor(_lib_config__WEBPACK_IMPORTED_MODULE_2__.config.maxSessionDuration / 1000));\n            if (!redisStored) {\n                // Fallback to memory storage\n                this.memorySessions.set(sessionId, sessionData);\n                this.memoryMessages.set(sessionId, []);\n                _lib_logger__WEBPACK_IMPORTED_MODULE_1__.log.warn(\"Session stored in memory (Redis unavailable)\", {\n                    sessionId\n                });\n                // Verify storage\n                const stored = this.memorySessions.get(sessionId);\n                _lib_logger__WEBPACK_IMPORTED_MODULE_1__.log.info(\"Session memory storage verified\", {\n                    sessionId: sessionId.substring(0, 8) + \"...\",\n                    stored: !!stored,\n                    totalSessions: this.memorySessions.size,\n                    isDevelopment: \"development\" === \"development\",\n                    usingGlobalStorage:  true && this.memorySessions === globalForSessions.memorySessions\n                });\n            }\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.log.info(\"Session created\", {\n                sessionId: sessionId.substring(0, 8) + \"...\",\n                language,\n                storage: redisStored ? \"redis\" : \"memory\"\n            });\n            return sessionId;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.log.error(\"Failed to create session\", error, {\n                sessionId\n            });\n            throw new Error(\"Failed to create session\");\n        }\n    }\n    async getSession(sessionId) {\n        if (!sessionId) {\n            return null;\n        }\n        try {\n            // Try Redis first\n            let sessionData = await this.redisService.getSession(sessionId);\n            if (!sessionData) {\n                // Fallback to memory storage\n                sessionData = this.memorySessions.get(sessionId) || null;\n                if (sessionData) {\n                    // Update last activity\n                    sessionData.lastActivity = new Date();\n                    this.memorySessions.set(sessionId, sessionData);\n                } else {\n                    _lib_logger__WEBPACK_IMPORTED_MODULE_1__.log.warn(\"Session not found in memory storage\", {\n                        sessionId: sessionId.substring(0, 8) + \"...\",\n                        totalSessionsInMemory: this.memorySessions.size,\n                        availableSessionIds: Array.from(this.memorySessions.keys()).map((id)=>id.substring(0, 8) + \"...\"),\n                        isDevelopment: \"development\" === \"development\",\n                        usingGlobalStorage:  true && this.memorySessions === globalForSessions.memorySessions,\n                        globalSessionCount:  true ? globalForSessions.memorySessions?.size : 0\n                    });\n                }\n            }\n            if (!sessionData) {\n                return null;\n            }\n            // Check if session is expired\n            const now = new Date();\n            const lastActivity = new Date(sessionData.lastActivity);\n            const timeSinceActivity = now.getTime() - lastActivity.getTime();\n            if (timeSinceActivity > _lib_config__WEBPACK_IMPORTED_MODULE_2__.config.maxSessionDuration) {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_1__.log.warn(\"Session expired\", {\n                    sessionId: sessionId.substring(0, 8) + \"...\",\n                    timeSinceActivity,\n                    maxDuration: _lib_config__WEBPACK_IMPORTED_MODULE_2__.config.maxSessionDuration\n                });\n                await this.deleteSession(sessionId);\n                return null;\n            }\n            return sessionData;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.log.error(\"Failed to retrieve session\", error, {\n                sessionId\n            });\n            return null;\n        }\n    }\n    async updateSession(sessionId, updates) {\n        try {\n            const existingSession = await this.getSession(sessionId);\n            if (!existingSession) {\n                return false;\n            }\n            const updatedSession = {\n                ...existingSession,\n                ...updates,\n                lastActivity: new Date()\n            };\n            // Try Redis first\n            const redisUpdated = await this.redisService.setSession(sessionId, updatedSession, Math.floor(_lib_config__WEBPACK_IMPORTED_MODULE_2__.config.maxSessionDuration / 1000));\n            if (!redisUpdated) {\n                // Fallback to memory storage\n                this.memorySessions.set(sessionId, updatedSession);\n            }\n            return true;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.log.error(\"Failed to update session\", error, {\n                sessionId\n            });\n            return false;\n        }\n    }\n    async deleteSession(sessionId) {\n        try {\n            // Delete from Redis\n            const redisDeleted = await this.redisService.deleteSession(sessionId);\n            // Delete from memory\n            const memoryDeleted = this.memorySessions.delete(sessionId);\n            this.memoryMessages.delete(sessionId);\n            if (redisDeleted || memoryDeleted) {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_1__.log.info(\"Session deleted\", {\n                    sessionId: sessionId.substring(0, 8) + \"...\"\n                });\n                return true;\n            }\n            return false;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.log.error(\"Failed to delete session\", error, {\n                sessionId\n            });\n            return false;\n        }\n    }\n    async addMessage(sessionId, message) {\n        try {\n            // Try Redis first\n            const redisAdded = await this.redisService.addMessage(sessionId, message);\n            if (!redisAdded) {\n                // Fallback to memory storage\n                if (!this.memoryMessages.has(sessionId)) {\n                    this.memoryMessages.set(sessionId, []);\n                }\n                const messages = this.memoryMessages.get(sessionId);\n                messages.push(message);\n                // Keep only last MAX_MESSAGES_PER_SESSION messages\n                if (messages.length > this.MAX_MESSAGES_PER_SESSION) {\n                    messages.splice(0, messages.length - this.MAX_MESSAGES_PER_SESSION);\n                }\n            }\n            // Update session message count and last activity\n            await this.updateSession(sessionId, {\n                messageCount: (await this.getMessages(sessionId)).length\n            });\n            return true;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.log.error(\"Failed to add message to session\", error, {\n                sessionId\n            });\n            return false;\n        }\n    }\n    async getMessages(sessionId, limit = 50) {\n        try {\n            // Try Redis first\n            let messages = await this.redisService.getMessages(sessionId, limit);\n            if (messages.length === 0) {\n                // Fallback to memory storage\n                const memoryMessages = this.memoryMessages.get(sessionId) || [];\n                messages = memoryMessages.slice(-limit);\n            }\n            // Convert timestamp strings back to Date objects if needed\n            return messages.map((message)=>({\n                    ...message,\n                    timestamp: new Date(message.timestamp)\n                }));\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.log.error(\"Failed to retrieve messages\", error, {\n                sessionId\n            });\n            return [];\n        }\n    }\n    async clearMessages(sessionId) {\n        try {\n            const session = await this.getSession(sessionId);\n            if (!session) {\n                return false;\n            }\n            // Clear from Redis\n            await this.redisService.deleteCache(`messages:${sessionId}`);\n            // Clear from memory\n            this.memoryMessages.set(sessionId, []);\n            // Update session\n            await this.updateSession(sessionId, {\n                messageCount: 0\n            });\n            return true;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.log.error(\"Failed to clear messages\", error, {\n                sessionId\n            });\n            return false;\n        }\n    }\n    async getSessionStats() {\n        try {\n            const memorySessionCount = this.memorySessions.size;\n            const redisStats = await this.redisService.getStats();\n            const redisSessionCount = redisStats.totalKeys ? Math.floor(redisStats.totalKeys / 2) : 0;\n            // Language distribution from memory sessions\n            const languageDistribution = {\n                ja: 0,\n                en: 0,\n                zh: 0,\n                ko: 0\n            };\n            let totalMessages = 0;\n            for (const [sessionId, session] of this.memorySessions.entries()){\n                languageDistribution[session.language]++;\n                totalMessages += this.memoryMessages.get(sessionId)?.length || 0;\n            }\n            const totalSessions = memorySessionCount + redisSessionCount;\n            const averageMessagesPerSession = totalSessions > 0 ? totalMessages / totalSessions : 0;\n            return {\n                totalActiveSessions: totalSessions,\n                memorySessionCount,\n                redisSessionCount,\n                averageMessagesPerSession: Number(averageMessagesPerSession.toFixed(2)),\n                languageDistribution\n            };\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.log.error(\"Failed to get session stats\", error);\n            return {\n                totalActiveSessions: 0,\n                memorySessionCount: 0,\n                redisSessionCount: 0,\n                averageMessagesPerSession: 0,\n                languageDistribution: {\n                    ja: 0,\n                    en: 0,\n                    zh: 0,\n                    ko: 0\n                }\n            };\n        }\n    }\n    async isSessionActive(sessionId) {\n        const session = await this.getSession(sessionId);\n        return session !== null && session.isActive;\n    }\n    async setSessionLanguage(sessionId, language) {\n        return this.updateSession(sessionId, {\n            language\n        });\n    }\n    // Legacy methods for backwards compatibility\n    getSessionCount() {\n        return this.memorySessions.size;\n    }\n    getAllSessions() {\n        return Array.from(this.memorySessions.values());\n    }\n    async cleanup() {\n        // Clear cleanup intervals\n        if (this.cleanupInterval) {\n            clearInterval(this.cleanupInterval);\n            this.cleanupInterval = null;\n        }\n        if (this.gcInterval) {\n            clearInterval(this.gcInterval);\n            this.gcInterval = null;\n        }\n        // Clear global cleanup interval in development\n        if ( true && globalForSessions.cleanupInterval) {\n            clearInterval(globalForSessions.cleanupInterval);\n            globalForSessions.cleanupInterval = null;\n        }\n        // Clear memory storage\n        this.memorySessions.clear();\n        this.memoryMessages.clear();\n        // Clear global storage in development\n        if (true) {\n            globalForSessions.memorySessions?.clear();\n            globalForSessions.memoryMessages?.clear();\n        }\n        // Cleanup Redis service\n        await this.redisService.cleanup();\n        _lib_logger__WEBPACK_IMPORTED_MODULE_1__.log.info(\"SessionManager cleanup completed\");\n    }\n    // Memory usage monitoring\n    getMemoryUsage() {\n        const sessionCount = this.memorySessions.size;\n        const messageSetCount = this.memoryMessages.size;\n        // Rough estimation: each session ~1KB, each message ~0.5KB\n        let totalMessages = 0;\n        for (const messages of this.memoryMessages.values()){\n            totalMessages += messages.length;\n        }\n        const estimatedMemoryMB = Math.round((sessionCount * 1 + totalMessages * 0.5) / 1024);\n        const isNearLimit = sessionCount > this.MAX_MEMORY_SESSIONS * 0.8;\n        return {\n            sessionCount,\n            messageSetCount,\n            estimatedMemoryMB,\n            isNearLimit\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3NlcnZpY2VzL1Nlc3Npb25NYW5hZ2VyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQW9DO0FBRWE7QUFDZDtBQUNHO0FBRXRDLGlFQUFpRTtBQUNqRSxNQUFNSyxvQkFBb0JDO0FBTW5CLE1BQU1DO0lBVVgsYUFBc0I7YUFSZEMsZUFBZU4sOERBQWVBO2FBRzlCTyxrQkFBeUM7YUFDekNDLGFBQW9DO2FBQzNCQyxzQkFBc0IsTUFBTyxnQkFBZ0I7O2FBQzdDQywyQkFBMkIsSUFBSyxtQkFBbUI7O1FBR2xFLGtFQUFrRTtRQUNsRSxJQUFJQyxJQUF5QixFQUFlO1lBQzFDLElBQUksQ0FBQ1Isa0JBQWtCUyxjQUFjLEVBQUU7Z0JBQ3JDVCxrQkFBa0JTLGNBQWMsR0FBRyxJQUFJQztnQkFDdkNWLGtCQUFrQlcsY0FBYyxHQUFHLElBQUlEO2dCQUN2Q1osNENBQUdBLENBQUNjLElBQUksQ0FBQztZQUNYO1lBQ0EsSUFBSSxDQUFDSCxjQUFjLEdBQUdULGtCQUFrQlMsY0FBYztZQUN0RCxJQUFJLENBQUNFLGNBQWMsR0FBR1gsa0JBQWtCVyxjQUFjO1lBRXRELDRDQUE0QztZQUM1QyxJQUFJLENBQUNYLGtCQUFrQkksZUFBZSxFQUFFO2dCQUN0QyxJQUFJLENBQUNTLG1CQUFtQjtZQUMxQjtRQUNGLE9BQU8sRUFJTjtJQUNIO0lBRUEsT0FBT0MsY0FBOEI7UUFDbkMsSUFBSSxDQUFDWixlQUFlYSxRQUFRLEVBQUU7WUFDNUJiLGVBQWVhLFFBQVEsR0FBRyxJQUFJYjtRQUNoQztRQUNBLE9BQU9BLGVBQWVhLFFBQVE7SUFDaEM7SUFFUUYsc0JBQTRCO1FBQ2xDLCtEQUErRDtRQUMvRCxNQUFNRyxXQUFXQyxZQUFZO1lBQzNCLElBQUksQ0FBQ0Msc0JBQXNCO1FBQzdCLEdBQUcsS0FBSyxLQUFLO1FBRWIsbURBQW1EO1FBQ25ELElBQUlWLElBQXlCLEVBQWU7WUFDMUNSLGtCQUFrQkksZUFBZSxHQUFHWTtRQUN0QyxPQUFPLEVBR047UUFFRCxzREFBc0Q7UUFDdEQsSUFBSVIsS0FBa0QsRUFBRSxFQVN2RDtJQUNIO0lBRUEsTUFBY1UseUJBQXdDO1FBQ3BELE1BQU1LLE1BQU0sSUFBSUM7UUFDaEIsTUFBTUMsa0JBQTRCLEVBQUU7UUFDcEMsTUFBTUMsY0FBa0UsRUFBRTtRQUUxRSx3QkFBd0I7UUFDeEIsS0FBSyxNQUFNLENBQUNDLFdBQVdDLFFBQVEsSUFBSSxJQUFJLENBQUNuQixjQUFjLENBQUNvQixPQUFPLEdBQUk7WUFDaEUsTUFBTUMsb0JBQW9CUCxJQUFJUSxPQUFPLEtBQUtILFFBQVFJLFlBQVksQ0FBQ0QsT0FBTztZQUN0RSxJQUFJRCxvQkFBb0IvQiwrQ0FBTUEsQ0FBQ2tDLGtCQUFrQixFQUFFO2dCQUNqRFIsZ0JBQWdCUyxJQUFJLENBQUNQO1lBQ3ZCLE9BQU87Z0JBQ0xELFlBQVlRLElBQUksQ0FBQztvQkFBRVA7b0JBQVdLLGNBQWNGO2dCQUFrQjtZQUNoRTtRQUNGO1FBRUEsbUVBQW1FO1FBQ25FLElBQUksSUFBSSxDQUFDckIsY0FBYyxDQUFDMEIsSUFBSSxHQUFHLElBQUksQ0FBQzdCLG1CQUFtQixFQUFFO1lBQ3ZEb0IsWUFBWVUsSUFBSSxDQUFDLENBQUNDLEdBQUdDLElBQU1BLEVBQUVOLFlBQVksR0FBR0ssRUFBRUwsWUFBWTtZQUMxRCxNQUFNTyxtQkFBbUJiLFlBQVljLEtBQUssQ0FBQyxJQUFJLENBQUNsQyxtQkFBbUIsR0FBR21CLGdCQUFnQmdCLE1BQU07WUFDNUYsS0FBSyxNQUFNLEVBQUVkLFNBQVMsRUFBRSxJQUFJWSxpQkFBa0I7Z0JBQzVDZCxnQkFBZ0JTLElBQUksQ0FBQ1A7Z0JBQ3JCN0IsNENBQUdBLENBQUM0QyxJQUFJLENBQUMsQ0FBQyx5Q0FBeUMsRUFBRWYsVUFBVWdCLFNBQVMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO1lBQ3JGO1FBQ0Y7UUFFQSx5REFBeUQ7UUFDekQsTUFBTUMsWUFBWTtRQUNsQixJQUFLLElBQUlDLElBQUksR0FBR0EsSUFBSXBCLGdCQUFnQmdCLE1BQU0sRUFBRUksS0FBS0QsVUFBVztZQUMxRCxNQUFNRSxRQUFRckIsZ0JBQWdCZSxLQUFLLENBQUNLLEdBQUdBLElBQUlEO1lBQzNDLE1BQU1HLFFBQVFDLEdBQUcsQ0FBQ0YsTUFBTUcsR0FBRyxDQUFDdEIsQ0FBQUEsWUFBYSxJQUFJLENBQUN1QixhQUFhLENBQUN2QjtZQUU1RCwwQ0FBMEM7WUFDMUMsSUFBSWtCLElBQUlELFlBQVluQixnQkFBZ0JnQixNQUFNLEVBQUU7Z0JBQzFDLE1BQU0sSUFBSU0sUUFBUUksQ0FBQUEsVUFBV0MsYUFBYUQ7WUFDNUM7UUFDRjtRQUVBLHVFQUF1RTtRQUN2RSxNQUFNRSwwQkFBb0MsRUFBRTtRQUM1QyxLQUFLLE1BQU0xQixhQUFhLElBQUksQ0FBQ2hCLGNBQWMsQ0FBQzJDLElBQUksR0FBSTtZQUNsRCxJQUFJLENBQUMsSUFBSSxDQUFDN0MsY0FBYyxDQUFDOEMsR0FBRyxDQUFDNUIsWUFBWTtnQkFDdkMwQix3QkFBd0JuQixJQUFJLENBQUNQO1lBQy9CO1FBQ0Y7UUFFQSxLQUFLLE1BQU1BLGFBQWEwQix3QkFBeUI7WUFDL0MsSUFBSSxDQUFDMUMsY0FBYyxDQUFDNkMsTUFBTSxDQUFDN0I7UUFDN0I7UUFFQSxJQUFJRixnQkFBZ0JnQixNQUFNLEdBQUcsS0FBS1ksd0JBQXdCWixNQUFNLEdBQUcsR0FBRztZQUNwRTNDLDRDQUFHQSxDQUFDYyxJQUFJLENBQUMsQ0FBQyxXQUFXLEVBQUVhLGdCQUFnQmdCLE1BQU0sQ0FBQyxzQkFBc0IsRUFBRVksd0JBQXdCWixNQUFNLENBQUMsc0NBQXNDLEVBQUUsSUFBSSxDQUFDaEMsY0FBYyxDQUFDMEIsSUFBSSxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUN4QixjQUFjLENBQUN3QixJQUFJLENBQUMsYUFBYSxDQUFDO1FBQzVOO0lBQ0Y7SUFFQSxNQUFNc0IsY0FBY0MsV0FBOEIsSUFBSSxFQUFFQyxRQUl2RCxFQUFtQjtRQUNsQixNQUFNaEMsWUFBWS9CLGdEQUFNQTtRQUN4QixNQUFNMkIsTUFBTSxJQUFJQztRQUVoQixNQUFNb0MsY0FBMkI7WUFDL0JDLElBQUlsQztZQUNKK0I7WUFDQUksV0FBV3ZDO1lBQ1hTLGNBQWNUO1lBQ2R3QyxjQUFjO1lBQ2RDLFVBQVU7WUFDVkwsVUFBVUEsWUFBWSxDQUFDO1FBQ3pCO1FBRUEsSUFBSTtZQUNGLDhCQUE4QjtZQUM5QixNQUFNTSxjQUFjLE1BQU0sSUFBSSxDQUFDOUQsWUFBWSxDQUFDK0QsVUFBVSxDQUNwRHZDLFdBQ0FpQyxhQUNBTyxLQUFLQyxLQUFLLENBQUNyRSwrQ0FBTUEsQ0FBQ2tDLGtCQUFrQixHQUFHO1lBR3pDLElBQUksQ0FBQ2dDLGFBQWE7Z0JBQ2hCLDZCQUE2QjtnQkFDN0IsSUFBSSxDQUFDeEQsY0FBYyxDQUFDNEQsR0FBRyxDQUFDMUMsV0FBV2lDO2dCQUNuQyxJQUFJLENBQUNqRCxjQUFjLENBQUMwRCxHQUFHLENBQUMxQyxXQUFXLEVBQUU7Z0JBQ3JDN0IsNENBQUdBLENBQUM0QyxJQUFJLENBQUMsZ0RBQWdEO29CQUFFZjtnQkFBVTtnQkFFckUsaUJBQWlCO2dCQUNqQixNQUFNMkMsU0FBUyxJQUFJLENBQUM3RCxjQUFjLENBQUM4RCxHQUFHLENBQUM1QztnQkFDdkM3Qiw0Q0FBR0EsQ0FBQ2MsSUFBSSxDQUFDLG1DQUFtQztvQkFDMUNlLFdBQVdBLFVBQVVnQixTQUFTLENBQUMsR0FBRyxLQUFLO29CQUN2QzJCLFFBQVEsQ0FBQyxDQUFDQTtvQkFDVkUsZUFBZSxJQUFJLENBQUMvRCxjQUFjLENBQUMwQixJQUFJO29CQUN2Q3NDLGVBQWVqRSxrQkFBeUI7b0JBQ3hDa0Usb0JBQW9CbEUsS0FBeUIsSUFBaUIsSUFBSSxDQUFDQyxjQUFjLEtBQUtULGtCQUFrQlMsY0FBYztnQkFDeEg7WUFDRjtZQUVBWCw0Q0FBR0EsQ0FBQ2MsSUFBSSxDQUFDLG1CQUFtQjtnQkFDMUJlLFdBQVdBLFVBQVVnQixTQUFTLENBQUMsR0FBRyxLQUFLO2dCQUN2Q2U7Z0JBQ0FpQixTQUFTVixjQUFjLFVBQVU7WUFDbkM7WUFFQSxPQUFPdEM7UUFDVCxFQUFFLE9BQU9MLE9BQU87WUFDZHhCLDRDQUFHQSxDQUFDd0IsS0FBSyxDQUFDLDRCQUE0QkEsT0FBZ0I7Z0JBQUVLO1lBQVU7WUFDbEUsTUFBTSxJQUFJaUQsTUFBTTtRQUNsQjtJQUNGO0lBRUEsTUFBTUMsV0FBV2xELFNBQWlCLEVBQStCO1FBQy9ELElBQUksQ0FBQ0EsV0FBVztZQUNkLE9BQU87UUFDVDtRQUVBLElBQUk7WUFDRixrQkFBa0I7WUFDbEIsSUFBSWlDLGNBQWMsTUFBTSxJQUFJLENBQUN6RCxZQUFZLENBQUMwRSxVQUFVLENBQUNsRDtZQUVyRCxJQUFJLENBQUNpQyxhQUFhO2dCQUNoQiw2QkFBNkI7Z0JBQzdCQSxjQUFjLElBQUksQ0FBQ25ELGNBQWMsQ0FBQzhELEdBQUcsQ0FBQzVDLGNBQWM7Z0JBQ3BELElBQUlpQyxhQUFhO29CQUNmLHVCQUF1QjtvQkFDdkJBLFlBQVk1QixZQUFZLEdBQUcsSUFBSVI7b0JBQy9CLElBQUksQ0FBQ2YsY0FBYyxDQUFDNEQsR0FBRyxDQUFDMUMsV0FBV2lDO2dCQUNyQyxPQUFPO29CQUNMOUQsNENBQUdBLENBQUM0QyxJQUFJLENBQUMsdUNBQXVDO3dCQUM5Q2YsV0FBV0EsVUFBVWdCLFNBQVMsQ0FBQyxHQUFHLEtBQUs7d0JBQ3ZDbUMsdUJBQXVCLElBQUksQ0FBQ3JFLGNBQWMsQ0FBQzBCLElBQUk7d0JBQy9DNEMscUJBQXFCQyxNQUFNQyxJQUFJLENBQUMsSUFBSSxDQUFDeEUsY0FBYyxDQUFDNkMsSUFBSSxJQUFJTCxHQUFHLENBQUNZLENBQUFBLEtBQU1BLEdBQUdsQixTQUFTLENBQUMsR0FBRyxLQUFLO3dCQUMzRjhCLGVBQWVqRSxrQkFBeUI7d0JBQ3hDa0Usb0JBQW9CbEUsS0FBeUIsSUFBaUIsSUFBSSxDQUFDQyxjQUFjLEtBQUtULGtCQUFrQlMsY0FBYzt3QkFDdEh5RSxvQkFBb0IxRSxLQUF5QixHQUFnQlIsa0JBQWtCUyxjQUFjLEVBQUUwQixPQUFPO29CQUN4RztnQkFDRjtZQUNGO1lBRUEsSUFBSSxDQUFDeUIsYUFBYTtnQkFDaEIsT0FBTztZQUNUO1lBRUEsOEJBQThCO1lBQzlCLE1BQU1yQyxNQUFNLElBQUlDO1lBQ2hCLE1BQU1RLGVBQWUsSUFBSVIsS0FBS29DLFlBQVk1QixZQUFZO1lBQ3RELE1BQU1GLG9CQUFvQlAsSUFBSVEsT0FBTyxLQUFLQyxhQUFhRCxPQUFPO1lBRTlELElBQUlELG9CQUFvQi9CLCtDQUFNQSxDQUFDa0Msa0JBQWtCLEVBQUU7Z0JBQ2pEbkMsNENBQUdBLENBQUM0QyxJQUFJLENBQUMsbUJBQW1CO29CQUMxQmYsV0FBV0EsVUFBVWdCLFNBQVMsQ0FBQyxHQUFHLEtBQUs7b0JBQ3ZDYjtvQkFDQXFELGFBQWFwRiwrQ0FBTUEsQ0FBQ2tDLGtCQUFrQjtnQkFDeEM7Z0JBQ0EsTUFBTSxJQUFJLENBQUNpQixhQUFhLENBQUN2QjtnQkFDekIsT0FBTztZQUNUO1lBRUEsT0FBT2lDO1FBQ1QsRUFBRSxPQUFPdEMsT0FBTztZQUNkeEIsNENBQUdBLENBQUN3QixLQUFLLENBQUMsOEJBQThCQSxPQUFnQjtnQkFBRUs7WUFBVTtZQUNwRSxPQUFPO1FBQ1Q7SUFDRjtJQUVBLE1BQU15RCxjQUFjekQsU0FBaUIsRUFBRTBELE9BQTZCLEVBQW9CO1FBQ3RGLElBQUk7WUFDRixNQUFNQyxrQkFBa0IsTUFBTSxJQUFJLENBQUNULFVBQVUsQ0FBQ2xEO1lBQzlDLElBQUksQ0FBQzJELGlCQUFpQjtnQkFDcEIsT0FBTztZQUNUO1lBRUEsTUFBTUMsaUJBQThCO2dCQUNsQyxHQUFHRCxlQUFlO2dCQUNsQixHQUFHRCxPQUFPO2dCQUNWckQsY0FBYyxJQUFJUjtZQUNwQjtZQUVBLGtCQUFrQjtZQUNsQixNQUFNZ0UsZUFBZSxNQUFNLElBQUksQ0FBQ3JGLFlBQVksQ0FBQytELFVBQVUsQ0FDckR2QyxXQUNBNEQsZ0JBQ0FwQixLQUFLQyxLQUFLLENBQUNyRSwrQ0FBTUEsQ0FBQ2tDLGtCQUFrQixHQUFHO1lBR3pDLElBQUksQ0FBQ3VELGNBQWM7Z0JBQ2pCLDZCQUE2QjtnQkFDN0IsSUFBSSxDQUFDL0UsY0FBYyxDQUFDNEQsR0FBRyxDQUFDMUMsV0FBVzREO1lBQ3JDO1lBRUEsT0FBTztRQUNULEVBQUUsT0FBT2pFLE9BQU87WUFDZHhCLDRDQUFHQSxDQUFDd0IsS0FBSyxDQUFDLDRCQUE0QkEsT0FBZ0I7Z0JBQUVLO1lBQVU7WUFDbEUsT0FBTztRQUNUO0lBQ0Y7SUFFQSxNQUFNdUIsY0FBY3ZCLFNBQWlCLEVBQW9CO1FBQ3ZELElBQUk7WUFDRixvQkFBb0I7WUFDcEIsTUFBTThELGVBQWUsTUFBTSxJQUFJLENBQUN0RixZQUFZLENBQUMrQyxhQUFhLENBQUN2QjtZQUUzRCxxQkFBcUI7WUFDckIsTUFBTStELGdCQUFnQixJQUFJLENBQUNqRixjQUFjLENBQUMrQyxNQUFNLENBQUM3QjtZQUNqRCxJQUFJLENBQUNoQixjQUFjLENBQUM2QyxNQUFNLENBQUM3QjtZQUUzQixJQUFJOEQsZ0JBQWdCQyxlQUFlO2dCQUNqQzVGLDRDQUFHQSxDQUFDYyxJQUFJLENBQUMsbUJBQW1CO29CQUFFZSxXQUFXQSxVQUFVZ0IsU0FBUyxDQUFDLEdBQUcsS0FBSztnQkFBTTtnQkFDM0UsT0FBTztZQUNUO1lBRUEsT0FBTztRQUNULEVBQUUsT0FBT3JCLE9BQU87WUFDZHhCLDRDQUFHQSxDQUFDd0IsS0FBSyxDQUFDLDRCQUE0QkEsT0FBZ0I7Z0JBQUVLO1lBQVU7WUFDbEUsT0FBTztRQUNUO0lBQ0Y7SUFFQSxNQUFNZ0UsV0FBV2hFLFNBQWlCLEVBQUVpRSxPQUFnQixFQUFvQjtRQUN0RSxJQUFJO1lBQ0Ysa0JBQWtCO1lBQ2xCLE1BQU1DLGFBQWEsTUFBTSxJQUFJLENBQUMxRixZQUFZLENBQUN3RixVQUFVLENBQUNoRSxXQUFXaUU7WUFFakUsSUFBSSxDQUFDQyxZQUFZO2dCQUNmLDZCQUE2QjtnQkFDN0IsSUFBSSxDQUFDLElBQUksQ0FBQ2xGLGNBQWMsQ0FBQzRDLEdBQUcsQ0FBQzVCLFlBQVk7b0JBQ3ZDLElBQUksQ0FBQ2hCLGNBQWMsQ0FBQzBELEdBQUcsQ0FBQzFDLFdBQVcsRUFBRTtnQkFDdkM7Z0JBQ0EsTUFBTW1FLFdBQVcsSUFBSSxDQUFDbkYsY0FBYyxDQUFDNEQsR0FBRyxDQUFDNUM7Z0JBQ3pDbUUsU0FBUzVELElBQUksQ0FBQzBEO2dCQUVkLG1EQUFtRDtnQkFDbkQsSUFBSUUsU0FBU3JELE1BQU0sR0FBRyxJQUFJLENBQUNsQyx3QkFBd0IsRUFBRTtvQkFDbkR1RixTQUFTQyxNQUFNLENBQUMsR0FBR0QsU0FBU3JELE1BQU0sR0FBRyxJQUFJLENBQUNsQyx3QkFBd0I7Z0JBQ3BFO1lBQ0Y7WUFFQSxpREFBaUQ7WUFDakQsTUFBTSxJQUFJLENBQUM2RSxhQUFhLENBQUN6RCxXQUFXO2dCQUNsQ29DLGNBQWMsQ0FBQyxNQUFNLElBQUksQ0FBQ2lDLFdBQVcsQ0FBQ3JFLFVBQVMsRUFBR2MsTUFBTTtZQUMxRDtZQUVBLE9BQU87UUFDVCxFQUFFLE9BQU9uQixPQUFPO1lBQ2R4Qiw0Q0FBR0EsQ0FBQ3dCLEtBQUssQ0FBQyxvQ0FBb0NBLE9BQWdCO2dCQUFFSztZQUFVO1lBQzFFLE9BQU87UUFDVDtJQUNGO0lBRUEsTUFBTXFFLFlBQVlyRSxTQUFpQixFQUFFc0UsUUFBZ0IsRUFBRSxFQUFzQjtRQUMzRSxJQUFJO1lBQ0Ysa0JBQWtCO1lBQ2xCLElBQUlILFdBQVcsTUFBTSxJQUFJLENBQUMzRixZQUFZLENBQUM2RixXQUFXLENBQUNyRSxXQUFXc0U7WUFFOUQsSUFBSUgsU0FBU3JELE1BQU0sS0FBSyxHQUFHO2dCQUN6Qiw2QkFBNkI7Z0JBQzdCLE1BQU05QixpQkFBaUIsSUFBSSxDQUFDQSxjQUFjLENBQUM0RCxHQUFHLENBQUM1QyxjQUFjLEVBQUU7Z0JBQy9EbUUsV0FBV25GLGVBQWU2QixLQUFLLENBQUMsQ0FBQ3lEO1lBQ25DO1lBRUEsMkRBQTJEO1lBQzNELE9BQU9ILFNBQVM3QyxHQUFHLENBQUMyQyxDQUFBQSxVQUFZO29CQUM5QixHQUFHQSxPQUFPO29CQUNWTSxXQUFXLElBQUkxRSxLQUFLb0UsUUFBUU0sU0FBUztnQkFDdkM7UUFDRixFQUFFLE9BQU81RSxPQUFPO1lBQ2R4Qiw0Q0FBR0EsQ0FBQ3dCLEtBQUssQ0FBQywrQkFBK0JBLE9BQWdCO2dCQUFFSztZQUFVO1lBQ3JFLE9BQU8sRUFBRTtRQUNYO0lBQ0Y7SUFFQSxNQUFNd0UsY0FBY3hFLFNBQWlCLEVBQW9CO1FBQ3ZELElBQUk7WUFDRixNQUFNQyxVQUFVLE1BQU0sSUFBSSxDQUFDaUQsVUFBVSxDQUFDbEQ7WUFDdEMsSUFBSSxDQUFDQyxTQUFTO2dCQUNaLE9BQU87WUFDVDtZQUVBLG1CQUFtQjtZQUNuQixNQUFNLElBQUksQ0FBQ3pCLFlBQVksQ0FBQ2lHLFdBQVcsQ0FBQyxDQUFDLFNBQVMsRUFBRXpFLFVBQVUsQ0FBQztZQUUzRCxvQkFBb0I7WUFDcEIsSUFBSSxDQUFDaEIsY0FBYyxDQUFDMEQsR0FBRyxDQUFDMUMsV0FBVyxFQUFFO1lBRXJDLGlCQUFpQjtZQUNqQixNQUFNLElBQUksQ0FBQ3lELGFBQWEsQ0FBQ3pELFdBQVc7Z0JBQUVvQyxjQUFjO1lBQUU7WUFFdEQsT0FBTztRQUNULEVBQUUsT0FBT3pDLE9BQU87WUFDZHhCLDRDQUFHQSxDQUFDd0IsS0FBSyxDQUFDLDRCQUE0QkEsT0FBZ0I7Z0JBQUVLO1lBQVU7WUFDbEUsT0FBTztRQUNUO0lBQ0Y7SUFFQSxNQUFNMEUsa0JBTUg7UUFDRCxJQUFJO1lBQ0YsTUFBTUMscUJBQXFCLElBQUksQ0FBQzdGLGNBQWMsQ0FBQzBCLElBQUk7WUFDbkQsTUFBTW9FLGFBQWEsTUFBTSxJQUFJLENBQUNwRyxZQUFZLENBQUNxRyxRQUFRO1lBQ25ELE1BQU1DLG9CQUFvQkYsV0FBV0csU0FBUyxHQUM1Q3ZDLEtBQUtDLEtBQUssQ0FBQ21DLFdBQVdHLFNBQVMsR0FBRyxLQUFLO1lBRXpDLDZDQUE2QztZQUM3QyxNQUFNQyx1QkFBMEQ7Z0JBQzlEQyxJQUFJO2dCQUNKQyxJQUFJO2dCQUNKQyxJQUFJO2dCQUNKQyxJQUFJO1lBQ047WUFFQSxJQUFJQyxnQkFBZ0I7WUFDcEIsS0FBSyxNQUFNLENBQUNyRixXQUFXQyxRQUFRLElBQUksSUFBSSxDQUFDbkIsY0FBYyxDQUFDb0IsT0FBTyxHQUFJO2dCQUNoRThFLG9CQUFvQixDQUFDL0UsUUFBUThCLFFBQVEsQ0FBQztnQkFDdENzRCxpQkFBaUIsSUFBSSxDQUFDckcsY0FBYyxDQUFDNEQsR0FBRyxDQUFDNUMsWUFBWWMsVUFBVTtZQUNqRTtZQUVBLE1BQU0rQixnQkFBZ0I4QixxQkFBcUJHO1lBQzNDLE1BQU1RLDRCQUE0QnpDLGdCQUFnQixJQUNoRHdDLGdCQUFnQnhDLGdCQUFnQjtZQUVsQyxPQUFPO2dCQUNMMEMscUJBQXFCMUM7Z0JBQ3JCOEI7Z0JBQ0FHO2dCQUNBUSwyQkFBMkJFLE9BQU9GLDBCQUEwQkcsT0FBTyxDQUFDO2dCQUNwRVQ7WUFDRjtRQUNGLEVBQUUsT0FBT3JGLE9BQU87WUFDZHhCLDRDQUFHQSxDQUFDd0IsS0FBSyxDQUFDLCtCQUErQkE7WUFDekMsT0FBTztnQkFDTDRGLHFCQUFxQjtnQkFDckJaLG9CQUFvQjtnQkFDcEJHLG1CQUFtQjtnQkFDbkJRLDJCQUEyQjtnQkFDM0JOLHNCQUFzQjtvQkFBRUMsSUFBSTtvQkFBR0MsSUFBSTtvQkFBR0MsSUFBSTtvQkFBR0MsSUFBSTtnQkFBRTtZQUNyRDtRQUNGO0lBQ0Y7SUFFQSxNQUFNTSxnQkFBZ0IxRixTQUFpQixFQUFvQjtRQUN6RCxNQUFNQyxVQUFVLE1BQU0sSUFBSSxDQUFDaUQsVUFBVSxDQUFDbEQ7UUFDdEMsT0FBT0MsWUFBWSxRQUFRQSxRQUFRb0MsUUFBUTtJQUM3QztJQUVBLE1BQU1zRCxtQkFBbUIzRixTQUFpQixFQUFFK0IsUUFBMkIsRUFBb0I7UUFDekYsT0FBTyxJQUFJLENBQUMwQixhQUFhLENBQUN6RCxXQUFXO1lBQUUrQjtRQUFTO0lBQ2xEO0lBRUEsNkNBQTZDO0lBQzdDNkQsa0JBQTBCO1FBQ3hCLE9BQU8sSUFBSSxDQUFDOUcsY0FBYyxDQUFDMEIsSUFBSTtJQUNqQztJQUVBcUYsaUJBQWdDO1FBQzlCLE9BQU94QyxNQUFNQyxJQUFJLENBQUMsSUFBSSxDQUFDeEUsY0FBYyxDQUFDZ0gsTUFBTTtJQUM5QztJQUVBLE1BQU1DLFVBQXlCO1FBQzdCLDBCQUEwQjtRQUMxQixJQUFJLElBQUksQ0FBQ3RILGVBQWUsRUFBRTtZQUN4QnVILGNBQWMsSUFBSSxDQUFDdkgsZUFBZTtZQUNsQyxJQUFJLENBQUNBLGVBQWUsR0FBRztRQUN6QjtRQUVBLElBQUksSUFBSSxDQUFDQyxVQUFVLEVBQUU7WUFDbkJzSCxjQUFjLElBQUksQ0FBQ3RILFVBQVU7WUFDN0IsSUFBSSxDQUFDQSxVQUFVLEdBQUc7UUFDcEI7UUFFQSwrQ0FBK0M7UUFDL0MsSUFBSUcsS0FBeUIsSUFBaUJSLGtCQUFrQkksZUFBZSxFQUFFO1lBQy9FdUgsY0FBYzNILGtCQUFrQkksZUFBZTtZQUMvQ0osa0JBQWtCSSxlQUFlLEdBQUc7UUFDdEM7UUFFQSx1QkFBdUI7UUFDdkIsSUFBSSxDQUFDSyxjQUFjLENBQUNtSCxLQUFLO1FBQ3pCLElBQUksQ0FBQ2pILGNBQWMsQ0FBQ2lILEtBQUs7UUFFekIsc0NBQXNDO1FBQ3RDLElBQUlwSCxJQUF5QixFQUFlO1lBQzFDUixrQkFBa0JTLGNBQWMsRUFBRW1IO1lBQ2xDNUgsa0JBQWtCVyxjQUFjLEVBQUVpSDtRQUNwQztRQUVBLHdCQUF3QjtRQUN4QixNQUFNLElBQUksQ0FBQ3pILFlBQVksQ0FBQ3VILE9BQU87UUFFL0I1SCw0Q0FBR0EsQ0FBQ2MsSUFBSSxDQUFDO0lBQ1g7SUFFQSwwQkFBMEI7SUFDMUJpSCxpQkFLRTtRQUNBLE1BQU1DLGVBQWUsSUFBSSxDQUFDckgsY0FBYyxDQUFDMEIsSUFBSTtRQUM3QyxNQUFNNEYsa0JBQWtCLElBQUksQ0FBQ3BILGNBQWMsQ0FBQ3dCLElBQUk7UUFFaEQsMkRBQTJEO1FBQzNELElBQUk2RSxnQkFBZ0I7UUFDcEIsS0FBSyxNQUFNbEIsWUFBWSxJQUFJLENBQUNuRixjQUFjLENBQUM4RyxNQUFNLEdBQUk7WUFDbkRULGlCQUFpQmxCLFNBQVNyRCxNQUFNO1FBQ2xDO1FBRUEsTUFBTXVGLG9CQUFvQjdELEtBQUs4RCxLQUFLLENBQ2xDLENBQUNILGVBQWUsSUFBSWQsZ0JBQWdCLEdBQUUsSUFBSztRQUc3QyxNQUFNa0IsY0FBY0osZUFBZSxJQUFJLENBQUN4SCxtQkFBbUIsR0FBRztRQUU5RCxPQUFPO1lBQ0x3SDtZQUNBQztZQUNBQztZQUNBRTtRQUNGO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3Rva3lvLW9wZW5kYXRhLWhhY2thdGhvbi8uL3NyYy9saWIvc2VydmljZXMvU2Vzc2lvbk1hbmFnZXIudHM/OTkxYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB2NCBhcyB1dWlkdjQgfSBmcm9tICd1dWlkJztcbmltcG9ydCB7IFNlc3Npb25EYXRhLCBNZXNzYWdlLCBTdXBwb3J0ZWRMYW5ndWFnZSB9IGZyb20gJ0AvdHlwZXMnO1xuaW1wb3J0IHsgZ2V0UmVkaXNTZXJ2aWNlIH0gZnJvbSAnLi9SZWRpc1NlcnZpY2UnO1xuaW1wb3J0IHsgbG9nIH0gZnJvbSAnQC9saWIvbG9nZ2VyJztcbmltcG9ydCB7IGNvbmZpZyB9IGZyb20gJ0AvbGliL2NvbmZpZyc7XG5cbi8vIEdsb2JhbCBzdG9yYWdlIHRoYXQgcGVyc2lzdHMgYWNyb3NzIGhvdCByZWxvYWRzIGluIGRldmVsb3BtZW50XG5jb25zdCBnbG9iYWxGb3JTZXNzaW9ucyA9IGdsb2JhbFRoaXMgYXMgdW5rbm93biBhcyB7XG4gIG1lbW9yeVNlc3Npb25zOiBNYXA8c3RyaW5nLCBTZXNzaW9uRGF0YT47XG4gIG1lbW9yeU1lc3NhZ2VzOiBNYXA8c3RyaW5nLCBNZXNzYWdlW10+O1xuICBjbGVhbnVwSW50ZXJ2YWw6IE5vZGVKUy5UaW1lb3V0IHwgbnVsbDtcbn07XG5cbmV4cG9ydCBjbGFzcyBTZXNzaW9uTWFuYWdlciB7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBTZXNzaW9uTWFuYWdlcjtcbiAgcHJpdmF0ZSByZWRpc1NlcnZpY2UgPSBnZXRSZWRpc1NlcnZpY2UoKTtcbiAgcHJpdmF0ZSBtZW1vcnlTZXNzaW9uczogTWFwPHN0cmluZywgU2Vzc2lvbkRhdGE+O1xuICBwcml2YXRlIG1lbW9yeU1lc3NhZ2VzOiBNYXA8c3RyaW5nLCBNZXNzYWdlW10+O1xuICBwcml2YXRlIGNsZWFudXBJbnRlcnZhbDogTm9kZUpTLlRpbWVvdXQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBnY0ludGVydmFsOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHJlYWRvbmx5IE1BWF9NRU1PUllfU0VTU0lPTlMgPSAxMDAwMDsgLy8g44Oh44Oi44Oq5YaF44K744OD44K344On44Oz5pWw44Gu5LiK6ZmQXG4gIHByaXZhdGUgcmVhZG9ubHkgTUFYX01FU1NBR0VTX1BFUl9TRVNTSU9OID0gMTAwOyAvLyDjgrvjg4Pjgrfjg6fjg7PjgZTjgajjga7jg6Hjg4Pjgrvjg7zjgrjmlbDkuIrpmZBcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xuICAgIC8vIFVzZSBnbG9iYWwgc3RvcmFnZSBpbiBkZXZlbG9wbWVudCB0byBwZXJzaXN0IGFjcm9zcyBob3QgcmVsb2Fkc1xuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xuICAgICAgaWYgKCFnbG9iYWxGb3JTZXNzaW9ucy5tZW1vcnlTZXNzaW9ucykge1xuICAgICAgICBnbG9iYWxGb3JTZXNzaW9ucy5tZW1vcnlTZXNzaW9ucyA9IG5ldyBNYXAoKTtcbiAgICAgICAgZ2xvYmFsRm9yU2Vzc2lvbnMubWVtb3J5TWVzc2FnZXMgPSBuZXcgTWFwKCk7XG4gICAgICAgIGxvZy5pbmZvKCdJbml0aWFsaXplZCBnbG9iYWwgc2Vzc2lvbiBzdG9yYWdlIGZvciBkZXZlbG9wbWVudCcpO1xuICAgICAgfVxuICAgICAgdGhpcy5tZW1vcnlTZXNzaW9ucyA9IGdsb2JhbEZvclNlc3Npb25zLm1lbW9yeVNlc3Npb25zO1xuICAgICAgdGhpcy5tZW1vcnlNZXNzYWdlcyA9IGdsb2JhbEZvclNlc3Npb25zLm1lbW9yeU1lc3NhZ2VzO1xuICAgICAgXG4gICAgICAvLyBPbmx5IHN0YXJ0IGNsZWFudXAgaWYgbm90IGFscmVhZHkgc3RhcnRlZFxuICAgICAgaWYgKCFnbG9iYWxGb3JTZXNzaW9ucy5jbGVhbnVwSW50ZXJ2YWwpIHtcbiAgICAgICAgdGhpcy5zdGFydENsZWFudXBQcm9jZXNzKCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubWVtb3J5U2Vzc2lvbnMgPSBuZXcgTWFwKCk7XG4gICAgICB0aGlzLm1lbW9yeU1lc3NhZ2VzID0gbmV3IE1hcCgpO1xuICAgICAgdGhpcy5zdGFydENsZWFudXBQcm9jZXNzKCk7XG4gICAgfVxuICB9XG5cbiAgc3RhdGljIGdldEluc3RhbmNlKCk6IFNlc3Npb25NYW5hZ2VyIHtcbiAgICBpZiAoIVNlc3Npb25NYW5hZ2VyLmluc3RhbmNlKSB7XG4gICAgICBTZXNzaW9uTWFuYWdlci5pbnN0YW5jZSA9IG5ldyBTZXNzaW9uTWFuYWdlcigpO1xuICAgIH1cbiAgICByZXR1cm4gU2Vzc2lvbk1hbmFnZXIuaW5zdGFuY2U7XG4gIH1cblxuICBwcml2YXRlIHN0YXJ0Q2xlYW51cFByb2Nlc3MoKTogdm9pZCB7XG4gICAgLy8gQ2xlYW4gdXAgZXhwaXJlZCBzZXNzaW9ucyBtb3JlIGZyZXF1ZW50bHkgKGV2ZXJ5IDEwIG1pbnV0ZXMpXG4gICAgY29uc3QgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICB0aGlzLmNsZWFudXBFeHBpcmVkU2Vzc2lvbnMoKTtcbiAgICB9LCAxMCAqIDYwICogMTAwMCk7XG4gICAgXG4gICAgLy8gU3RvcmUgaW50ZXJ2YWwgcmVmZXJlbmNlIGdsb2JhbGx5IGluIGRldmVsb3BtZW50XG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XG4gICAgICBnbG9iYWxGb3JTZXNzaW9ucy5jbGVhbnVwSW50ZXJ2YWwgPSBpbnRlcnZhbDtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gU3RvcmUgcmVmZXJlbmNlIGZvciBwcm9kdWN0aW9uIGNsZWFudXBcbiAgICAgIHRoaXMuY2xlYW51cEludGVydmFsID0gaW50ZXJ2YWw7XG4gICAgfVxuICAgIFxuICAgIC8vIEZvcmNlIGdhcmJhZ2UgY29sbGVjdGlvbiBwZXJpb2RpY2FsbHkgaW4gcHJvZHVjdGlvblxuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nICYmIGdsb2JhbC5nYykge1xuICAgICAgc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGdsb2JhbC5nYygpO1xuICAgICAgICAgIGxvZy5kZWJ1ZygnTWFudWFsIGdhcmJhZ2UgY29sbGVjdGlvbiB0cmlnZ2VyZWQnKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAvLyBJZ25vcmUgR0MgZXJyb3JzXG4gICAgICAgIH1cbiAgICAgIH0sIDMwICogNjAgKiAxMDAwKTsgLy8gRXZlcnkgMzAgbWludXRlc1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY2xlYW51cEV4cGlyZWRTZXNzaW9ucygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IGV4cGlyZWRTZXNzaW9uczogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCBvbGRTZXNzaW9uczogQXJyYXk8eyBzZXNzaW9uSWQ6IHN0cmluZzsgbGFzdEFjdGl2aXR5OiBudW1iZXIgfT4gPSBbXTtcblxuICAgIC8vIENoZWNrIG1lbW9yeSBzZXNzaW9uc1xuICAgIGZvciAoY29uc3QgW3Nlc3Npb25JZCwgc2Vzc2lvbl0gb2YgdGhpcy5tZW1vcnlTZXNzaW9ucy5lbnRyaWVzKCkpIHtcbiAgICAgIGNvbnN0IHRpbWVTaW5jZUFjdGl2aXR5ID0gbm93LmdldFRpbWUoKSAtIHNlc3Npb24ubGFzdEFjdGl2aXR5LmdldFRpbWUoKTtcbiAgICAgIGlmICh0aW1lU2luY2VBY3Rpdml0eSA+IGNvbmZpZy5tYXhTZXNzaW9uRHVyYXRpb24pIHtcbiAgICAgICAgZXhwaXJlZFNlc3Npb25zLnB1c2goc2Vzc2lvbklkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9sZFNlc3Npb25zLnB1c2goeyBzZXNzaW9uSWQsIGxhc3RBY3Rpdml0eTogdGltZVNpbmNlQWN0aXZpdHkgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gTWVtb3J5IHByZXNzdXJlIG1hbmFnZW1lbnQ6IHJlbW92ZSBvbGRlc3Qgc2Vzc2lvbnMgaWYgb3ZlciBsaW1pdFxuICAgIGlmICh0aGlzLm1lbW9yeVNlc3Npb25zLnNpemUgPiB0aGlzLk1BWF9NRU1PUllfU0VTU0lPTlMpIHtcbiAgICAgIG9sZFNlc3Npb25zLnNvcnQoKGEsIGIpID0+IGIubGFzdEFjdGl2aXR5IC0gYS5sYXN0QWN0aXZpdHkpO1xuICAgICAgY29uc3Qgc2Vzc2lvbnNUb1JlbW92ZSA9IG9sZFNlc3Npb25zLnNsaWNlKHRoaXMuTUFYX01FTU9SWV9TRVNTSU9OUyAtIGV4cGlyZWRTZXNzaW9ucy5sZW5ndGgpO1xuICAgICAgZm9yIChjb25zdCB7IHNlc3Npb25JZCB9IG9mIHNlc3Npb25zVG9SZW1vdmUpIHtcbiAgICAgICAgZXhwaXJlZFNlc3Npb25zLnB1c2goc2Vzc2lvbklkKTtcbiAgICAgICAgbG9nLndhcm4oYFJlbW92aW5nIHNlc3Npb24gZHVlIHRvIG1lbW9yeSBwcmVzc3VyZTogJHtzZXNzaW9uSWQuc3Vic3RyaW5nKDAsIDgpfS4uLmApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENsZWFuIHVwIGV4cGlyZWQgc2Vzc2lvbnMgaW4gYmF0Y2hlcyB0byBhdm9pZCBibG9ja2luZ1xuICAgIGNvbnN0IGJhdGNoU2l6ZSA9IDUwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZXhwaXJlZFNlc3Npb25zLmxlbmd0aDsgaSArPSBiYXRjaFNpemUpIHtcbiAgICAgIGNvbnN0IGJhdGNoID0gZXhwaXJlZFNlc3Npb25zLnNsaWNlKGksIGkgKyBiYXRjaFNpemUpO1xuICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoYmF0Y2gubWFwKHNlc3Npb25JZCA9PiB0aGlzLmRlbGV0ZVNlc3Npb24oc2Vzc2lvbklkKSkpO1xuICAgICAgXG4gICAgICAvLyBBbGxvdyBldmVudCBsb29wIHRvIHByb2Nlc3Mgb3RoZXIgdGFza3NcbiAgICAgIGlmIChpICsgYmF0Y2hTaXplIDwgZXhwaXJlZFNlc3Npb25zLmxlbmd0aCkge1xuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldEltbWVkaWF0ZShyZXNvbHZlKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2xlYW4gdXAgb3JwaGFuZWQgbWVzc2FnZXMgKG1lc3NhZ2VzIHdpdGhvdXQgY29ycmVzcG9uZGluZyBzZXNzaW9ucylcbiAgICBjb25zdCBvcnBoYW5lZE1lc3NhZ2VTZXNzaW9uczogc3RyaW5nW10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IHNlc3Npb25JZCBvZiB0aGlzLm1lbW9yeU1lc3NhZ2VzLmtleXMoKSkge1xuICAgICAgaWYgKCF0aGlzLm1lbW9yeVNlc3Npb25zLmhhcyhzZXNzaW9uSWQpKSB7XG4gICAgICAgIG9ycGhhbmVkTWVzc2FnZVNlc3Npb25zLnB1c2goc2Vzc2lvbklkKTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgZm9yIChjb25zdCBzZXNzaW9uSWQgb2Ygb3JwaGFuZWRNZXNzYWdlU2Vzc2lvbnMpIHtcbiAgICAgIHRoaXMubWVtb3J5TWVzc2FnZXMuZGVsZXRlKHNlc3Npb25JZCk7XG4gICAgfVxuXG4gICAgaWYgKGV4cGlyZWRTZXNzaW9ucy5sZW5ndGggPiAwIHx8IG9ycGhhbmVkTWVzc2FnZVNlc3Npb25zLmxlbmd0aCA+IDApIHtcbiAgICAgIGxvZy5pbmZvKGBDbGVhbmVkIHVwICR7ZXhwaXJlZFNlc3Npb25zLmxlbmd0aH0gZXhwaXJlZCBzZXNzaW9ucyBhbmQgJHtvcnBoYW5lZE1lc3NhZ2VTZXNzaW9ucy5sZW5ndGh9IG9ycGhhbmVkIG1lc3NhZ2Ugc2V0cy4gTWVtb3J5IHVzYWdlOiAke3RoaXMubWVtb3J5U2Vzc2lvbnMuc2l6ZX0gc2Vzc2lvbnMsICR7dGhpcy5tZW1vcnlNZXNzYWdlcy5zaXplfSBtZXNzYWdlIHNldHNgKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBjcmVhdGVTZXNzaW9uKGxhbmd1YWdlOiBTdXBwb3J0ZWRMYW5ndWFnZSA9ICdqYScsIG1ldGFkYXRhPzoge1xuICAgIHVzZXJBZ2VudD86IHN0cmluZztcbiAgICBpcEFkZHJlc3M/OiBzdHJpbmc7XG4gICAgZGV2aWNlVHlwZT86ICdtb2JpbGUnIHwgJ2Rlc2t0b3AnIHwgJ3RhYmxldCc7XG4gIH0pOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IHNlc3Npb25JZCA9IHV1aWR2NCgpO1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG5cbiAgICBjb25zdCBzZXNzaW9uRGF0YTogU2Vzc2lvbkRhdGEgPSB7XG4gICAgICBpZDogc2Vzc2lvbklkLFxuICAgICAgbGFuZ3VhZ2UsXG4gICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgIGxhc3RBY3Rpdml0eTogbm93LFxuICAgICAgbWVzc2FnZUNvdW50OiAwLFxuICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICBtZXRhZGF0YTogbWV0YWRhdGEgfHwge30sXG4gICAgfTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBUcnkgdG8gc3RvcmUgaW4gUmVkaXMgZmlyc3RcbiAgICAgIGNvbnN0IHJlZGlzU3RvcmVkID0gYXdhaXQgdGhpcy5yZWRpc1NlcnZpY2Uuc2V0U2Vzc2lvbihcbiAgICAgICAgc2Vzc2lvbklkLCBcbiAgICAgICAgc2Vzc2lvbkRhdGEsIFxuICAgICAgICBNYXRoLmZsb29yKGNvbmZpZy5tYXhTZXNzaW9uRHVyYXRpb24gLyAxMDAwKVxuICAgICAgKTtcblxuICAgICAgaWYgKCFyZWRpc1N0b3JlZCkge1xuICAgICAgICAvLyBGYWxsYmFjayB0byBtZW1vcnkgc3RvcmFnZVxuICAgICAgICB0aGlzLm1lbW9yeVNlc3Npb25zLnNldChzZXNzaW9uSWQsIHNlc3Npb25EYXRhKTtcbiAgICAgICAgdGhpcy5tZW1vcnlNZXNzYWdlcy5zZXQoc2Vzc2lvbklkLCBbXSk7XG4gICAgICAgIGxvZy53YXJuKCdTZXNzaW9uIHN0b3JlZCBpbiBtZW1vcnkgKFJlZGlzIHVuYXZhaWxhYmxlKScsIHsgc2Vzc2lvbklkIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gVmVyaWZ5IHN0b3JhZ2VcbiAgICAgICAgY29uc3Qgc3RvcmVkID0gdGhpcy5tZW1vcnlTZXNzaW9ucy5nZXQoc2Vzc2lvbklkKTtcbiAgICAgICAgbG9nLmluZm8oJ1Nlc3Npb24gbWVtb3J5IHN0b3JhZ2UgdmVyaWZpZWQnLCB7XG4gICAgICAgICAgc2Vzc2lvbklkOiBzZXNzaW9uSWQuc3Vic3RyaW5nKDAsIDgpICsgJy4uLicsXG4gICAgICAgICAgc3RvcmVkOiAhIXN0b3JlZCxcbiAgICAgICAgICB0b3RhbFNlc3Npb25zOiB0aGlzLm1lbW9yeVNlc3Npb25zLnNpemUsXG4gICAgICAgICAgaXNEZXZlbG9wbWVudDogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcsXG4gICAgICAgICAgdXNpbmdHbG9iYWxTdG9yYWdlOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyAmJiB0aGlzLm1lbW9yeVNlc3Npb25zID09PSBnbG9iYWxGb3JTZXNzaW9ucy5tZW1vcnlTZXNzaW9uc1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgbG9nLmluZm8oJ1Nlc3Npb24gY3JlYXRlZCcsIHsgXG4gICAgICAgIHNlc3Npb25JZDogc2Vzc2lvbklkLnN1YnN0cmluZygwLCA4KSArICcuLi4nLFxuICAgICAgICBsYW5ndWFnZSxcbiAgICAgICAgc3RvcmFnZTogcmVkaXNTdG9yZWQgPyAncmVkaXMnIDogJ21lbW9yeSdcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gc2Vzc2lvbklkO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2cuZXJyb3IoJ0ZhaWxlZCB0byBjcmVhdGUgc2Vzc2lvbicsIGVycm9yIGFzIEVycm9yLCB7IHNlc3Npb25JZCB9KTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBzZXNzaW9uJyk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0U2Vzc2lvbihzZXNzaW9uSWQ6IHN0cmluZyk6IFByb21pc2U8U2Vzc2lvbkRhdGEgfCBudWxsPiB7XG4gICAgaWYgKCFzZXNzaW9uSWQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBUcnkgUmVkaXMgZmlyc3RcbiAgICAgIGxldCBzZXNzaW9uRGF0YSA9IGF3YWl0IHRoaXMucmVkaXNTZXJ2aWNlLmdldFNlc3Npb24oc2Vzc2lvbklkKTtcbiAgICAgIFxuICAgICAgaWYgKCFzZXNzaW9uRGF0YSkge1xuICAgICAgICAvLyBGYWxsYmFjayB0byBtZW1vcnkgc3RvcmFnZVxuICAgICAgICBzZXNzaW9uRGF0YSA9IHRoaXMubWVtb3J5U2Vzc2lvbnMuZ2V0KHNlc3Npb25JZCkgfHwgbnVsbDtcbiAgICAgICAgaWYgKHNlc3Npb25EYXRhKSB7XG4gICAgICAgICAgLy8gVXBkYXRlIGxhc3QgYWN0aXZpdHlcbiAgICAgICAgICBzZXNzaW9uRGF0YS5sYXN0QWN0aXZpdHkgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgIHRoaXMubWVtb3J5U2Vzc2lvbnMuc2V0KHNlc3Npb25JZCwgc2Vzc2lvbkRhdGEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxvZy53YXJuKCdTZXNzaW9uIG5vdCBmb3VuZCBpbiBtZW1vcnkgc3RvcmFnZScsIHsgXG4gICAgICAgICAgICBzZXNzaW9uSWQ6IHNlc3Npb25JZC5zdWJzdHJpbmcoMCwgOCkgKyAnLi4uJyxcbiAgICAgICAgICAgIHRvdGFsU2Vzc2lvbnNJbk1lbW9yeTogdGhpcy5tZW1vcnlTZXNzaW9ucy5zaXplLFxuICAgICAgICAgICAgYXZhaWxhYmxlU2Vzc2lvbklkczogQXJyYXkuZnJvbSh0aGlzLm1lbW9yeVNlc3Npb25zLmtleXMoKSkubWFwKGlkID0+IGlkLnN1YnN0cmluZygwLCA4KSArICcuLi4nKSxcbiAgICAgICAgICAgIGlzRGV2ZWxvcG1lbnQ6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnLFxuICAgICAgICAgICAgdXNpbmdHbG9iYWxTdG9yYWdlOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyAmJiB0aGlzLm1lbW9yeVNlc3Npb25zID09PSBnbG9iYWxGb3JTZXNzaW9ucy5tZW1vcnlTZXNzaW9ucyxcbiAgICAgICAgICAgIGdsb2JhbFNlc3Npb25Db3VudDogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBnbG9iYWxGb3JTZXNzaW9ucy5tZW1vcnlTZXNzaW9ucz8uc2l6ZSA6ICdOL0EnXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKCFzZXNzaW9uRGF0YSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgc2Vzc2lvbiBpcyBleHBpcmVkXG4gICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgY29uc3QgbGFzdEFjdGl2aXR5ID0gbmV3IERhdGUoc2Vzc2lvbkRhdGEubGFzdEFjdGl2aXR5KTtcbiAgICAgIGNvbnN0IHRpbWVTaW5jZUFjdGl2aXR5ID0gbm93LmdldFRpbWUoKSAtIGxhc3RBY3Rpdml0eS5nZXRUaW1lKCk7XG4gICAgICBcbiAgICAgIGlmICh0aW1lU2luY2VBY3Rpdml0eSA+IGNvbmZpZy5tYXhTZXNzaW9uRHVyYXRpb24pIHtcbiAgICAgICAgbG9nLndhcm4oJ1Nlc3Npb24gZXhwaXJlZCcsIHsgXG4gICAgICAgICAgc2Vzc2lvbklkOiBzZXNzaW9uSWQuc3Vic3RyaW5nKDAsIDgpICsgJy4uLicsXG4gICAgICAgICAgdGltZVNpbmNlQWN0aXZpdHksXG4gICAgICAgICAgbWF4RHVyYXRpb246IGNvbmZpZy5tYXhTZXNzaW9uRHVyYXRpb25cbiAgICAgICAgfSk7XG4gICAgICAgIGF3YWl0IHRoaXMuZGVsZXRlU2Vzc2lvbihzZXNzaW9uSWQpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHNlc3Npb25EYXRhO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2cuZXJyb3IoJ0ZhaWxlZCB0byByZXRyaWV2ZSBzZXNzaW9uJywgZXJyb3IgYXMgRXJyb3IsIHsgc2Vzc2lvbklkIH0pO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgdXBkYXRlU2Vzc2lvbihzZXNzaW9uSWQ6IHN0cmluZywgdXBkYXRlczogUGFydGlhbDxTZXNzaW9uRGF0YT4pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZXhpc3RpbmdTZXNzaW9uID0gYXdhaXQgdGhpcy5nZXRTZXNzaW9uKHNlc3Npb25JZCk7XG4gICAgICBpZiAoIWV4aXN0aW5nU2Vzc2lvbikge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHVwZGF0ZWRTZXNzaW9uOiBTZXNzaW9uRGF0YSA9IHtcbiAgICAgICAgLi4uZXhpc3RpbmdTZXNzaW9uLFxuICAgICAgICAuLi51cGRhdGVzLFxuICAgICAgICBsYXN0QWN0aXZpdHk6IG5ldyBEYXRlKCksXG4gICAgICB9O1xuXG4gICAgICAvLyBUcnkgUmVkaXMgZmlyc3RcbiAgICAgIGNvbnN0IHJlZGlzVXBkYXRlZCA9IGF3YWl0IHRoaXMucmVkaXNTZXJ2aWNlLnNldFNlc3Npb24oXG4gICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgdXBkYXRlZFNlc3Npb24sXG4gICAgICAgIE1hdGguZmxvb3IoY29uZmlnLm1heFNlc3Npb25EdXJhdGlvbiAvIDEwMDApXG4gICAgICApO1xuXG4gICAgICBpZiAoIXJlZGlzVXBkYXRlZCkge1xuICAgICAgICAvLyBGYWxsYmFjayB0byBtZW1vcnkgc3RvcmFnZVxuICAgICAgICB0aGlzLm1lbW9yeVNlc3Npb25zLnNldChzZXNzaW9uSWQsIHVwZGF0ZWRTZXNzaW9uKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZy5lcnJvcignRmFpbGVkIHRvIHVwZGF0ZSBzZXNzaW9uJywgZXJyb3IgYXMgRXJyb3IsIHsgc2Vzc2lvbklkIH0pO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZVNlc3Npb24oc2Vzc2lvbklkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgLy8gRGVsZXRlIGZyb20gUmVkaXNcbiAgICAgIGNvbnN0IHJlZGlzRGVsZXRlZCA9IGF3YWl0IHRoaXMucmVkaXNTZXJ2aWNlLmRlbGV0ZVNlc3Npb24oc2Vzc2lvbklkKTtcbiAgICAgIFxuICAgICAgLy8gRGVsZXRlIGZyb20gbWVtb3J5XG4gICAgICBjb25zdCBtZW1vcnlEZWxldGVkID0gdGhpcy5tZW1vcnlTZXNzaW9ucy5kZWxldGUoc2Vzc2lvbklkKTtcbiAgICAgIHRoaXMubWVtb3J5TWVzc2FnZXMuZGVsZXRlKHNlc3Npb25JZCk7XG5cbiAgICAgIGlmIChyZWRpc0RlbGV0ZWQgfHwgbWVtb3J5RGVsZXRlZCkge1xuICAgICAgICBsb2cuaW5mbygnU2Vzc2lvbiBkZWxldGVkJywgeyBzZXNzaW9uSWQ6IHNlc3Npb25JZC5zdWJzdHJpbmcoMCwgOCkgKyAnLi4uJyB9KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nLmVycm9yKCdGYWlsZWQgdG8gZGVsZXRlIHNlc3Npb24nLCBlcnJvciBhcyBFcnJvciwgeyBzZXNzaW9uSWQgfSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgYWRkTWVzc2FnZShzZXNzaW9uSWQ6IHN0cmluZywgbWVzc2FnZTogTWVzc2FnZSk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBUcnkgUmVkaXMgZmlyc3RcbiAgICAgIGNvbnN0IHJlZGlzQWRkZWQgPSBhd2FpdCB0aGlzLnJlZGlzU2VydmljZS5hZGRNZXNzYWdlKHNlc3Npb25JZCwgbWVzc2FnZSk7XG4gICAgICBcbiAgICAgIGlmICghcmVkaXNBZGRlZCkge1xuICAgICAgICAvLyBGYWxsYmFjayB0byBtZW1vcnkgc3RvcmFnZVxuICAgICAgICBpZiAoIXRoaXMubWVtb3J5TWVzc2FnZXMuaGFzKHNlc3Npb25JZCkpIHtcbiAgICAgICAgICB0aGlzLm1lbW9yeU1lc3NhZ2VzLnNldChzZXNzaW9uSWQsIFtdKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtZXNzYWdlcyA9IHRoaXMubWVtb3J5TWVzc2FnZXMuZ2V0KHNlc3Npb25JZCkhO1xuICAgICAgICBtZXNzYWdlcy5wdXNoKG1lc3NhZ2UpO1xuICAgICAgICBcbiAgICAgICAgLy8gS2VlcCBvbmx5IGxhc3QgTUFYX01FU1NBR0VTX1BFUl9TRVNTSU9OIG1lc3NhZ2VzXG4gICAgICAgIGlmIChtZXNzYWdlcy5sZW5ndGggPiB0aGlzLk1BWF9NRVNTQUdFU19QRVJfU0VTU0lPTikge1xuICAgICAgICAgIG1lc3NhZ2VzLnNwbGljZSgwLCBtZXNzYWdlcy5sZW5ndGggLSB0aGlzLk1BWF9NRVNTQUdFU19QRVJfU0VTU0lPTik7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gVXBkYXRlIHNlc3Npb24gbWVzc2FnZSBjb3VudCBhbmQgbGFzdCBhY3Rpdml0eVxuICAgICAgYXdhaXQgdGhpcy51cGRhdGVTZXNzaW9uKHNlc3Npb25JZCwge1xuICAgICAgICBtZXNzYWdlQ291bnQ6IChhd2FpdCB0aGlzLmdldE1lc3NhZ2VzKHNlc3Npb25JZCkpLmxlbmd0aCxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nLmVycm9yKCdGYWlsZWQgdG8gYWRkIG1lc3NhZ2UgdG8gc2Vzc2lvbicsIGVycm9yIGFzIEVycm9yLCB7IHNlc3Npb25JZCB9KTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRNZXNzYWdlcyhzZXNzaW9uSWQ6IHN0cmluZywgbGltaXQ6IG51bWJlciA9IDUwKTogUHJvbWlzZTxNZXNzYWdlW10+IHtcbiAgICB0cnkge1xuICAgICAgLy8gVHJ5IFJlZGlzIGZpcnN0XG4gICAgICBsZXQgbWVzc2FnZXMgPSBhd2FpdCB0aGlzLnJlZGlzU2VydmljZS5nZXRNZXNzYWdlcyhzZXNzaW9uSWQsIGxpbWl0KTtcbiAgICAgIFxuICAgICAgaWYgKG1lc3NhZ2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAvLyBGYWxsYmFjayB0byBtZW1vcnkgc3RvcmFnZVxuICAgICAgICBjb25zdCBtZW1vcnlNZXNzYWdlcyA9IHRoaXMubWVtb3J5TWVzc2FnZXMuZ2V0KHNlc3Npb25JZCkgfHwgW107XG4gICAgICAgIG1lc3NhZ2VzID0gbWVtb3J5TWVzc2FnZXMuc2xpY2UoLWxpbWl0KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ29udmVydCB0aW1lc3RhbXAgc3RyaW5ncyBiYWNrIHRvIERhdGUgb2JqZWN0cyBpZiBuZWVkZWRcbiAgICAgIHJldHVybiBtZXNzYWdlcy5tYXAobWVzc2FnZSA9PiAoe1xuICAgICAgICAuLi5tZXNzYWdlLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKG1lc3NhZ2UudGltZXN0YW1wKSxcbiAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nLmVycm9yKCdGYWlsZWQgdG8gcmV0cmlldmUgbWVzc2FnZXMnLCBlcnJvciBhcyBFcnJvciwgeyBzZXNzaW9uSWQgfSk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgY2xlYXJNZXNzYWdlcyhzZXNzaW9uSWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgdGhpcy5nZXRTZXNzaW9uKHNlc3Npb25JZCk7XG4gICAgICBpZiAoIXNlc3Npb24pIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICAvLyBDbGVhciBmcm9tIFJlZGlzXG4gICAgICBhd2FpdCB0aGlzLnJlZGlzU2VydmljZS5kZWxldGVDYWNoZShgbWVzc2FnZXM6JHtzZXNzaW9uSWR9YCk7XG4gICAgICBcbiAgICAgIC8vIENsZWFyIGZyb20gbWVtb3J5XG4gICAgICB0aGlzLm1lbW9yeU1lc3NhZ2VzLnNldChzZXNzaW9uSWQsIFtdKTtcblxuICAgICAgLy8gVXBkYXRlIHNlc3Npb25cbiAgICAgIGF3YWl0IHRoaXMudXBkYXRlU2Vzc2lvbihzZXNzaW9uSWQsIHsgbWVzc2FnZUNvdW50OiAwIH0pO1xuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nLmVycm9yKCdGYWlsZWQgdG8gY2xlYXIgbWVzc2FnZXMnLCBlcnJvciBhcyBFcnJvciwgeyBzZXNzaW9uSWQgfSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0U2Vzc2lvblN0YXRzKCk6IFByb21pc2U8e1xuICAgIHRvdGFsQWN0aXZlU2Vzc2lvbnM6IG51bWJlcjtcbiAgICBtZW1vcnlTZXNzaW9uQ291bnQ6IG51bWJlcjtcbiAgICByZWRpc1Nlc3Npb25Db3VudDogbnVtYmVyO1xuICAgIGF2ZXJhZ2VNZXNzYWdlc1BlclNlc3Npb246IG51bWJlcjtcbiAgICBsYW5ndWFnZURpc3RyaWJ1dGlvbjogUmVjb3JkPFN1cHBvcnRlZExhbmd1YWdlLCBudW1iZXI+O1xuICB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG1lbW9yeVNlc3Npb25Db3VudCA9IHRoaXMubWVtb3J5U2Vzc2lvbnMuc2l6ZTtcbiAgICAgIGNvbnN0IHJlZGlzU3RhdHMgPSBhd2FpdCB0aGlzLnJlZGlzU2VydmljZS5nZXRTdGF0cygpO1xuICAgICAgY29uc3QgcmVkaXNTZXNzaW9uQ291bnQgPSByZWRpc1N0YXRzLnRvdGFsS2V5cyA/IFxuICAgICAgICBNYXRoLmZsb29yKHJlZGlzU3RhdHMudG90YWxLZXlzIC8gMikgOiAwO1xuICAgICAgXG4gICAgICAvLyBMYW5ndWFnZSBkaXN0cmlidXRpb24gZnJvbSBtZW1vcnkgc2Vzc2lvbnNcbiAgICAgIGNvbnN0IGxhbmd1YWdlRGlzdHJpYnV0aW9uOiBSZWNvcmQ8U3VwcG9ydGVkTGFuZ3VhZ2UsIG51bWJlcj4gPSB7XG4gICAgICAgIGphOiAwLFxuICAgICAgICBlbjogMCxcbiAgICAgICAgemg6IDAsXG4gICAgICAgIGtvOiAwLFxuICAgICAgfTtcblxuICAgICAgbGV0IHRvdGFsTWVzc2FnZXMgPSAwO1xuICAgICAgZm9yIChjb25zdCBbc2Vzc2lvbklkLCBzZXNzaW9uXSBvZiB0aGlzLm1lbW9yeVNlc3Npb25zLmVudHJpZXMoKSkge1xuICAgICAgICBsYW5ndWFnZURpc3RyaWJ1dGlvbltzZXNzaW9uLmxhbmd1YWdlXSsrO1xuICAgICAgICB0b3RhbE1lc3NhZ2VzICs9IHRoaXMubWVtb3J5TWVzc2FnZXMuZ2V0KHNlc3Npb25JZCk/Lmxlbmd0aCB8fCAwO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB0b3RhbFNlc3Npb25zID0gbWVtb3J5U2Vzc2lvbkNvdW50ICsgcmVkaXNTZXNzaW9uQ291bnQ7XG4gICAgICBjb25zdCBhdmVyYWdlTWVzc2FnZXNQZXJTZXNzaW9uID0gdG90YWxTZXNzaW9ucyA+IDAgPyBcbiAgICAgICAgdG90YWxNZXNzYWdlcyAvIHRvdGFsU2Vzc2lvbnMgOiAwO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB0b3RhbEFjdGl2ZVNlc3Npb25zOiB0b3RhbFNlc3Npb25zLFxuICAgICAgICBtZW1vcnlTZXNzaW9uQ291bnQsXG4gICAgICAgIHJlZGlzU2Vzc2lvbkNvdW50LFxuICAgICAgICBhdmVyYWdlTWVzc2FnZXNQZXJTZXNzaW9uOiBOdW1iZXIoYXZlcmFnZU1lc3NhZ2VzUGVyU2Vzc2lvbi50b0ZpeGVkKDIpKSxcbiAgICAgICAgbGFuZ3VhZ2VEaXN0cmlidXRpb24sXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2cuZXJyb3IoJ0ZhaWxlZCB0byBnZXQgc2Vzc2lvbiBzdGF0cycsIGVycm9yIGFzIEVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRvdGFsQWN0aXZlU2Vzc2lvbnM6IDAsXG4gICAgICAgIG1lbW9yeVNlc3Npb25Db3VudDogMCxcbiAgICAgICAgcmVkaXNTZXNzaW9uQ291bnQ6IDAsXG4gICAgICAgIGF2ZXJhZ2VNZXNzYWdlc1BlclNlc3Npb246IDAsXG4gICAgICAgIGxhbmd1YWdlRGlzdHJpYnV0aW9uOiB7IGphOiAwLCBlbjogMCwgemg6IDAsIGtvOiAwIH0sXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGlzU2Vzc2lvbkFjdGl2ZShzZXNzaW9uSWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCB0aGlzLmdldFNlc3Npb24oc2Vzc2lvbklkKTtcbiAgICByZXR1cm4gc2Vzc2lvbiAhPT0gbnVsbCAmJiBzZXNzaW9uLmlzQWN0aXZlO1xuICB9XG5cbiAgYXN5bmMgc2V0U2Vzc2lvbkxhbmd1YWdlKHNlc3Npb25JZDogc3RyaW5nLCBsYW5ndWFnZTogU3VwcG9ydGVkTGFuZ3VhZ2UpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICByZXR1cm4gdGhpcy51cGRhdGVTZXNzaW9uKHNlc3Npb25JZCwgeyBsYW5ndWFnZSB9KTtcbiAgfVxuXG4gIC8vIExlZ2FjeSBtZXRob2RzIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eVxuICBnZXRTZXNzaW9uQ291bnQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5tZW1vcnlTZXNzaW9ucy5zaXplO1xuICB9XG5cbiAgZ2V0QWxsU2Vzc2lvbnMoKTogU2Vzc2lvbkRhdGFbXSB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5tZW1vcnlTZXNzaW9ucy52YWx1ZXMoKSk7XG4gIH1cblxuICBhc3luYyBjbGVhbnVwKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIENsZWFyIGNsZWFudXAgaW50ZXJ2YWxzXG4gICAgaWYgKHRoaXMuY2xlYW51cEludGVydmFsKSB7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMuY2xlYW51cEludGVydmFsKTtcbiAgICAgIHRoaXMuY2xlYW51cEludGVydmFsID0gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgaWYgKHRoaXMuZ2NJbnRlcnZhbCkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmdjSW50ZXJ2YWwpO1xuICAgICAgdGhpcy5nY0ludGVydmFsID0gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2xlYXIgZ2xvYmFsIGNsZWFudXAgaW50ZXJ2YWwgaW4gZGV2ZWxvcG1lbnRcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgJiYgZ2xvYmFsRm9yU2Vzc2lvbnMuY2xlYW51cEludGVydmFsKSB7XG4gICAgICBjbGVhckludGVydmFsKGdsb2JhbEZvclNlc3Npb25zLmNsZWFudXBJbnRlcnZhbCk7XG4gICAgICBnbG9iYWxGb3JTZXNzaW9ucy5jbGVhbnVwSW50ZXJ2YWwgPSBudWxsO1xuICAgIH1cbiAgICBcbiAgICAvLyBDbGVhciBtZW1vcnkgc3RvcmFnZVxuICAgIHRoaXMubWVtb3J5U2Vzc2lvbnMuY2xlYXIoKTtcbiAgICB0aGlzLm1lbW9yeU1lc3NhZ2VzLmNsZWFyKCk7XG4gICAgXG4gICAgLy8gQ2xlYXIgZ2xvYmFsIHN0b3JhZ2UgaW4gZGV2ZWxvcG1lbnRcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcbiAgICAgIGdsb2JhbEZvclNlc3Npb25zLm1lbW9yeVNlc3Npb25zPy5jbGVhcigpO1xuICAgICAgZ2xvYmFsRm9yU2Vzc2lvbnMubWVtb3J5TWVzc2FnZXM/LmNsZWFyKCk7XG4gICAgfVxuICAgIFxuICAgIC8vIENsZWFudXAgUmVkaXMgc2VydmljZVxuICAgIGF3YWl0IHRoaXMucmVkaXNTZXJ2aWNlLmNsZWFudXAoKTtcbiAgICBcbiAgICBsb2cuaW5mbygnU2Vzc2lvbk1hbmFnZXIgY2xlYW51cCBjb21wbGV0ZWQnKTtcbiAgfVxuXG4gIC8vIE1lbW9yeSB1c2FnZSBtb25pdG9yaW5nXG4gIGdldE1lbW9yeVVzYWdlKCk6IHtcbiAgICBzZXNzaW9uQ291bnQ6IG51bWJlcjtcbiAgICBtZXNzYWdlU2V0Q291bnQ6IG51bWJlcjtcbiAgICBlc3RpbWF0ZWRNZW1vcnlNQjogbnVtYmVyO1xuICAgIGlzTmVhckxpbWl0OiBib29sZWFuO1xuICB9IHtcbiAgICBjb25zdCBzZXNzaW9uQ291bnQgPSB0aGlzLm1lbW9yeVNlc3Npb25zLnNpemU7XG4gICAgY29uc3QgbWVzc2FnZVNldENvdW50ID0gdGhpcy5tZW1vcnlNZXNzYWdlcy5zaXplO1xuICAgIFxuICAgIC8vIFJvdWdoIGVzdGltYXRpb246IGVhY2ggc2Vzc2lvbiB+MUtCLCBlYWNoIG1lc3NhZ2UgfjAuNUtCXG4gICAgbGV0IHRvdGFsTWVzc2FnZXMgPSAwO1xuICAgIGZvciAoY29uc3QgbWVzc2FnZXMgb2YgdGhpcy5tZW1vcnlNZXNzYWdlcy52YWx1ZXMoKSkge1xuICAgICAgdG90YWxNZXNzYWdlcyArPSBtZXNzYWdlcy5sZW5ndGg7XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IGVzdGltYXRlZE1lbW9yeU1CID0gTWF0aC5yb3VuZChcbiAgICAgIChzZXNzaW9uQ291bnQgKiAxICsgdG90YWxNZXNzYWdlcyAqIDAuNSkgLyAxMDI0XG4gICAgKTtcbiAgICBcbiAgICBjb25zdCBpc05lYXJMaW1pdCA9IHNlc3Npb25Db3VudCA+IHRoaXMuTUFYX01FTU9SWV9TRVNTSU9OUyAqIDAuODtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgc2Vzc2lvbkNvdW50LFxuICAgICAgbWVzc2FnZVNldENvdW50LFxuICAgICAgZXN0aW1hdGVkTWVtb3J5TUIsXG4gICAgICBpc05lYXJMaW1pdCxcbiAgICB9O1xuICB9XG59Il0sIm5hbWVzIjpbInY0IiwidXVpZHY0IiwiZ2V0UmVkaXNTZXJ2aWNlIiwibG9nIiwiY29uZmlnIiwiZ2xvYmFsRm9yU2Vzc2lvbnMiLCJnbG9iYWxUaGlzIiwiU2Vzc2lvbk1hbmFnZXIiLCJyZWRpc1NlcnZpY2UiLCJjbGVhbnVwSW50ZXJ2YWwiLCJnY0ludGVydmFsIiwiTUFYX01FTU9SWV9TRVNTSU9OUyIsIk1BWF9NRVNTQUdFU19QRVJfU0VTU0lPTiIsInByb2Nlc3MiLCJtZW1vcnlTZXNzaW9ucyIsIk1hcCIsIm1lbW9yeU1lc3NhZ2VzIiwiaW5mbyIsInN0YXJ0Q2xlYW51cFByb2Nlc3MiLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwiaW50ZXJ2YWwiLCJzZXRJbnRlcnZhbCIsImNsZWFudXBFeHBpcmVkU2Vzc2lvbnMiLCJnbG9iYWwiLCJnYyIsImRlYnVnIiwiZXJyb3IiLCJub3ciLCJEYXRlIiwiZXhwaXJlZFNlc3Npb25zIiwib2xkU2Vzc2lvbnMiLCJzZXNzaW9uSWQiLCJzZXNzaW9uIiwiZW50cmllcyIsInRpbWVTaW5jZUFjdGl2aXR5IiwiZ2V0VGltZSIsImxhc3RBY3Rpdml0eSIsIm1heFNlc3Npb25EdXJhdGlvbiIsInB1c2giLCJzaXplIiwic29ydCIsImEiLCJiIiwic2Vzc2lvbnNUb1JlbW92ZSIsInNsaWNlIiwibGVuZ3RoIiwid2FybiIsInN1YnN0cmluZyIsImJhdGNoU2l6ZSIsImkiLCJiYXRjaCIsIlByb21pc2UiLCJhbGwiLCJtYXAiLCJkZWxldGVTZXNzaW9uIiwicmVzb2x2ZSIsInNldEltbWVkaWF0ZSIsIm9ycGhhbmVkTWVzc2FnZVNlc3Npb25zIiwia2V5cyIsImhhcyIsImRlbGV0ZSIsImNyZWF0ZVNlc3Npb24iLCJsYW5ndWFnZSIsIm1ldGFkYXRhIiwic2Vzc2lvbkRhdGEiLCJpZCIsImNyZWF0ZWRBdCIsIm1lc3NhZ2VDb3VudCIsImlzQWN0aXZlIiwicmVkaXNTdG9yZWQiLCJzZXRTZXNzaW9uIiwiTWF0aCIsImZsb29yIiwic2V0Iiwic3RvcmVkIiwiZ2V0IiwidG90YWxTZXNzaW9ucyIsImlzRGV2ZWxvcG1lbnQiLCJ1c2luZ0dsb2JhbFN0b3JhZ2UiLCJzdG9yYWdlIiwiRXJyb3IiLCJnZXRTZXNzaW9uIiwidG90YWxTZXNzaW9uc0luTWVtb3J5IiwiYXZhaWxhYmxlU2Vzc2lvbklkcyIsIkFycmF5IiwiZnJvbSIsImdsb2JhbFNlc3Npb25Db3VudCIsIm1heER1cmF0aW9uIiwidXBkYXRlU2Vzc2lvbiIsInVwZGF0ZXMiLCJleGlzdGluZ1Nlc3Npb24iLCJ1cGRhdGVkU2Vzc2lvbiIsInJlZGlzVXBkYXRlZCIsInJlZGlzRGVsZXRlZCIsIm1lbW9yeURlbGV0ZWQiLCJhZGRNZXNzYWdlIiwibWVzc2FnZSIsInJlZGlzQWRkZWQiLCJtZXNzYWdlcyIsInNwbGljZSIsImdldE1lc3NhZ2VzIiwibGltaXQiLCJ0aW1lc3RhbXAiLCJjbGVhck1lc3NhZ2VzIiwiZGVsZXRlQ2FjaGUiLCJnZXRTZXNzaW9uU3RhdHMiLCJtZW1vcnlTZXNzaW9uQ291bnQiLCJyZWRpc1N0YXRzIiwiZ2V0U3RhdHMiLCJyZWRpc1Nlc3Npb25Db3VudCIsInRvdGFsS2V5cyIsImxhbmd1YWdlRGlzdHJpYnV0aW9uIiwiamEiLCJlbiIsInpoIiwia28iLCJ0b3RhbE1lc3NhZ2VzIiwiYXZlcmFnZU1lc3NhZ2VzUGVyU2Vzc2lvbiIsInRvdGFsQWN0aXZlU2Vzc2lvbnMiLCJOdW1iZXIiLCJ0b0ZpeGVkIiwiaXNTZXNzaW9uQWN0aXZlIiwic2V0U2Vzc2lvbkxhbmd1YWdlIiwiZ2V0U2Vzc2lvbkNvdW50IiwiZ2V0QWxsU2Vzc2lvbnMiLCJ2YWx1ZXMiLCJjbGVhbnVwIiwiY2xlYXJJbnRlcnZhbCIsImNsZWFyIiwiZ2V0TWVtb3J5VXNhZ2UiLCJzZXNzaW9uQ291bnQiLCJtZXNzYWdlU2V0Q291bnQiLCJlc3RpbWF0ZWRNZW1vcnlNQiIsInJvdW5kIiwiaXNOZWFyTGltaXQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/services/SessionManager.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/services/SimpleRAGService.ts":
/*!**********************************************!*\
  !*** ./src/lib/services/SimpleRAGService.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SimpleRAGService: () => (/* binding */ SimpleRAGService)\n/* harmony export */ });\n/* harmony import */ var _GeminiService__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./GeminiService */ \"(rsc)/./src/lib/services/GeminiService.ts\");\n/* harmony import */ var _TokyoOpenDataService__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./TokyoOpenDataService */ \"(rsc)/./src/lib/services/TokyoOpenDataService.ts\");\n/* harmony import */ var _lib_cache_SearchCache__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/cache/SearchCache */ \"(rsc)/./src/lib/cache/SearchCache.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./src/lib/logger.ts\");\n\n\n\n\n/**\n * シンプルなRAG（Retrieval-Augmented Generation）サービス\n * 複雑な推論や自律的機能を排除し、行政情報への正確な応答に特化\n */ class SimpleRAGService {\n    constructor(){\n        this.cache = (0,_lib_cache_SearchCache__WEBPACK_IMPORTED_MODULE_2__.getSearchCache)();\n        this.geminiService = new _GeminiService__WEBPACK_IMPORTED_MODULE_0__.GeminiService();\n        this.openDataService = new _TokyoOpenDataService__WEBPACK_IMPORTED_MODULE_1__.TokyoOpenDataService();\n    }\n    /**\n   * ストリーミング対応：思考過程をリアルタイムで通知しながら処理\n   */ async processQueryStreaming(query, language = \"ja\", onStep) {\n        const startTime = Date.now();\n        const emitStep = (step, status, message, data)=>{\n            onStep({\n                step,\n                status,\n                message,\n                timestamp: Date.now() - startTime,\n                data\n            });\n        };\n        try {\n            emitStep(\"start\", \"started\", \"質問を処理しています...\", {\n                query: query.substring(0, 50)\n            });\n            _lib_logger__WEBPACK_IMPORTED_MODULE_3__.log.info(\"SimpleRAG streaming processing started\", {\n                query: query.substring(0, 100),\n                language\n            });\n            // 1. キャッシュチェック\n            emitStep(\"cache-check\", \"started\", \"キャッシュを確認しています...\");\n            const cacheKey = this.generateCacheKey(query, language);\n            const cachedResult = this.cache.get({\n                text: query,\n                language\n            });\n            if (cachedResult) {\n                emitStep(\"cache-check\", \"completed\", \"キャッシュからデータを取得しました\");\n                emitStep(\"response-generation\", \"completed\", \"応答を生成しました\");\n                _lib_logger__WEBPACK_IMPORTED_MODULE_3__.log.info(\"Cache hit for streaming query\", {\n                    query: query.substring(0, 50)\n                });\n                return this.formatCachedResponse(cachedResult, startTime);\n            }\n            emitStep(\"cache-check\", \"completed\", \"キャッシュにデータが見つかりませんでした\");\n            // 2. 行政データ検索の必要性を判別\n            emitStep(\"search-decision\", \"started\", \"質問内容を分析しています...\");\n            const needsDataSearch = await this.shouldSearchAdministrativeData(query, language);\n            emitStep(\"search-decision\", \"completed\", needsDataSearch ? \"データ検索が必要と判断されました\" : \"データ検索は不要と判断されました\", {\n                needsSearch: needsDataSearch\n            });\n            let relevantData = [];\n            if (needsDataSearch) {\n                // 3. キーワード抽出\n                emitStep(\"keyword-extraction\", \"started\", \"キーワードを抽出しています...\");\n                const keywords = this.extractKeywords(query, language);\n                emitStep(\"keyword-extraction\", \"completed\", `${keywords.length}個のキーワードを抽出しました`, {\n                    keywords: keywords.slice(0, 5)\n                });\n                // 4. データ検索\n                emitStep(\"data-search\", \"started\", \"東京都オープンデータを検索しています...\");\n                relevantData = await this.searchRelevantData(keywords, language);\n                emitStep(\"data-search\", \"completed\", `${relevantData.length}件のデータを取得しました`, {\n                    count: relevantData.length\n                });\n            } else {\n                emitStep(\"data-search\", \"completed\", \"データ検索をスキップしました\");\n            }\n            // 5. 応答生成\n            emitStep(\"response-generation\", \"started\", \"AI応答を生成しています...\");\n            const response = await this.generateResponse(query, relevantData, language);\n            emitStep(\"response-generation\", \"completed\", \"応答を生成しました\", {\n                length: response.length\n            });\n            // 6. 結果キャッシュ\n            emitStep(\"caching\", \"started\", \"結果をキャッシュしています...\");\n            const result = {\n                content: response,\n                sources: relevantData,\n                confidence: this.calculateConfidence(relevantData.length, needsDataSearch),\n                processingTime: Date.now() - startTime\n            };\n            // キャッシュに保存\n            this.cache.set({\n                text: query,\n                language\n            }, {\n                items: relevantData,\n                total: relevantData.length,\n                query,\n                processingTime: result.processingTime,\n                usedCache: false\n            });\n            emitStep(\"caching\", \"completed\", \"結果をキャッシュしました\");\n            emitStep(\"complete\", \"completed\", \"処理が完了しました\", {\n                sourceCount: relevantData.length,\n                confidence: result.confidence,\n                processingTime: result.processingTime\n            });\n            _lib_logger__WEBPACK_IMPORTED_MODULE_3__.log.info(\"SimpleRAG streaming processing completed\", {\n                query: query.substring(0, 50),\n                sourceCount: relevantData.length,\n                processingTime: result.processingTime,\n                confidence: result.confidence,\n                usedDataSearch: needsDataSearch\n            });\n            return result;\n        } catch (error) {\n            emitStep(\"error\", \"failed\", \"エラーが発生しました\", {\n                error: error.message\n            });\n            _lib_logger__WEBPACK_IMPORTED_MODULE_3__.log.error(\"SimpleRAG streaming processing failed\", error, {\n                query: query.substring(0, 50),\n                language\n            });\n            return this.generateErrorResponse(error, language, startTime);\n        }\n    }\n    /**\n   * メイン処理：質問に対してシンプルなRAG応答を生成\n   */ async processQuery(query, language = \"ja\") {\n        const startTime = Date.now();\n        try {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_3__.log.info(\"SimpleRAG processing started\", {\n                query: query.substring(0, 100),\n                language\n            });\n            // 1. キャッシュチェック\n            const cacheKey = this.generateCacheKey(query, language);\n            const cachedResult = this.cache.get({\n                text: query,\n                language\n            });\n            if (cachedResult) {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_3__.log.info(\"Cache hit for query\", {\n                    query: query.substring(0, 50)\n                });\n                return this.formatCachedResponse(cachedResult, startTime);\n            }\n            // 2. 行政データ検索の必要性を判別\n            const needsDataSearch = await this.shouldSearchAdministrativeData(query, language);\n            _lib_logger__WEBPACK_IMPORTED_MODULE_3__.log.debug(\"Data search decision\", {\n                needsDataSearch,\n                query: query.substring(0, 50)\n            });\n            let relevantData = [];\n            if (needsDataSearch) {\n                // 3. キーワード抽出\n                const keywords = this.extractKeywords(query, language);\n                _lib_logger__WEBPACK_IMPORTED_MODULE_3__.log.debug(\"Keywords extracted\", {\n                    keywords\n                });\n                // 4. データ検索\n                relevantData = await this.searchRelevantData(keywords, language);\n                _lib_logger__WEBPACK_IMPORTED_MODULE_3__.log.debug(\"Data retrieved\", {\n                    count: relevantData.length\n                });\n            } else {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_3__.log.debug(\"Skipped data search - not required for this query type\");\n            }\n            // 5. 応答生成\n            const response = await this.generateResponse(query, relevantData, language);\n            // 6. 結果キャッシュ\n            const result = {\n                content: response,\n                sources: relevantData,\n                confidence: this.calculateConfidence(relevantData.length, needsDataSearch),\n                processingTime: Date.now() - startTime\n            };\n            // キャッシュに保存\n            this.cache.set({\n                text: query,\n                language\n            }, {\n                items: relevantData,\n                total: relevantData.length,\n                query,\n                processingTime: result.processingTime,\n                usedCache: false\n            });\n            _lib_logger__WEBPACK_IMPORTED_MODULE_3__.log.info(\"SimpleRAG processing completed\", {\n                query: query.substring(0, 50),\n                sourceCount: relevantData.length,\n                processingTime: result.processingTime,\n                confidence: result.confidence,\n                usedDataSearch: needsDataSearch\n            });\n            return result;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_3__.log.error(\"SimpleRAG processing failed\", error, {\n                query: query.substring(0, 50),\n                language\n            });\n            return this.generateErrorResponse(error, language, startTime);\n        }\n    }\n    /**\n   * 行政データ検索の必要性を判別\n   */ async shouldSearchAdministrativeData(query, language) {\n        try {\n            // 1. パターンマッチングによる基本判別\n            const basicDecision = this.basicSearchDecision(query, language);\n            if (basicDecision.isDefinitive) {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_3__.log.debug(\"Basic pattern matching decision\", {\n                    needsSearch: basicDecision.needsSearch,\n                    reason: basicDecision.reason\n                });\n                return basicDecision.needsSearch;\n            }\n            // 2. AIによる詳細判別（基本判別で確定しない場合）\n            const aiDecision = await this.aiSearchDecision(query, language);\n            _lib_logger__WEBPACK_IMPORTED_MODULE_3__.log.debug(\"AI-based decision\", {\n                needsSearch: aiDecision,\n                query: query.substring(0, 50)\n            });\n            return aiDecision;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_3__.log.warn(\"Failed to determine search necessity\", {\n                error: error.message,\n                fallback: \"searching-data\"\n            });\n            // エラー時は安全側に倒してデータ検索を実行\n            return true;\n        }\n    }\n    /**\n   * パターンマッチングによる基本判別\n   */ basicSearchDecision(query, language) {\n        const lowerQuery = query.toLowerCase().trim();\n        // 確実に検索不要なパターン\n        const noSearchPatterns = {\n            ja: [\n                // 挨拶\n                /^(おはよう|こんにちは|こんばんは|はじめまして|お疲れ様|よろしく)/,\n                // 感謝・謝罪\n                /^(ありがとう|すみません|申し訳|失礼)/,\n                // システム関連質問\n                /^(あなたは|君は|システム|AI|人工知能|使い方|操作方法)/,\n                // 一般的な雑談\n                /^(今日は|天気|気温|時間|何時|どうですか)/,\n                // 終了の挨拶\n                /^(さようなら|また|終了|やめ|バイバイ)/\n            ],\n            en: [\n                /^(hello|hi|good morning|good afternoon|good evening|thank you|thanks|sorry)/,\n                /^(what are you|who are you|how to use|weather|time|goodbye|bye)/\n            ],\n            zh: [\n                /^(你好|早上好|下午好|晚上好|谢谢|对不起|再见)/,\n                /^(你是|系统|怎么用|天气|时间)/\n            ],\n            ko: [\n                /^(안녕|감사|죄송|안녕히|시스템|날씨|시간)/\n            ]\n        };\n        // 確実に検索必要なパターン\n        const needSearchPatterns = {\n            ja: [\n                // 子育て関連\n                /(保育園|幼稚園|児童館|子育て|育児|出産|妊娠|小児科|予防接種)/,\n                // 福祉関連\n                /(介護|高齢者|障害|福祉|年金|医療費|生活保護)/,\n                // 教育関連\n                /(学校|入学|教育|図書館|奨学金)/,\n                // 住宅関連\n                /(住宅|家賃|公営住宅|都営住宅|引っ越し)/,\n                // 防災関連\n                /(災害|避難|防災|地震|台風|洪水|避難所)/,\n                // 手続き関連\n                /(申請|手続き|届出|証明書|住民票|戸籍|印鑑登録|転入|転出)/,\n                // 施設関連\n                /(区役所|市役所|公民館|体育館|プール|公園)/,\n                // 東京都特有\n                /(都バス|都営|メトロ|JR|小田急|京王|東急|西武|東武)/\n            ],\n            en: [\n                /(childcare|nursery|kindergarten|school|education|welfare|disaster|evacuation|application|certificate)/\n            ],\n            zh: [\n                /(托儿|幼儿园|学校|教育|福利|灾害|避难|申请|证明)/\n            ],\n            ko: [\n                /(어린이집|유치원|학교|교육|복지|재해|대피|신청|증명)/\n            ]\n        };\n        const patterns = noSearchPatterns[language] || noSearchPatterns.ja;\n        const searchPatterns = needSearchPatterns[language] || needSearchPatterns.ja;\n        // 検索不要パターンのチェック\n        for (const pattern of patterns){\n            if (pattern.test(lowerQuery)) {\n                return {\n                    isDefinitive: true,\n                    needsSearch: false,\n                    reason: \"matched_no_search_pattern\"\n                };\n            }\n        }\n        // 検索必要パターンのチェック\n        for (const pattern of searchPatterns){\n            if (pattern.test(lowerQuery)) {\n                return {\n                    isDefinitive: true,\n                    needsSearch: true,\n                    reason: \"matched_search_pattern\"\n                };\n            }\n        }\n        // どちらにも該当しない場合は非確定\n        return {\n            isDefinitive: false,\n            needsSearch: false,\n            reason: \"no_definitive_pattern_match\"\n        };\n    }\n    /**\n   * AI による検索必要性判別\n   */ async aiSearchDecision(query, language) {\n        try {\n            const prompt = this.buildSearchDecisionPrompt(query, language);\n            const response = await this.geminiService.generateText(prompt, undefined, language);\n            // 簡単なパースロジック\n            const decision = response.toLowerCase().includes(\"true\") || response.toLowerCase().includes(\"必要\") || response.toLowerCase().includes(\"yes\");\n            return decision;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_3__.log.warn(\"AI search decision failed\", {\n                error: error.message\n            });\n            // AIが失敗した場合は検索を実行（安全側）\n            return true;\n        }\n    }\n    /**\n   * 検索判別用プロンプト構築\n   */ buildSearchDecisionPrompt(query, language) {\n        const prompts = {\n            ja: `\n以下のユーザーの質問に答えるために、東京都の行政データ（オープンデータ）を検索する必要がありますか？\n\nユーザーの質問: \"${query}\"\n\n【検索が必要な場合の例】\n- 保育園、学校、病院などの施設情報\n- 行政手続きや申請方法\n- 福祉サービスや給付金\n- 防災・避難所情報\n- 交通機関の情報\n- 各種証明書の取得方法\n\n【検索が不要な場合の例】\n- 挨拶（こんにちは、ありがとう等）\n- システムに関する質問（あなたは何ですか等）\n- 一般的な雑談（天気、時間等）\n- 東京都と関係ない一般的な質問\n\n\"true\" または \"false\" で回答してください。`,\n            en: `\nDoes answering the following user question require searching Tokyo administrative data (open data)?\n\nUser question: \"${query}\"\n\n【Cases requiring search】\n- Facility information (nurseries, schools, hospitals)\n- Administrative procedures and applications\n- Welfare services and benefits\n- Disaster prevention and evacuation information\n- Transportation information\n- Certificate acquisition methods\n\n【Cases not requiring search】\n- Greetings (hello, thank you, etc.)\n- System-related questions (what are you, etc.)\n- General chat (weather, time, etc.)\n- General questions unrelated to Tokyo\n\nAnswer with \"true\" or \"false\".`\n        };\n        return prompts[language] || prompts.ja;\n    }\n    /**\n   * キーワード抽出（シンプルな実装）\n   */ extractKeywords(query, language) {\n        const stopWords = this.getStopWords(language);\n        // 基本的な前処理とキーワード抽出\n        const words = query.toLowerCase().replace(/[^\\w\\s]/g, \" \") // 句読点を除去\n        .split(/\\s+/).filter((word)=>word.length > 1).filter((word)=>!stopWords.includes(word));\n        // 重複除去と最大キーワード数制限\n        return [\n            ...new Set(words)\n        ].slice(0, 10);\n    }\n    /**\n   * 関連データの検索\n   */ async searchRelevantData(keywords, language) {\n        try {\n            // 東京都オープンデータサービスから検索\n            const searchQuery = keywords.join(\" \");\n            const items = await this.openDataService.fetchRelevantData(searchQuery, language);\n            // 最大件数制限（性能とコスト効率のため）\n            return items.slice(0, 5);\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_3__.log.warn(\"Data search failed\", {\n                keywords,\n                language,\n                error: error.message\n            });\n            return [];\n        }\n    }\n    /**\n   * Gemini APIを使用した応答生成\n   */ async generateResponse(query, data, language) {\n        const prompt = this.buildPrompt(query, data, language);\n        try {\n            return await this.geminiService.generateText(prompt, undefined, language);\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_3__.log.warn(\"Response generation failed\", {\n                error: error.message\n            });\n            return this.getFallbackResponse(language);\n        }\n    }\n    /**\n   * プロンプト構築\n   */ buildPrompt(query, data, language) {\n        const templates = {\n            ja: {\n                system: `あなたは東京都の行政情報に関する質問に正確に答えるAIアシスタントです。\n以下のガイドラインに従って回答してください：\n\n1. 提供された参考データのみを使用して回答する\n2. データにない情報は推測せず、「提供されたデータでは確認できません」と回答する\n3. 簡潔で分かりやすい言葉で説明する\n4. 必要に応じて具体的な手続きや連絡先を案内する`,\n                userPrompt: (query, dataContext)=>`\n参考データ:\n${dataContext}\n\n質問: ${query}\n\n参考データに基づいて、正確で有用な回答を提供してください。データにない情報については推測せず、その旨を明記してください。`\n            },\n            en: {\n                system: `You are an AI assistant that accurately answers questions about Tokyo administrative information.\nPlease follow these guidelines:\n\n1. Use only the provided reference data for your answers\n2. Do not speculate on information not in the data; respond with \"This information is not available in the provided data\"\n3. Explain in clear and simple language\n4. Provide specific procedures or contact information when necessary`,\n                userPrompt: (query, dataContext)=>`\nReference Data:\n${dataContext}\n\nQuestion: ${query}\n\nBased on the reference data, provide an accurate and useful answer. For information not in the data, do not speculate and clearly indicate that.`\n            }\n        };\n        const template = templates[language] || templates.ja;\n        // データコンテキストの構築\n        const dataContext = data.length > 0 ? data.map((item, index)=>`${index + 1}. ${item.title}\\n   ${item.description}\\n   ${item.content.substring(0, 200)}...`).join(\"\\n\\n\") : language === \"ja\" ? \"関連するデータが見つかりませんでした。\" : \"No relevant data found.\";\n        return template.system + \"\\n\\n\" + template.userPrompt(query, dataContext);\n    }\n    /**\n   * 信頼度計算\n   */ calculateConfidence(dataCount, needsDataSearch = true) {\n        // データ検索が不要な質問（挨拶など）は高い信頼度\n        if (!needsDataSearch) {\n            return 0.9;\n        }\n        // データ検索が必要な質問の場合\n        if (dataCount === 0) return 0.2;\n        if (dataCount >= 3) return 0.8;\n        return 0.4 + dataCount * 0.2;\n    }\n    /**\n   * キャッシュキー生成\n   */ generateCacheKey(query, language) {\n        return `rag_${language}_${query.toLowerCase().replace(/\\s+/g, \"_\").substring(0, 50)}`;\n    }\n    /**\n   * キャッシュ結果のフォーマット\n   */ formatCachedResponse(cachedResult, startTime) {\n        return {\n            content: `キャッシュから取得した結果です。\\n\\n${cachedResult.items[0]?.description || \"関連情報が見つかりました。\"}`,\n            sources: cachedResult.items || [],\n            confidence: this.calculateConfidence(cachedResult.items?.length || 0),\n            processingTime: Date.now() - startTime\n        };\n    }\n    /**\n   * エラー応答生成\n   */ generateErrorResponse(error, language, startTime) {\n        const errorMessages = {\n            ja: \"申し訳ございませんが、システムエラーが発生しました。しばらく後にもう一度お試しください。\",\n            en: \"Sorry, a system error occurred. Please try again later.\",\n            zh: \"抱歉，系统发生错误。请稍后重试。\",\n            ko: \"죄송합니다. 시스템 오류가 발생했습니다. 잠시 후 다시 시도해주세요.\"\n        };\n        return {\n            content: errorMessages[language] || errorMessages.ja,\n            sources: [],\n            confidence: 0.1,\n            processingTime: Date.now() - startTime\n        };\n    }\n    /**\n   * フォールバック応答\n   */ getFallbackResponse(language) {\n        const fallbackMessages = {\n            ja: \"申し訳ございませんが、現在この質問にお答えできません。東京都の公式ホームページや各区市町村の窓口でご確認ください。\",\n            en: \"Sorry, I cannot answer this question at the moment. Please check the official Tokyo Metropolitan Government website or contact your local municipal office.\",\n            zh: \"抱歉，目前无法回答这个问题。请查看东京都官方网站或联系当地市区町村窗口。\",\n            ko: \"죄송합니다. 현재 이 질문에 답할 수 없습니다. 도쿄도 공식 홈페이지나 각 구시정촌 창구에서 확인해주세요.\"\n        };\n        return fallbackMessages[language] || fallbackMessages.ja;\n    }\n    /**\n   * ストップワード取得\n   */ getStopWords(language) {\n        const stopWords = {\n            ja: [\n                \"は\",\n                \"が\",\n                \"を\",\n                \"に\",\n                \"で\",\n                \"と\",\n                \"の\",\n                \"から\",\n                \"まで\",\n                \"など\",\n                \"について\",\n                \"に関して\",\n                \"を教えて\",\n                \"ください\",\n                \"です\",\n                \"ます\",\n                \"である\"\n            ],\n            en: [\n                \"the\",\n                \"is\",\n                \"at\",\n                \"which\",\n                \"on\",\n                \"a\",\n                \"an\",\n                \"and\",\n                \"or\",\n                \"but\",\n                \"in\",\n                \"with\",\n                \"for\",\n                \"to\",\n                \"of\",\n                \"as\",\n                \"by\"\n            ],\n            zh: [\n                \"的\",\n                \"是\",\n                \"在\",\n                \"有\",\n                \"和\",\n                \"与\",\n                \"或\",\n                \"但\",\n                \"因为\",\n                \"所以\",\n                \"如果\",\n                \"那么\",\n                \"这个\",\n                \"那个\"\n            ],\n            ko: [\n                \"은\",\n                \"는\",\n                \"이\",\n                \"가\",\n                \"을\",\n                \"를\",\n                \"에\",\n                \"에서\",\n                \"와\",\n                \"과\",\n                \"의\",\n                \"으로\",\n                \"로\",\n                \"에게\",\n                \"한테\"\n            ]\n        };\n        return stopWords[language] || stopWords.ja;\n    }\n    /**\n   * サービス統計取得\n   */ getStats() {\n        // 簡単な統計情報（実際の実装では永続化されたメトリクスを使用）\n        return {\n            cacheHitRate: 0.0,\n            totalQueries: 0,\n            averageProcessingTime: 0\n        };\n    }\n    /**\n   * クリーンアップ\n   */ cleanup() {\n        // 必要に応じてリソースクリーンアップ\n        _lib_logger__WEBPACK_IMPORTED_MODULE_3__.log.info(\"SimpleRAGService cleanup completed\");\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3NlcnZpY2VzL1NpbXBsZVJBR1NlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFDZ0Q7QUFDYztBQUNMO0FBQ3RCO0FBbUJuQzs7O0NBR0MsR0FDTSxNQUFNSTtJQUtYQyxhQUFjO2FBRk5DLFFBQVFKLHNFQUFjQTtRQUc1QixJQUFJLENBQUNLLGFBQWEsR0FBRyxJQUFJUCx5REFBYUE7UUFDdEMsSUFBSSxDQUFDUSxlQUFlLEdBQUcsSUFBSVAsdUVBQW9CQTtJQUNqRDtJQUVBOztHQUVDLEdBQ0QsTUFBTVEsc0JBQ0pDLEtBQWEsRUFDYkMsV0FBOEIsSUFBSSxFQUNsQ0MsTUFBeUIsRUFDRztRQUM1QixNQUFNQyxZQUFZQyxLQUFLQyxHQUFHO1FBRTFCLE1BQU1DLFdBQVcsQ0FBQ0MsTUFBY0MsUUFBaUNDLFNBQWlCQztZQUNoRlIsT0FBTztnQkFDTEs7Z0JBQ0FDO2dCQUNBQztnQkFDQUUsV0FBV1AsS0FBS0MsR0FBRyxLQUFLRjtnQkFDeEJPO1lBQ0Y7UUFDRjtRQUVBLElBQUk7WUFDRkosU0FBUyxTQUFTLFdBQVcsaUJBQWlCO2dCQUFFTixPQUFPQSxNQUFNWSxTQUFTLENBQUMsR0FBRztZQUFJO1lBRTlFbkIsNENBQUdBLENBQUNvQixJQUFJLENBQUMsMENBQTBDO2dCQUNqRGIsT0FBT0EsTUFBTVksU0FBUyxDQUFDLEdBQUc7Z0JBQzFCWDtZQUNGO1lBRUEsZUFBZTtZQUNmSyxTQUFTLGVBQWUsV0FBVztZQUNuQyxNQUFNUSxXQUFXLElBQUksQ0FBQ0MsZ0JBQWdCLENBQUNmLE9BQU9DO1lBQzlDLE1BQU1lLGVBQWUsSUFBSSxDQUFDcEIsS0FBSyxDQUFDcUIsR0FBRyxDQUFDO2dCQUFFQyxNQUFNbEI7Z0JBQU9DO1lBQVM7WUFFNUQsSUFBSWUsY0FBYztnQkFDaEJWLFNBQVMsZUFBZSxhQUFhO2dCQUNyQ0EsU0FBUyx1QkFBdUIsYUFBYTtnQkFDN0NiLDRDQUFHQSxDQUFDb0IsSUFBSSxDQUFDLGlDQUFpQztvQkFB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QUs7Z0JBQUs7Z0JBQUs7Z0JBQUs7Z0JBQUs7Z0JBQUs7Z0JBQU07Z0JBQU07Z0JBQU07Z0JBQU07Z0JBQU07YUFBSztZQUNoRkMsSUFBSTtnQkFBQztnQkFBSztnQkFBSztnQkFBSztnQkFBSztnQkFBSztnQkFBSztnQkFBSztnQkFBTTtnQkFBSztnQkFBSztnQkFBSztnQkFBTTtnQkFBSztnQkFBTTthQUFLO1FBQ3JGO1FBRUEsT0FBT2EsU0FBUyxDQUFDM0UsU0FBUyxJQUFJMkUsVUFBVWhCLEVBQUU7SUFDNUM7SUFFQTs7R0FFQyxHQUNEMEMsV0FJRTtRQUNBLGlDQUFpQztRQUNqQyxPQUFPO1lBQ0xDLGNBQWM7WUFDZEMsY0FBYztZQUNkQyx1QkFBdUI7UUFDekI7SUFDRjtJQUVBOztHQUVDLEdBQ0RDLFVBQWdCO1FBQ2Qsb0JBQW9CO1FBQ3BCakgsNENBQUdBLENBQUNvQixJQUFJLENBQUM7SUFDWDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdG9reW8tb3BlbmRhdGEtaGFja2F0aG9uLy4vc3JjL2xpYi9zZXJ2aWNlcy9TaW1wbGVSQUdTZXJ2aWNlLnRzPzQ3N2UiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT3BlbkRhdGFJdGVtLCBTdXBwb3J0ZWRMYW5ndWFnZSB9IGZyb20gJ0AvdHlwZXMnO1xuaW1wb3J0IHsgR2VtaW5pU2VydmljZSB9IGZyb20gJy4vR2VtaW5pU2VydmljZSc7XG5pbXBvcnQgeyBUb2t5b09wZW5EYXRhU2VydmljZSB9IGZyb20gJy4vVG9reW9PcGVuRGF0YVNlcnZpY2UnO1xuaW1wb3J0IHsgZ2V0U2VhcmNoQ2FjaGUgfSBmcm9tICdAL2xpYi9jYWNoZS9TZWFyY2hDYWNoZSc7XG5pbXBvcnQgeyBsb2cgfSBmcm9tICdAL2xpYi9sb2dnZXInO1xuXG5pbnRlcmZhY2UgU2ltcGxlUkFHUmVzcG9uc2Uge1xuICBjb250ZW50OiBzdHJpbmc7XG4gIHNvdXJjZXM6IE9wZW5EYXRhSXRlbVtdO1xuICBjb25maWRlbmNlOiBudW1iZXI7XG4gIHByb2Nlc3NpbmdUaW1lOiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBTdHJlYW1pbmdTdGVwIHtcbiAgc3RlcDogc3RyaW5nO1xuICBzdGF0dXM6ICdzdGFydGVkJyB8ICdjb21wbGV0ZWQnIHwgJ2ZhaWxlZCc7XG4gIG1lc3NhZ2U6IHN0cmluZztcbiAgdGltZXN0YW1wOiBudW1iZXI7XG4gIGRhdGE/OiBhbnk7XG59XG5cbnR5cGUgU3RyZWFtaW5nQ2FsbGJhY2sgPSAoc3RlcDogU3RyZWFtaW5nU3RlcCkgPT4gdm9pZDtcblxuLyoqXG4gKiDjgrfjg7Pjg5fjg6vjgapSQUfvvIhSZXRyaWV2YWwtQXVnbWVudGVkIEdlbmVyYXRpb27vvInjgrXjg7zjg5PjgrlcbiAqIOikh+mbkeOBquaOqOirluOChOiHquW+i+eahOapn+iDveOCkuaOkumZpOOBl+OAgeihjOaUv+aDheWgseOBuOOBruato+eiuuOBquW/nOetlOOBq+eJueWMllxuICovXG5leHBvcnQgY2xhc3MgU2ltcGxlUkFHU2VydmljZSB7XG4gIHByaXZhdGUgZ2VtaW5pU2VydmljZTogR2VtaW5pU2VydmljZTtcbiAgcHJpdmF0ZSBvcGVuRGF0YVNlcnZpY2U6IFRva3lvT3BlbkRhdGFTZXJ2aWNlO1xuICBwcml2YXRlIGNhY2hlID0gZ2V0U2VhcmNoQ2FjaGUoKTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmdlbWluaVNlcnZpY2UgPSBuZXcgR2VtaW5pU2VydmljZSgpO1xuICAgIHRoaXMub3BlbkRhdGFTZXJ2aWNlID0gbmV3IFRva3lvT3BlbkRhdGFTZXJ2aWNlKCk7XG4gIH1cblxuICAvKipcbiAgICog44K544OI44Oq44O844Of44Oz44Kw5a++5b+c77ya5oCd6ICD6YGO56iL44KS44Oq44Ki44Or44K/44Kk44Og44Gn6YCa55+l44GX44Gq44GM44KJ5Yem55CGXG4gICAqL1xuICBhc3luYyBwcm9jZXNzUXVlcnlTdHJlYW1pbmcoXG4gICAgcXVlcnk6IHN0cmluZywgXG4gICAgbGFuZ3VhZ2U6IFN1cHBvcnRlZExhbmd1YWdlID0gJ2phJyxcbiAgICBvblN0ZXA6IFN0cmVhbWluZ0NhbGxiYWNrXG4gICk6IFByb21pc2U8U2ltcGxlUkFHUmVzcG9uc2U+IHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIFxuICAgIGNvbnN0IGVtaXRTdGVwID0gKHN0ZXA6IHN0cmluZywgc3RhdHVzOiBTdHJlYW1pbmdTdGVwWydzdGF0dXMnXSwgbWVzc2FnZTogc3RyaW5nLCBkYXRhPzogYW55KSA9PiB7XG4gICAgICBvblN0ZXAoe1xuICAgICAgICBzdGVwLFxuICAgICAgICBzdGF0dXMsXG4gICAgICAgIG1lc3NhZ2UsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZSxcbiAgICAgICAgZGF0YVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRyeSB7XG4gICAgICBlbWl0U3RlcCgnc3RhcnQnLCAnc3RhcnRlZCcsICfos6rllY/jgpLlh6bnkIbjgZfjgabjgYTjgb7jgZkuLi4nLCB7IHF1ZXJ5OiBxdWVyeS5zdWJzdHJpbmcoMCwgNTApIH0pO1xuICAgICAgXG4gICAgICBsb2cuaW5mbygnU2ltcGxlUkFHIHN0cmVhbWluZyBwcm9jZXNzaW5nIHN0YXJ0ZWQnLCB7IFxuICAgICAgICBxdWVyeTogcXVlcnkuc3Vic3RyaW5nKDAsIDEwMCksXG4gICAgICAgIGxhbmd1YWdlIFxuICAgICAgfSk7XG5cbiAgICAgIC8vIDEuIOOCreODo+ODg+OCt+ODpeODgeOCp+ODg+OCr1xuICAgICAgZW1pdFN0ZXAoJ2NhY2hlLWNoZWNrJywgJ3N0YXJ0ZWQnLCAn44Kt44Oj44OD44K344Ol44KS56K66KqN44GX44Gm44GE44G+44GZLi4uJyk7XG4gICAgICBjb25zdCBjYWNoZUtleSA9IHRoaXMuZ2VuZXJhdGVDYWNoZUtleShxdWVyeSwgbGFuZ3VhZ2UpO1xuICAgICAgY29uc3QgY2FjaGVkUmVzdWx0ID0gdGhpcy5jYWNoZS5nZXQoeyB0ZXh0OiBxdWVyeSwgbGFuZ3VhZ2UgfSk7XG4gICAgICBcbiAgICAgIGlmIChjYWNoZWRSZXN1bHQpIHtcbiAgICAgICAgZW1pdFN0ZXAoJ2NhY2hlLWNoZWNrJywgJ2NvbXBsZXRlZCcsICfjgq3jg6Pjg4Pjgrfjg6XjgYvjgonjg4fjg7zjgr/jgpLlj5blvpfjgZfjgb7jgZfjgZ8nKTtcbiAgICAgICAgZW1pdFN0ZXAoJ3Jlc3BvbnNlLWdlbmVyYXRpb24nLCAnY29tcGxldGVkJywgJ+W/nOetlOOCkueUn+aIkOOBl+OBvuOBl+OBnycpO1xuICAgICAgICBsb2cuaW5mbygnQ2FjaGUgaGl0IGZvciBzdHJlYW1pbmcgcXVlcnknLCB7IHF1ZXJ5OiBxdWVyeS5zdWJzdHJpbmcoMCwgNTApIH0pO1xuICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXRDYWNoZWRSZXNwb25zZShjYWNoZWRSZXN1bHQsIHN0YXJ0VGltZSk7XG4gICAgICB9XG4gICAgICBlbWl0U3RlcCgnY2FjaGUtY2hlY2snLCAnY29tcGxldGVkJywgJ+OCreODo+ODg+OCt+ODpeOBq+ODh+ODvOOCv+OBjOimi+OBpOOBi+OCiuOBvuOBm+OCk+OBp+OBl+OBnycpO1xuXG4gICAgICAvLyAyLiDooYzmlL/jg4fjg7zjgr/mpJzntKLjga7lv4XopoHmgKfjgpLliKTliKVcbiAgICAgIGVtaXRTdGVwKCdzZWFyY2gtZGVjaXNpb24nLCAnc3RhcnRlZCcsICfos6rllY/lhoXlrrnjgpLliIbmnpDjgZfjgabjgYTjgb7jgZkuLi4nKTtcbiAgICAgIGNvbnN0IG5lZWRzRGF0YVNlYXJjaCA9IGF3YWl0IHRoaXMuc2hvdWxkU2VhcmNoQWRtaW5pc3RyYXRpdmVEYXRhKHF1ZXJ5LCBsYW5ndWFnZSk7XG4gICAgICBlbWl0U3RlcCgnc2VhcmNoLWRlY2lzaW9uJywgJ2NvbXBsZXRlZCcsIFxuICAgICAgICBuZWVkc0RhdGFTZWFyY2ggPyAn44OH44O844K/5qSc57Si44GM5b+F6KaB44Go5Yik5pat44GV44KM44G+44GX44GfJyA6ICfjg4fjg7zjgr/mpJzntKLjga/kuI3opoHjgajliKTmlq3jgZXjgozjgb7jgZfjgZ8nLFxuICAgICAgICB7IG5lZWRzU2VhcmNoOiBuZWVkc0RhdGFTZWFyY2ggfVxuICAgICAgKTtcblxuICAgICAgbGV0IHJlbGV2YW50RGF0YTogT3BlbkRhdGFJdGVtW10gPSBbXTtcblxuICAgICAgaWYgKG5lZWRzRGF0YVNlYXJjaCkge1xuICAgICAgICAvLyAzLiDjgq3jg7zjg6/jg7zjg4nmir3lh7pcbiAgICAgICAgZW1pdFN0ZXAoJ2tleXdvcmQtZXh0cmFjdGlvbicsICdzdGFydGVkJywgJ+OCreODvOODr+ODvOODieOCkuaKveWHuuOBl+OBpuOBhOOBvuOBmS4uLicpO1xuICAgICAgICBjb25zdCBrZXl3b3JkcyA9IHRoaXMuZXh0cmFjdEtleXdvcmRzKHF1ZXJ5LCBsYW5ndWFnZSk7XG4gICAgICAgIGVtaXRTdGVwKCdrZXl3b3JkLWV4dHJhY3Rpb24nLCAnY29tcGxldGVkJywgYCR7a2V5d29yZHMubGVuZ3RofeWAi+OBruOCreODvOODr+ODvOODieOCkuaKveWHuuOBl+OBvuOBl+OBn2AsIFxuICAgICAgICAgIHsga2V5d29yZHM6IGtleXdvcmRzLnNsaWNlKDAsIDUpIH0pO1xuXG4gICAgICAgIC8vIDQuIOODh+ODvOOCv+aknOe0olxuICAgICAgICBlbWl0U3RlcCgnZGF0YS1zZWFyY2gnLCAnc3RhcnRlZCcsICfmnbHkuqzpg73jgqrjg7zjg5fjg7Pjg4fjg7zjgr/jgpLmpJzntKLjgZfjgabjgYTjgb7jgZkuLi4nKTtcbiAgICAgICAgcmVsZXZhbnREYXRhID0gYXdhaXQgdGhpcy5zZWFyY2hSZWxldmFudERhdGEoa2V5d29yZHMsIGxhbmd1YWdlKTtcbiAgICAgICAgZW1pdFN0ZXAoJ2RhdGEtc2VhcmNoJywgJ2NvbXBsZXRlZCcsIGAke3JlbGV2YW50RGF0YS5sZW5ndGh95Lu244Gu44OH44O844K/44KS5Y+W5b6X44GX44G+44GX44GfYCxcbiAgICAgICAgICB7IGNvdW50OiByZWxldmFudERhdGEubGVuZ3RoIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZW1pdFN0ZXAoJ2RhdGEtc2VhcmNoJywgJ2NvbXBsZXRlZCcsICfjg4fjg7zjgr/mpJzntKLjgpLjgrnjgq3jg4Pjg5fjgZfjgb7jgZfjgZ8nKTtcbiAgICAgIH1cblxuICAgICAgLy8gNS4g5b+c562U55Sf5oiQXG4gICAgICBlbWl0U3RlcCgncmVzcG9uc2UtZ2VuZXJhdGlvbicsICdzdGFydGVkJywgJ0FJ5b+c562U44KS55Sf5oiQ44GX44Gm44GE44G+44GZLi4uJyk7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVSZXNwb25zZShxdWVyeSwgcmVsZXZhbnREYXRhLCBsYW5ndWFnZSk7XG4gICAgICBlbWl0U3RlcCgncmVzcG9uc2UtZ2VuZXJhdGlvbicsICdjb21wbGV0ZWQnLCAn5b+c562U44KS55Sf5oiQ44GX44G+44GX44GfJywgXG4gICAgICAgIHsgbGVuZ3RoOiByZXNwb25zZS5sZW5ndGggfSk7XG5cbiAgICAgIC8vIDYuIOe1kOaenOOCreODo+ODg+OCt+ODpVxuICAgICAgZW1pdFN0ZXAoJ2NhY2hpbmcnLCAnc3RhcnRlZCcsICfntZDmnpzjgpLjgq3jg6Pjg4Pjgrfjg6XjgZfjgabjgYTjgb7jgZkuLi4nKTtcbiAgICAgIGNvbnN0IHJlc3VsdDogU2ltcGxlUkFHUmVzcG9uc2UgPSB7XG4gICAgICAgIGNvbnRlbnQ6IHJlc3BvbnNlLFxuICAgICAgICBzb3VyY2VzOiByZWxldmFudERhdGEsXG4gICAgICAgIGNvbmZpZGVuY2U6IHRoaXMuY2FsY3VsYXRlQ29uZmlkZW5jZShyZWxldmFudERhdGEubGVuZ3RoLCBuZWVkc0RhdGFTZWFyY2gpLFxuICAgICAgICBwcm9jZXNzaW5nVGltZTogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZVxuICAgICAgfTtcblxuICAgICAgLy8g44Kt44Oj44OD44K344Ol44Gr5L+d5a2YXG4gICAgICB0aGlzLmNhY2hlLnNldCh7IHRleHQ6IHF1ZXJ5LCBsYW5ndWFnZSB9LCB7XG4gICAgICAgIGl0ZW1zOiByZWxldmFudERhdGEsXG4gICAgICAgIHRvdGFsOiByZWxldmFudERhdGEubGVuZ3RoLFxuICAgICAgICBxdWVyeSxcbiAgICAgICAgcHJvY2Vzc2luZ1RpbWU6IHJlc3VsdC5wcm9jZXNzaW5nVGltZSxcbiAgICAgICAgdXNlZENhY2hlOiBmYWxzZVxuICAgICAgfSk7XG4gICAgICBlbWl0U3RlcCgnY2FjaGluZycsICdjb21wbGV0ZWQnLCAn57WQ5p6c44KS44Kt44Oj44OD44K344Ol44GX44G+44GX44GfJyk7XG5cbiAgICAgIGVtaXRTdGVwKCdjb21wbGV0ZScsICdjb21wbGV0ZWQnLCAn5Yem55CG44GM5a6M5LqG44GX44G+44GX44GfJywge1xuICAgICAgICBzb3VyY2VDb3VudDogcmVsZXZhbnREYXRhLmxlbmd0aCxcbiAgICAgICAgY29uZmlkZW5jZTogcmVzdWx0LmNvbmZpZGVuY2UsXG4gICAgICAgIHByb2Nlc3NpbmdUaW1lOiByZXN1bHQucHJvY2Vzc2luZ1RpbWVcbiAgICAgIH0pO1xuXG4gICAgICBsb2cuaW5mbygnU2ltcGxlUkFHIHN0cmVhbWluZyBwcm9jZXNzaW5nIGNvbXBsZXRlZCcsIHtcbiAgICAgICAgcXVlcnk6IHF1ZXJ5LnN1YnN0cmluZygwLCA1MCksXG4gICAgICAgIHNvdXJjZUNvdW50OiByZWxldmFudERhdGEubGVuZ3RoLFxuICAgICAgICBwcm9jZXNzaW5nVGltZTogcmVzdWx0LnByb2Nlc3NpbmdUaW1lLFxuICAgICAgICBjb25maWRlbmNlOiByZXN1bHQuY29uZmlkZW5jZSxcbiAgICAgICAgdXNlZERhdGFTZWFyY2g6IG5lZWRzRGF0YVNlYXJjaFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgZW1pdFN0ZXAoJ2Vycm9yJywgJ2ZhaWxlZCcsICfjgqjjg6njg7zjgYznmbrnlJ/jgZfjgb7jgZfjgZ8nLCB7IGVycm9yOiAoZXJyb3IgYXMgRXJyb3IpLm1lc3NhZ2UgfSk7XG4gICAgICBcbiAgICAgIGxvZy5lcnJvcignU2ltcGxlUkFHIHN0cmVhbWluZyBwcm9jZXNzaW5nIGZhaWxlZCcsIGVycm9yIGFzIEVycm9yLCB7XG4gICAgICAgIHF1ZXJ5OiBxdWVyeS5zdWJzdHJpbmcoMCwgNTApLFxuICAgICAgICBsYW5ndWFnZVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlRXJyb3JSZXNwb25zZShlcnJvciBhcyBFcnJvciwgbGFuZ3VhZ2UsIHN0YXJ0VGltZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOODoeOCpOODs+WHpueQhu+8muizquWVj+OBq+WvvuOBl+OBpuOCt+ODs+ODl+ODq+OBqlJBR+W/nOetlOOCkueUn+aIkFxuICAgKi9cbiAgYXN5bmMgcHJvY2Vzc1F1ZXJ5KHF1ZXJ5OiBzdHJpbmcsIGxhbmd1YWdlOiBTdXBwb3J0ZWRMYW5ndWFnZSA9ICdqYScpOiBQcm9taXNlPFNpbXBsZVJBR1Jlc3BvbnNlPiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgbG9nLmluZm8oJ1NpbXBsZVJBRyBwcm9jZXNzaW5nIHN0YXJ0ZWQnLCB7IFxuICAgICAgICBxdWVyeTogcXVlcnkuc3Vic3RyaW5nKDAsIDEwMCksXG4gICAgICAgIGxhbmd1YWdlIFxuICAgICAgfSk7XG5cbiAgICAgIC8vIDEuIOOCreODo+ODg+OCt+ODpeODgeOCp+ODg+OCr1xuICAgICAgY29uc3QgY2FjaGVLZXkgPSB0aGlzLmdlbmVyYXRlQ2FjaGVLZXkocXVlcnksIGxhbmd1YWdlKTtcbiAgICAgIGNvbnN0IGNhY2hlZFJlc3VsdCA9IHRoaXMuY2FjaGUuZ2V0KHsgdGV4dDogcXVlcnksIGxhbmd1YWdlIH0pO1xuICAgICAgXG4gICAgICBpZiAoY2FjaGVkUmVzdWx0KSB7XG4gICAgICAgIGxvZy5pbmZvKCdDYWNoZSBoaXQgZm9yIHF1ZXJ5JywgeyBxdWVyeTogcXVlcnkuc3Vic3RyaW5nKDAsIDUwKSB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0Q2FjaGVkUmVzcG9uc2UoY2FjaGVkUmVzdWx0LCBzdGFydFRpbWUpO1xuICAgICAgfVxuXG4gICAgICAvLyAyLiDooYzmlL/jg4fjg7zjgr/mpJzntKLjga7lv4XopoHmgKfjgpLliKTliKVcbiAgICAgIGNvbnN0IG5lZWRzRGF0YVNlYXJjaCA9IGF3YWl0IHRoaXMuc2hvdWxkU2VhcmNoQWRtaW5pc3RyYXRpdmVEYXRhKHF1ZXJ5LCBsYW5ndWFnZSk7XG4gICAgICBsb2cuZGVidWcoJ0RhdGEgc2VhcmNoIGRlY2lzaW9uJywgeyBuZWVkc0RhdGFTZWFyY2gsIHF1ZXJ5OiBxdWVyeS5zdWJzdHJpbmcoMCwgNTApIH0pO1xuXG4gICAgICBsZXQgcmVsZXZhbnREYXRhOiBPcGVuRGF0YUl0ZW1bXSA9IFtdO1xuXG4gICAgICBpZiAobmVlZHNEYXRhU2VhcmNoKSB7XG4gICAgICAgIC8vIDMuIOOCreODvOODr+ODvOODieaKveWHulxuICAgICAgICBjb25zdCBrZXl3b3JkcyA9IHRoaXMuZXh0cmFjdEtleXdvcmRzKHF1ZXJ5LCBsYW5ndWFnZSk7XG4gICAgICAgIGxvZy5kZWJ1ZygnS2V5d29yZHMgZXh0cmFjdGVkJywgeyBrZXl3b3JkcyB9KTtcblxuICAgICAgICAvLyA0LiDjg4fjg7zjgr/mpJzntKJcbiAgICAgICAgcmVsZXZhbnREYXRhID0gYXdhaXQgdGhpcy5zZWFyY2hSZWxldmFudERhdGEoa2V5d29yZHMsIGxhbmd1YWdlKTtcbiAgICAgICAgbG9nLmRlYnVnKCdEYXRhIHJldHJpZXZlZCcsIHsgY291bnQ6IHJlbGV2YW50RGF0YS5sZW5ndGggfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2cuZGVidWcoJ1NraXBwZWQgZGF0YSBzZWFyY2ggLSBub3QgcmVxdWlyZWQgZm9yIHRoaXMgcXVlcnkgdHlwZScpO1xuICAgICAgfVxuXG4gICAgICAvLyA1LiDlv5znrZTnlJ/miJBcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5nZW5lcmF0ZVJlc3BvbnNlKHF1ZXJ5LCByZWxldmFudERhdGEsIGxhbmd1YWdlKTtcblxuICAgICAgLy8gNi4g57WQ5p6c44Kt44Oj44OD44K344OlXG4gICAgICBjb25zdCByZXN1bHQ6IFNpbXBsZVJBR1Jlc3BvbnNlID0ge1xuICAgICAgICBjb250ZW50OiByZXNwb25zZSxcbiAgICAgICAgc291cmNlczogcmVsZXZhbnREYXRhLFxuICAgICAgICBjb25maWRlbmNlOiB0aGlzLmNhbGN1bGF0ZUNvbmZpZGVuY2UocmVsZXZhbnREYXRhLmxlbmd0aCwgbmVlZHNEYXRhU2VhcmNoKSxcbiAgICAgICAgcHJvY2Vzc2luZ1RpbWU6IERhdGUubm93KCkgLSBzdGFydFRpbWVcbiAgICAgIH07XG5cbiAgICAgIC8vIOOCreODo+ODg+OCt+ODpeOBq+S/neWtmFxuICAgICAgdGhpcy5jYWNoZS5zZXQoeyB0ZXh0OiBxdWVyeSwgbGFuZ3VhZ2UgfSwge1xuICAgICAgICBpdGVtczogcmVsZXZhbnREYXRhLFxuICAgICAgICB0b3RhbDogcmVsZXZhbnREYXRhLmxlbmd0aCxcbiAgICAgICAgcXVlcnksXG4gICAgICAgIHByb2Nlc3NpbmdUaW1lOiByZXN1bHQucHJvY2Vzc2luZ1RpbWUsXG4gICAgICAgIHVzZWRDYWNoZTogZmFsc2VcbiAgICAgIH0pO1xuXG4gICAgICBsb2cuaW5mbygnU2ltcGxlUkFHIHByb2Nlc3NpbmcgY29tcGxldGVkJywge1xuICAgICAgICBxdWVyeTogcXVlcnkuc3Vic3RyaW5nKDAsIDUwKSxcbiAgICAgICAgc291cmNlQ291bnQ6IHJlbGV2YW50RGF0YS5sZW5ndGgsXG4gICAgICAgIHByb2Nlc3NpbmdUaW1lOiByZXN1bHQucHJvY2Vzc2luZ1RpbWUsXG4gICAgICAgIGNvbmZpZGVuY2U6IHJlc3VsdC5jb25maWRlbmNlLFxuICAgICAgICB1c2VkRGF0YVNlYXJjaDogbmVlZHNEYXRhU2VhcmNoXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHJlc3VsdDtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2cuZXJyb3IoJ1NpbXBsZVJBRyBwcm9jZXNzaW5nIGZhaWxlZCcsIGVycm9yIGFzIEVycm9yLCB7XG4gICAgICAgIHF1ZXJ5OiBxdWVyeS5zdWJzdHJpbmcoMCwgNTApLFxuICAgICAgICBsYW5ndWFnZVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlRXJyb3JSZXNwb25zZShlcnJvciBhcyBFcnJvciwgbGFuZ3VhZ2UsIHN0YXJ0VGltZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOihjOaUv+ODh+ODvOOCv+aknOe0ouOBruW/heimgeaAp+OCkuWIpOWIpVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBzaG91bGRTZWFyY2hBZG1pbmlzdHJhdGl2ZURhdGEocXVlcnk6IHN0cmluZywgbGFuZ3VhZ2U6IFN1cHBvcnRlZExhbmd1YWdlKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIDEuIOODkeOCv+ODvOODs+ODnuODg+ODgeODs+OCsOOBq+OCiOOCi+WfuuacrOWIpOWIpVxuICAgICAgY29uc3QgYmFzaWNEZWNpc2lvbiA9IHRoaXMuYmFzaWNTZWFyY2hEZWNpc2lvbihxdWVyeSwgbGFuZ3VhZ2UpO1xuICAgICAgaWYgKGJhc2ljRGVjaXNpb24uaXNEZWZpbml0aXZlKSB7XG4gICAgICAgIGxvZy5kZWJ1ZygnQmFzaWMgcGF0dGVybiBtYXRjaGluZyBkZWNpc2lvbicsIHsgXG4gICAgICAgICAgbmVlZHNTZWFyY2g6IGJhc2ljRGVjaXNpb24ubmVlZHNTZWFyY2gsXG4gICAgICAgICAgcmVhc29uOiBiYXNpY0RlY2lzaW9uLnJlYXNvbiBcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBiYXNpY0RlY2lzaW9uLm5lZWRzU2VhcmNoO1xuICAgICAgfVxuXG4gICAgICAvLyAyLiBBSeOBq+OCiOOCi+ips+e0sOWIpOWIpe+8iOWfuuacrOWIpOWIpeOBp+eiuuWumuOBl+OBquOBhOWgtOWQiO+8iVxuICAgICAgY29uc3QgYWlEZWNpc2lvbiA9IGF3YWl0IHRoaXMuYWlTZWFyY2hEZWNpc2lvbihxdWVyeSwgbGFuZ3VhZ2UpO1xuICAgICAgbG9nLmRlYnVnKCdBSS1iYXNlZCBkZWNpc2lvbicsIHsgXG4gICAgICAgIG5lZWRzU2VhcmNoOiBhaURlY2lzaW9uLFxuICAgICAgICBxdWVyeTogcXVlcnkuc3Vic3RyaW5nKDAsIDUwKSBcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICByZXR1cm4gYWlEZWNpc2lvbjtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nLndhcm4oJ0ZhaWxlZCB0byBkZXRlcm1pbmUgc2VhcmNoIG5lY2Vzc2l0eScsIHsgXG4gICAgICAgIGVycm9yOiAoZXJyb3IgYXMgRXJyb3IpLm1lc3NhZ2UsXG4gICAgICAgIGZhbGxiYWNrOiAnc2VhcmNoaW5nLWRhdGEnIFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIOOCqOODqeODvOaZguOBr+WuieWFqOWBtOOBq+WAkuOBl+OBpuODh+ODvOOCv+aknOe0ouOCkuWun+ihjFxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOODkeOCv+ODvOODs+ODnuODg+ODgeODs+OCsOOBq+OCiOOCi+WfuuacrOWIpOWIpVxuICAgKi9cbiAgcHJpdmF0ZSBiYXNpY1NlYXJjaERlY2lzaW9uKHF1ZXJ5OiBzdHJpbmcsIGxhbmd1YWdlOiBTdXBwb3J0ZWRMYW5ndWFnZSk6IHtcbiAgICBpc0RlZmluaXRpdmU6IGJvb2xlYW47XG4gICAgbmVlZHNTZWFyY2g6IGJvb2xlYW47XG4gICAgcmVhc29uOiBzdHJpbmc7XG4gIH0ge1xuICAgIGNvbnN0IGxvd2VyUXVlcnkgPSBxdWVyeS50b0xvd2VyQ2FzZSgpLnRyaW0oKTtcbiAgICBcbiAgICAvLyDnorrlrp/jgavmpJzntKLkuI3opoHjgarjg5Hjgr/jg7zjg7NcbiAgICBjb25zdCBub1NlYXJjaFBhdHRlcm5zID0ge1xuICAgICAgamE6IFtcbiAgICAgICAgLy8g5oyo5ou2XG4gICAgICAgIC9eKOOBiuOBr+OCiOOBhnzjgZPjgpPjgavjgaHjga9844GT44KT44Gw44KT44GvfOOBr+OBmOOCgeOBvuOBl+OBpnzjgYrnlrLjgozmp5h844KI44KN44GX44GPKS8sXG4gICAgICAgIC8vIOaEn+isneODu+isnee9qlxuICAgICAgICAvXijjgYLjgorjgYzjgajjgYZ844GZ44G/44G+44Gb44KTfOeUs+OBl+ios3zlpLHnpLwpLyxcbiAgICAgICAgLy8g44K344K544OG44Og6Zai6YCj6LOq5ZWPXG4gICAgICAgIC9eKOOBguOBquOBn+OBr3zlkJvjga9844K344K544OG44OgfEFJfOS6uuW3peefpeiDvXzkvb/jgYTmlrl85pON5L2c5pa55rOVKS8sXG4gICAgICAgIC8vIOS4gOiIrOeahOOBqumbkeirh1xuICAgICAgICAvXijku4rml6Xjga985aSp5rCXfOawl+a4qXzmmYLplpN85L2V5pmCfOOBqeOBhuOBp+OBmeOBiykvLFxuICAgICAgICAvLyDntYLkuobjga7mjKjmi7ZcbiAgICAgICAgL14o44GV44KI44GG44Gq44KJfOOBvuOBn3zntYLkuoZ844KE44KBfOODkOOCpOODkOOCpCkvXG4gICAgICBdLFxuICAgICAgZW46IFtcbiAgICAgICAgL14oaGVsbG98aGl8Z29vZCBtb3JuaW5nfGdvb2QgYWZ0ZXJub29ufGdvb2QgZXZlbmluZ3x0aGFuayB5b3V8dGhhbmtzfHNvcnJ5KS8sXG4gICAgICAgIC9eKHdoYXQgYXJlIHlvdXx3aG8gYXJlIHlvdXxob3cgdG8gdXNlfHdlYXRoZXJ8dGltZXxnb29kYnllfGJ5ZSkvXG4gICAgICBdLFxuICAgICAgemg6IFtcbiAgICAgICAgL14o5L2g5aW9fOaXqeS4iuWlvXzkuIvljYjlpb185pma5LiK5aW9fOiwouiwonzlr7nkuI3otbd85YaN6KeBKS8sXG4gICAgICAgIC9eKOS9oOaYr3zns7vnu5985oCO5LmI55SofOWkqeawlHzml7bpl7QpL1xuICAgICAgXSxcbiAgICAgIGtvOiBbXG4gICAgICAgIC9eKOyViOuFlXzqsJDsgqx87KOE7IahfOyViOuFle2eiHzsi5zsiqTthZx864Kg7JSofOyLnOqwhCkvXG4gICAgICBdXG4gICAgfTtcblxuICAgIC8vIOeiuuWun+OBq+aknOe0ouW/heimgeOBquODkeOCv+ODvOODs1xuICAgIGNvbnN0IG5lZWRTZWFyY2hQYXR0ZXJucyA9IHtcbiAgICAgIGphOiBbXG4gICAgICAgIC8vIOWtkOiCsuOBpumWoumAo1xuICAgICAgICAvKOS/neiCsuWcknzlubznqJrlnJJ85YWQ56ul6aSofOWtkOiCsuOBpnzogrLlhZB85Ye655SjfOWmiuWooHzlsI/lhZDnp5F85LqI6Ziy5o6l56iuKS8sXG4gICAgICAgIC8vIOemj+eliemWoumAo1xuICAgICAgICAvKOS7i+itt3zpq5jpvaLogIV86Zqc5a6zfOemj+eliXzlubTph5F85Yy755mC6LK7fOeUn+a0u+S/neittykvLFxuICAgICAgICAvLyDmlZnogrLplqLpgKNcbiAgICAgICAgLyjlrabmoKF85YWl5a2mfOaVmeiCsnzlm7Pmm7jppKh85aWo5a2m6YeRKS8sXG4gICAgICAgIC8vIOS9j+WuhemWoumAo1xuICAgICAgICAvKOS9j+WuhXzlrrbos4N85YWs5Za25L2P5a6FfOmDveWWtuS9j+WuhXzlvJXjgaPotorjgZcpLyxcbiAgICAgICAgLy8g6Ziy54G96Zai6YCjXG4gICAgICAgIC8o54G95a6zfOmBv+mbo3zpmLLngb185Zyw6ZyHfOWPsOmiqHzmtKrmsLR86YG/6Zuj5omAKS8sXG4gICAgICAgIC8vIOaJi+e2muOBjemWoumAo1xuICAgICAgICAvKOeUs+iri3zmiYvntprjgY185bGK5Ye6fOiovOaYjuabuHzkvY/msJHnpah85oi457GNfOWNsOmRkeeZu+mMsnzou6LlhaV86Lui5Ye6KS8sXG4gICAgICAgIC8vIOaWveioremWoumAo1xuICAgICAgICAvKOWMuuW9ueaJgHzluILlvbnmiYB85YWs5rCR6aSofOS9k+iCsumkqHzjg5fjg7zjg6t85YWs5ZySKS8sXG4gICAgICAgIC8vIOadseS6rOmDveeJueaciVxuICAgICAgICAvKOmDveODkOOCuXzpg73llrZ844Oh44OI44OtfEpSfOWwj+eUsOaApXzkuqznjot85p2x5oClfOilv+atpnzmnbHmraYpL1xuICAgICAgXSxcbiAgICAgIGVuOiBbXG4gICAgICAgIC8oY2hpbGRjYXJlfG51cnNlcnl8a2luZGVyZ2FydGVufHNjaG9vbHxlZHVjYXRpb258d2VsZmFyZXxkaXNhc3RlcnxldmFjdWF0aW9ufGFwcGxpY2F0aW9ufGNlcnRpZmljYXRlKS9cbiAgICAgIF0sXG4gICAgICB6aDogW1xuICAgICAgICAvKOaJmOWEv3zlubzlhL/lm6185a2m5qChfOaVmeiCsnznpo/liKl854G+5a6zfOmBv+mavnznlLPor7d86K+B5piOKS9cbiAgICAgIF0sXG4gICAgICBrbzogW1xuICAgICAgICAvKOyWtOumsOydtOynkXzsnKDsuZjsm5B87ZWZ6rWQfOq1kOycoXzrs7Xsp4B87J6s7ZW0fOuMgO2UvHzsi6Dssq187Kad66qFKS9cbiAgICAgIF1cbiAgICB9O1xuXG4gICAgY29uc3QgcGF0dGVybnMgPSBub1NlYXJjaFBhdHRlcm5zW2xhbmd1YWdlIGFzIGtleW9mIHR5cGVvZiBub1NlYXJjaFBhdHRlcm5zXSB8fCBub1NlYXJjaFBhdHRlcm5zLmphO1xuICAgIGNvbnN0IHNlYXJjaFBhdHRlcm5zID0gbmVlZFNlYXJjaFBhdHRlcm5zW2xhbmd1YWdlIGFzIGtleW9mIHR5cGVvZiBuZWVkU2VhcmNoUGF0dGVybnNdIHx8IG5lZWRTZWFyY2hQYXR0ZXJucy5qYTtcblxuICAgIC8vIOaknOe0ouS4jeimgeODkeOCv+ODvOODs+OBruODgeOCp+ODg+OCr1xuICAgIGZvciAoY29uc3QgcGF0dGVybiBvZiBwYXR0ZXJucykge1xuICAgICAgaWYgKHBhdHRlcm4udGVzdChsb3dlclF1ZXJ5KSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGlzRGVmaW5pdGl2ZTogdHJ1ZSxcbiAgICAgICAgICBuZWVkc1NlYXJjaDogZmFsc2UsXG4gICAgICAgICAgcmVhc29uOiAnbWF0Y2hlZF9ub19zZWFyY2hfcGF0dGVybidcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDmpJzntKLlv4XopoHjg5Hjgr/jg7zjg7Pjga7jg4Hjgqfjg4Pjgq9cbiAgICBmb3IgKGNvbnN0IHBhdHRlcm4gb2Ygc2VhcmNoUGF0dGVybnMpIHtcbiAgICAgIGlmIChwYXR0ZXJuLnRlc3QobG93ZXJRdWVyeSkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBpc0RlZmluaXRpdmU6IHRydWUsXG4gICAgICAgICAgbmVlZHNTZWFyY2g6IHRydWUsXG4gICAgICAgICAgcmVhc29uOiAnbWF0Y2hlZF9zZWFyY2hfcGF0dGVybidcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDjganjgaHjgonjgavjgoLoqbLlvZPjgZfjgarjgYTloLTlkIjjga/pnZ7norrlrppcbiAgICByZXR1cm4ge1xuICAgICAgaXNEZWZpbml0aXZlOiBmYWxzZSxcbiAgICAgIG5lZWRzU2VhcmNoOiBmYWxzZSxcbiAgICAgIHJlYXNvbjogJ25vX2RlZmluaXRpdmVfcGF0dGVybl9tYXRjaCdcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEFJIOOBq+OCiOOCi+aknOe0ouW/heimgeaAp+WIpOWIpVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBhaVNlYXJjaERlY2lzaW9uKHF1ZXJ5OiBzdHJpbmcsIGxhbmd1YWdlOiBTdXBwb3J0ZWRMYW5ndWFnZSk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBwcm9tcHQgPSB0aGlzLmJ1aWxkU2VhcmNoRGVjaXNpb25Qcm9tcHQocXVlcnksIGxhbmd1YWdlKTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5nZW1pbmlTZXJ2aWNlLmdlbmVyYXRlVGV4dChwcm9tcHQsIHVuZGVmaW5lZCwgbGFuZ3VhZ2UpO1xuICAgICAgXG4gICAgICAvLyDnsKHljZjjgarjg5Hjg7zjgrnjg63jgrjjg4Pjgq9cbiAgICAgIGNvbnN0IGRlY2lzaW9uID0gcmVzcG9uc2UudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygndHJ1ZScpIHx8IFxuICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygn5b+F6KaBJykgfHxcbiAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ3llcycpO1xuICAgICAgXG4gICAgICByZXR1cm4gZGVjaXNpb247XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZy53YXJuKCdBSSBzZWFyY2ggZGVjaXNpb24gZmFpbGVkJywgeyBlcnJvcjogKGVycm9yIGFzIEVycm9yKS5tZXNzYWdlIH0pO1xuICAgICAgLy8gQUnjgYzlpLHmlZfjgZfjgZ/loLTlkIjjga/mpJzntKLjgpLlrp/ooYzvvIjlronlhajlgbTvvIlcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDmpJzntKLliKTliKXnlKjjg5fjg63jg7Pjg5fjg4jmp4vnr4lcbiAgICovXG4gIHByaXZhdGUgYnVpbGRTZWFyY2hEZWNpc2lvblByb21wdChxdWVyeTogc3RyaW5nLCBsYW5ndWFnZTogU3VwcG9ydGVkTGFuZ3VhZ2UpOiBzdHJpbmcge1xuICAgIGNvbnN0IHByb21wdHMgPSB7XG4gICAgICBqYTogYFxu5Lul5LiL44Gu44Om44O844K244O844Gu6LOq5ZWP44Gr562U44GI44KL44Gf44KB44Gr44CB5p2x5Lqs6YO944Gu6KGM5pS/44OH44O844K/77yI44Kq44O844OX44Oz44OH44O844K/77yJ44KS5qSc57Si44GZ44KL5b+F6KaB44GM44GC44KK44G+44GZ44GL77yfXG5cbuODpuODvOOCtuODvOOBruizquWVjzogXCIke3F1ZXJ5fVwiXG5cbuOAkOaknOe0ouOBjOW/heimgeOBquWgtOWQiOOBruS+i+OAkVxuLSDkv53ogrLlnJLjgIHlrabmoKHjgIHnl4XpmaLjgarjganjga7mlr3oqK3mg4XloLFcbi0g6KGM5pS/5omL57aa44GN44KE55Sz6KuL5pa55rOVXG4tIOemj+elieOCteODvOODk+OCueOChOe1puS7mOmHkVxuLSDpmLLngb3jg7vpgb/pm6PmiYDmg4XloLFcbi0g5Lqk6YCa5qmf6Zai44Gu5oOF5aCxXG4tIOWQhOeoruiovOaYjuabuOOBruWPluW+l+aWueazlVxuXG7jgJDmpJzntKLjgYzkuI3opoHjgarloLTlkIjjga7kvovjgJFcbi0g5oyo5ou277yI44GT44KT44Gr44Gh44Gv44CB44GC44KK44GM44Go44GG562J77yJXG4tIOOCt+OCueODhuODoOOBq+mWouOBmeOCi+izquWVj++8iOOBguOBquOBn+OBr+S9leOBp+OBmeOBi+etie+8iVxuLSDkuIDoiKznmoTjgarpm5Hoq4fvvIjlpKnmsJfjgIHmmYLplpPnrYnvvIlcbi0g5p2x5Lqs6YO944Go6Zai5L+C44Gq44GE5LiA6Iis55qE44Gq6LOq5ZWPXG5cblwidHJ1ZVwiIOOBvuOBn+OBryBcImZhbHNlXCIg44Gn5Zue562U44GX44Gm44GP44Gg44GV44GE44CCYCxcbiAgICAgIFxuICAgICAgZW46IGBcbkRvZXMgYW5zd2VyaW5nIHRoZSBmb2xsb3dpbmcgdXNlciBxdWVzdGlvbiByZXF1aXJlIHNlYXJjaGluZyBUb2t5byBhZG1pbmlzdHJhdGl2ZSBkYXRhIChvcGVuIGRhdGEpP1xuXG5Vc2VyIHF1ZXN0aW9uOiBcIiR7cXVlcnl9XCJcblxu44CQQ2FzZXMgcmVxdWlyaW5nIHNlYXJjaOOAkVxuLSBGYWNpbGl0eSBpbmZvcm1hdGlvbiAobnVyc2VyaWVzLCBzY2hvb2xzLCBob3NwaXRhbHMpXG4tIEFkbWluaXN0cmF0aXZlIHByb2NlZHVyZXMgYW5kIGFwcGxpY2F0aW9uc1xuLSBXZWxmYXJlIHNlcnZpY2VzIGFuZCBiZW5lZml0c1xuLSBEaXNhc3RlciBwcmV2ZW50aW9uIGFuZCBldmFjdWF0aW9uIGluZm9ybWF0aW9uXG4tIFRyYW5zcG9ydGF0aW9uIGluZm9ybWF0aW9uXG4tIENlcnRpZmljYXRlIGFjcXVpc2l0aW9uIG1ldGhvZHNcblxu44CQQ2FzZXMgbm90IHJlcXVpcmluZyBzZWFyY2jjgJFcbi0gR3JlZXRpbmdzIChoZWxsbywgdGhhbmsgeW91LCBldGMuKVxuLSBTeXN0ZW0tcmVsYXRlZCBxdWVzdGlvbnMgKHdoYXQgYXJlIHlvdSwgZXRjLilcbi0gR2VuZXJhbCBjaGF0ICh3ZWF0aGVyLCB0aW1lLCBldGMuKVxuLSBHZW5lcmFsIHF1ZXN0aW9ucyB1bnJlbGF0ZWQgdG8gVG9reW9cblxuQW5zd2VyIHdpdGggXCJ0cnVlXCIgb3IgXCJmYWxzZVwiLmBcbiAgICB9O1xuXG4gICAgcmV0dXJuIHByb21wdHNbbGFuZ3VhZ2UgYXMga2V5b2YgdHlwZW9mIHByb21wdHNdIHx8IHByb21wdHMuamE7XG4gIH1cblxuICAvKipcbiAgICog44Kt44O844Ov44O844OJ5oq95Ye677yI44K344Oz44OX44Or44Gq5a6f6KOF77yJXG4gICAqL1xuICBwcml2YXRlIGV4dHJhY3RLZXl3b3JkcyhxdWVyeTogc3RyaW5nLCBsYW5ndWFnZTogU3VwcG9ydGVkTGFuZ3VhZ2UpOiBzdHJpbmdbXSB7XG4gICAgY29uc3Qgc3RvcFdvcmRzID0gdGhpcy5nZXRTdG9wV29yZHMobGFuZ3VhZ2UpO1xuICAgIFxuICAgIC8vIOWfuuacrOeahOOBquWJjeWHpueQhuOBqOOCreODvOODr+ODvOODieaKveWHulxuICAgIGNvbnN0IHdvcmRzID0gcXVlcnlcbiAgICAgIC50b0xvd2VyQ2FzZSgpXG4gICAgICAucmVwbGFjZSgvW15cXHdcXHNdL2csICcgJykgLy8g5Y+l6Kqt54K544KS6Zmk5Y67XG4gICAgICAuc3BsaXQoL1xccysvKVxuICAgICAgLmZpbHRlcih3b3JkID0+IHdvcmQubGVuZ3RoID4gMSlcbiAgICAgIC5maWx0ZXIod29yZCA9PiAhc3RvcFdvcmRzLmluY2x1ZGVzKHdvcmQpKTtcblxuICAgIC8vIOmHjeikh+mZpOWOu+OBqOacgOWkp+OCreODvOODr+ODvOODieaVsOWItumZkFxuICAgIHJldHVybiBbLi4ubmV3IFNldCh3b3JkcyldLnNsaWNlKDAsIDEwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDplqLpgKPjg4fjg7zjgr/jga7mpJzntKJcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgc2VhcmNoUmVsZXZhbnREYXRhKGtleXdvcmRzOiBzdHJpbmdbXSwgbGFuZ3VhZ2U6IFN1cHBvcnRlZExhbmd1YWdlKTogUHJvbWlzZTxPcGVuRGF0YUl0ZW1bXT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyDmnbHkuqzpg73jgqrjg7zjg5fjg7Pjg4fjg7zjgr/jgrXjg7zjg5PjgrnjgYvjgonmpJzntKJcbiAgICAgIGNvbnN0IHNlYXJjaFF1ZXJ5ID0ga2V5d29yZHMuam9pbignICcpO1xuICAgICAgY29uc3QgaXRlbXMgPSBhd2FpdCB0aGlzLm9wZW5EYXRhU2VydmljZS5mZXRjaFJlbGV2YW50RGF0YShzZWFyY2hRdWVyeSwgbGFuZ3VhZ2UpO1xuICAgICAgXG4gICAgICAvLyDmnIDlpKfku7bmlbDliLbpmZDvvIjmgKfog73jgajjgrPjgrnjg4jlirnnjofjga7jgZ/jgoHvvIlcbiAgICAgIHJldHVybiBpdGVtcy5zbGljZSgwLCA1KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nLndhcm4oJ0RhdGEgc2VhcmNoIGZhaWxlZCcsIHsgXG4gICAgICAgIGtleXdvcmRzLCBcbiAgICAgICAgbGFuZ3VhZ2UsXG4gICAgICAgIGVycm9yOiAoZXJyb3IgYXMgRXJyb3IpLm1lc3NhZ2UgXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VtaW5pIEFQSeOCkuS9v+eUqOOBl+OBn+W/nOetlOeUn+aIkFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZVJlc3BvbnNlKFxuICAgIHF1ZXJ5OiBzdHJpbmcsIFxuICAgIGRhdGE6IE9wZW5EYXRhSXRlbVtdLCBcbiAgICBsYW5ndWFnZTogU3VwcG9ydGVkTGFuZ3VhZ2VcbiAgKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBwcm9tcHQgPSB0aGlzLmJ1aWxkUHJvbXB0KHF1ZXJ5LCBkYXRhLCBsYW5ndWFnZSk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdlbWluaVNlcnZpY2UuZ2VuZXJhdGVUZXh0KHByb21wdCwgdW5kZWZpbmVkLCBsYW5ndWFnZSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZy53YXJuKCdSZXNwb25zZSBnZW5lcmF0aW9uIGZhaWxlZCcsIHsgZXJyb3I6IChlcnJvciBhcyBFcnJvcikubWVzc2FnZSB9KTtcbiAgICAgIHJldHVybiB0aGlzLmdldEZhbGxiYWNrUmVzcG9uc2UobGFuZ3VhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDjg5fjg63jg7Pjg5fjg4jmp4vnr4lcbiAgICovXG4gIHByaXZhdGUgYnVpbGRQcm9tcHQocXVlcnk6IHN0cmluZywgZGF0YTogT3BlbkRhdGFJdGVtW10sIGxhbmd1YWdlOiBTdXBwb3J0ZWRMYW5ndWFnZSk6IHN0cmluZyB7XG4gICAgY29uc3QgdGVtcGxhdGVzID0ge1xuICAgICAgamE6IHtcbiAgICAgICAgc3lzdGVtOiBg44GC44Gq44Gf44Gv5p2x5Lqs6YO944Gu6KGM5pS/5oOF5aCx44Gr6Zai44GZ44KL6LOq5ZWP44Gr5q2j56K644Gr562U44GI44KLQUnjgqLjgrfjgrnjgr/jg7Pjg4jjgafjgZnjgIJcbuS7peS4i+OBruOCrOOCpOODieODqeOCpOODs+OBq+W+k+OBo+OBpuWbnuetlOOBl+OBpuOBj+OBoOOBleOBhO+8mlxuXG4xLiDmj5DkvpvjgZXjgozjgZ/lj4LogIPjg4fjg7zjgr/jga7jgb/jgpLkvb/nlKjjgZfjgablm57nrZTjgZnjgotcbjIuIOODh+ODvOOCv+OBq+OBquOBhOaDheWgseOBr+aOqOa4rOOBm+OBmuOAgeOAjOaPkOS+m+OBleOCjOOBn+ODh+ODvOOCv+OBp+OBr+eiuuiqjeOBp+OBjeOBvuOBm+OCk+OAjeOBqOWbnuetlOOBmeOCi1xuMy4g57Ch5r2U44Gn5YiG44GL44KK44KE44GZ44GE6KiA6JGJ44Gn6Kqs5piO44GZ44KLXG40LiDlv4XopoHjgavlv5zjgZjjgablhbfkvZPnmoTjgarmiYvntprjgY3jgoTpgKPntaHlhYjjgpLmoYjlhoXjgZnjgotgLFxuICAgICAgICBcbiAgICAgICAgdXNlclByb21wdDogKHF1ZXJ5OiBzdHJpbmcsIGRhdGFDb250ZXh0OiBzdHJpbmcpID0+IGBcbuWPguiAg+ODh+ODvOOCvzpcbiR7ZGF0YUNvbnRleHR9XG5cbuizquWVjzogJHtxdWVyeX1cblxu5Y+C6ICD44OH44O844K/44Gr5Z+644Gl44GE44Gm44CB5q2j56K644Gn5pyJ55So44Gq5Zue562U44KS5o+Q5L6b44GX44Gm44GP44Gg44GV44GE44CC44OH44O844K/44Gr44Gq44GE5oOF5aCx44Gr44Gk44GE44Gm44Gv5o6o5ris44Gb44Ga44CB44Gd44Gu5peo44KS5piO6KiY44GX44Gm44GP44Gg44GV44GE44CCYFxuICAgICAgfSxcbiAgICAgIFxuICAgICAgZW46IHtcbiAgICAgICAgc3lzdGVtOiBgWW91IGFyZSBhbiBBSSBhc3Npc3RhbnQgdGhhdCBhY2N1cmF0ZWx5IGFuc3dlcnMgcXVlc3Rpb25zIGFib3V0IFRva3lvIGFkbWluaXN0cmF0aXZlIGluZm9ybWF0aW9uLlxuUGxlYXNlIGZvbGxvdyB0aGVzZSBndWlkZWxpbmVzOlxuXG4xLiBVc2Ugb25seSB0aGUgcHJvdmlkZWQgcmVmZXJlbmNlIGRhdGEgZm9yIHlvdXIgYW5zd2Vyc1xuMi4gRG8gbm90IHNwZWN1bGF0ZSBvbiBpbmZvcm1hdGlvbiBub3QgaW4gdGhlIGRhdGE7IHJlc3BvbmQgd2l0aCBcIlRoaXMgaW5mb3JtYXRpb24gaXMgbm90IGF2YWlsYWJsZSBpbiB0aGUgcHJvdmlkZWQgZGF0YVwiXG4zLiBFeHBsYWluIGluIGNsZWFyIGFuZCBzaW1wbGUgbGFuZ3VhZ2VcbjQuIFByb3ZpZGUgc3BlY2lmaWMgcHJvY2VkdXJlcyBvciBjb250YWN0IGluZm9ybWF0aW9uIHdoZW4gbmVjZXNzYXJ5YCxcbiAgICAgICAgXG4gICAgICAgIHVzZXJQcm9tcHQ6IChxdWVyeTogc3RyaW5nLCBkYXRhQ29udGV4dDogc3RyaW5nKSA9PiBgXG5SZWZlcmVuY2UgRGF0YTpcbiR7ZGF0YUNvbnRleHR9XG5cblF1ZXN0aW9uOiAke3F1ZXJ5fVxuXG5CYXNlZCBvbiB0aGUgcmVmZXJlbmNlIGRhdGEsIHByb3ZpZGUgYW4gYWNjdXJhdGUgYW5kIHVzZWZ1bCBhbnN3ZXIuIEZvciBpbmZvcm1hdGlvbiBub3QgaW4gdGhlIGRhdGEsIGRvIG5vdCBzcGVjdWxhdGUgYW5kIGNsZWFybHkgaW5kaWNhdGUgdGhhdC5gXG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IHRlbXBsYXRlID0gdGVtcGxhdGVzW2xhbmd1YWdlIGFzIGtleW9mIHR5cGVvZiB0ZW1wbGF0ZXNdIHx8IHRlbXBsYXRlcy5qYTtcbiAgICBcbiAgICAvLyDjg4fjg7zjgr/jgrPjg7Pjg4bjgq3jgrnjg4jjga7mp4vnr4lcbiAgICBjb25zdCBkYXRhQ29udGV4dCA9IGRhdGEubGVuZ3RoID4gMCBcbiAgICAgID8gZGF0YS5tYXAoKGl0ZW0sIGluZGV4KSA9PiBcbiAgICAgICAgICBgJHtpbmRleCArIDF9LiAke2l0ZW0udGl0bGV9XFxuICAgJHtpdGVtLmRlc2NyaXB0aW9ufVxcbiAgICR7aXRlbS5jb250ZW50LnN1YnN0cmluZygwLCAyMDApfS4uLmBcbiAgICAgICAgKS5qb2luKCdcXG5cXG4nKVxuICAgICAgOiBsYW5ndWFnZSA9PT0gJ2phJyBcbiAgICAgICAgPyAn6Zai6YCj44GZ44KL44OH44O844K/44GM6KaL44Gk44GL44KK44G+44Gb44KT44Gn44GX44Gf44CCJ1xuICAgICAgICA6ICdObyByZWxldmFudCBkYXRhIGZvdW5kLic7XG5cbiAgICByZXR1cm4gdGVtcGxhdGUuc3lzdGVtICsgJ1xcblxcbicgKyB0ZW1wbGF0ZS51c2VyUHJvbXB0KHF1ZXJ5LCBkYXRhQ29udGV4dCk7XG4gIH1cblxuICAvKipcbiAgICog5L+h6aC85bqm6KiI566XXG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZUNvbmZpZGVuY2UoZGF0YUNvdW50OiBudW1iZXIsIG5lZWRzRGF0YVNlYXJjaDogYm9vbGVhbiA9IHRydWUpOiBudW1iZXIge1xuICAgIC8vIOODh+ODvOOCv+aknOe0ouOBjOS4jeimgeOBquizquWVj++8iOaMqOaLtuOBquOBqe+8ieOBr+mrmOOBhOS/oemgvOW6plxuICAgIGlmICghbmVlZHNEYXRhU2VhcmNoKSB7XG4gICAgICByZXR1cm4gMC45O1xuICAgIH1cbiAgICBcbiAgICAvLyDjg4fjg7zjgr/mpJzntKLjgYzlv4XopoHjgaros6rllY/jga7loLTlkIhcbiAgICBpZiAoZGF0YUNvdW50ID09PSAwKSByZXR1cm4gMC4yO1xuICAgIGlmIChkYXRhQ291bnQgPj0gMykgcmV0dXJuIDAuODtcbiAgICByZXR1cm4gMC40ICsgKGRhdGFDb3VudCAqIDAuMik7XG4gIH1cblxuICAvKipcbiAgICog44Kt44Oj44OD44K344Ol44Kt44O855Sf5oiQXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlQ2FjaGVLZXkocXVlcnk6IHN0cmluZywgbGFuZ3VhZ2U6IFN1cHBvcnRlZExhbmd1YWdlKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYHJhZ18ke2xhbmd1YWdlfV8ke3F1ZXJ5LnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXFxzKy9nLCAnXycpLnN1YnN0cmluZygwLCA1MCl9YDtcbiAgfVxuXG4gIC8qKlxuICAgKiDjgq3jg6Pjg4Pjgrfjg6XntZDmnpzjga7jg5Xjgqnjg7zjg57jg4Pjg4hcbiAgICovXG4gIHByaXZhdGUgZm9ybWF0Q2FjaGVkUmVzcG9uc2UoY2FjaGVkUmVzdWx0OiBhbnksIHN0YXJ0VGltZTogbnVtYmVyKTogU2ltcGxlUkFHUmVzcG9uc2Uge1xuICAgIHJldHVybiB7XG4gICAgICBjb250ZW50OiBg44Kt44Oj44OD44K344Ol44GL44KJ5Y+W5b6X44GX44Gf57WQ5p6c44Gn44GZ44CCXFxuXFxuJHtjYWNoZWRSZXN1bHQuaXRlbXNbMF0/LmRlc2NyaXB0aW9uIHx8ICfplqLpgKPmg4XloLHjgYzopovjgaTjgYvjgorjgb7jgZfjgZ/jgIInfWAsXG4gICAgICBzb3VyY2VzOiBjYWNoZWRSZXN1bHQuaXRlbXMgfHwgW10sXG4gICAgICBjb25maWRlbmNlOiB0aGlzLmNhbGN1bGF0ZUNvbmZpZGVuY2UoY2FjaGVkUmVzdWx0Lml0ZW1zPy5sZW5ndGggfHwgMCksXG4gICAgICBwcm9jZXNzaW5nVGltZTogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog44Ko44Op44O85b+c562U55Sf5oiQXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlRXJyb3JSZXNwb25zZShlcnJvcjogRXJyb3IsIGxhbmd1YWdlOiBTdXBwb3J0ZWRMYW5ndWFnZSwgc3RhcnRUaW1lOiBudW1iZXIpOiBTaW1wbGVSQUdSZXNwb25zZSB7XG4gICAgY29uc3QgZXJyb3JNZXNzYWdlcyA9IHtcbiAgICAgIGphOiAn55Sz44GX6Kiz44GU44GW44GE44G+44Gb44KT44GM44CB44K344K544OG44Og44Ko44Op44O844GM55m655Sf44GX44G+44GX44Gf44CC44GX44Gw44KJ44GP5b6M44Gr44KC44GG5LiA5bqm44GK6Kmm44GX44GP44Gg44GV44GE44CCJyxcbiAgICAgIGVuOiAnU29ycnksIGEgc3lzdGVtIGVycm9yIG9jY3VycmVkLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLicsXG4gICAgICB6aDogJ+aKseatie+8jOezu+e7n+WPkeeUn+mUmeivr+OAguivt+eojeWQjumHjeivleOAgicsXG4gICAgICBrbzogJ+yjhOyGoe2VqeuLiOuLpC4g7Iuc7Iqk7YWcIOyYpOulmOqwgCDrsJzsg53tlojsirXri4jri6QuIOyeoOyLnCDtm4Qg64uk7IucIOyLnOuPhO2VtOyjvOyEuOyalC4nXG4gICAgfTtcblxuICAgIHJldHVybiB7XG4gICAgICBjb250ZW50OiBlcnJvck1lc3NhZ2VzW2xhbmd1YWdlXSB8fCBlcnJvck1lc3NhZ2VzLmphLFxuICAgICAgc291cmNlczogW10sXG4gICAgICBjb25maWRlbmNlOiAwLjEsXG4gICAgICBwcm9jZXNzaW5nVGltZTogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog44OV44Kp44O844Or44OQ44OD44Kv5b+c562UXG4gICAqL1xuICBwcml2YXRlIGdldEZhbGxiYWNrUmVzcG9uc2UobGFuZ3VhZ2U6IFN1cHBvcnRlZExhbmd1YWdlKTogc3RyaW5nIHtcbiAgICBjb25zdCBmYWxsYmFja01lc3NhZ2VzID0ge1xuICAgICAgamE6ICfnlLPjgZfoqLPjgZTjgZbjgYTjgb7jgZvjgpPjgYzjgIHnj77lnKjjgZPjga7os6rllY/jgavjgYrnrZTjgYjjgafjgY3jgb7jgZvjgpPjgILmnbHkuqzpg73jga7lhazlvI/jg5vjg7zjg6Djg5rjg7zjgrjjgoTlkITljLrluILnlLrmnZHjga7nqpPlj6PjgafjgZTnorroqo3jgY/jgaDjgZXjgYTjgIInLFxuICAgICAgZW46ICdTb3JyeSwgSSBjYW5ub3QgYW5zd2VyIHRoaXMgcXVlc3Rpb24gYXQgdGhlIG1vbWVudC4gUGxlYXNlIGNoZWNrIHRoZSBvZmZpY2lhbCBUb2t5byBNZXRyb3BvbGl0YW4gR292ZXJubWVudCB3ZWJzaXRlIG9yIGNvbnRhY3QgeW91ciBsb2NhbCBtdW5pY2lwYWwgb2ZmaWNlLicsXG4gICAgICB6aDogJ+aKseatie+8jOebruWJjeaXoOazleWbnuetlOi/meS4qumXrumimOOAguivt+afpeeci+S4nOS6rOmDveWumOaWuee9keermeaIluiBlOezu+W9k+WcsOW4guWMuueUuuadkeeql+WPo+OAgicsXG4gICAgICBrbzogJ+yjhOyGoe2VqeuLiOuLpC4g7ZiE7J6sIOydtCDsp4jrrLjsl5Ag64u17ZWgIOyImCDsl4bsirXri4jri6QuIOuPhOy/hOuPhCDqs7Xsi50g7ZmI7Y6Y7J207KeA64KYIOqwgSDqtazsi5zsoJXstIwg7LC96rWs7JeQ7IScIO2ZleyduO2VtOyjvOyEuOyalC4nXG4gICAgfTtcblxuICAgIHJldHVybiBmYWxsYmFja01lc3NhZ2VzW2xhbmd1YWdlXSB8fCBmYWxsYmFja01lc3NhZ2VzLmphO1xuICB9XG5cbiAgLyoqXG4gICAqIOOCueODiOODg+ODl+ODr+ODvOODieWPluW+l1xuICAgKi9cbiAgcHJpdmF0ZSBnZXRTdG9wV29yZHMobGFuZ3VhZ2U6IFN1cHBvcnRlZExhbmd1YWdlKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IHN0b3BXb3JkcyA9IHtcbiAgICAgIGphOiBbJ+OBrycsICfjgYwnLCAn44KSJywgJ+OBqycsICfjgacnLCAn44GoJywgJ+OBricsICfjgYvjgoknLCAn44G+44GnJywgJ+OBquOBqScsICfjgavjgaTjgYTjgaYnLCAn44Gr6Zai44GX44GmJywgJ+OCkuaVmeOBiOOBpicsICfjgY/jgaDjgZXjgYQnLCAn44Gn44GZJywgJ+OBvuOBmScsICfjgafjgYLjgosnXSxcbiAgICAgIGVuOiBbJ3RoZScsICdpcycsICdhdCcsICd3aGljaCcsICdvbicsICdhJywgJ2FuJywgJ2FuZCcsICdvcicsICdidXQnLCAnaW4nLCAnd2l0aCcsICdmb3InLCAndG8nLCAnb2YnLCAnYXMnLCAnYnknXSxcbiAgICAgIHpoOiBbJ+eahCcsICfmmK8nLCAn5ZyoJywgJ+aciScsICflkownLCAn5LiOJywgJ+aIlicsICfkvYYnLCAn5Zug5Li6JywgJ+aJgOS7pScsICflpoLmnpwnLCAn6YKj5LmIJywgJ+i/meS4qicsICfpgqPkuKonXSxcbiAgICAgIGtvOiBbJ+ydgCcsICfripQnLCAn7J20JywgJ+qwgCcsICfsnYQnLCAn66W8JywgJ+yXkCcsICfsl5DshJwnLCAn7JmAJywgJ+qzvCcsICfsnZgnLCAn7Jy866GcJywgJ+uhnCcsICfsl5DqsownLCAn7ZWc7YWMJ11cbiAgICB9O1xuXG4gICAgcmV0dXJuIHN0b3BXb3Jkc1tsYW5ndWFnZV0gfHwgc3RvcFdvcmRzLmphO1xuICB9XG5cbiAgLyoqXG4gICAqIOOCteODvOODk+OCuee1seioiOWPluW+l1xuICAgKi9cbiAgZ2V0U3RhdHMoKToge1xuICAgIGNhY2hlSGl0UmF0ZTogbnVtYmVyO1xuICAgIHRvdGFsUXVlcmllczogbnVtYmVyO1xuICAgIGF2ZXJhZ2VQcm9jZXNzaW5nVGltZTogbnVtYmVyO1xuICB9IHtcbiAgICAvLyDnsKHljZjjgarntbHoqIjmg4XloLHvvIjlrp/pmpvjga7lrp/oo4Xjgafjga/msLjntprljJbjgZXjgozjgZ/jg6Hjg4jjg6rjgq/jgrnjgpLkvb/nlKjvvIlcbiAgICByZXR1cm4ge1xuICAgICAgY2FjaGVIaXRSYXRlOiAwLjAsIC8vIOOCreODo+ODg+OCt+ODpeOBruWun+ijheOBq+S+neWtmFxuICAgICAgdG90YWxRdWVyaWVzOiAwLFxuICAgICAgYXZlcmFnZVByb2Nlc3NpbmdUaW1lOiAwXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiDjgq/jg6rjg7zjg7PjgqLjg4Pjg5dcbiAgICovXG4gIGNsZWFudXAoKTogdm9pZCB7XG4gICAgLy8g5b+F6KaB44Gr5b+c44GY44Gm44Oq44K944O844K544Kv44Oq44O844Oz44Ki44OD44OXXG4gICAgbG9nLmluZm8oJ1NpbXBsZVJBR1NlcnZpY2UgY2xlYW51cCBjb21wbGV0ZWQnKTtcbiAgfVxufSJdLCJuYW1lcyI6WyJHZW1pbmlTZXJ2aWNlIiwiVG9reW9PcGVuRGF0YVNlcnZpY2UiLCJnZXRTZWFyY2hDYWNoZSIsImxvZyIsIlNpbXBsZVJBR1NlcnZpY2UiLCJjb25zdHJ1Y3RvciIsImNhY2hlIiwiZ2VtaW5pU2VydmljZSIsIm9wZW5EYXRhU2VydmljZSIsInByb2Nlc3NRdWVyeVN0cmVhbWluZyIsInF1ZXJ5IiwibGFuZ3VhZ2UiLCJvblN0ZXAiLCJzdGFydFRpbWUiLCJEYXRlIiwibm93IiwiZW1pdFN0ZXAiLCJzdGVwIiwic3RhdHVzIiwibWVzc2FnZSIsImRhdGEiLCJ0aW1lc3RhbXAiLCJzdWJzdHJpbmciLCJpbmZvIiwiY2FjaGVLZXkiLCJnZW5lcmF0ZUNhY2hlS2V5IiwiY2FjaGVkUmVzdWx0IiwiZ2V0IiwidGV4dCIsImZvcm1hdENhY2hlZFJlc3BvbnNlIiwibmVlZHNEYXRhU2VhcmNoIiwic2hvdWxkU2VhcmNoQWRtaW5pc3RyYXRpdmVEYXRhIiwibmVlZHNTZWFyY2giLCJyZWxldmFudERhdGEiLCJrZXl3b3JkcyIsImV4dHJhY3RLZXl3b3JkcyIsImxlbmd0aCIsInNsaWNlIiwic2VhcmNoUmVsZXZhbnREYXRhIiwiY291bnQiLCJyZXNwb25zZSIsImdlbmVyYXRlUmVzcG9uc2UiLCJyZXN1bHQiLCJjb250ZW50Iiwic291cmNlcyIsImNvbmZpZGVuY2UiLCJjYWxjdWxhdGVDb25maWRlbmNlIiwicHJvY2Vzc2luZ1RpbWUiLCJzZXQiLCJpdGVtcyIsInRvdGFsIiwidXNlZENhY2hlIiwic291cmNlQ291bnQiLCJ1c2VkRGF0YVNlYXJjaCIsImVycm9yIiwiZ2VuZXJhdGVFcnJvclJlc3BvbnNlIiwicHJvY2Vzc1F1ZXJ5IiwiZGVidWciLCJiYXNpY0RlY2lzaW9uIiwiYmFzaWNTZWFyY2hEZWNpc2lvbiIsImlzRGVmaW5pdGl2ZSIsInJlYXNvbiIsImFpRGVjaXNpb24iLCJhaVNlYXJjaERlY2lzaW9uIiwid2FybiIsImZhbGxiYWNrIiwibG93ZXJRdWVyeSIsInRvTG93ZXJDYXNlIiwidHJpbSIsIm5vU2VhcmNoUGF0dGVybnMiLCJqYSIsImVuIiwiemgiLCJrbyIsIm5lZWRTZWFyY2hQYXR0ZXJucyIsInBhdHRlcm5zIiwic2VhcmNoUGF0dGVybnMiLCJwYXR0ZXJuIiwidGVzdCIsInByb21wdCIsImJ1aWxkU2VhcmNoRGVjaXNpb25Qcm9tcHQiLCJnZW5lcmF0ZVRleHQiLCJ1bmRlZmluZWQiLCJkZWNpc2lvbiIsImluY2x1ZGVzIiwicHJvbXB0cyIsInN0b3BXb3JkcyIsImdldFN0b3BXb3JkcyIsIndvcmRzIiwicmVwbGFjZSIsInNwbGl0IiwiZmlsdGVyIiwid29yZCIsIlNldCIsInNlYXJjaFF1ZXJ5Iiwiam9pbiIsImZldGNoUmVsZXZhbnREYXRhIiwiYnVpbGRQcm9tcHQiLCJnZXRGYWxsYmFja1Jlc3BvbnNlIiwidGVtcGxhdGVzIiwic3lzdGVtIiwidXNlclByb21wdCIsImRhdGFDb250ZXh0IiwidGVtcGxhdGUiLCJtYXAiLCJpdGVtIiwiaW5kZXgiLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwiZGF0YUNvdW50IiwiZXJyb3JNZXNzYWdlcyIsImZhbGxiYWNrTWVzc2FnZXMiLCJnZXRTdGF0cyIsImNhY2hlSGl0UmF0ZSIsInRvdGFsUXVlcmllcyIsImF2ZXJhZ2VQcm9jZXNzaW5nVGltZSIsImNsZWFudXAiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/services/SimpleRAGService.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/services/TokyoOpenDataService.ts":
/*!**************************************************!*\
  !*** ./src/lib/services/TokyoOpenDataService.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TokyoOpenDataService: () => (/* binding */ TokyoOpenDataService)\n/* harmony export */ });\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! axios */ \"(rsc)/./node_modules/axios/lib/axios.js\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./src/lib/logger.ts\");\n/* harmony import */ var _GeminiService__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./GeminiService */ \"(rsc)/./src/lib/services/GeminiService.ts\");\n/* harmony import */ var _lib_utils_jsonParser__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/utils/jsonParser */ \"(rsc)/./src/lib/utils/jsonParser.ts\");\n\n\n\n\nclass TokyoOpenDataService {\n    constructor(){\n        this.catalogBaseUrl = \"https://catalog.data.metro.tokyo.lg.jp\";\n        this.apiBaseUrl = \"https://catalog.data.metro.tokyo.lg.jp/api/3\";\n        this.datasetCache = new Map();\n        this.cacheExpiry = new Map();\n        this.CACHE_TTL = 30 * 60 * 1000 // 30分\n        ;\n        this.geminiService = new _GeminiService__WEBPACK_IMPORTED_MODULE_1__.GeminiService();\n    }\n    /**\n   * ユーザーの質問に基づいて関連するオープンデータを動的に検索・取得\n   */ async fetchRelevantData(query, language = \"ja\") {\n        try {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__.log.info(\"Starting dynamic open data search\", {\n                query: query.substring(0, 100),\n                language\n            });\n            // 1. AIを使って検索キーワードとカテゴリを抽出\n            const searchParams = await this.extractSearchParameters(query, language);\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__.log.debug(\"Extracted search parameters\", searchParams);\n            // 2. CKAN APIでデータセットを検索\n            const datasets = await this.searchDatasets(searchParams);\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__.log.info(\"Found datasets\", {\n                count: datasets.length\n            });\n            if (datasets.length === 0) {\n                return this.getFallbackData(query, language);\n            }\n            // 3. 関連度でソートして上位データセットを選択\n            const relevantDatasets = await this.rankDatasetsByRelevance(datasets, query, language);\n            const topDatasets = relevantDatasets.slice(0, 5); // 上位5データセット\n            // 4. 選択されたデータセットからデータを並列取得・変換\n            const datasetPromises = topDatasets.map(async (dataset)=>{\n                try {\n                    return await this.processDataset(dataset, query, language);\n                } catch (error) {\n                    _lib_logger__WEBPACK_IMPORTED_MODULE_0__.log.warn(\"Failed to process dataset\", {\n                        datasetId: dataset.id,\n                        error: error.message\n                    });\n                    return [];\n                }\n            });\n            const datasetResults = await Promise.allSettled(datasetPromises);\n            const allItems = [];\n            for (const result of datasetResults){\n                if (result.status === \"fulfilled\") {\n                    allItems.push(...result.value);\n                }\n            }\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__.log.info(\"Successfully processed open data\", {\n                totalItems: allItems.length,\n                datasetsProcessed: topDatasets.length\n            });\n            return allItems;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__.log.error(\"Error in dynamic open data search\", error, {\n                query\n            });\n            return this.getFallbackData(query, language);\n        }\n    }\n    /**\n   * AIを使ってユーザーの質問から検索パラメータを抽出\n   */ async extractSearchParameters(query, language) {\n        try {\n            const prompt = this.buildSearchExtractionPrompt(query, language);\n            const response = await this.geminiService.generateText(prompt, undefined, language);\n            // 安全なJSON解析\n            const parsed = (0,_lib_utils_jsonParser__WEBPACK_IMPORTED_MODULE_2__.safeJsonParse)(response, {\n                keywords: this.extractKeywordsBasic(query),\n                categories: [],\n                organizations: [],\n                tags: []\n            });\n            return {\n                keywords: parsed.keywords || [],\n                categories: parsed.categories || [],\n                organizations: parsed.organizations || [],\n                tags: parsed.tags || []\n            };\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__.log.warn(\"Failed to extract search parameters with AI\", {\n                error: error.message,\n                fallback: \"basic-keyword-extraction\"\n            });\n            return {\n                keywords: this.extractKeywordsBasic(query),\n                categories: [],\n                organizations: [],\n                tags: []\n            };\n        }\n    }\n    buildSearchExtractionPrompt(query, language) {\n        const prompts = {\n            ja: `\n以下のユーザーの質問から、東京都オープンデータを検索するためのパラメータを抽出してください。\n\nユーザーの質問: \"${query}\"\n\n【抽出する情報】\n1. キーワード: 質問に含まれる重要な単語（名詞、動詞など）\n2. カテゴリ: 関連する行政分野（例：子育て、教育、福祉、環境、交通、防災、経済、観光等）\n3. 組織: 関連する東京都の組織（例：都庁、区市町村等）\n4. タグ: データに付与されそうなタグ\n\n【出力形式】\n以下のJSON形式で出力してください：\n{\n  \"keywords\": [\"キーワード1\", \"キーワード2\"],\n  \"categories\": [\"カテゴリ1\"],\n  \"organizations\": [\"組織1\"],\n  \"tags\": [\"タグ1\", \"タグ2\"]\n}`,\n            en: `\nExtract search parameters for Tokyo Open Data from the following user question.\n\nUser question: \"${query}\"\n\nExtract:\n1. Keywords: Important words (nouns, verbs, etc.)\n2. Categories: Related administrative fields (childcare, education, welfare, environment, transportation, disaster prevention, economy, tourism, etc.)\n3. Organizations: Related Tokyo organizations\n4. Tags: Likely data tags\n\nOutput in JSON format:\n{\n  \"keywords\": [\"keyword1\", \"keyword2\"],\n  \"categories\": [\"category1\"],\n  \"organizations\": [\"org1\"],\n  \"tags\": [\"tag1\", \"tag2\"]\n}`\n        };\n        return prompts[language] || prompts.ja;\n    }\n    /**\n   * 基本的なキーワード抽出（AI失敗時のフォールバック）\n   */ extractKeywordsBasic(query) {\n        // 簡単な形態素解析もどき\n        const keywords = query.replace(/[？?！!。、，,．.]/g, \" \").split(/\\s+/).filter((word)=>word.length > 1).filter((word)=>![\n                \"について\",\n                \"に関して\",\n                \"を教えて\",\n                \"ください\",\n                \"です\",\n                \"ます\",\n                \"である\"\n            ].includes(word));\n        return [\n            ...new Set(keywords)\n        ]; // 重複除去\n    }\n    /**\n   * CKAN APIを使用してデータセットを検索\n   */ async searchDatasets(searchParams) {\n        const cacheKey = JSON.stringify(searchParams);\n        // キャッシュチェック\n        if (this.datasetCache.has(cacheKey) && this.cacheExpiry.get(cacheKey) > Date.now()) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__.log.debug(\"Using cached dataset search results\");\n            return this.datasetCache.get(cacheKey);\n        }\n        try {\n            // CKANのpackage_search APIを使用\n            const searchQuery = this.buildCKANQuery(searchParams);\n            const url = `${this.apiBaseUrl}/action/package_search`;\n            const response = await axios__WEBPACK_IMPORTED_MODULE_3__[\"default\"].get(url, {\n                params: {\n                    q: searchQuery,\n                    rows: 50,\n                    start: 0,\n                    sort: \"score desc, metadata_modified desc\"\n                },\n                timeout: 10000,\n                headers: {\n                    \"User-Agent\": \"Tokyo-AI-Assistant/1.0\"\n                },\n                // Add caching and performance optimizations\n                validateStatus: (status)=>status < 500\n            });\n            if (response.data.success && response.data.result.results) {\n                const datasets = response.data.result.results;\n                // キャッシュに保存\n                this.datasetCache.set(cacheKey, datasets);\n                this.cacheExpiry.set(cacheKey, Date.now() + this.CACHE_TTL);\n                _lib_logger__WEBPACK_IMPORTED_MODULE_0__.log.info(\"CKAN search completed\", {\n                    query: searchQuery,\n                    totalCount: response.data.result.count,\n                    returnedCount: datasets.length\n                });\n                return datasets;\n            } else {\n                throw new Error(\"CKAN API returned unsuccessful response\");\n            }\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__.log.error(\"CKAN dataset search failed\", error, {\n                searchParams\n            });\n            return [];\n        }\n    }\n    buildCKANQuery(searchParams) {\n        // カテゴリフィルタのみを使用\n        if (searchParams.categories.length > 0) {\n            return `groups:(${searchParams.categories.join(\" OR \")})`;\n        }\n        // カテゴリが指定されていない場合は全データセットを対象\n        return \"*:*\";\n    }\n    /**\n   * AIを使ってデータセットの関連度をランキング\n   */ async rankDatasetsByRelevance(datasets, query, language) {\n        // For performance, limit AI ranking to top 20 datasets\n        const datasetsToRank = datasets.slice(0, 20);\n        try {\n            // データセットの情報を簡潔にまとめてAIに送信\n            const datasetSummaries = datasetsToRank.map((dataset, index)=>({\n                    index,\n                    id: dataset.id,\n                    title: dataset.title,\n                    description: dataset.notes?.substring(0, 200) || \"\",\n                    tags: dataset.tags.map((tag)=>tag.name).join(\", \"),\n                    organization: dataset.organization?.title || \"\"\n                }));\n            // Use Promise.race with timeout for better performance\n            const rankingPromise = this.performAIRanking(query, datasetSummaries, language);\n            const timeoutPromise = new Promise((_, reject)=>setTimeout(()=>reject(new Error(\"AI ranking timeout\")), 5000));\n            const rankedDatasets = await Promise.race([\n                rankingPromise,\n                timeoutPromise\n            ]);\n            // Append remaining datasets that weren't ranked\n            const remainingDatasets = datasets.slice(20);\n            return [\n                ...rankedDatasets,\n                ...remainingDatasets\n            ];\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__.log.warn(\"Failed to rank datasets with AI\", {\n                error: error.message\n            });\n            // AI失敗時は元の順序を保持\n            return datasets;\n        }\n    }\n    async performAIRanking(query, datasetSummaries, language) {\n        const prompt = this.buildRankingPrompt(query, datasetSummaries, language);\n        const response = await this.geminiService.generateText(prompt, undefined, language);\n        // 安全なJSON解析\n        const ranking = (0,_lib_utils_jsonParser__WEBPACK_IMPORTED_MODULE_2__.safeJsonParse)(response, []);\n        if (Array.isArray(ranking) && ranking.length > 0) {\n            // ランキングに基づいてデータセットを並び替え\n            const rankedDatasets = ranking.filter((item)=>typeof item.index === \"number\" && item.index < datasetSummaries.length).map((item)=>datasetSummaries[item.index]);\n            return rankedDatasets;\n        }\n        return datasetSummaries;\n    }\n    buildRankingPrompt(query, datasetSummaries, language) {\n        const prompts = {\n            ja: `\nユーザーの質問: \"${query}\"\n\n以下のデータセットの中から、ユーザーの質問に最も関連性の高いものから順番に並べ替えてください。\n\nデータセット一覧:\n${datasetSummaries.map((dataset, i)=>`${i}. ${dataset.title}\\n説明: ${dataset.description}\\nタグ: ${dataset.tags}\\n組織: ${dataset.organization}`).join(\"\\n\\n\")}\n\n関連度の高い順に並べて、以下のJSON形式で出力してください：\n[\n  {\"index\": 0, \"score\": 0.9, \"reason\": \"理由\"},\n  {\"index\": 2, \"score\": 0.8, \"reason\": \"理由\"}\n]`,\n            en: `\nUser question: \"${query}\"\n\nRank the following datasets by relevance to the user's question:\n\nDatasets:\n${datasetSummaries.map((dataset, i)=>`${i}. ${dataset.title}\\nDescription: ${dataset.description}\\nTags: ${dataset.tags}\\nOrganization: ${dataset.organization}`).join(\"\\n\\n\")}\n\nOutput in JSON format, ordered by relevance:\n[\n  {\"index\": 0, \"score\": 0.9, \"reason\": \"reason\"},\n  {\"index\": 2, \"score\": 0.8, \"reason\": \"reason\"}\n]`\n        };\n        return prompts[language] || prompts.ja;\n    }\n    /**\n   * データセットを処理してOpenDataItemに変換\n   */ async processDataset(dataset, originalQuery, language) {\n        const items = [];\n        try {\n            // データセット概要アイテムを作成\n            const summaryItem = this.createDatasetSummaryItem(dataset, language);\n            items.push(summaryItem);\n            // 処理可能なリソースからデータを取得\n            const processableResources = dataset.resources.filter((resource)=>this.isSupportedFormat(resource.format));\n            for (const resource of processableResources.slice(0, 2)){\n                try {\n                    const resourceItems = await this.processResource(resource, dataset, originalQuery, language);\n                    items.push(...resourceItems);\n                } catch (error) {\n                    _lib_logger__WEBPACK_IMPORTED_MODULE_0__.log.warn(\"Failed to process resource\", {\n                        resourceId: resource.id,\n                        format: resource.format,\n                        error: error.message\n                    });\n                }\n            }\n            return items;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__.log.error(\"Failed to process dataset\", error, {\n                datasetId: dataset.id\n            });\n            return [];\n        }\n    }\n    createDatasetSummaryItem(dataset, language) {\n        const category = this.extractCategory(dataset);\n        const tags = dataset.tags.map((tag)=>tag.name);\n        return {\n            id: `${dataset.id}-summary`,\n            title: dataset.title,\n            description: dataset.notes || \"東京都オープンデータ\",\n            category: category,\n            tags: [\n                ...tags,\n                \"東京都\",\n                \"オープンデータ\"\n            ],\n            content: this.generateDatasetSummaryContent(dataset, language),\n            metadata: {\n                source: `東京都オープンデータ: ${dataset.title}`,\n                lastUpdated: new Date(dataset.metadata_modified || dataset.metadata_created),\n                language,\n                datasetId: dataset.id,\n                organization: dataset.organization?.title,\n                license: dataset.license_title\n            }\n        };\n    }\n    generateDatasetSummaryContent(dataset, language) {\n        const templates = {\n            ja: `# ${dataset.title}\n\n## 概要\n${dataset.notes || \"データセットの詳細な説明は提供されていません。\"}\n\n## データセット情報\n- **提供組織**: ${dataset.organization?.title || \"東京都\"}\n- **最終更新**: ${new Date(dataset.metadata_modified || dataset.metadata_created).toLocaleDateString(\"ja-JP\")}\n- **ライセンス**: ${dataset.license_title || \"未指定\"}\n- **タグ**: ${dataset.tags.map((tag)=>tag.name).join(\"、\")}\n\n## 利用可能なリソース\n${dataset.resources.map((resource)=>`- ${resource.name || \"データファイル\"} (${resource.format})`).join(\"\\n\")}\n\n東京都オープンデータポータルより提供されている公式データです。`,\n            en: `# ${dataset.title}\n\n## Overview\n${dataset.notes || \"No detailed description provided for this dataset.\"}\n\n## Dataset Information\n- **Organization**: ${dataset.organization?.title || \"Tokyo Metropolitan Government\"}\n- **Last Updated**: ${new Date(dataset.metadata_modified || dataset.metadata_created).toLocaleDateString(\"en-US\")}\n- **License**: ${dataset.license_title || \"Not specified\"}\n- **Tags**: ${dataset.tags.map((tag)=>tag.name).join(\", \")}\n\n## Available Resources\n${dataset.resources.map((resource)=>`- ${resource.name || \"Data file\"} (${resource.format})`).join(\"\\n\")}\n\nOfficial data provided by Tokyo Open Data Portal.`\n        };\n        return templates[language] || templates.ja;\n    }\n    async processResource(resource, dataset, originalQuery, language) {\n        try {\n            const response = await axios__WEBPACK_IMPORTED_MODULE_3__[\"default\"].get(resource.url, {\n                timeout: 20000,\n                maxContentLength: 10 * 1024 * 1024,\n                headers: {\n                    \"User-Agent\": \"Tokyo-AI-Assistant/1.0\"\n                }\n            });\n            return this.convertResourceDataToItems(response.data, resource, dataset, originalQuery, language);\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__.log.warn(\"Failed to fetch resource data\", {\n                resourceId: resource.id,\n                url: resource.url,\n                error: error.message\n            });\n            return [];\n        }\n    }\n    convertResourceDataToItems(data, resource, dataset, originalQuery, language) {\n        const items = [];\n        try {\n            if (Array.isArray(data) && data.length > 0) {\n                // 配列データの場合、関連性の高いエントリを抽出\n                const relevantEntries = this.findRelevantEntries(data, originalQuery);\n                relevantEntries.slice(0, 3).forEach((entry, index)=>{\n                    const item = this.createResourceEntryItem(entry, resource, dataset, index, language);\n                    items.push(item);\n                });\n            } else if (typeof data === \"object\") {\n                // オブジェクトデータの場合\n                const item = this.createResourceEntryItem(data, resource, dataset, 0, language);\n                items.push(item);\n            }\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__.log.error(\"Failed to convert resource data\", error, {\n                resourceId: resource.id\n            });\n        }\n        return items;\n    }\n    findRelevantEntries(data, query) {\n        const queryWords = query.toLowerCase().split(/\\s+/);\n        return data.map((entry)=>{\n            let score = 0;\n            const entryText = JSON.stringify(entry).toLowerCase();\n            queryWords.forEach((word)=>{\n                if (entryText.includes(word)) {\n                    score += 1;\n                }\n            });\n            return {\n                entry,\n                score\n            };\n        }).filter((item)=>item.score > 0).sort((a, b)=>b.score - a.score).map((item)=>item.entry);\n    }\n    createResourceEntryItem(entry, resource, dataset, index, language) {\n        const title = this.extractEntryTitle(entry, dataset.title);\n        const description = this.extractEntryDescription(entry, resource.description);\n        const content = this.formatEntryContent(entry, language);\n        const category = this.extractCategory(dataset);\n        return {\n            id: `${dataset.id}-${resource.id}-${index}`,\n            title,\n            description,\n            category: category,\n            tags: [\n                ...dataset.tags.map((tag)=>tag.name),\n                \"データエントリ\"\n            ],\n            content,\n            metadata: {\n                source: `東京都オープンデータ: ${dataset.title} - ${resource.name}`,\n                lastUpdated: new Date(resource.last_modified || dataset.metadata_modified),\n                language,\n                datasetId: dataset.id,\n                resourceId: resource.id,\n                organization: dataset.organization?.title\n            }\n        };\n    }\n    extractEntryTitle(entry, datasetTitle) {\n        const titleFields = [\n            \"name\",\n            \"title\",\n            \"名称\",\n            \"施設名\",\n            \"事業名\",\n            \"facility_name\",\n            \"項目名\"\n        ];\n        for (const field of titleFields){\n            if (entry[field] && typeof entry[field] === \"string\") {\n                return `${datasetTitle} - ${entry[field].substring(0, 50)}`;\n            }\n        }\n        // フォールバック\n        const firstStringValue = Object.values(entry).find((value)=>typeof value === \"string\" && value.trim().length > 0);\n        if (firstStringValue) {\n            return `${datasetTitle} - ${firstStringValue.substring(0, 30)}`;\n        }\n        return `${datasetTitle} - データエントリ`;\n    }\n    extractEntryDescription(entry, resourceDescription) {\n        const descFields = [\n            \"description\",\n            \"summary\",\n            \"説明\",\n            \"概要\",\n            \"details\"\n        ];\n        for (const field of descFields){\n            if (entry[field] && typeof entry[field] === \"string\") {\n                return entry[field].substring(0, 200);\n            }\n        }\n        return resourceDescription || \"東京都オープンデータのエントリです。\";\n    }\n    formatEntryContent(entry, language) {\n        const templates = {\n            ja: \"## データ詳細\\n\\n\",\n            en: \"## Data Details\\n\\n\"\n        };\n        let content = templates[language] || templates.ja;\n        Object.entries(entry).forEach(([key, value])=>{\n            if (value !== null && value !== undefined && value !== \"\") {\n                content += `**${key}**: ${value}\\n`;\n            }\n        });\n        return content || \"データエントリの詳細情報\";\n    }\n    extractCategory(dataset) {\n        // グループ情報からカテゴリを推定\n        if (dataset.groups && dataset.groups.length > 0) {\n            return dataset.groups[0].title || dataset.groups[0].name;\n        }\n        // タグからカテゴリを推定\n        const categoryKeywords = {\n            \"子育て\": [\n                \"子育て\",\n                \"保育\",\n                \"育児\",\n                \"児童\"\n            ],\n            \"教育\": [\n                \"教育\",\n                \"学校\",\n                \"学習\"\n            ],\n            \"福祉\": [\n                \"福祉\",\n                \"介護\",\n                \"高齢者\"\n            ],\n            \"環境\": [\n                \"環境\",\n                \"気象\",\n                \"ごみ\"\n            ],\n            \"交通\": [\n                \"交通\",\n                \"道路\",\n                \"電車\"\n            ],\n            \"防災\": [\n                \"防災\",\n                \"災害\",\n                \"避難\"\n            ],\n            \"経済\": [\n                \"経済\",\n                \"産業\",\n                \"企業\"\n            ],\n            \"観光\": [\n                \"観光\",\n                \"文化\",\n                \"イベント\"\n            ]\n        };\n        const tags = dataset.tags.map((tag)=>tag.name).join(\" \");\n        const text = `${dataset.title} ${dataset.notes} ${tags}`.toLowerCase();\n        for (const [category, keywords] of Object.entries(categoryKeywords)){\n            if (keywords.some((keyword)=>text.includes(keyword))) {\n                return category;\n            }\n        }\n        return \"general\";\n    }\n    isSupportedFormat(format) {\n        const supportedFormats = [\n            \"JSON\",\n            \"CSV\",\n            \"TSV\",\n            \"XLS\",\n            \"XLSX\"\n        ];\n        return supportedFormats.includes(format?.toUpperCase());\n    }\n    getFallbackData(query, language) {\n        const templates = {\n            ja: {\n                title: \"お探しの情報について\",\n                description: \"ご質問にお答えできるよう努めます\",\n                content: `申し訳ございませんが、「${query}」に関する具体的なオープンデータが見つかりませんでした。\n\n東京都では9,742件のオープンデータを公開しています。以下の方法でより詳しい情報を得ることができます：\n\n1. **東京都オープンデータカタログ** (https://catalog.data.metro.tokyo.lg.jp/)\n2. **各区市町村の公式ホームページ**\n3. **東京都公式ホームページ** (https://www.metro.tokyo.lg.jp/)\n\nより具体的なキーワードや分野を指定していただければ、関連するデータを見つけやすくなります。`\n            },\n            en: {\n                title: \"About Your Inquiry\",\n                description: \"We strive to answer your questions\",\n                content: `I apologize, but I could not find specific open data related to \"${query}\".\n\nTokyo provides 9,742 open datasets. You can get more detailed information through:\n\n1. **Tokyo Open Data Catalog** (https://catalog.data.metro.tokyo.lg.jp/)\n2. **Official websites of each ward/city/town**\n3. **Tokyo Metropolitan Government Official Website** (https://www.metro.tokyo.lg.jp/)\n\nPlease provide more specific keywords or fields to help find relevant data.`\n            }\n        };\n        const template = templates[language] || templates.ja;\n        return [\n            {\n                id: \"fallback-general\",\n                title: template.title,\n                description: template.description,\n                category: \"general\",\n                tags: [\n                    \"案内\",\n                    \"ヘルプ\"\n                ],\n                content: template.content,\n                metadata: {\n                    source: \"システム\",\n                    lastUpdated: new Date(),\n                    language\n                }\n            }\n        ];\n    }\n    /**\n   * 利用可能なデータソース一覧を取得\n   */ async getAvailableDataSources() {\n        try {\n            const url = `${this.apiBaseUrl}/action/organization_list`;\n            const response = await axios__WEBPACK_IMPORTED_MODULE_3__[\"default\"].get(url, {\n                params: {\n                    all_fields: true\n                },\n                timeout: 10000\n            });\n            if (response.data.success && response.data.result) {\n                return response.data.result.map((org)=>({\n                        id: org.name,\n                        title: org.title,\n                        url: `${this.catalogBaseUrl}/organization/${org.name}`,\n                        description: org.description || \"東京都オープンデータ提供組織\",\n                        category: \"organization\",\n                        lastUpdated: new Date(org.created)\n                    }));\n            }\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__.log.error(\"Failed to fetch data sources\", error);\n        }\n        return [\n            {\n                id: \"tokyo-metro\",\n                title: \"東京都\",\n                url: this.catalogBaseUrl,\n                description: \"東京都オープンデータポータル\",\n                category: \"organization\",\n                lastUpdated: new Date()\n            }\n        ];\n    }\n    /**\n   * 特定のカテゴリのデータを検索\n   */ async searchByCategory(category, limit = 20) {\n        const searchParams = {\n            keywords: [],\n            categories: [\n                category\n            ],\n            organizations: [],\n            tags: []\n        };\n        const datasets = await this.searchDatasets(searchParams);\n        const items = [];\n        for (const dataset of datasets.slice(0, Math.min(limit, 10))){\n            try {\n                const datasetItems = await this.processDataset(dataset, category, \"ja\");\n                items.push(...datasetItems);\n            } catch (error) {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_0__.log.warn(\"Failed to process dataset in category search\", {\n                    datasetId: dataset.id,\n                    category,\n                    error: error.message\n                });\n            }\n        }\n        return items;\n    }\n    /**\n   * 統計情報を取得\n   */ async getStats() {\n        try {\n            // 全データセット数を取得\n            const countResponse = await axios__WEBPACK_IMPORTED_MODULE_3__[\"default\"].get(`${this.apiBaseUrl}/action/package_search`, {\n                params: {\n                    q: \"*:*\",\n                    rows: 0\n                },\n                timeout: 10000\n            });\n            const totalDatasets = countResponse.data.result?.count || 0;\n            // 組織一覧を取得\n            const orgResponse = await axios__WEBPACK_IMPORTED_MODULE_3__[\"default\"].get(`${this.apiBaseUrl}/action/organization_list`, {\n                params: {\n                    all_fields: true\n                },\n                timeout: 10000\n            });\n            const organizations = orgResponse.data.result?.map((org)=>({\n                    name: org.name,\n                    title: org.title,\n                    count: org.package_count || 0\n                })) || [];\n            return {\n                totalDatasets,\n                categories: [],\n                organizations,\n                lastUpdated: new Date()\n            };\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__.log.error(\"Failed to get stats\", error);\n            return {\n                totalDatasets: 0,\n                categories: [],\n                organizations: [],\n                lastUpdated: new Date()\n            };\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3NlcnZpY2VzL1Rva3lvT3BlbkRhdGFTZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQTBCO0FBRVM7QUFDYTtBQUNPO0FBNkNoRCxNQUFNSTtJQVFYQyxhQUFjO2FBUE5DLGlCQUFpQjthQUNqQkMsYUFBYTthQUViQyxlQUFlLElBQUlDO2FBQ25CQyxjQUFjLElBQUlEO2FBQ1RFLFlBQVksS0FBSyxLQUFLLEtBQU0sTUFBTTs7UUFHakQsSUFBSSxDQUFDQyxhQUFhLEdBQUcsSUFBSVYseURBQWFBO0lBQ3hDO0lBRUE7O0dBRUMsR0FDRCxNQUFNVyxrQkFBa0JDLEtBQWEsRUFBRUMsV0FBOEIsSUFBSSxFQUEyQjtRQUNsRyxJQUFJO1lBQ0ZkLDRDQUFHQSxDQUFDZSxJQUFJLENBQUMscUNBQXFDO2dCQUM1Q0YsT0FBT0EsTUFBTUcsU0FBUyxDQUFDLEdBQUc7Z0JBQzFCRjtZQUNGO1lBRUEsMkJBQTJCO1lBQzNCLE1BQU1HLGVBQWUsTUFBTSxJQUFJLENBQUNDLHVCQUF1QixDQUFDTCxPQUFPQztZQUMvRGQsNENBQUdBLENBQUNtQixLQUFLLENBQUMsK0JBQStCRjtZQUV6Qyx3QkFBd0I7WUFDeEIsTUFBTUcsV0FBVyxNQUFNLElBQUksQ0FBQ0MsY0FBYyxDQUFDSjtZQUMzQ2pCLDRDQUFHQSxDQUFDZSxJQUFJLENBQUMsa0JBQWtCO2dCQUFFTyxPQUFPRixTQUFTRyxNQUFNO1lBQUM7WUFFcEQsSUFBSUgsU0FBU0csTUFBTSxLQUFLLEdBQUc7Z0JBQ3pCLE9BQU8sSUFBSSxDQUFDQyxlQUFlLENBQUNYLE9BQU9DO1lBQ3JDO1lBRUEsMEJBQTBCO1lBQzFCLE1BQU1XLG1CQUFtQixNQUFNLElBQUksQ0FBQ0MsdUJBQXVCLENBQUNOLFVBQVVQLE9BQU9DO1lBQzdFLE1BQU1hLGNBQWNGLGlCQUFpQkcsS0FBSyxDQUFDLEdBQUcsSUFBSSxZQUFZO1lBRTlELDhCQUE4QjtZQUM5QixNQUFNQyxrQkFBa0JGLFlBQVlHLEdBQUcsQ0FBQyxPQUFPQztnQkFDN0MsSUFBSTtvQkFDRixPQUFPLE1BQU0sSUFBSSxDQUFDQyxjQUFjLENBQUNELFNBQVNsQixPQUFPQztnQkFDbkQsRUFBRSxPQUFPbUIsT0FBTztvQkFDZGpDLDRDQUFHQSxDQUFDa0MsSUFBSSxDQUFDLDZCQUE2Qjt3QkFDcENDLFdBQVdKLFFBQVFLLEVBQUU7d0JBQ3JCSCxPQUFPLE1BQWlCSSxPQUFPO29CQUNqQztvQkFDQSxPQUFPLEVBQUU7Z0JBQ1g7WUFDRjtZQUVBLE1BQU1DLGlCQUFpQixNQUFNQyxRQUFRQyxVQUFVLENBQUNYO1lBQ2hELE1BQU1ZLFdBQTJCLEVBQUU7WUFFbkMsS0FBSyxNQUFNQyxVQUFVSixlQUFnQjtnQkFDbkMsSUFBSUksT0FBT0MsTUFBTSxLQUFLLGFBQWE7b0JBQ2pDRixTQUFTRyxJQUFJLElBQUlGLE9BQU9HLEtBQUs7Z0JBQy9CO1lBQ0Y7WUFFQTdDLDRDQUFHQSxDQUFDZSxJQUFJLENBQUMsb0NBQW9DO2dCQUMzQytCLFlBQVlMLFNBQVNsQixNQUFNO2dCQUMzQndCLG1CQUFtQnBCLFlBQVlKLE1BQU07WUFDdkM7WUFFQSxPQUFPa0I7UUFFVCxFQUFFLE9BQU9SLE9BQU87WUFDZGpDLDRDQUFHQSxDQUFDaUMsS0FBSyxDQUFDLHFDQUFxQ0EsT0FBZ0I7Z0JBQUVwQjtZQUFNO1lBQ3ZFLE9BQU8sSUFBSSxDQUFDVyxlQUFlLENBQUNYLE9BQU9DO1FBQ3JDO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE1BQWNJLHdCQUF3QkwsS0FBYSxFQUFFQyxRQUEyQixFQUs3RTtRQUNELElBQUk7WUFDRixNQUFNa0MsU0FBUyxJQUFJLENBQUNDLDJCQUEyQixDQUFDcEMsT0FBT0M7WUFDdkQsTUFBTW9DLFdBQVcsTUFBTSxJQUFJLENBQUN2QyxhQUFhLENBQUN3QyxZQUFZLENBQUNILFFBQVFJLFdBQVd0QztZQUUxRSxZQUFZO1lBQ1osTUFBTXVDLFNBQVNuRCxvRUFBYUEsQ0FBQ2dELFVBQVU7Z0JBQ3JDSSxVQUFVLElBQUksQ0FBQ0Msb0JBQW9CLENBQUMxQztnQkFDcEMyQyxZQUFZLEVBQUU7Z0JBQ2RDLGVBQWUsRUFBRTtnQkFDakJDLE1BQU0sRUFBRTtZQUNWO1lBRUEsT0FBTztnQkFDTEosVUFBVUQsT0FBT0MsUUFBUSxJQUFJLEVBQUU7Z0JBQy9CRSxZQUFZSCxPQUFPRyxVQUFVLElBQUksRUFBRTtnQkFDbkNDLGVBQWVKLE9BQU9JLGFBQWEsSUFBSSxFQUFFO2dCQUN6Q0MsTUFBTUwsT0FBT0ssSUFBSSxJQUFJLEVBQUU7WUFDekI7UUFDRixFQUFFLE9BQU96QixPQUFPO1lBQ2RqQyw0Q0FBR0EsQ0FBQ2tDLElBQUksQ0FBQywrQ0FBK0M7Z0JBQ3RERCxPQUFPLE1BQWlCSSxPQUFPO2dCQUMvQnNCLFVBQVU7WUFDWjtZQUVBLE9BQU87Z0JBQ0xMLFVBQVUsSUFBSSxDQUFDQyxvQkFBb0IsQ0FBQzFDO2dCQUNwQzJDLFlBQVksRUFBRTtnQkFDZEMsZUFBZSxFQUFFO2dCQUNqQkMsTUFBTSxFQUFFO1lBQ1Y7UUFDRjtJQUNGO0lBRVFULDRCQUE0QnBDLEtBQWEsRUFBRUMsUUFBMkIsRUFBVTtRQUN0RixNQUFNOEMsVUFBVTtZQUNkQyxJQUFJLENBQUM7OztVQUdELEVBQUVoRCxNQUFNOzs7Ozs7Ozs7Ozs7Ozs7Q0FlakIsQ0FBQztZQUNJaUQsSUFBSSxDQUFDOzs7Z0JBR0ssRUFBRWpELE1BQU07Ozs7Ozs7Ozs7Ozs7O0NBY3ZCLENBQUM7UUFDRTtRQUVBLE9BQU8rQyxPQUFPLENBQUM5QyxTQUFpQyxJQUFJOEMsUUFBUUMsRUFBRTtJQUNoRTtJQUVBOztHQUVDLEdBQ0QscUJBQTZCaEQsS0FBYSxFQUFZO1FBQ3BELGNBQWM7UUFDZCxNQUFNeUMsV0FBV3pDLE1BQ2RrRCxPQUFPLENBQUMsaUJBQWlCLEtBQ3pCQyxLQUFLLENBQUMsT0FDTkMsTUFBTSxDQUFDQyxDQUFBQSxPQUFRQSxLQUFLM0MsTUFBTSxHQUFHLEdBQzdCMEMsTUFBTSxDQUFDQyxDQUFBQSxPQUFRLENBQUM7Z0JBQUM7Z0JBQVE7Z0JBQVE7Z0JBQVE7Z0JBQVE7Z0JBQU07Z0JBQU07YUFBTSxDQUFDQyxRQUFRLENBQUNEO1FBRWhGLE9BQU87ZUFBSSxJQUFJRSxJQUFJZDtTQUFVLEVBQUUsT0FBTztJQUN4QztJQUVBOztHQUVDLEdBQ0QsTUFBY2pDLGVBQWVKLFlBSzVCLEVBQTBCO1FBQ3pCLE1BQU1vRCxXQUFXQyxLQUFLQyxTQUFTLENBQUN0RDtRQUVoQyxZQUFZO1FBQ1osSUFBSSxJQUFJLENBQUNWLFlBQVksQ0FBQ2lFLEdBQUcsQ0FBQ0gsYUFDdEIsSUFBSSxDQUFDNUQsV0FBVyxDQUFDZ0UsR0FBRyxDQUFDSixZQUFhSyxLQUFLQyxHQUFHLElBQUk7WUFDaEQzRSw0Q0FBR0EsQ0FBQ21CLEtBQUssQ0FBQztZQUNWLE9BQU8sSUFBSSxDQUFDWixZQUFZLENBQUNrRSxHQUFHLENBQUNKO1FBQy9CO1FBRUEsSUFBSTtZQUNGLDZCQUE2QjtZQUM3QixNQUFNTyxjQUFjLElBQUksQ0FBQ0MsY0FBYyxDQUFDNUQ7WUFDeEMsTUFBTTZELE1BQU0sQ0FBQyxFQUFFLElBQUksQ0FBQ3hFLFVBQVUsQ0FBQyxzQkFBc0IsQ0FBQztZQUV0RCxNQUFNNEMsV0FBVyxNQUFNbkQsNkNBQUtBLENBQUMwRSxHQUFHLENBQXFCSyxLQUFLO2dCQUN4REMsUUFBUTtvQkFDTkMsR0FBR0o7b0JBQ0hLLE1BQU07b0JBQ05DLE9BQU87b0JBQ1BDLE1BQU07Z0JBQ1I7Z0JBQ0FDLFNBQVM7Z0JBQ1RDLFNBQVM7b0JBQ1AsY0FBYztnQkFDaEI7Z0JBQ0EsNENBQTRDO2dCQUM1Q0MsZ0JBQWdCLENBQUMzQyxTQUFXQSxTQUFTO1lBQ3ZDO1lBRUEsSUFBSU8sU0FBU3FDLElBQUksQ0FBQ0MsT0FBTyxJQUFJdEMsU0FBU3FDLElBQUksQ0FBQzdDLE1BQU0sQ0FBQytDLE9BQU8sRUFBRTtnQkFDekQsTUFBTXJFLFdBQVc4QixTQUFTcUMsSUFBSSxDQUFDN0MsTUFBTSxDQUFDK0MsT0FBTztnQkFFN0MsV0FBVztnQkFDWCxJQUFJLENBQUNsRixZQUFZLENBQUNtRixHQUFHLENBQUNyQixVQUFVakQ7Z0JBQ2hDLElBQUksQ0FBQ1gsV0FBVyxDQUFDaUYsR0FBRyxDQUFDckIsVUFBVUssS0FBS0MsR0FBRyxLQUFLLElBQUksQ0FBQ2pFLFNBQVM7Z0JBRTFEViw0Q0FBR0EsQ0FBQ2UsSUFBSSxDQUFDLHlCQUF5QjtvQkFDaENGLE9BQU8rRDtvQkFDUGUsWUFBWXpDLFNBQVNxQyxJQUFJLENBQUM3QyxNQUFNLENBQUNwQixLQUFLO29CQUN0Q3NFLGVBQWV4RSxTQUFTRyxNQUFNO2dCQUNoQztnQkFFQSxPQUFPSDtZQUNULE9BQU87Z0JBQ0wsTUFBTSxJQUFJeUUsTUFBTTtZQUNsQjtRQUNGLEVBQUUsT0FBTzVELE9BQU87WUFDZGpDLDRDQUFHQSxDQUFDaUMsS0FBSyxDQUFDLDhCQUE4QkEsT0FBZ0I7Z0JBQUVoQjtZQUFhO1lBQ3ZFLE9BQU8sRUFBRTtRQUNYO0lBQ0Y7SUFFUTRELGVBQWU1RCxZQUt0QixFQUFVO1FBQ1QsZ0JBQWdCO1FBQ2hCLElBQUlBLGFBQWF1QyxVQUFVLENBQUNqQyxNQUFNLEdBQUcsR0FBRztZQUN0QyxPQUFPLENBQUMsUUFBUSxFQUFFTixhQUFhdUMsVUFBVSxDQUFDc0MsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzNEO1FBRUEsNkJBQTZCO1FBQzdCLE9BQU87SUFDVDtJQUVBOztHQUVDLEdBQ0QsTUFBY3BFLHdCQUNaTixRQUF1QixFQUN2QlAsS0FBYSxFQUNiQyxRQUEyQixFQUNIO1FBQ3hCLHVEQUF1RDtRQUN2RCxNQUFNaUYsaUJBQWlCM0UsU0FBU1EsS0FBSyxDQUFDLEdBQUc7UUFFekMsSUFBSTtZQUNGLHlCQUF5QjtZQUN6QixNQUFNb0UsbUJBQW1CRCxlQUFlakUsR0FBRyxDQUFDLENBQUNDLFNBQVNrRSxRQUFXO29CQUMvREE7b0JBQ0E3RCxJQUFJTCxRQUFRSyxFQUFFO29CQUNkOEQsT0FBT25FLFFBQVFtRSxLQUFLO29CQUNwQkMsYUFBYXBFLFFBQVFxRSxLQUFLLEVBQUVwRixVQUFVLEdBQUcsUUFBUTtvQkFDakQwQyxNQUFNM0IsUUFBUTJCLElBQUksQ0FBQzVCLEdBQUcsQ0FBQ3VFLENBQUFBLE1BQU9BLElBQUlDLElBQUksRUFBRVIsSUFBSSxDQUFDO29CQUM3Q1MsY0FBY3hFLFFBQVF3RSxZQUFZLEVBQUVMLFNBQVM7Z0JBQy9DO1lBRUEsdURBQXVEO1lBQ3ZELE1BQU1NLGlCQUFpQixJQUFJLENBQUNDLGdCQUFnQixDQUFDNUYsT0FBT21GLGtCQUFrQmxGO1lBQ3RFLE1BQU00RixpQkFBaUIsSUFBSW5FLFFBQXVCLENBQUNvRSxHQUFHQyxTQUNwREMsV0FBVyxJQUFNRCxPQUFPLElBQUlmLE1BQU0sd0JBQXdCO1lBRzVELE1BQU1pQixpQkFBaUIsTUFBTXZFLFFBQVF3RSxJQUFJLENBQUM7Z0JBQUNQO2dCQUFnQkU7YUFBZTtZQUUxRSxnREFBZ0Q7WUFDaEQsTUFBTU0sb0JBQW9CNUYsU0FBU1EsS0FBSyxDQUFDO1lBQ3pDLE9BQU87bUJBQUlrRjttQkFBbUJFO2FBQWtCO1FBRWxELEVBQUUsT0FBTy9FLE9BQU87WUFDZGpDLDRDQUFHQSxDQUFDa0MsSUFBSSxDQUFDLG1DQUFtQztnQkFDMUNELE9BQU8sTUFBaUJJLE9BQU87WUFDakM7WUFFQSxnQkFBZ0I7WUFDaEIsT0FBT2pCO1FBQ1Q7SUFDRjtJQUVBLE1BQWNxRixpQkFDWjVGLEtBQWEsRUFDYm1GLGdCQUFrQyxFQUNsQ2xGLFFBQTJCLEVBQ0g7UUFDeEIsTUFBTWtDLFNBQVMsSUFBSSxDQUFDaUUsa0JBQWtCLENBQUNwRyxPQUFPbUYsa0JBQWtCbEY7UUFDaEUsTUFBTW9DLFdBQVcsTUFBTSxJQUFJLENBQUN2QyxhQUFhLENBQUN3QyxZQUFZLENBQUNILFFBQVFJLFdBQVd0QztRQUUxRSxZQUFZO1FBQ1osTUFBTW9HLFVBQVVoSCxvRUFBYUEsQ0FBQ2dELFVBQVUsRUFBRTtRQUUxQyxJQUFJaUUsTUFBTUMsT0FBTyxDQUFDRixZQUFZQSxRQUFRM0YsTUFBTSxHQUFHLEdBQUc7WUFDaEQsd0JBQXdCO1lBQ3hCLE1BQU11RixpQkFBaUJJLFFBQ3BCakQsTUFBTSxDQUFDb0QsQ0FBQUEsT0FBUSxPQUFPQSxLQUFLcEIsS0FBSyxLQUFLLFlBQVlvQixLQUFLcEIsS0FBSyxHQUFHRCxpQkFBaUJ6RSxNQUFNLEVBQ3JGTyxHQUFHLENBQUN1RixDQUFBQSxPQUFRckIsZ0JBQWdCLENBQUNxQixLQUFLcEIsS0FBSyxDQUFDO1lBRTNDLE9BQU9hO1FBQ1Q7UUFFQSxPQUFPZDtJQUNUO0lBRVFpQixtQkFDTnBHLEtBQWEsRUFDYm1GLGdCQUFrQyxFQUNsQ2xGLFFBQTJCLEVBQ25CO1FBQ1IsTUFBTThDLFVBQVU7WUFDZEMsSUFBSSxDQUFDO1VBQ0QsRUFBRWhELE1BQU07Ozs7O0FBS2xCLEVBQUVtRixpQkFBaUJsRSxHQUFHLENBQUMsQ0FBQ0MsU0FBU3VGLElBQy9CLENBQUMsRUFBRUEsRUFBRSxFQUFFLEVBQUV2RixRQUFRbUUsS0FBSyxDQUFDLE1BQU0sRUFBRW5FLFFBQVFvRSxXQUFXLENBQUMsTUFBTSxFQUFFcEUsUUFBUTJCLElBQUksQ0FBQyxNQUFNLEVBQUUzQixRQUFRd0UsWUFBWSxDQUFDLENBQUMsRUFDdEdULElBQUksQ0FBQyxRQUFROzs7Ozs7Q0FNZCxDQUFDO1lBQ0loQyxJQUFJLENBQUM7Z0JBQ0ssRUFBRWpELE1BQU07Ozs7O0FBS3hCLEVBQUVtRixpQkFBaUJsRSxHQUFHLENBQUMsQ0FBQ0MsU0FBU3VGLElBQy9CLENBQUMsRUFBRUEsRUFBRSxFQUFFLEVBQUV2RixRQUFRbUUsS0FBSyxDQUFDLGVBQWUsRUFBRW5FLFFBQVFvRSxXQUFXLENBQUMsUUFBUSxFQUFFcEUsUUFBUTJCLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTNCLFFBQVF3RSxZQUFZLENBQUMsQ0FBQyxFQUMzSFQsSUFBSSxDQUFDLFFBQVE7Ozs7OztDQU1kLENBQUM7UUFDRTtRQUVBLE9BQU9sQyxPQUFPLENBQUM5QyxTQUFpQyxJQUFJOEMsUUFBUUMsRUFBRTtJQUNoRTtJQUVBOztHQUVDLEdBQ0QsTUFBYzdCLGVBQ1pELE9BQW9CLEVBQ3BCd0YsYUFBcUIsRUFDckJ6RyxRQUEyQixFQUNGO1FBQ3pCLE1BQU0wRyxRQUF3QixFQUFFO1FBRWhDLElBQUk7WUFDRixrQkFBa0I7WUFDbEIsTUFBTUMsY0FBYyxJQUFJLENBQUNDLHdCQUF3QixDQUFDM0YsU0FBU2pCO1lBQzNEMEcsTUFBTTVFLElBQUksQ0FBQzZFO1lBRVgsb0JBQW9CO1lBQ3BCLE1BQU1FLHVCQUF1QjVGLFFBQVE2RixTQUFTLENBQUMzRCxNQUFNLENBQUM0RCxDQUFBQSxXQUNwRCxJQUFJLENBQUNDLGlCQUFpQixDQUFDRCxTQUFTRSxNQUFNO1lBR3hDLEtBQUssTUFBTUYsWUFBWUYscUJBQXFCL0YsS0FBSyxDQUFDLEdBQUcsR0FBSTtnQkFDdkQsSUFBSTtvQkFDRixNQUFNb0csZ0JBQWdCLE1BQU0sSUFBSSxDQUFDQyxlQUFlLENBQUNKLFVBQVU5RixTQUFTd0YsZUFBZXpHO29CQUNuRjBHLE1BQU01RSxJQUFJLElBQUlvRjtnQkFDaEIsRUFBRSxPQUFPL0YsT0FBTztvQkFDZGpDLDRDQUFHQSxDQUFDa0MsSUFBSSxDQUFDLDhCQUE4Qjt3QkFDckNnRyxZQUFZTCxTQUFTekYsRUFBRTt3QkFDdkIyRixRQUFRRixTQUFTRSxNQUFNO3dCQUN2QjlGLE9BQU8sTUFBaUJJLE9BQU87b0JBQ2pDO2dCQUNGO1lBQ0Y7WUFFQSxPQUFPbUY7UUFDVCxFQUFFLE9BQU92RixPQUFPO1lBQ2RqQyw0Q0FBR0EsQ0FBQ2lDLEtBQUssQ0FBQyw2QkFBNkJBLE9BQWdCO2dCQUNyREUsV0FBV0osUUFBUUssRUFBRTtZQUN2QjtZQUNBLE9BQU8sRUFBRTtRQUNYO0lBQ0Y7SUFFUXNGLHlCQUF5QjNGLE9BQW9CLEVBQUVqQixRQUEyQixFQUFnQjtRQUNoRyxNQUFNcUgsV0FBVyxJQUFJLENBQUNDLGVBQWUsQ0FBQ3JHO1FBQ3RDLE1BQU0yQixPQUFPM0IsUUFBUTJCLElBQUksQ0FBQzVCLEdBQUcsQ0FBQ3VFLENBQUFBLE1BQU9BLElBQUlDLElBQUk7UUFFN0MsT0FBTztZQUNMbEUsSUFBSSxDQUFDLEVBQUVMLFFBQVFLLEVBQUUsQ0FBQyxRQUFRLENBQUM7WUFDM0I4RCxPQUFPbkUsUUFBUW1FLEtBQUs7WUFDcEJDLGFBQWFwRSxRQUFRcUUsS0FBSyxJQUFJO1lBQzlCK0IsVUFBVUE7WUFDVnpFLE1BQU07bUJBQUlBO2dCQUFNO2dCQUFPO2FBQVU7WUFDakMyRSxTQUFTLElBQUksQ0FBQ0MsNkJBQTZCLENBQUN2RyxTQUFTakI7WUFDckR5SCxVQUFVO2dCQUNSQyxRQUFRLENBQUMsWUFBWSxFQUFFekcsUUFBUW1FLEtBQUssQ0FBQyxDQUFDO2dCQUN0Q3VDLGFBQWEsSUFBSS9ELEtBQUszQyxRQUFRMkcsaUJBQWlCLElBQUkzRyxRQUFRNEcsZ0JBQWdCO2dCQUMzRTdIO2dCQUNBcUIsV0FBV0osUUFBUUssRUFBRTtnQkFDckJtRSxjQUFjeEUsUUFBUXdFLFlBQVksRUFBRUw7Z0JBQ3BDMEMsU0FBUzdHLFFBQVE4RyxhQUFhO1lBQ2hDO1FBQ0Y7SUFDRjtJQUVRUCw4QkFBOEJ2RyxPQUFvQixFQUFFakIsUUFBMkIsRUFBVTtRQUMvRixNQUFNZ0ksWUFBWTtZQUNoQmpGLElBQUksQ0FBQyxFQUFFLEVBQUU5QixRQUFRbUUsS0FBSyxDQUFDOzs7QUFHN0IsRUFBRW5FLFFBQVFxRSxLQUFLLElBQUksMEJBQTBCOzs7WUFHakMsRUFBRXJFLFFBQVF3RSxZQUFZLEVBQUVMLFNBQVMsTUFBTTtZQUN2QyxFQUFFLElBQUl4QixLQUFLM0MsUUFBUTJHLGlCQUFpQixJQUFJM0csUUFBUTRHLGdCQUFnQixFQUFFSSxrQkFBa0IsQ0FBQyxTQUFTO2FBQzdGLEVBQUVoSCxRQUFROEcsYUFBYSxJQUFJLE1BQU07VUFDcEMsRUFBRTlHLFFBQVEyQixJQUFJLENBQUM1QixHQUFHLENBQUN1RSxDQUFBQSxNQUFPQSxJQUFJQyxJQUFJLEVBQUVSLElBQUksQ0FBQyxLQUFLOzs7QUFHeEQsRUFBRS9ELFFBQVE2RixTQUFTLENBQUM5RixHQUFHLENBQUMrRixDQUFBQSxXQUN0QixDQUFDLEVBQUUsRUFBRUEsU0FBU3ZCLElBQUksSUFBSSxVQUFVLEVBQUUsRUFBRXVCLFNBQVNFLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFDdERqQyxJQUFJLENBQUMsTUFBTTs7K0JBRWtCLENBQUM7WUFDMUJoQyxJQUFJLENBQUMsRUFBRSxFQUFFL0IsUUFBUW1FLEtBQUssQ0FBQzs7O0FBRzdCLEVBQUVuRSxRQUFRcUUsS0FBSyxJQUFJLHFEQUFxRDs7O29CQUdwRCxFQUFFckUsUUFBUXdFLFlBQVksRUFBRUwsU0FBUyxnQ0FBZ0M7b0JBQ2pFLEVBQUUsSUFBSXhCLEtBQUszQyxRQUFRMkcsaUJBQWlCLElBQUkzRyxRQUFRNEcsZ0JBQWdCLEVBQUVJLGtCQUFrQixDQUFDLFNBQVM7ZUFDbkcsRUFBRWhILFFBQVE4RyxhQUFhLElBQUksZ0JBQWdCO1lBQzlDLEVBQUU5RyxRQUFRMkIsSUFBSSxDQUFDNUIsR0FBRyxDQUFDdUUsQ0FBQUEsTUFBT0EsSUFBSUMsSUFBSSxFQUFFUixJQUFJLENBQUMsTUFBTTs7O0FBRzNELEVBQUUvRCxRQUFRNkYsU0FBUyxDQUFDOUYsR0FBRyxDQUFDK0YsQ0FBQUEsV0FDdEIsQ0FBQyxFQUFFLEVBQUVBLFNBQVN2QixJQUFJLElBQUksWUFBWSxFQUFFLEVBQUV1QixTQUFTRSxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQ3hEakMsSUFBSSxDQUFDLE1BQU07O2lEQUVvQyxDQUFDO1FBQzlDO1FBRUEsT0FBT2dELFNBQVMsQ0FBQ2hJLFNBQW1DLElBQUlnSSxVQUFVakYsRUFBRTtJQUN0RTtJQUVBLE1BQWNvRSxnQkFDWkosUUFBYSxFQUNiOUYsT0FBb0IsRUFDcEJ3RixhQUFxQixFQUNyQnpHLFFBQTJCLEVBQ0Y7UUFDekIsSUFBSTtZQUNGLE1BQU1vQyxXQUFXLE1BQU1uRCw2Q0FBS0EsQ0FBQzBFLEdBQUcsQ0FBQ29ELFNBQVMvQyxHQUFHLEVBQUU7Z0JBQzdDTSxTQUFTO2dCQUNUNEQsa0JBQWtCLEtBQUssT0FBTztnQkFDOUIzRCxTQUFTO29CQUNQLGNBQWM7Z0JBQ2hCO1lBQ0Y7WUFFQSxPQUFPLElBQUksQ0FBQzRELDBCQUEwQixDQUNwQy9GLFNBQVNxQyxJQUFJLEVBQ2JzQyxVQUNBOUYsU0FDQXdGLGVBQ0F6RztRQUVKLEVBQUUsT0FBT21CLE9BQU87WUFDZGpDLDRDQUFHQSxDQUFDa0MsSUFBSSxDQUFDLGlDQUFpQztnQkFDeENnRyxZQUFZTCxTQUFTekYsRUFBRTtnQkFDdkIwQyxLQUFLK0MsU0FBUy9DLEdBQUc7Z0JBQ2pCN0MsT0FBTyxNQUFpQkksT0FBTztZQUNqQztZQUNBLE9BQU8sRUFBRTtRQUNYO0lBQ0Y7SUFFUTRHLDJCQUNOMUQsSUFBUyxFQUNUc0MsUUFBYSxFQUNiOUYsT0FBb0IsRUFDcEJ3RixhQUFxQixFQUNyQnpHLFFBQTJCLEVBQ1g7UUFDaEIsTUFBTTBHLFFBQXdCLEVBQUU7UUFFaEMsSUFBSTtZQUNGLElBQUlMLE1BQU1DLE9BQU8sQ0FBQzdCLFNBQVNBLEtBQUtoRSxNQUFNLEdBQUcsR0FBRztnQkFDMUMseUJBQXlCO2dCQUN6QixNQUFNMkgsa0JBQWtCLElBQUksQ0FBQ0MsbUJBQW1CLENBQUM1RCxNQUFNZ0M7Z0JBRXZEMkIsZ0JBQWdCdEgsS0FBSyxDQUFDLEdBQUcsR0FBR3dILE9BQU8sQ0FBQyxDQUFDQyxPQUFPcEQ7b0JBQzFDLE1BQU1vQixPQUFPLElBQUksQ0FBQ2lDLHVCQUF1QixDQUN2Q0QsT0FDQXhCLFVBQ0E5RixTQUNBa0UsT0FDQW5GO29CQUVGMEcsTUFBTTVFLElBQUksQ0FBQ3lFO2dCQUNiO1lBQ0YsT0FBTyxJQUFJLE9BQU85QixTQUFTLFVBQVU7Z0JBQ25DLGVBQWU7Z0JBQ2YsTUFBTThCLE9BQU8sSUFBSSxDQUFDaUMsdUJBQXVCLENBQ3ZDL0QsTUFDQXNDLFVBQ0E5RixTQUNBLEdBQ0FqQjtnQkFFRjBHLE1BQU01RSxJQUFJLENBQUN5RTtZQUNiO1FBQ0YsRUFBRSxPQUFPcEYsT0FBTztZQUNkakMsNENBQUdBLENBQUNpQyxLQUFLLENBQUMsbUNBQW1DQSxPQUFnQjtnQkFDM0RpRyxZQUFZTCxTQUFTekYsRUFBRTtZQUN6QjtRQUNGO1FBRUEsT0FBT29GO0lBQ1Q7SUFFUTJCLG9CQUFvQjVELElBQVcsRUFBRTFFLEtBQWEsRUFBUztRQUM3RCxNQUFNMEksYUFBYTFJLE1BQU0ySSxXQUFXLEdBQUd4RixLQUFLLENBQUM7UUFFN0MsT0FBT3VCLEtBQ0p6RCxHQUFHLENBQUN1SCxDQUFBQTtZQUNILElBQUlJLFFBQVE7WUFDWixNQUFNQyxZQUFZcEYsS0FBS0MsU0FBUyxDQUFDOEUsT0FBT0csV0FBVztZQUVuREQsV0FBV0gsT0FBTyxDQUFDbEYsQ0FBQUE7Z0JBQ2pCLElBQUl3RixVQUFVdkYsUUFBUSxDQUFDRCxPQUFPO29CQUM1QnVGLFNBQVM7Z0JBQ1g7WUFDRjtZQUVBLE9BQU87Z0JBQUVKO2dCQUFPSTtZQUFNO1FBQ3hCLEdBQ0N4RixNQUFNLENBQUNvRCxDQUFBQSxPQUFRQSxLQUFLb0MsS0FBSyxHQUFHLEdBQzVCdEUsSUFBSSxDQUFDLENBQUN3RSxHQUFHQyxJQUFNQSxFQUFFSCxLQUFLLEdBQUdFLEVBQUVGLEtBQUssRUFDaEMzSCxHQUFHLENBQUN1RixDQUFBQSxPQUFRQSxLQUFLZ0MsS0FBSztJQUMzQjtJQUVRQyx3QkFDTkQsS0FBVSxFQUNWeEIsUUFBYSxFQUNiOUYsT0FBb0IsRUFDcEJrRSxLQUFhLEVBQ2JuRixRQUEyQixFQUNiO1FBQ2QsTUFBTW9GLFFBQVEsSUFBSSxDQUFDMkQsaUJBQWlCLENBQUNSLE9BQU90SCxRQUFRbUUsS0FBSztRQUN6RCxNQUFNQyxjQUFjLElBQUksQ0FBQzJELHVCQUF1QixDQUFDVCxPQUFPeEIsU0FBUzFCLFdBQVc7UUFDNUUsTUFBTWtDLFVBQVUsSUFBSSxDQUFDMEIsa0JBQWtCLENBQUNWLE9BQU92STtRQUMvQyxNQUFNcUgsV0FBVyxJQUFJLENBQUNDLGVBQWUsQ0FBQ3JHO1FBRXRDLE9BQU87WUFDTEssSUFBSSxDQUFDLEVBQUVMLFFBQVFLLEVBQUUsQ0FBQyxDQUFDLEVBQUV5RixTQUFTekYsRUFBRSxDQUFDLENBQUMsRUFBRTZELE1BQU0sQ0FBQztZQUMzQ0M7WUFDQUM7WUFDQWdDLFVBQVVBO1lBQ1Z6RSxNQUFNO21CQUFJM0IsUUFBUTJCLElBQUksQ0FBQzVCLEdBQUcsQ0FBQ3VFLENBQUFBLE1BQU9BLElBQUlDLElBQUk7Z0JBQUc7YUFBVTtZQUN2RCtCO1lBQ0FFLFVBQVU7Z0JBQ1JDLFFBQVEsQ0FBQyxZQUFZLEVBQUV6RyxRQUFRbUUsS0FBSyxDQUFDLEdBQUcsRUFBRTJCLFNBQVN2QixJQUFJLENBQUMsQ0FBQztnQkFDekRtQyxhQUFhLElBQUkvRCxLQUFLbUQsU0FBU21DLGFBQWEsSUFBSWpJLFFBQVEyRyxpQkFBaUI7Z0JBQ3pFNUg7Z0JBQ0FxQixXQUFXSixRQUFRSyxFQUFFO2dCQUNyQjhGLFlBQVlMLFNBQVN6RixFQUFFO2dCQUN2Qm1FLGNBQWN4RSxRQUFRd0UsWUFBWSxFQUFFTDtZQUN0QztRQUNGO0lBQ0Y7SUFFUTJELGtCQUFrQlIsS0FBVSxFQUFFWSxZQUFvQixFQUFVO1FBQ2xFLE1BQU1DLGNBQWM7WUFBQztZQUFRO1lBQVM7WUFBTTtZQUFPO1lBQU87WUFBaUI7U0FBTTtRQUVqRixLQUFLLE1BQU1DLFNBQVNELFlBQWE7WUFDL0IsSUFBSWIsS0FBSyxDQUFDYyxNQUFNLElBQUksT0FBT2QsS0FBSyxDQUFDYyxNQUFNLEtBQUssVUFBVTtnQkFDcEQsT0FBTyxDQUFDLEVBQUVGLGFBQWEsR0FBRyxFQUFFWixLQUFLLENBQUNjLE1BQU0sQ0FBQ25KLFNBQVMsQ0FBQyxHQUFHLElBQUksQ0FBQztZQUM3RDtRQUNGO1FBRUEsVUFBVTtRQUNWLE1BQU1vSixtQkFBbUJDLE9BQU9DLE1BQU0sQ0FBQ2pCLE9BQU9rQixJQUFJLENBQUMxSCxDQUFBQSxRQUNqRCxPQUFPQSxVQUFVLFlBQVlBLE1BQU0ySCxJQUFJLEdBQUdqSixNQUFNLEdBQUc7UUFHckQsSUFBSTZJLGtCQUFrQjtZQUNwQixPQUFPLENBQUMsRUFBRUgsYUFBYSxHQUFHLEVBQUVHLGlCQUFpQnBKLFNBQVMsQ0FBQyxHQUFHLElBQUksQ0FBQztRQUNqRTtRQUVBLE9BQU8sQ0FBQyxFQUFFaUosYUFBYSxVQUFVLENBQUM7SUFDcEM7SUFFUUgsd0JBQXdCVCxLQUFVLEVBQUVvQixtQkFBMkIsRUFBVTtRQUMvRSxNQUFNQyxhQUFhO1lBQUM7WUFBZTtZQUFXO1lBQU07WUFBTTtTQUFVO1FBRXBFLEtBQUssTUFBTVAsU0FBU08sV0FBWTtZQUM5QixJQUFJckIsS0FBSyxDQUFDYyxNQUFNLElBQUksT0FBT2QsS0FBSyxDQUFDYyxNQUFNLEtBQUssVUFBVTtnQkFDcEQsT0FBT2QsS0FBSyxDQUFDYyxNQUFNLENBQUNuSixTQUFTLENBQUMsR0FBRztZQUNuQztRQUNGO1FBRUEsT0FBT3lKLHVCQUF1QjtJQUNoQztJQUVRVixtQkFBbUJWLEtBQVUsRUFBRXZJLFFBQTJCLEVBQVU7UUFDMUUsTUFBTWdJLFlBQVk7WUFDaEJqRixJQUFJO1lBQ0pDLElBQUk7UUFDTjtRQUVBLElBQUl1RSxVQUFVUyxTQUFTLENBQUNoSSxTQUFtQyxJQUFJZ0ksVUFBVWpGLEVBQUU7UUFFM0V3RyxPQUFPTSxPQUFPLENBQUN0QixPQUFPRCxPQUFPLENBQUMsQ0FBQyxDQUFDd0IsS0FBSy9ILE1BQU07WUFDekMsSUFBSUEsVUFBVSxRQUFRQSxVQUFVTyxhQUFhUCxVQUFVLElBQUk7Z0JBQ3pEd0YsV0FBVyxDQUFDLEVBQUUsRUFBRXVDLElBQUksSUFBSSxFQUFFL0gsTUFBTSxFQUFFLENBQUM7WUFDckM7UUFDRjtRQUVBLE9BQU93RixXQUFXO0lBQ3BCO0lBRVFELGdCQUFnQnJHLE9BQW9CLEVBQVU7UUFDcEQsa0JBQWtCO1FBQ2xCLElBQUlBLFFBQVE4SSxNQUFNLElBQUk5SSxRQUFROEksTUFBTSxDQUFDdEosTUFBTSxHQUFHLEdBQUc7WUFDL0MsT0FBT1EsUUFBUThJLE1BQU0sQ0FBQyxFQUFFLENBQUMzRSxLQUFLLElBQUluRSxRQUFROEksTUFBTSxDQUFDLEVBQUUsQ0FBQ3ZFLElBQUk7UUFDMUQ7UUFFQSxjQUFjO1FBQ2QsTUFBTXdFLG1CQUFtQjtZQUN2QixPQUFPO2dCQUFDO2dCQUFPO2dCQUFNO2dCQUFNO2FBQUs7WUFDaEMsTUFBTTtnQkFBQztnQkFBTTtnQkFBTTthQUFLO1lBQ3hCLE1BQU07Z0JBQUM7Z0JBQU07Z0JBQU07YUFBTTtZQUN6QixNQUFNO2dCQUFDO2dCQUFNO2dCQUFNO2FBQUs7WUFDeEIsTUFBTTtnQkFBQztnQkFBTTtnQkFBTTthQUFLO1lBQ3hCLE1BQU07Z0JBQUM7Z0JBQU07Z0JBQU07YUFBSztZQUN4QixNQUFNO2dCQUFDO2dCQUFNO2dCQUFNO2FBQUs7WUFDeEIsTUFBTTtnQkFBQztnQkFBTTtnQkFBTTthQUFPO1FBQzVCO1FBRUEsTUFBTXBILE9BQU8zQixRQUFRMkIsSUFBSSxDQUFDNUIsR0FBRyxDQUFDdUUsQ0FBQUEsTUFBT0EsSUFBSUMsSUFBSSxFQUFFUixJQUFJLENBQUM7UUFDcEQsTUFBTWlGLE9BQU8sQ0FBQyxFQUFFaEosUUFBUW1FLEtBQUssQ0FBQyxDQUFDLEVBQUVuRSxRQUFRcUUsS0FBSyxDQUFDLENBQUMsRUFBRTFDLEtBQUssQ0FBQyxDQUFDOEYsV0FBVztRQUVwRSxLQUFLLE1BQU0sQ0FBQ3JCLFVBQVU3RSxTQUFTLElBQUkrRyxPQUFPTSxPQUFPLENBQUNHLGtCQUFtQjtZQUNuRSxJQUFJeEgsU0FBUzBILElBQUksQ0FBQ0MsQ0FBQUEsVUFBV0YsS0FBSzVHLFFBQVEsQ0FBQzhHLFdBQVc7Z0JBQ3BELE9BQU85QztZQUNUO1FBQ0Y7UUFFQSxPQUFPO0lBQ1Q7SUFFUUwsa0JBQWtCQyxNQUFjLEVBQVc7UUFDakQsTUFBTW1ELG1CQUFtQjtZQUFDO1lBQVE7WUFBTztZQUFPO1lBQU87U0FBTztRQUM5RCxPQUFPQSxpQkFBaUIvRyxRQUFRLENBQUM0RCxRQUFRb0Q7SUFDM0M7SUFFUTNKLGdCQUFnQlgsS0FBYSxFQUFFQyxRQUEyQixFQUFrQjtRQUNsRixNQUFNZ0ksWUFBWTtZQUNoQmpGLElBQUk7Z0JBQ0ZxQyxPQUFPO2dCQUNQQyxhQUFhO2dCQUNia0MsU0FBUyxDQUFDLFlBQVksRUFBRXhILE1BQU07Ozs7Ozs7OzZDQVFPLENBQUM7WUFDeEM7WUFDQWlELElBQUk7Z0JBQ0ZvQyxPQUFPO2dCQUNQQyxhQUFhO2dCQUNia0MsU0FBUyxDQUFDLGlFQUFpRSxFQUFFeEgsTUFBTTs7Ozs7Ozs7MkVBUWhCLENBQUM7WUFDdEU7UUFDRjtRQUVBLE1BQU11SyxXQUFXdEMsU0FBUyxDQUFDaEksU0FBbUMsSUFBSWdJLFVBQVVqRixFQUFFO1FBRTlFLE9BQU87WUFBQztnQkFDTnpCLElBQUk7Z0JBQ0o4RCxPQUFPa0YsU0FBU2xGLEtBQUs7Z0JBQ3JCQyxhQUFhaUYsU0FBU2pGLFdBQVc7Z0JBQ2pDZ0MsVUFBVTtnQkFDVnpFLE1BQU07b0JBQUM7b0JBQU07aUJBQU07Z0JBQ25CMkUsU0FBUytDLFNBQVMvQyxPQUFPO2dCQUN6QkUsVUFBVTtvQkFDUkMsUUFBUTtvQkFDUkMsYUFBYSxJQUFJL0Q7b0JBQ2pCNUQ7Z0JBQ0Y7WUFDRjtTQUFFO0lBQ0o7SUFFQTs7R0FFQyxHQUNELE1BQU11SywwQkFBaUQ7UUFDckQsSUFBSTtZQUNGLE1BQU12RyxNQUFNLENBQUMsRUFBRSxJQUFJLENBQUN4RSxVQUFVLENBQUMseUJBQXlCLENBQUM7WUFDekQsTUFBTTRDLFdBQVcsTUFBTW5ELDZDQUFLQSxDQUFDMEUsR0FBRyxDQUFDSyxLQUFLO2dCQUNwQ0MsUUFBUTtvQkFBRXVHLFlBQVk7Z0JBQUs7Z0JBQzNCbEcsU0FBUztZQUNYO1lBRUEsSUFBSWxDLFNBQVNxQyxJQUFJLENBQUNDLE9BQU8sSUFBSXRDLFNBQVNxQyxJQUFJLENBQUM3QyxNQUFNLEVBQUU7Z0JBQ2pELE9BQU9RLFNBQVNxQyxJQUFJLENBQUM3QyxNQUFNLENBQUNaLEdBQUcsQ0FBQyxDQUFDeUosTUFBYzt3QkFDN0NuSixJQUFJbUosSUFBSWpGLElBQUk7d0JBQ1pKLE9BQU9xRixJQUFJckYsS0FBSzt3QkFDaEJwQixLQUFLLENBQUMsRUFBRSxJQUFJLENBQUN6RSxjQUFjLENBQUMsY0FBYyxFQUFFa0wsSUFBSWpGLElBQUksQ0FBQyxDQUFDO3dCQUN0REgsYUFBYW9GLElBQUlwRixXQUFXLElBQUk7d0JBQ2hDZ0MsVUFBVTt3QkFDVk0sYUFBYSxJQUFJL0QsS0FBSzZHLElBQUlDLE9BQU87b0JBQ25DO1lBQ0Y7UUFDRixFQUFFLE9BQU92SixPQUFPO1lBQ2RqQyw0Q0FBR0EsQ0FBQ2lDLEtBQUssQ0FBQyxnQ0FBZ0NBO1FBQzVDO1FBRUEsT0FBTztZQUFDO2dCQUNORyxJQUFJO2dCQUNKOEQsT0FBTztnQkFDUHBCLEtBQUssSUFBSSxDQUFDekUsY0FBYztnQkFDeEI4RixhQUFhO2dCQUNiZ0MsVUFBVTtnQkFDVk0sYUFBYSxJQUFJL0Q7WUFDbkI7U0FBRTtJQUNKO0lBRUE7O0dBRUMsR0FDRCxNQUFNK0csaUJBQWlCdEQsUUFBZ0IsRUFBRXVELFFBQWdCLEVBQUUsRUFBMkI7UUFDcEYsTUFBTXpLLGVBQWU7WUFDbkJxQyxVQUFVLEVBQUU7WUFDWkUsWUFBWTtnQkFBQzJFO2FBQVM7WUFDdEIxRSxlQUFlLEVBQUU7WUFDakJDLE1BQU0sRUFBRTtRQUNWO1FBRUEsTUFBTXRDLFdBQVcsTUFBTSxJQUFJLENBQUNDLGNBQWMsQ0FBQ0o7UUFDM0MsTUFBTXVHLFFBQXdCLEVBQUU7UUFFaEMsS0FBSyxNQUFNekYsV0FBV1gsU0FBU1EsS0FBSyxDQUFDLEdBQUcrSixLQUFLQyxHQUFHLENBQUNGLE9BQU8sS0FBTTtZQUM1RCxJQUFJO2dCQUNGLE1BQU1HLGVBQWUsTUFBTSxJQUFJLENBQUM3SixjQUFjLENBQUNELFNBQVNvRyxVQUFVO2dCQUNsRVgsTUFBTTVFLElBQUksSUFBSWlKO1lBQ2hCLEVBQUUsT0FBTzVKLE9BQU87Z0JBQ2RqQyw0Q0FBR0EsQ0FBQ2tDLElBQUksQ0FBQyxnREFBZ0Q7b0JBQ3ZEQyxXQUFXSixRQUFRSyxFQUFFO29CQUNyQitGO29CQUNBbEcsT0FBTyxNQUFpQkksT0FBTztnQkFDakM7WUFDRjtRQUNGO1FBRUEsT0FBT21GO0lBQ1Q7SUFFQTs7R0FFQyxHQUNELE1BQU1zRSxXQUtIO1FBQ0QsSUFBSTtZQUNGLGNBQWM7WUFDZCxNQUFNQyxnQkFBZ0IsTUFBTWhNLDZDQUFLQSxDQUFDMEUsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUNuRSxVQUFVLENBQUMsc0JBQXNCLENBQUMsRUFBRTtnQkFDaEZ5RSxRQUFRO29CQUFFQyxHQUFHO29CQUFPQyxNQUFNO2dCQUFFO2dCQUM1QkcsU0FBUztZQUNYO1lBRUEsTUFBTTRHLGdCQUFnQkQsY0FBY3hHLElBQUksQ0FBQzdDLE1BQU0sRUFBRXBCLFNBQVM7WUFFMUQsVUFBVTtZQUNWLE1BQU0ySyxjQUFjLE1BQU1sTSw2Q0FBS0EsQ0FBQzBFLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDbkUsVUFBVSxDQUFDLHlCQUF5QixDQUFDLEVBQUU7Z0JBQ2pGeUUsUUFBUTtvQkFBRXVHLFlBQVk7Z0JBQUs7Z0JBQzNCbEcsU0FBUztZQUNYO1lBRUEsTUFBTTNCLGdCQUFnQndJLFlBQVkxRyxJQUFJLENBQUM3QyxNQUFNLEVBQUVaLElBQUksQ0FBQ3lKLE1BQWM7b0JBQ2hFakYsTUFBTWlGLElBQUlqRixJQUFJO29CQUNkSixPQUFPcUYsSUFBSXJGLEtBQUs7b0JBQ2hCNUUsT0FBT2lLLElBQUlXLGFBQWEsSUFBSTtnQkFDOUIsT0FBTyxFQUFFO1lBRVQsT0FBTztnQkFDTEY7Z0JBQ0F4SSxZQUFZLEVBQUU7Z0JBQ2RDO2dCQUNBZ0YsYUFBYSxJQUFJL0Q7WUFDbkI7UUFDRixFQUFFLE9BQU96QyxPQUFPO1lBQ2RqQyw0Q0FBR0EsQ0FBQ2lDLEtBQUssQ0FBQyx1QkFBdUJBO1lBQ2pDLE9BQU87Z0JBQ0wrSixlQUFlO2dCQUNmeEksWUFBWSxFQUFFO2dCQUNkQyxlQUFlLEVBQUU7Z0JBQ2pCZ0YsYUFBYSxJQUFJL0Q7WUFDbkI7UUFDRjtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90b2t5by1vcGVuZGF0YS1oYWNrYXRob24vLi9zcmMvbGliL3NlcnZpY2VzL1Rva3lvT3BlbkRhdGFTZXJ2aWNlLnRzPzAxYzgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcbmltcG9ydCB7IE9wZW5EYXRhSXRlbSwgRGF0YVNvdXJjZSwgU3VwcG9ydGVkTGFuZ3VhZ2UsIE9wZW5EYXRhQ2F0ZWdvcnkgfSBmcm9tICdAL3R5cGVzJztcbmltcG9ydCB7IGxvZyB9IGZyb20gJ0AvbGliL2xvZ2dlcic7XG5pbXBvcnQgeyBHZW1pbmlTZXJ2aWNlIH0gZnJvbSAnLi9HZW1pbmlTZXJ2aWNlJztcbmltcG9ydCB7IHNhZmVKc29uUGFyc2UgfSBmcm9tICdAL2xpYi91dGlscy9qc29uUGFyc2VyJztcblxuaW50ZXJmYWNlIENLQU5EYXRhc2V0IHtcbiAgaWQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICB0aXRsZTogc3RyaW5nO1xuICBub3Rlczogc3RyaW5nO1xuICB0YWdzOiBBcnJheTx7IG5hbWU6IHN0cmluZzsgdm9jYWJ1bGFyeV9pZD86IHN0cmluZyB9PjtcbiAgZ3JvdXBzOiBBcnJheTx7IG5hbWU6IHN0cmluZzsgdGl0bGU6IHN0cmluZyB9PjtcbiAgb3JnYW5pemF0aW9uOiB7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHRpdGxlOiBzdHJpbmc7XG4gIH07XG4gIHJlc291cmNlczogQXJyYXk8e1xuICAgIGlkOiBzdHJpbmc7XG4gICAgdXJsOiBzdHJpbmc7XG4gICAgZm9ybWF0OiBzdHJpbmc7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgY3JlYXRlZDogc3RyaW5nO1xuICAgIGxhc3RfbW9kaWZpZWQ6IHN0cmluZztcbiAgfT47XG4gIG1ldGFkYXRhX2NyZWF0ZWQ6IHN0cmluZztcbiAgbWV0YWRhdGFfbW9kaWZpZWQ6IHN0cmluZztcbiAgbGljZW5zZV90aXRsZT86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIERhdGFzZXRTdW1tYXJ5IHtcbiAgaW5kZXg6IG51bWJlcjtcbiAgaWQ6IHN0cmluZztcbiAgdGl0bGU6IHN0cmluZztcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgdGFnczogc3RyaW5nO1xuICBvcmdhbml6YXRpb246IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIENLQU5TZWFyY2hSZXNwb25zZSB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIHJlc3VsdDoge1xuICAgIGNvdW50OiBudW1iZXI7XG4gICAgcmVzdWx0czogQ0tBTkRhdGFzZXRbXTtcbiAgICBmYWNldHM/OiBhbnk7XG4gIH07XG59XG5cbmV4cG9ydCBjbGFzcyBUb2t5b09wZW5EYXRhU2VydmljZSB7XG4gIHByaXZhdGUgY2F0YWxvZ0Jhc2VVcmwgPSAnaHR0cHM6Ly9jYXRhbG9nLmRhdGEubWV0cm8udG9reW8ubGcuanAnO1xuICBwcml2YXRlIGFwaUJhc2VVcmwgPSAnaHR0cHM6Ly9jYXRhbG9nLmRhdGEubWV0cm8udG9reW8ubGcuanAvYXBpLzMnO1xuICBwcml2YXRlIGdlbWluaVNlcnZpY2U6IEdlbWluaVNlcnZpY2U7XG4gIHByaXZhdGUgZGF0YXNldENhY2hlID0gbmV3IE1hcDxzdHJpbmcsIENLQU5EYXRhc2V0W10+KCk7XG4gIHByaXZhdGUgY2FjaGVFeHBpcnkgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICBwcml2YXRlIHJlYWRvbmx5IENBQ0hFX1RUTCA9IDMwICogNjAgKiAxMDAwOyAvLyAzMOWIhlxuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuZ2VtaW5pU2VydmljZSA9IG5ldyBHZW1pbmlTZXJ2aWNlKCk7XG4gIH1cblxuICAvKipcbiAgICog44Om44O844K244O844Gu6LOq5ZWP44Gr5Z+644Gl44GE44Gm6Zai6YCj44GZ44KL44Kq44O844OX44Oz44OH44O844K/44KS5YuV55qE44Gr5qSc57Si44O75Y+W5b6XXG4gICAqL1xuICBhc3luYyBmZXRjaFJlbGV2YW50RGF0YShxdWVyeTogc3RyaW5nLCBsYW5ndWFnZTogU3VwcG9ydGVkTGFuZ3VhZ2UgPSAnamEnKTogUHJvbWlzZTxPcGVuRGF0YUl0ZW1bXT4ge1xuICAgIHRyeSB7XG4gICAgICBsb2cuaW5mbygnU3RhcnRpbmcgZHluYW1pYyBvcGVuIGRhdGEgc2VhcmNoJywgeyBcbiAgICAgICAgcXVlcnk6IHF1ZXJ5LnN1YnN0cmluZygwLCAxMDApLFxuICAgICAgICBsYW5ndWFnZSBcbiAgICAgIH0pO1xuXG4gICAgICAvLyAxLiBBSeOCkuS9v+OBo+OBpuaknOe0ouOCreODvOODr+ODvOODieOBqOOCq+ODhuOCtOODquOCkuaKveWHulxuICAgICAgY29uc3Qgc2VhcmNoUGFyYW1zID0gYXdhaXQgdGhpcy5leHRyYWN0U2VhcmNoUGFyYW1ldGVycyhxdWVyeSwgbGFuZ3VhZ2UpO1xuICAgICAgbG9nLmRlYnVnKCdFeHRyYWN0ZWQgc2VhcmNoIHBhcmFtZXRlcnMnLCBzZWFyY2hQYXJhbXMpO1xuXG4gICAgICAvLyAyLiBDS0FOIEFQSeOBp+ODh+ODvOOCv+OCu+ODg+ODiOOCkuaknOe0olxuICAgICAgY29uc3QgZGF0YXNldHMgPSBhd2FpdCB0aGlzLnNlYXJjaERhdGFzZXRzKHNlYXJjaFBhcmFtcyk7XG4gICAgICBsb2cuaW5mbygnRm91bmQgZGF0YXNldHMnLCB7IGNvdW50OiBkYXRhc2V0cy5sZW5ndGggfSk7XG5cbiAgICAgIGlmIChkYXRhc2V0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RmFsbGJhY2tEYXRhKHF1ZXJ5LCBsYW5ndWFnZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIDMuIOmWoumAo+W6puOBp+OCveODvOODiOOBl+OBpuS4iuS9jeODh+ODvOOCv+OCu+ODg+ODiOOCkumBuOaKnlxuICAgICAgY29uc3QgcmVsZXZhbnREYXRhc2V0cyA9IGF3YWl0IHRoaXMucmFua0RhdGFzZXRzQnlSZWxldmFuY2UoZGF0YXNldHMsIHF1ZXJ5LCBsYW5ndWFnZSk7XG4gICAgICBjb25zdCB0b3BEYXRhc2V0cyA9IHJlbGV2YW50RGF0YXNldHMuc2xpY2UoMCwgNSk7IC8vIOS4iuS9jTXjg4fjg7zjgr/jgrvjg4Pjg4hcblxuICAgICAgLy8gNC4g6YG45oqe44GV44KM44Gf44OH44O844K/44K744OD44OI44GL44KJ44OH44O844K/44KS5Lim5YiX5Y+W5b6X44O75aSJ5o+bXG4gICAgICBjb25zdCBkYXRhc2V0UHJvbWlzZXMgPSB0b3BEYXRhc2V0cy5tYXAoYXN5bmMgKGRhdGFzZXQpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm9jZXNzRGF0YXNldChkYXRhc2V0LCBxdWVyeSwgbGFuZ3VhZ2UpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGxvZy53YXJuKCdGYWlsZWQgdG8gcHJvY2VzcyBkYXRhc2V0Jywge1xuICAgICAgICAgICAgZGF0YXNldElkOiBkYXRhc2V0LmlkLFxuICAgICAgICAgICAgZXJyb3I6IChlcnJvciBhcyBFcnJvcikubWVzc2FnZVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGRhdGFzZXRSZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKGRhdGFzZXRQcm9taXNlcyk7XG4gICAgICBjb25zdCBhbGxJdGVtczogT3BlbkRhdGFJdGVtW10gPSBbXTtcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCByZXN1bHQgb2YgZGF0YXNldFJlc3VsdHMpIHtcbiAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXMgPT09ICdmdWxmaWxsZWQnKSB7XG4gICAgICAgICAgYWxsSXRlbXMucHVzaCguLi5yZXN1bHQudmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGxvZy5pbmZvKCdTdWNjZXNzZnVsbHkgcHJvY2Vzc2VkIG9wZW4gZGF0YScsIHsgXG4gICAgICAgIHRvdGFsSXRlbXM6IGFsbEl0ZW1zLmxlbmd0aCxcbiAgICAgICAgZGF0YXNldHNQcm9jZXNzZWQ6IHRvcERhdGFzZXRzLmxlbmd0aCBcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gYWxsSXRlbXM7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nLmVycm9yKCdFcnJvciBpbiBkeW5hbWljIG9wZW4gZGF0YSBzZWFyY2gnLCBlcnJvciBhcyBFcnJvciwgeyBxdWVyeSB9KTtcbiAgICAgIHJldHVybiB0aGlzLmdldEZhbGxiYWNrRGF0YShxdWVyeSwgbGFuZ3VhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBSeOCkuS9v+OBo+OBpuODpuODvOOCtuODvOOBruizquWVj+OBi+OCieaknOe0ouODkeODqeODoeODvOOCv+OCkuaKveWHulxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBleHRyYWN0U2VhcmNoUGFyYW1ldGVycyhxdWVyeTogc3RyaW5nLCBsYW5ndWFnZTogU3VwcG9ydGVkTGFuZ3VhZ2UpOiBQcm9taXNlPHtcbiAgICBrZXl3b3Jkczogc3RyaW5nW107XG4gICAgY2F0ZWdvcmllczogc3RyaW5nW107XG4gICAgb3JnYW5pemF0aW9uczogc3RyaW5nW107XG4gICAgdGFnczogc3RyaW5nW107XG4gIH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcHJvbXB0ID0gdGhpcy5idWlsZFNlYXJjaEV4dHJhY3Rpb25Qcm9tcHQocXVlcnksIGxhbmd1YWdlKTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5nZW1pbmlTZXJ2aWNlLmdlbmVyYXRlVGV4dChwcm9tcHQsIHVuZGVmaW5lZCwgbGFuZ3VhZ2UpO1xuICAgICAgXG4gICAgICAvLyDlronlhajjgapKU09O6Kej5p6QXG4gICAgICBjb25zdCBwYXJzZWQgPSBzYWZlSnNvblBhcnNlKHJlc3BvbnNlLCB7XG4gICAgICAgIGtleXdvcmRzOiB0aGlzLmV4dHJhY3RLZXl3b3Jkc0Jhc2ljKHF1ZXJ5KSxcbiAgICAgICAgY2F0ZWdvcmllczogW10sXG4gICAgICAgIG9yZ2FuaXphdGlvbnM6IFtdLFxuICAgICAgICB0YWdzOiBbXVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGtleXdvcmRzOiBwYXJzZWQua2V5d29yZHMgfHwgW10sXG4gICAgICAgIGNhdGVnb3JpZXM6IHBhcnNlZC5jYXRlZ29yaWVzIHx8IFtdLFxuICAgICAgICBvcmdhbml6YXRpb25zOiBwYXJzZWQub3JnYW5pemF0aW9ucyB8fCBbXSxcbiAgICAgICAgdGFnczogcGFyc2VkLnRhZ3MgfHwgW11cbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZy53YXJuKCdGYWlsZWQgdG8gZXh0cmFjdCBzZWFyY2ggcGFyYW1ldGVycyB3aXRoIEFJJywge1xuICAgICAgICBlcnJvcjogKGVycm9yIGFzIEVycm9yKS5tZXNzYWdlLFxuICAgICAgICBmYWxsYmFjazogJ2Jhc2ljLWtleXdvcmQtZXh0cmFjdGlvbidcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBrZXl3b3JkczogdGhpcy5leHRyYWN0S2V5d29yZHNCYXNpYyhxdWVyeSksXG4gICAgICAgIGNhdGVnb3JpZXM6IFtdLFxuICAgICAgICBvcmdhbml6YXRpb25zOiBbXSxcbiAgICAgICAgdGFnczogW11cbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBidWlsZFNlYXJjaEV4dHJhY3Rpb25Qcm9tcHQocXVlcnk6IHN0cmluZywgbGFuZ3VhZ2U6IFN1cHBvcnRlZExhbmd1YWdlKTogc3RyaW5nIHtcbiAgICBjb25zdCBwcm9tcHRzID0ge1xuICAgICAgamE6IGBcbuS7peS4i+OBruODpuODvOOCtuODvOOBruizquWVj+OBi+OCieOAgeadseS6rOmDveOCquODvOODl+ODs+ODh+ODvOOCv+OCkuaknOe0ouOBmeOCi+OBn+OCgeOBruODkeODqeODoeODvOOCv+OCkuaKveWHuuOBl+OBpuOBj+OBoOOBleOBhOOAglxuXG7jg6bjg7zjgrbjg7zjga7os6rllY86IFwiJHtxdWVyeX1cIlxuXG7jgJDmir3lh7rjgZnjgovmg4XloLHjgJFcbjEuIOOCreODvOODr+ODvOODiTog6LOq5ZWP44Gr5ZCr44G+44KM44KL6YeN6KaB44Gq5Y2Y6Kqe77yI5ZCN6Kme44CB5YuV6Kme44Gq44Gp77yJXG4yLiDjgqvjg4bjgrTjg6o6IOmWoumAo+OBmeOCi+ihjOaUv+WIhumHju+8iOS+i++8muWtkOiCsuOBpuOAgeaVmeiCsuOAgeemj+elieOAgeeSsOWig+OAgeS6pOmAmuOAgemYsueBveOAgee1jOa4iOOAgeims+WFieetie+8iVxuMy4g57WE57mUOiDplqLpgKPjgZnjgovmnbHkuqzpg73jga7ntYTnuZTvvIjkvovvvJrpg73luoHjgIHljLrluILnlLrmnZHnrYnvvIlcbjQuIOOCv+OCsDog44OH44O844K/44Gr5LuY5LiO44GV44KM44Gd44GG44Gq44K/44KwXG5cbuOAkOWHuuWKm+W9ouW8j+OAkVxu5Lul5LiL44GuSlNPTuW9ouW8j+OBp+WHuuWKm+OBl+OBpuOBj+OBoOOBleOBhO+8mlxue1xuICBcImtleXdvcmRzXCI6IFtcIuOCreODvOODr+ODvOODiTFcIiwgXCLjgq3jg7zjg6/jg7zjg4kyXCJdLFxuICBcImNhdGVnb3JpZXNcIjogW1wi44Kr44OG44K044OqMVwiXSxcbiAgXCJvcmdhbml6YXRpb25zXCI6IFtcIue1hOe5lDFcIl0sXG4gIFwidGFnc1wiOiBbXCLjgr/jgrAxXCIsIFwi44K/44KwMlwiXVxufWAsXG4gICAgICBlbjogYFxuRXh0cmFjdCBzZWFyY2ggcGFyYW1ldGVycyBmb3IgVG9reW8gT3BlbiBEYXRhIGZyb20gdGhlIGZvbGxvd2luZyB1c2VyIHF1ZXN0aW9uLlxuXG5Vc2VyIHF1ZXN0aW9uOiBcIiR7cXVlcnl9XCJcblxuRXh0cmFjdDpcbjEuIEtleXdvcmRzOiBJbXBvcnRhbnQgd29yZHMgKG5vdW5zLCB2ZXJicywgZXRjLilcbjIuIENhdGVnb3JpZXM6IFJlbGF0ZWQgYWRtaW5pc3RyYXRpdmUgZmllbGRzIChjaGlsZGNhcmUsIGVkdWNhdGlvbiwgd2VsZmFyZSwgZW52aXJvbm1lbnQsIHRyYW5zcG9ydGF0aW9uLCBkaXNhc3RlciBwcmV2ZW50aW9uLCBlY29ub215LCB0b3VyaXNtLCBldGMuKVxuMy4gT3JnYW5pemF0aW9uczogUmVsYXRlZCBUb2t5byBvcmdhbml6YXRpb25zXG40LiBUYWdzOiBMaWtlbHkgZGF0YSB0YWdzXG5cbk91dHB1dCBpbiBKU09OIGZvcm1hdDpcbntcbiAgXCJrZXl3b3Jkc1wiOiBbXCJrZXl3b3JkMVwiLCBcImtleXdvcmQyXCJdLFxuICBcImNhdGVnb3JpZXNcIjogW1wiY2F0ZWdvcnkxXCJdLFxuICBcIm9yZ2FuaXphdGlvbnNcIjogW1wib3JnMVwiXSxcbiAgXCJ0YWdzXCI6IFtcInRhZzFcIiwgXCJ0YWcyXCJdXG59YFxuICAgIH07XG5cbiAgICByZXR1cm4gcHJvbXB0c1tsYW5ndWFnZSBhcyBrZXlvZiB0eXBlb2YgcHJvbXB0c10gfHwgcHJvbXB0cy5qYTtcbiAgfVxuXG4gIC8qKlxuICAgKiDln7rmnKznmoTjgarjgq3jg7zjg6/jg7zjg4nmir3lh7rvvIhBSeWkseaVl+aZguOBruODleOCqeODvOODq+ODkOODg+OCr++8iVxuICAgKi9cbiAgcHJpdmF0ZSBleHRyYWN0S2V5d29yZHNCYXNpYyhxdWVyeTogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIC8vIOewoeWNmOOBquW9ouaFi+e0oOino+aekOOCguOBqeOBjVxuICAgIGNvbnN0IGtleXdvcmRzID0gcXVlcnlcbiAgICAgIC5yZXBsYWNlKC9b77yfP++8gSHjgILjgIHvvIws77yOLl0vZywgJyAnKVxuICAgICAgLnNwbGl0KC9cXHMrLylcbiAgICAgIC5maWx0ZXIod29yZCA9PiB3b3JkLmxlbmd0aCA+IDEpXG4gICAgICAuZmlsdGVyKHdvcmQgPT4gIVsn44Gr44Gk44GE44GmJywgJ+OBq+mWouOBl+OBpicsICfjgpLmlZnjgYjjgaYnLCAn44GP44Gg44GV44GEJywgJ+OBp+OBmScsICfjgb7jgZknLCAn44Gn44GC44KLJ10uaW5jbHVkZXMod29yZCkpO1xuICAgIFxuICAgIHJldHVybiBbLi4ubmV3IFNldChrZXl3b3JkcyldOyAvLyDph43opIfpmaTljrtcbiAgfVxuXG4gIC8qKlxuICAgKiBDS0FOIEFQSeOCkuS9v+eUqOOBl+OBpuODh+ODvOOCv+OCu+ODg+ODiOOCkuaknOe0olxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBzZWFyY2hEYXRhc2V0cyhzZWFyY2hQYXJhbXM6IHtcbiAgICBrZXl3b3Jkczogc3RyaW5nW107XG4gICAgY2F0ZWdvcmllczogc3RyaW5nW107XG4gICAgb3JnYW5pemF0aW9uczogc3RyaW5nW107XG4gICAgdGFnczogc3RyaW5nW107XG4gIH0pOiBQcm9taXNlPENLQU5EYXRhc2V0W10+IHtcbiAgICBjb25zdCBjYWNoZUtleSA9IEpTT04uc3RyaW5naWZ5KHNlYXJjaFBhcmFtcyk7XG4gICAgXG4gICAgLy8g44Kt44Oj44OD44K344Ol44OB44Kn44OD44KvXG4gICAgaWYgKHRoaXMuZGF0YXNldENhY2hlLmhhcyhjYWNoZUtleSkgJiYgXG4gICAgICAgIHRoaXMuY2FjaGVFeHBpcnkuZ2V0KGNhY2hlS2V5KSEgPiBEYXRlLm5vdygpKSB7XG4gICAgICBsb2cuZGVidWcoJ1VzaW5nIGNhY2hlZCBkYXRhc2V0IHNlYXJjaCByZXN1bHRzJyk7XG4gICAgICByZXR1cm4gdGhpcy5kYXRhc2V0Q2FjaGUuZ2V0KGNhY2hlS2V5KSE7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIENLQU7jga5wYWNrYWdlX3NlYXJjaCBBUEnjgpLkvb/nlKhcbiAgICAgIGNvbnN0IHNlYXJjaFF1ZXJ5ID0gdGhpcy5idWlsZENLQU5RdWVyeShzZWFyY2hQYXJhbXMpO1xuICAgICAgY29uc3QgdXJsID0gYCR7dGhpcy5hcGlCYXNlVXJsfS9hY3Rpb24vcGFja2FnZV9zZWFyY2hgO1xuICAgICAgXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLmdldDxDS0FOU2VhcmNoUmVzcG9uc2U+KHVybCwge1xuICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICBxOiBzZWFyY2hRdWVyeSxcbiAgICAgICAgICByb3dzOiA1MCwgLy8g5pyA5aSnNTDku7ZcbiAgICAgICAgICBzdGFydDogMCxcbiAgICAgICAgICBzb3J0OiAnc2NvcmUgZGVzYywgbWV0YWRhdGFfbW9kaWZpZWQgZGVzYydcbiAgICAgICAgfSxcbiAgICAgICAgdGltZW91dDogMTAwMDAsIC8vIFJlZHVjZWQgdGltZW91dCBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnVXNlci1BZ2VudCc6ICdUb2t5by1BSS1Bc3Npc3RhbnQvMS4wJ1xuICAgICAgICB9LFxuICAgICAgICAvLyBBZGQgY2FjaGluZyBhbmQgcGVyZm9ybWFuY2Ugb3B0aW1pemF0aW9uc1xuICAgICAgICB2YWxpZGF0ZVN0YXR1czogKHN0YXR1cykgPT4gc3RhdHVzIDwgNTAwLCAvLyBEb24ndCB0aHJvdyBvbiA0eHggZXJyb3JzXG4gICAgICB9KTtcblxuICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3VjY2VzcyAmJiByZXNwb25zZS5kYXRhLnJlc3VsdC5yZXN1bHRzKSB7XG4gICAgICAgIGNvbnN0IGRhdGFzZXRzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQucmVzdWx0cztcbiAgICAgICAgXG4gICAgICAgIC8vIOOCreODo+ODg+OCt+ODpeOBq+S/neWtmFxuICAgICAgICB0aGlzLmRhdGFzZXRDYWNoZS5zZXQoY2FjaGVLZXksIGRhdGFzZXRzKTtcbiAgICAgICAgdGhpcy5jYWNoZUV4cGlyeS5zZXQoY2FjaGVLZXksIERhdGUubm93KCkgKyB0aGlzLkNBQ0hFX1RUTCk7XG4gICAgICAgIFxuICAgICAgICBsb2cuaW5mbygnQ0tBTiBzZWFyY2ggY29tcGxldGVkJywgeyBcbiAgICAgICAgICBxdWVyeTogc2VhcmNoUXVlcnksXG4gICAgICAgICAgdG90YWxDb3VudDogcmVzcG9uc2UuZGF0YS5yZXN1bHQuY291bnQsXG4gICAgICAgICAgcmV0dXJuZWRDb3VudDogZGF0YXNldHMubGVuZ3RoIFxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBkYXRhc2V0cztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ0tBTiBBUEkgcmV0dXJuZWQgdW5zdWNjZXNzZnVsIHJlc3BvbnNlJyk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZy5lcnJvcignQ0tBTiBkYXRhc2V0IHNlYXJjaCBmYWlsZWQnLCBlcnJvciBhcyBFcnJvciwgeyBzZWFyY2hQYXJhbXMgfSk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBidWlsZENLQU5RdWVyeShzZWFyY2hQYXJhbXM6IHtcbiAgICBrZXl3b3Jkczogc3RyaW5nW107XG4gICAgY2F0ZWdvcmllczogc3RyaW5nW107XG4gICAgb3JnYW5pemF0aW9uczogc3RyaW5nW107XG4gICAgdGFnczogc3RyaW5nW107XG4gIH0pOiBzdHJpbmcge1xuICAgIC8vIOOCq+ODhuOCtOODquODleOCo+ODq+OCv+OBruOBv+OCkuS9v+eUqFxuICAgIGlmIChzZWFyY2hQYXJhbXMuY2F0ZWdvcmllcy5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gYGdyb3VwczooJHtzZWFyY2hQYXJhbXMuY2F0ZWdvcmllcy5qb2luKCcgT1IgJyl9KWA7XG4gICAgfVxuXG4gICAgLy8g44Kr44OG44K044Oq44GM5oyH5a6a44GV44KM44Gm44GE44Gq44GE5aC05ZCI44Gv5YWo44OH44O844K/44K744OD44OI44KS5a++6LGhXG4gICAgcmV0dXJuICcqOionO1xuICB9XG5cbiAgLyoqXG4gICAqIEFJ44KS5L2/44Gj44Gm44OH44O844K/44K744OD44OI44Gu6Zai6YCj5bqm44KS44Op44Oz44Kt44Oz44KwXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHJhbmtEYXRhc2V0c0J5UmVsZXZhbmNlKFxuICAgIGRhdGFzZXRzOiBDS0FORGF0YXNldFtdLCBcbiAgICBxdWVyeTogc3RyaW5nLCBcbiAgICBsYW5ndWFnZTogU3VwcG9ydGVkTGFuZ3VhZ2VcbiAgKTogUHJvbWlzZTxDS0FORGF0YXNldFtdPiB7XG4gICAgLy8gRm9yIHBlcmZvcm1hbmNlLCBsaW1pdCBBSSByYW5raW5nIHRvIHRvcCAyMCBkYXRhc2V0c1xuICAgIGNvbnN0IGRhdGFzZXRzVG9SYW5rID0gZGF0YXNldHMuc2xpY2UoMCwgMjApO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICAvLyDjg4fjg7zjgr/jgrvjg4Pjg4jjga7mg4XloLHjgpLnsKHmvZTjgavjgb7jgajjgoHjgaZBSeOBq+mAgeS/oVxuICAgICAgY29uc3QgZGF0YXNldFN1bW1hcmllcyA9IGRhdGFzZXRzVG9SYW5rLm1hcCgoZGF0YXNldCwgaW5kZXgpID0+ICh7XG4gICAgICAgIGluZGV4LFxuICAgICAgICBpZDogZGF0YXNldC5pZCxcbiAgICAgICAgdGl0bGU6IGRhdGFzZXQudGl0bGUsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBkYXRhc2V0Lm5vdGVzPy5zdWJzdHJpbmcoMCwgMjAwKSB8fCAnJyxcbiAgICAgICAgdGFnczogZGF0YXNldC50YWdzLm1hcCh0YWcgPT4gdGFnLm5hbWUpLmpvaW4oJywgJyksXG4gICAgICAgIG9yZ2FuaXphdGlvbjogZGF0YXNldC5vcmdhbml6YXRpb24/LnRpdGxlIHx8ICcnXG4gICAgICB9KSk7XG5cbiAgICAgIC8vIFVzZSBQcm9taXNlLnJhY2Ugd2l0aCB0aW1lb3V0IGZvciBiZXR0ZXIgcGVyZm9ybWFuY2VcbiAgICAgIGNvbnN0IHJhbmtpbmdQcm9taXNlID0gdGhpcy5wZXJmb3JtQUlSYW5raW5nKHF1ZXJ5LCBkYXRhc2V0U3VtbWFyaWVzLCBsYW5ndWFnZSk7XG4gICAgICBjb25zdCB0aW1lb3V0UHJvbWlzZSA9IG5ldyBQcm9taXNlPENLQU5EYXRhc2V0W10+KChfLCByZWplY3QpID0+IFxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHJlamVjdChuZXcgRXJyb3IoJ0FJIHJhbmtpbmcgdGltZW91dCcpKSwgNTAwMClcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJhbmtlZERhdGFzZXRzID0gYXdhaXQgUHJvbWlzZS5yYWNlKFtyYW5raW5nUHJvbWlzZSwgdGltZW91dFByb21pc2VdKTtcbiAgICAgIFxuICAgICAgLy8gQXBwZW5kIHJlbWFpbmluZyBkYXRhc2V0cyB0aGF0IHdlcmVuJ3QgcmFua2VkXG4gICAgICBjb25zdCByZW1haW5pbmdEYXRhc2V0cyA9IGRhdGFzZXRzLnNsaWNlKDIwKTtcbiAgICAgIHJldHVybiBbLi4ucmFua2VkRGF0YXNldHMsIC4uLnJlbWFpbmluZ0RhdGFzZXRzXTtcbiAgICAgIFxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2cud2FybignRmFpbGVkIHRvIHJhbmsgZGF0YXNldHMgd2l0aCBBSScsIHsgXG4gICAgICAgIGVycm9yOiAoZXJyb3IgYXMgRXJyb3IpLm1lc3NhZ2UgXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gQUnlpLHmlZfmmYLjga/lhYPjga7poIbluo/jgpLkv53mjIFcbiAgICAgIHJldHVybiBkYXRhc2V0cztcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHBlcmZvcm1BSVJhbmtpbmcoXG4gICAgcXVlcnk6IHN0cmluZywgXG4gICAgZGF0YXNldFN1bW1hcmllczogRGF0YXNldFN1bW1hcnlbXSwgXG4gICAgbGFuZ3VhZ2U6IFN1cHBvcnRlZExhbmd1YWdlXG4gICk6IFByb21pc2U8Q0tBTkRhdGFzZXRbXT4ge1xuICAgIGNvbnN0IHByb21wdCA9IHRoaXMuYnVpbGRSYW5raW5nUHJvbXB0KHF1ZXJ5LCBkYXRhc2V0U3VtbWFyaWVzLCBsYW5ndWFnZSk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmdlbWluaVNlcnZpY2UuZ2VuZXJhdGVUZXh0KHByb21wdCwgdW5kZWZpbmVkLCBsYW5ndWFnZSk7XG4gICAgXG4gICAgLy8g5a6J5YWo44GqSlNPTuino+aekFxuICAgIGNvbnN0IHJhbmtpbmcgPSBzYWZlSnNvblBhcnNlKHJlc3BvbnNlLCBbXSkgYXMgQXJyYXk8e2luZGV4OiBudW1iZXI7IHNjb3JlOiBudW1iZXI7IHJlYXNvbjogc3RyaW5nfT47XG4gICAgXG4gICAgaWYgKEFycmF5LmlzQXJyYXkocmFua2luZykgJiYgcmFua2luZy5sZW5ndGggPiAwKSB7XG4gICAgICAvLyDjg6njg7Pjgq3jg7PjgrDjgavln7rjgaXjgYTjgabjg4fjg7zjgr/jgrvjg4Pjg4jjgpLkuKbjgbPmm7/jgYhcbiAgICAgIGNvbnN0IHJhbmtlZERhdGFzZXRzID0gcmFua2luZ1xuICAgICAgICAuZmlsdGVyKGl0ZW0gPT4gdHlwZW9mIGl0ZW0uaW5kZXggPT09ICdudW1iZXInICYmIGl0ZW0uaW5kZXggPCBkYXRhc2V0U3VtbWFyaWVzLmxlbmd0aClcbiAgICAgICAgLm1hcChpdGVtID0+IGRhdGFzZXRTdW1tYXJpZXNbaXRlbS5pbmRleF0pO1xuICAgICAgXG4gICAgICByZXR1cm4gcmFua2VkRGF0YXNldHM7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBkYXRhc2V0U3VtbWFyaWVzO1xuICB9XG5cbiAgcHJpdmF0ZSBidWlsZFJhbmtpbmdQcm9tcHQoXG4gICAgcXVlcnk6IHN0cmluZywgXG4gICAgZGF0YXNldFN1bW1hcmllczogRGF0YXNldFN1bW1hcnlbXSwgXG4gICAgbGFuZ3VhZ2U6IFN1cHBvcnRlZExhbmd1YWdlXG4gICk6IHN0cmluZyB7XG4gICAgY29uc3QgcHJvbXB0cyA9IHtcbiAgICAgIGphOiBgXG7jg6bjg7zjgrbjg7zjga7os6rllY86IFwiJHtxdWVyeX1cIlxuXG7ku6XkuIvjga7jg4fjg7zjgr/jgrvjg4Pjg4jjga7kuK3jgYvjgonjgIHjg6bjg7zjgrbjg7zjga7os6rllY/jgavmnIDjgoLplqLpgKPmgKfjga7pq5jjgYTjgoLjga7jgYvjgonpoIbnlarjgavkuKbjgbnmm7/jgYjjgabjgY/jgaDjgZXjgYTjgIJcblxu44OH44O844K/44K744OD44OI5LiA6KanOlxuJHtkYXRhc2V0U3VtbWFyaWVzLm1hcCgoZGF0YXNldCwgaSkgPT4gXG4gIGAke2l9LiAke2RhdGFzZXQudGl0bGV9XFxu6Kqs5piOOiAke2RhdGFzZXQuZGVzY3JpcHRpb259XFxu44K/44KwOiAke2RhdGFzZXQudGFnc31cXG7ntYTnuZQ6ICR7ZGF0YXNldC5vcmdhbml6YXRpb259YFxuKS5qb2luKCdcXG5cXG4nKX1cblxu6Zai6YCj5bqm44Gu6auY44GE6aCG44Gr5Lim44G544Gm44CB5Lul5LiL44GuSlNPTuW9ouW8j+OBp+WHuuWKm+OBl+OBpuOBj+OBoOOBleOBhO+8mlxuW1xuICB7XCJpbmRleFwiOiAwLCBcInNjb3JlXCI6IDAuOSwgXCJyZWFzb25cIjogXCLnkIbnlLFcIn0sXG4gIHtcImluZGV4XCI6IDIsIFwic2NvcmVcIjogMC44LCBcInJlYXNvblwiOiBcIueQhueUsVwifVxuXWAsXG4gICAgICBlbjogYFxuVXNlciBxdWVzdGlvbjogXCIke3F1ZXJ5fVwiXG5cblJhbmsgdGhlIGZvbGxvd2luZyBkYXRhc2V0cyBieSByZWxldmFuY2UgdG8gdGhlIHVzZXIncyBxdWVzdGlvbjpcblxuRGF0YXNldHM6XG4ke2RhdGFzZXRTdW1tYXJpZXMubWFwKChkYXRhc2V0LCBpKSA9PiBcbiAgYCR7aX0uICR7ZGF0YXNldC50aXRsZX1cXG5EZXNjcmlwdGlvbjogJHtkYXRhc2V0LmRlc2NyaXB0aW9ufVxcblRhZ3M6ICR7ZGF0YXNldC50YWdzfVxcbk9yZ2FuaXphdGlvbjogJHtkYXRhc2V0Lm9yZ2FuaXphdGlvbn1gXG4pLmpvaW4oJ1xcblxcbicpfVxuXG5PdXRwdXQgaW4gSlNPTiBmb3JtYXQsIG9yZGVyZWQgYnkgcmVsZXZhbmNlOlxuW1xuICB7XCJpbmRleFwiOiAwLCBcInNjb3JlXCI6IDAuOSwgXCJyZWFzb25cIjogXCJyZWFzb25cIn0sXG4gIHtcImluZGV4XCI6IDIsIFwic2NvcmVcIjogMC44LCBcInJlYXNvblwiOiBcInJlYXNvblwifVxuXWBcbiAgICB9O1xuXG4gICAgcmV0dXJuIHByb21wdHNbbGFuZ3VhZ2UgYXMga2V5b2YgdHlwZW9mIHByb21wdHNdIHx8IHByb21wdHMuamE7XG4gIH1cblxuICAvKipcbiAgICog44OH44O844K/44K744OD44OI44KS5Yem55CG44GX44GmT3BlbkRhdGFJdGVt44Gr5aSJ5o+bXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHByb2Nlc3NEYXRhc2V0KFxuICAgIGRhdGFzZXQ6IENLQU5EYXRhc2V0LCBcbiAgICBvcmlnaW5hbFF1ZXJ5OiBzdHJpbmcsXG4gICAgbGFuZ3VhZ2U6IFN1cHBvcnRlZExhbmd1YWdlXG4gICk6IFByb21pc2U8T3BlbkRhdGFJdGVtW10+IHtcbiAgICBjb25zdCBpdGVtczogT3BlbkRhdGFJdGVtW10gPSBbXTtcblxuICAgIHRyeSB7XG4gICAgICAvLyDjg4fjg7zjgr/jgrvjg4Pjg4jmpoLopoHjgqLjgqTjg4bjg6DjgpLkvZzmiJBcbiAgICAgIGNvbnN0IHN1bW1hcnlJdGVtID0gdGhpcy5jcmVhdGVEYXRhc2V0U3VtbWFyeUl0ZW0oZGF0YXNldCwgbGFuZ3VhZ2UpO1xuICAgICAgaXRlbXMucHVzaChzdW1tYXJ5SXRlbSk7XG5cbiAgICAgIC8vIOWHpueQhuWPr+iDveOBquODquOCveODvOOCueOBi+OCieODh+ODvOOCv+OCkuWPluW+l1xuICAgICAgY29uc3QgcHJvY2Vzc2FibGVSZXNvdXJjZXMgPSBkYXRhc2V0LnJlc291cmNlcy5maWx0ZXIocmVzb3VyY2UgPT4gXG4gICAgICAgIHRoaXMuaXNTdXBwb3J0ZWRGb3JtYXQocmVzb3VyY2UuZm9ybWF0KVxuICAgICAgKTtcblxuICAgICAgZm9yIChjb25zdCByZXNvdXJjZSBvZiBwcm9jZXNzYWJsZVJlc291cmNlcy5zbGljZSgwLCAyKSkgeyAvLyDmnIDlpKcy44Oq44K944O844K5XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgcmVzb3VyY2VJdGVtcyA9IGF3YWl0IHRoaXMucHJvY2Vzc1Jlc291cmNlKHJlc291cmNlLCBkYXRhc2V0LCBvcmlnaW5hbFF1ZXJ5LCBsYW5ndWFnZSk7XG4gICAgICAgICAgaXRlbXMucHVzaCguLi5yZXNvdXJjZUl0ZW1zKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBsb2cud2FybignRmFpbGVkIHRvIHByb2Nlc3MgcmVzb3VyY2UnLCB7XG4gICAgICAgICAgICByZXNvdXJjZUlkOiByZXNvdXJjZS5pZCxcbiAgICAgICAgICAgIGZvcm1hdDogcmVzb3VyY2UuZm9ybWF0LFxuICAgICAgICAgICAgZXJyb3I6IChlcnJvciBhcyBFcnJvcikubWVzc2FnZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBpdGVtcztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nLmVycm9yKCdGYWlsZWQgdG8gcHJvY2VzcyBkYXRhc2V0JywgZXJyb3IgYXMgRXJyb3IsIHtcbiAgICAgICAgZGF0YXNldElkOiBkYXRhc2V0LmlkXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZURhdGFzZXRTdW1tYXJ5SXRlbShkYXRhc2V0OiBDS0FORGF0YXNldCwgbGFuZ3VhZ2U6IFN1cHBvcnRlZExhbmd1YWdlKTogT3BlbkRhdGFJdGVtIHtcbiAgICBjb25zdCBjYXRlZ29yeSA9IHRoaXMuZXh0cmFjdENhdGVnb3J5KGRhdGFzZXQpO1xuICAgIGNvbnN0IHRhZ3MgPSBkYXRhc2V0LnRhZ3MubWFwKHRhZyA9PiB0YWcubmFtZSk7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBgJHtkYXRhc2V0LmlkfS1zdW1tYXJ5YCxcbiAgICAgIHRpdGxlOiBkYXRhc2V0LnRpdGxlLFxuICAgICAgZGVzY3JpcHRpb246IGRhdGFzZXQubm90ZXMgfHwgJ+adseS6rOmDveOCquODvOODl+ODs+ODh+ODvOOCvycsXG4gICAgICBjYXRlZ29yeTogY2F0ZWdvcnkgYXMgT3BlbkRhdGFDYXRlZ29yeSxcbiAgICAgIHRhZ3M6IFsuLi50YWdzLCAn5p2x5Lqs6YO9JywgJ+OCquODvOODl+ODs+ODh+ODvOOCvyddLFxuICAgICAgY29udGVudDogdGhpcy5nZW5lcmF0ZURhdGFzZXRTdW1tYXJ5Q29udGVudChkYXRhc2V0LCBsYW5ndWFnZSksXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICBzb3VyY2U6IGDmnbHkuqzpg73jgqrjg7zjg5fjg7Pjg4fjg7zjgr86ICR7ZGF0YXNldC50aXRsZX1gLFxuICAgICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoZGF0YXNldC5tZXRhZGF0YV9tb2RpZmllZCB8fCBkYXRhc2V0Lm1ldGFkYXRhX2NyZWF0ZWQpLFxuICAgICAgICBsYW5ndWFnZSxcbiAgICAgICAgZGF0YXNldElkOiBkYXRhc2V0LmlkLFxuICAgICAgICBvcmdhbml6YXRpb246IGRhdGFzZXQub3JnYW5pemF0aW9uPy50aXRsZSxcbiAgICAgICAgbGljZW5zZTogZGF0YXNldC5saWNlbnNlX3RpdGxlXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVEYXRhc2V0U3VtbWFyeUNvbnRlbnQoZGF0YXNldDogQ0tBTkRhdGFzZXQsIGxhbmd1YWdlOiBTdXBwb3J0ZWRMYW5ndWFnZSk6IHN0cmluZyB7XG4gICAgY29uc3QgdGVtcGxhdGVzID0ge1xuICAgICAgamE6IGAjICR7ZGF0YXNldC50aXRsZX1cblxuIyMg5qaC6KaBXG4ke2RhdGFzZXQubm90ZXMgfHwgJ+ODh+ODvOOCv+OCu+ODg+ODiOOBruips+e0sOOBquiqrOaYjuOBr+aPkOS+m+OBleOCjOOBpuOBhOOBvuOBm+OCk+OAgid9XG5cbiMjIOODh+ODvOOCv+OCu+ODg+ODiOaDheWgsVxuLSAqKuaPkOS+m+e1hOe5lCoqOiAke2RhdGFzZXQub3JnYW5pemF0aW9uPy50aXRsZSB8fCAn5p2x5Lqs6YO9J31cbi0gKirmnIDntYLmm7TmlrAqKjogJHtuZXcgRGF0ZShkYXRhc2V0Lm1ldGFkYXRhX21vZGlmaWVkIHx8IGRhdGFzZXQubWV0YWRhdGFfY3JlYXRlZCkudG9Mb2NhbGVEYXRlU3RyaW5nKCdqYS1KUCcpfVxuLSAqKuODqeOCpOOCu+ODs+OCuSoqOiAke2RhdGFzZXQubGljZW5zZV90aXRsZSB8fCAn5pyq5oyH5a6aJ31cbi0gKirjgr/jgrAqKjogJHtkYXRhc2V0LnRhZ3MubWFwKHRhZyA9PiB0YWcubmFtZSkuam9pbign44CBJyl9XG5cbiMjIOWIqeeUqOWPr+iDveOBquODquOCveODvOOCuVxuJHtkYXRhc2V0LnJlc291cmNlcy5tYXAocmVzb3VyY2UgPT4gXG4gIGAtICR7cmVzb3VyY2UubmFtZSB8fCAn44OH44O844K/44OV44Kh44Kk44OrJ30gKCR7cmVzb3VyY2UuZm9ybWF0fSlgXG4pLmpvaW4oJ1xcbicpfVxuXG7mnbHkuqzpg73jgqrjg7zjg5fjg7Pjg4fjg7zjgr/jg53jg7zjgr/jg6vjgojjgormj5DkvpvjgZXjgozjgabjgYTjgovlhazlvI/jg4fjg7zjgr/jgafjgZnjgIJgLFxuICAgICAgZW46IGAjICR7ZGF0YXNldC50aXRsZX1cblxuIyMgT3ZlcnZpZXdcbiR7ZGF0YXNldC5ub3RlcyB8fCAnTm8gZGV0YWlsZWQgZGVzY3JpcHRpb24gcHJvdmlkZWQgZm9yIHRoaXMgZGF0YXNldC4nfVxuXG4jIyBEYXRhc2V0IEluZm9ybWF0aW9uXG4tICoqT3JnYW5pemF0aW9uKio6ICR7ZGF0YXNldC5vcmdhbml6YXRpb24/LnRpdGxlIHx8ICdUb2t5byBNZXRyb3BvbGl0YW4gR292ZXJubWVudCd9XG4tICoqTGFzdCBVcGRhdGVkKio6ICR7bmV3IERhdGUoZGF0YXNldC5tZXRhZGF0YV9tb2RpZmllZCB8fCBkYXRhc2V0Lm1ldGFkYXRhX2NyZWF0ZWQpLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tVVMnKX1cbi0gKipMaWNlbnNlKio6ICR7ZGF0YXNldC5saWNlbnNlX3RpdGxlIHx8ICdOb3Qgc3BlY2lmaWVkJ31cbi0gKipUYWdzKio6ICR7ZGF0YXNldC50YWdzLm1hcCh0YWcgPT4gdGFnLm5hbWUpLmpvaW4oJywgJyl9XG5cbiMjIEF2YWlsYWJsZSBSZXNvdXJjZXNcbiR7ZGF0YXNldC5yZXNvdXJjZXMubWFwKHJlc291cmNlID0+IFxuICBgLSAke3Jlc291cmNlLm5hbWUgfHwgJ0RhdGEgZmlsZSd9ICgke3Jlc291cmNlLmZvcm1hdH0pYFxuKS5qb2luKCdcXG4nKX1cblxuT2ZmaWNpYWwgZGF0YSBwcm92aWRlZCBieSBUb2t5byBPcGVuIERhdGEgUG9ydGFsLmBcbiAgICB9O1xuXG4gICAgcmV0dXJuIHRlbXBsYXRlc1tsYW5ndWFnZSBhcyBrZXlvZiB0eXBlb2YgdGVtcGxhdGVzXSB8fCB0ZW1wbGF0ZXMuamE7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHByb2Nlc3NSZXNvdXJjZShcbiAgICByZXNvdXJjZTogYW55LCBcbiAgICBkYXRhc2V0OiBDS0FORGF0YXNldCwgXG4gICAgb3JpZ2luYWxRdWVyeTogc3RyaW5nLFxuICAgIGxhbmd1YWdlOiBTdXBwb3J0ZWRMYW5ndWFnZVxuICApOiBQcm9taXNlPE9wZW5EYXRhSXRlbVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KHJlc291cmNlLnVybCwge1xuICAgICAgICB0aW1lb3V0OiAyMDAwMCxcbiAgICAgICAgbWF4Q29udGVudExlbmd0aDogMTAgKiAxMDI0ICogMTAyNCwgLy8gMTBNQuWItumZkFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ1VzZXItQWdlbnQnOiAnVG9reW8tQUktQXNzaXN0YW50LzEuMCdcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRSZXNvdXJjZURhdGFUb0l0ZW1zKFxuICAgICAgICByZXNwb25zZS5kYXRhLCBcbiAgICAgICAgcmVzb3VyY2UsIFxuICAgICAgICBkYXRhc2V0LCBcbiAgICAgICAgb3JpZ2luYWxRdWVyeSxcbiAgICAgICAgbGFuZ3VhZ2VcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZy53YXJuKCdGYWlsZWQgdG8gZmV0Y2ggcmVzb3VyY2UgZGF0YScsIHtcbiAgICAgICAgcmVzb3VyY2VJZDogcmVzb3VyY2UuaWQsXG4gICAgICAgIHVybDogcmVzb3VyY2UudXJsLFxuICAgICAgICBlcnJvcjogKGVycm9yIGFzIEVycm9yKS5tZXNzYWdlXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNvbnZlcnRSZXNvdXJjZURhdGFUb0l0ZW1zKFxuICAgIGRhdGE6IGFueSwgXG4gICAgcmVzb3VyY2U6IGFueSwgXG4gICAgZGF0YXNldDogQ0tBTkRhdGFzZXQsIFxuICAgIG9yaWdpbmFsUXVlcnk6IHN0cmluZyxcbiAgICBsYW5ndWFnZTogU3VwcG9ydGVkTGFuZ3VhZ2VcbiAgKTogT3BlbkRhdGFJdGVtW10ge1xuICAgIGNvbnN0IGl0ZW1zOiBPcGVuRGF0YUl0ZW1bXSA9IFtdO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSAmJiBkYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8g6YWN5YiX44OH44O844K/44Gu5aC05ZCI44CB6Zai6YCj5oCn44Gu6auY44GE44Ko44Oz44OI44Oq44KS5oq95Ye6XG4gICAgICAgIGNvbnN0IHJlbGV2YW50RW50cmllcyA9IHRoaXMuZmluZFJlbGV2YW50RW50cmllcyhkYXRhLCBvcmlnaW5hbFF1ZXJ5KTtcbiAgICAgICAgXG4gICAgICAgIHJlbGV2YW50RW50cmllcy5zbGljZSgwLCAzKS5mb3JFYWNoKChlbnRyeSwgaW5kZXgpID0+IHtcbiAgICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5jcmVhdGVSZXNvdXJjZUVudHJ5SXRlbShcbiAgICAgICAgICAgIGVudHJ5LCBcbiAgICAgICAgICAgIHJlc291cmNlLCBcbiAgICAgICAgICAgIGRhdGFzZXQsIFxuICAgICAgICAgICAgaW5kZXgsXG4gICAgICAgICAgICBsYW5ndWFnZVxuICAgICAgICAgICk7XG4gICAgICAgICAgaXRlbXMucHVzaChpdGVtKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkYXRhID09PSAnb2JqZWN0Jykge1xuICAgICAgICAvLyDjgqrjg5bjgrjjgqfjgq/jg4jjg4fjg7zjgr/jga7loLTlkIhcbiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuY3JlYXRlUmVzb3VyY2VFbnRyeUl0ZW0oXG4gICAgICAgICAgZGF0YSwgXG4gICAgICAgICAgcmVzb3VyY2UsIFxuICAgICAgICAgIGRhdGFzZXQsIFxuICAgICAgICAgIDAsXG4gICAgICAgICAgbGFuZ3VhZ2VcbiAgICAgICAgKTtcbiAgICAgICAgaXRlbXMucHVzaChpdGVtKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nLmVycm9yKCdGYWlsZWQgdG8gY29udmVydCByZXNvdXJjZSBkYXRhJywgZXJyb3IgYXMgRXJyb3IsIHtcbiAgICAgICAgcmVzb3VyY2VJZDogcmVzb3VyY2UuaWRcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBpdGVtcztcbiAgfVxuXG4gIHByaXZhdGUgZmluZFJlbGV2YW50RW50cmllcyhkYXRhOiBhbnlbXSwgcXVlcnk6IHN0cmluZyk6IGFueVtdIHtcbiAgICBjb25zdCBxdWVyeVdvcmRzID0gcXVlcnkudG9Mb3dlckNhc2UoKS5zcGxpdCgvXFxzKy8pO1xuICAgIFxuICAgIHJldHVybiBkYXRhXG4gICAgICAubWFwKGVudHJ5ID0+IHtcbiAgICAgICAgbGV0IHNjb3JlID0gMDtcbiAgICAgICAgY29uc3QgZW50cnlUZXh0ID0gSlNPTi5zdHJpbmdpZnkoZW50cnkpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIFxuICAgICAgICBxdWVyeVdvcmRzLmZvckVhY2god29yZCA9PiB7XG4gICAgICAgICAgaWYgKGVudHJ5VGV4dC5pbmNsdWRlcyh3b3JkKSkge1xuICAgICAgICAgICAgc2NvcmUgKz0gMTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHsgZW50cnksIHNjb3JlIH07XG4gICAgICB9KVxuICAgICAgLmZpbHRlcihpdGVtID0+IGl0ZW0uc2NvcmUgPiAwKVxuICAgICAgLnNvcnQoKGEsIGIpID0+IGIuc2NvcmUgLSBhLnNjb3JlKVxuICAgICAgLm1hcChpdGVtID0+IGl0ZW0uZW50cnkpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVSZXNvdXJjZUVudHJ5SXRlbShcbiAgICBlbnRyeTogYW55LCBcbiAgICByZXNvdXJjZTogYW55LCBcbiAgICBkYXRhc2V0OiBDS0FORGF0YXNldCwgXG4gICAgaW5kZXg6IG51bWJlcixcbiAgICBsYW5ndWFnZTogU3VwcG9ydGVkTGFuZ3VhZ2VcbiAgKTogT3BlbkRhdGFJdGVtIHtcbiAgICBjb25zdCB0aXRsZSA9IHRoaXMuZXh0cmFjdEVudHJ5VGl0bGUoZW50cnksIGRhdGFzZXQudGl0bGUpO1xuICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gdGhpcy5leHRyYWN0RW50cnlEZXNjcmlwdGlvbihlbnRyeSwgcmVzb3VyY2UuZGVzY3JpcHRpb24pO1xuICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLmZvcm1hdEVudHJ5Q29udGVudChlbnRyeSwgbGFuZ3VhZ2UpO1xuICAgIGNvbnN0IGNhdGVnb3J5ID0gdGhpcy5leHRyYWN0Q2F0ZWdvcnkoZGF0YXNldCk7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBgJHtkYXRhc2V0LmlkfS0ke3Jlc291cmNlLmlkfS0ke2luZGV4fWAsXG4gICAgICB0aXRsZSxcbiAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgY2F0ZWdvcnk6IGNhdGVnb3J5IGFzIE9wZW5EYXRhQ2F0ZWdvcnksXG4gICAgICB0YWdzOiBbLi4uZGF0YXNldC50YWdzLm1hcCh0YWcgPT4gdGFnLm5hbWUpLCAn44OH44O844K/44Ko44Oz44OI44OqJ10sXG4gICAgICBjb250ZW50LFxuICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgc291cmNlOiBg5p2x5Lqs6YO944Kq44O844OX44Oz44OH44O844K/OiAke2RhdGFzZXQudGl0bGV9IC0gJHtyZXNvdXJjZS5uYW1lfWAsXG4gICAgICAgIGxhc3RVcGRhdGVkOiBuZXcgRGF0ZShyZXNvdXJjZS5sYXN0X21vZGlmaWVkIHx8IGRhdGFzZXQubWV0YWRhdGFfbW9kaWZpZWQpLFxuICAgICAgICBsYW5ndWFnZSxcbiAgICAgICAgZGF0YXNldElkOiBkYXRhc2V0LmlkLFxuICAgICAgICByZXNvdXJjZUlkOiByZXNvdXJjZS5pZCxcbiAgICAgICAgb3JnYW5pemF0aW9uOiBkYXRhc2V0Lm9yZ2FuaXphdGlvbj8udGl0bGVcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBleHRyYWN0RW50cnlUaXRsZShlbnRyeTogYW55LCBkYXRhc2V0VGl0bGU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3QgdGl0bGVGaWVsZHMgPSBbJ25hbWUnLCAndGl0bGUnLCAn5ZCN56ewJywgJ+aWveioreWQjScsICfkuovmpa3lkI0nLCAnZmFjaWxpdHlfbmFtZScsICfpoIXnm67lkI0nXTtcbiAgICBcbiAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIHRpdGxlRmllbGRzKSB7XG4gICAgICBpZiAoZW50cnlbZmllbGRdICYmIHR5cGVvZiBlbnRyeVtmaWVsZF0gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiBgJHtkYXRhc2V0VGl0bGV9IC0gJHtlbnRyeVtmaWVsZF0uc3Vic3RyaW5nKDAsIDUwKX1gO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIOODleOCqeODvOODq+ODkOODg+OCr1xuICAgIGNvbnN0IGZpcnN0U3RyaW5nVmFsdWUgPSBPYmplY3QudmFsdWVzKGVudHJ5KS5maW5kKHZhbHVlID0+IFxuICAgICAgdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJiB2YWx1ZS50cmltKCkubGVuZ3RoID4gMFxuICAgICkgYXMgc3RyaW5nO1xuICAgIFxuICAgIGlmIChmaXJzdFN0cmluZ1ZhbHVlKSB7XG4gICAgICByZXR1cm4gYCR7ZGF0YXNldFRpdGxlfSAtICR7Zmlyc3RTdHJpbmdWYWx1ZS5zdWJzdHJpbmcoMCwgMzApfWA7XG4gICAgfVxuXG4gICAgcmV0dXJuIGAke2RhdGFzZXRUaXRsZX0gLSDjg4fjg7zjgr/jgqjjg7Pjg4jjg6pgO1xuICB9XG5cbiAgcHJpdmF0ZSBleHRyYWN0RW50cnlEZXNjcmlwdGlvbihlbnRyeTogYW55LCByZXNvdXJjZURlc2NyaXB0aW9uOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IGRlc2NGaWVsZHMgPSBbJ2Rlc2NyaXB0aW9uJywgJ3N1bW1hcnknLCAn6Kqs5piOJywgJ+amguimgScsICdkZXRhaWxzJ107XG4gICAgXG4gICAgZm9yIChjb25zdCBmaWVsZCBvZiBkZXNjRmllbGRzKSB7XG4gICAgICBpZiAoZW50cnlbZmllbGRdICYmIHR5cGVvZiBlbnRyeVtmaWVsZF0gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiBlbnRyeVtmaWVsZF0uc3Vic3RyaW5nKDAsIDIwMCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc291cmNlRGVzY3JpcHRpb24gfHwgJ+adseS6rOmDveOCquODvOODl+ODs+ODh+ODvOOCv+OBruOCqOODs+ODiOODquOBp+OBmeOAgic7XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdEVudHJ5Q29udGVudChlbnRyeTogYW55LCBsYW5ndWFnZTogU3VwcG9ydGVkTGFuZ3VhZ2UpOiBzdHJpbmcge1xuICAgIGNvbnN0IHRlbXBsYXRlcyA9IHtcbiAgICAgIGphOiAnIyMg44OH44O844K/6Kmz57SwXFxuXFxuJyxcbiAgICAgIGVuOiAnIyMgRGF0YSBEZXRhaWxzXFxuXFxuJ1xuICAgIH07XG4gICAgXG4gICAgbGV0IGNvbnRlbnQgPSB0ZW1wbGF0ZXNbbGFuZ3VhZ2UgYXMga2V5b2YgdHlwZW9mIHRlbXBsYXRlc10gfHwgdGVtcGxhdGVzLmphO1xuICAgIFxuICAgIE9iamVjdC5lbnRyaWVzKGVudHJ5KS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgIGlmICh2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlICE9PSAnJykge1xuICAgICAgICBjb250ZW50ICs9IGAqKiR7a2V5fSoqOiAke3ZhbHVlfVxcbmA7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gY29udGVudCB8fCAn44OH44O844K/44Ko44Oz44OI44Oq44Gu6Kmz57Sw5oOF5aCxJztcbiAgfVxuXG4gIHByaXZhdGUgZXh0cmFjdENhdGVnb3J5KGRhdGFzZXQ6IENLQU5EYXRhc2V0KTogc3RyaW5nIHtcbiAgICAvLyDjgrDjg6vjg7zjg5fmg4XloLHjgYvjgonjgqvjg4bjgrTjg6rjgpLmjqjlrppcbiAgICBpZiAoZGF0YXNldC5ncm91cHMgJiYgZGF0YXNldC5ncm91cHMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIGRhdGFzZXQuZ3JvdXBzWzBdLnRpdGxlIHx8IGRhdGFzZXQuZ3JvdXBzWzBdLm5hbWU7XG4gICAgfVxuXG4gICAgLy8g44K/44Kw44GL44KJ44Kr44OG44K044Oq44KS5o6o5a6aXG4gICAgY29uc3QgY2F0ZWdvcnlLZXl3b3JkcyA9IHtcbiAgICAgICflrZDogrLjgaYnOiBbJ+WtkOiCsuOBpicsICfkv53ogrInLCAn6IKy5YWQJywgJ+WFkOerpSddLFxuICAgICAgJ+aVmeiCsic6IFsn5pWZ6IKyJywgJ+WtpuagoScsICflrabnv5InXSxcbiAgICAgICfnpo/npYknOiBbJ+emj+eliScsICfku4vorbcnLCAn6auY6b2i6ICFJ10sXG4gICAgICAn55Kw5aKDJzogWyfnkrDlooMnLCAn5rCX6LGhJywgJ+OBlOOBvyddLFxuICAgICAgJ+S6pOmAmic6IFsn5Lqk6YCaJywgJ+mBk+i3rycsICfpm7vou4onXSxcbiAgICAgICfpmLLngb0nOiBbJ+mYsueBvScsICfngb3lrrMnLCAn6YG/6ZujJ10sXG4gICAgICAn57WM5riIJzogWyfntYzmuIgnLCAn55Sj5qWtJywgJ+S8gealrSddLFxuICAgICAgJ+ims+WFiSc6IFsn6Kaz5YWJJywgJ+aWh+WMlicsICfjgqTjg5njg7Pjg4gnXVxuICAgIH07XG5cbiAgICBjb25zdCB0YWdzID0gZGF0YXNldC50YWdzLm1hcCh0YWcgPT4gdGFnLm5hbWUpLmpvaW4oJyAnKTtcbiAgICBjb25zdCB0ZXh0ID0gYCR7ZGF0YXNldC50aXRsZX0gJHtkYXRhc2V0Lm5vdGVzfSAke3RhZ3N9YC50b0xvd2VyQ2FzZSgpO1xuXG4gICAgZm9yIChjb25zdCBbY2F0ZWdvcnksIGtleXdvcmRzXSBvZiBPYmplY3QuZW50cmllcyhjYXRlZ29yeUtleXdvcmRzKSkge1xuICAgICAgaWYgKGtleXdvcmRzLnNvbWUoa2V5d29yZCA9PiB0ZXh0LmluY2x1ZGVzKGtleXdvcmQpKSkge1xuICAgICAgICByZXR1cm4gY2F0ZWdvcnk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuICdnZW5lcmFsJztcbiAgfVxuXG4gIHByaXZhdGUgaXNTdXBwb3J0ZWRGb3JtYXQoZm9ybWF0OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICBjb25zdCBzdXBwb3J0ZWRGb3JtYXRzID0gWydKU09OJywgJ0NTVicsICdUU1YnLCAnWExTJywgJ1hMU1gnXTtcbiAgICByZXR1cm4gc3VwcG9ydGVkRm9ybWF0cy5pbmNsdWRlcyhmb3JtYXQ/LnRvVXBwZXJDYXNlKCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRGYWxsYmFja0RhdGEocXVlcnk6IHN0cmluZywgbGFuZ3VhZ2U6IFN1cHBvcnRlZExhbmd1YWdlKTogT3BlbkRhdGFJdGVtW10ge1xuICAgIGNvbnN0IHRlbXBsYXRlcyA9IHtcbiAgICAgIGphOiB7XG4gICAgICAgIHRpdGxlOiAn44GK5o6i44GX44Gu5oOF5aCx44Gr44Gk44GE44GmJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICfjgZTos6rllY/jgavjgYrnrZTjgYjjgafjgY3jgovjgojjgYbliqrjgoHjgb7jgZknLFxuICAgICAgICBjb250ZW50OiBg55Sz44GX6Kiz44GU44GW44GE44G+44Gb44KT44GM44CB44CMJHtxdWVyeX3jgI3jgavplqLjgZnjgovlhbfkvZPnmoTjgarjgqrjg7zjg5fjg7Pjg4fjg7zjgr/jgYzopovjgaTjgYvjgorjgb7jgZvjgpPjgafjgZfjgZ/jgIJcblxu5p2x5Lqs6YO944Gn44GvOSw3NDLku7bjga7jgqrjg7zjg5fjg7Pjg4fjg7zjgr/jgpLlhazplovjgZfjgabjgYTjgb7jgZnjgILku6XkuIvjga7mlrnms5XjgafjgojjgoroqbPjgZfjgYTmg4XloLHjgpLlvpfjgovjgZPjgajjgYzjgafjgY3jgb7jgZnvvJpcblxuMS4gKirmnbHkuqzpg73jgqrjg7zjg5fjg7Pjg4fjg7zjgr/jgqvjgr/jg63jgrAqKiAoaHR0cHM6Ly9jYXRhbG9nLmRhdGEubWV0cm8udG9reW8ubGcuanAvKVxuMi4gKirlkITljLrluILnlLrmnZHjga7lhazlvI/jg5vjg7zjg6Djg5rjg7zjgrgqKlxuMy4gKirmnbHkuqzpg73lhazlvI/jg5vjg7zjg6Djg5rjg7zjgrgqKiAoaHR0cHM6Ly93d3cubWV0cm8udG9reW8ubGcuanAvKVxuXG7jgojjgorlhbfkvZPnmoTjgarjgq3jg7zjg6/jg7zjg4njgoTliIbph47jgpLmjIflrprjgZfjgabjgYTjgZ/jgaDjgZHjgozjgbDjgIHplqLpgKPjgZnjgovjg4fjg7zjgr/jgpLopovjgaTjgZHjgoTjgZnjgY/jgarjgorjgb7jgZnjgIJgXG4gICAgICB9LFxuICAgICAgZW46IHtcbiAgICAgICAgdGl0bGU6ICdBYm91dCBZb3VyIElucXVpcnknLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1dlIHN0cml2ZSB0byBhbnN3ZXIgeW91ciBxdWVzdGlvbnMnLFxuICAgICAgICBjb250ZW50OiBgSSBhcG9sb2dpemUsIGJ1dCBJIGNvdWxkIG5vdCBmaW5kIHNwZWNpZmljIG9wZW4gZGF0YSByZWxhdGVkIHRvIFwiJHtxdWVyeX1cIi5cblxuVG9reW8gcHJvdmlkZXMgOSw3NDIgb3BlbiBkYXRhc2V0cy4gWW91IGNhbiBnZXQgbW9yZSBkZXRhaWxlZCBpbmZvcm1hdGlvbiB0aHJvdWdoOlxuXG4xLiAqKlRva3lvIE9wZW4gRGF0YSBDYXRhbG9nKiogKGh0dHBzOi8vY2F0YWxvZy5kYXRhLm1ldHJvLnRva3lvLmxnLmpwLylcbjIuICoqT2ZmaWNpYWwgd2Vic2l0ZXMgb2YgZWFjaCB3YXJkL2NpdHkvdG93bioqXG4zLiAqKlRva3lvIE1ldHJvcG9saXRhbiBHb3Zlcm5tZW50IE9mZmljaWFsIFdlYnNpdGUqKiAoaHR0cHM6Ly93d3cubWV0cm8udG9reW8ubGcuanAvKVxuXG5QbGVhc2UgcHJvdmlkZSBtb3JlIHNwZWNpZmljIGtleXdvcmRzIG9yIGZpZWxkcyB0byBoZWxwIGZpbmQgcmVsZXZhbnQgZGF0YS5gXG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IHRlbXBsYXRlID0gdGVtcGxhdGVzW2xhbmd1YWdlIGFzIGtleW9mIHR5cGVvZiB0ZW1wbGF0ZXNdIHx8IHRlbXBsYXRlcy5qYTtcblxuICAgIHJldHVybiBbe1xuICAgICAgaWQ6ICdmYWxsYmFjay1nZW5lcmFsJyxcbiAgICAgIHRpdGxlOiB0ZW1wbGF0ZS50aXRsZSxcbiAgICAgIGRlc2NyaXB0aW9uOiB0ZW1wbGF0ZS5kZXNjcmlwdGlvbixcbiAgICAgIGNhdGVnb3J5OiAnZ2VuZXJhbCcsXG4gICAgICB0YWdzOiBbJ+ahiOWGhScsICfjg5jjg6vjg5cnXSxcbiAgICAgIGNvbnRlbnQ6IHRlbXBsYXRlLmNvbnRlbnQsXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICBzb3VyY2U6ICfjgrfjgrnjg4bjg6AnLFxuICAgICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKSxcbiAgICAgICAgbGFuZ3VhZ2VcbiAgICAgIH1cbiAgICB9XTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliKnnlKjlj6/og73jgarjg4fjg7zjgr/jgr3jg7zjgrnkuIDopqfjgpLlj5blvpdcbiAgICovXG4gIGFzeW5jIGdldEF2YWlsYWJsZURhdGFTb3VyY2VzKCk6IFByb21pc2U8RGF0YVNvdXJjZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYXBpQmFzZVVybH0vYWN0aW9uL29yZ2FuaXphdGlvbl9saXN0YDtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KHVybCwge1xuICAgICAgICBwYXJhbXM6IHsgYWxsX2ZpZWxkczogdHJ1ZSB9LFxuICAgICAgICB0aW1lb3V0OiAxMDAwMFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN1Y2Nlc3MgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQpIHtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGEucmVzdWx0Lm1hcCgob3JnOiBhbnkpID0+ICh7XG4gICAgICAgICAgaWQ6IG9yZy5uYW1lLFxuICAgICAgICAgIHRpdGxlOiBvcmcudGl0bGUsXG4gICAgICAgICAgdXJsOiBgJHt0aGlzLmNhdGFsb2dCYXNlVXJsfS9vcmdhbml6YXRpb24vJHtvcmcubmFtZX1gLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBvcmcuZGVzY3JpcHRpb24gfHwgJ+adseS6rOmDveOCquODvOODl+ODs+ODh+ODvOOCv+aPkOS+m+e1hOe5lCcsXG4gICAgICAgICAgY2F0ZWdvcnk6ICdvcmdhbml6YXRpb24nLFxuICAgICAgICAgIGxhc3RVcGRhdGVkOiBuZXcgRGF0ZShvcmcuY3JlYXRlZClcbiAgICAgICAgfSkpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2cuZXJyb3IoJ0ZhaWxlZCB0byBmZXRjaCBkYXRhIHNvdXJjZXMnLCBlcnJvciBhcyBFcnJvcik7XG4gICAgfVxuXG4gICAgcmV0dXJuIFt7XG4gICAgICBpZDogJ3Rva3lvLW1ldHJvJyxcbiAgICAgIHRpdGxlOiAn5p2x5Lqs6YO9JyxcbiAgICAgIHVybDogdGhpcy5jYXRhbG9nQmFzZVVybCxcbiAgICAgIGRlc2NyaXB0aW9uOiAn5p2x5Lqs6YO944Kq44O844OX44Oz44OH44O844K/44Od44O844K/44OrJyxcbiAgICAgIGNhdGVnb3J5OiAnb3JnYW5pemF0aW9uJyxcbiAgICAgIGxhc3RVcGRhdGVkOiBuZXcgRGF0ZSgpXG4gICAgfV07XG4gIH1cblxuICAvKipcbiAgICog54m55a6a44Gu44Kr44OG44K044Oq44Gu44OH44O844K/44KS5qSc57SiXG4gICAqL1xuICBhc3luYyBzZWFyY2hCeUNhdGVnb3J5KGNhdGVnb3J5OiBzdHJpbmcsIGxpbWl0OiBudW1iZXIgPSAyMCk6IFByb21pc2U8T3BlbkRhdGFJdGVtW10+IHtcbiAgICBjb25zdCBzZWFyY2hQYXJhbXMgPSB7XG4gICAgICBrZXl3b3JkczogW10sXG4gICAgICBjYXRlZ29yaWVzOiBbY2F0ZWdvcnldLFxuICAgICAgb3JnYW5pemF0aW9uczogW10sXG4gICAgICB0YWdzOiBbXVxuICAgIH07XG5cbiAgICBjb25zdCBkYXRhc2V0cyA9IGF3YWl0IHRoaXMuc2VhcmNoRGF0YXNldHMoc2VhcmNoUGFyYW1zKTtcbiAgICBjb25zdCBpdGVtczogT3BlbkRhdGFJdGVtW10gPSBbXTtcblxuICAgIGZvciAoY29uc3QgZGF0YXNldCBvZiBkYXRhc2V0cy5zbGljZSgwLCBNYXRoLm1pbihsaW1pdCwgMTApKSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZGF0YXNldEl0ZW1zID0gYXdhaXQgdGhpcy5wcm9jZXNzRGF0YXNldChkYXRhc2V0LCBjYXRlZ29yeSwgJ2phJyk7XG4gICAgICAgIGl0ZW1zLnB1c2goLi4uZGF0YXNldEl0ZW1zKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGxvZy53YXJuKCdGYWlsZWQgdG8gcHJvY2VzcyBkYXRhc2V0IGluIGNhdGVnb3J5IHNlYXJjaCcsIHtcbiAgICAgICAgICBkYXRhc2V0SWQ6IGRhdGFzZXQuaWQsXG4gICAgICAgICAgY2F0ZWdvcnksXG4gICAgICAgICAgZXJyb3I6IChlcnJvciBhcyBFcnJvcikubWVzc2FnZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gaXRlbXM7XG4gIH1cblxuICAvKipcbiAgICog57Wx6KiI5oOF5aCx44KS5Y+W5b6XXG4gICAqL1xuICBhc3luYyBnZXRTdGF0cygpOiBQcm9taXNlPHtcbiAgICB0b3RhbERhdGFzZXRzOiBudW1iZXI7XG4gICAgY2F0ZWdvcmllczogQXJyYXk8eyBuYW1lOiBzdHJpbmc7IGNvdW50OiBudW1iZXIgfT47XG4gICAgb3JnYW5pemF0aW9uczogQXJyYXk8eyBuYW1lOiBzdHJpbmc7IHRpdGxlOiBzdHJpbmc7IGNvdW50OiBudW1iZXIgfT47XG4gICAgbGFzdFVwZGF0ZWQ6IERhdGU7XG4gIH0+IHtcbiAgICB0cnkge1xuICAgICAgLy8g5YWo44OH44O844K/44K744OD44OI5pWw44KS5Y+W5b6XXG4gICAgICBjb25zdCBjb3VudFJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KGAke3RoaXMuYXBpQmFzZVVybH0vYWN0aW9uL3BhY2thZ2Vfc2VhcmNoYCwge1xuICAgICAgICBwYXJhbXM6IHsgcTogJyo6KicsIHJvd3M6IDAgfSxcbiAgICAgICAgdGltZW91dDogMTAwMDBcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB0b3RhbERhdGFzZXRzID0gY291bnRSZXNwb25zZS5kYXRhLnJlc3VsdD8uY291bnQgfHwgMDtcblxuICAgICAgLy8g57WE57mU5LiA6Kan44KS5Y+W5b6XXG4gICAgICBjb25zdCBvcmdSZXNwb25zZSA9IGF3YWl0IGF4aW9zLmdldChgJHt0aGlzLmFwaUJhc2VVcmx9L2FjdGlvbi9vcmdhbml6YXRpb25fbGlzdGAsIHtcbiAgICAgICAgcGFyYW1zOiB7IGFsbF9maWVsZHM6IHRydWUgfSxcbiAgICAgICAgdGltZW91dDogMTAwMDBcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBvcmdhbml6YXRpb25zID0gb3JnUmVzcG9uc2UuZGF0YS5yZXN1bHQ/Lm1hcCgob3JnOiBhbnkpID0+ICh7XG4gICAgICAgIG5hbWU6IG9yZy5uYW1lLFxuICAgICAgICB0aXRsZTogb3JnLnRpdGxlLFxuICAgICAgICBjb3VudDogb3JnLnBhY2thZ2VfY291bnQgfHwgMFxuICAgICAgfSkpIHx8IFtdO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB0b3RhbERhdGFzZXRzLFxuICAgICAgICBjYXRlZ29yaWVzOiBbXSwgLy8gQ0tBTuOBruOCsOODq+ODvOODl0FQSeOBp+WPluW+l+WPr+iDvVxuICAgICAgICBvcmdhbml6YXRpb25zLFxuICAgICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nLmVycm9yKCdGYWlsZWQgdG8gZ2V0IHN0YXRzJywgZXJyb3IgYXMgRXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdG90YWxEYXRhc2V0czogMCxcbiAgICAgICAgY2F0ZWdvcmllczogW10sXG4gICAgICAgIG9yZ2FuaXphdGlvbnM6IFtdLFxuICAgICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKVxuICAgICAgfTtcbiAgICB9XG4gIH1cbn0iXSwibmFtZXMiOlsiYXhpb3MiLCJsb2ciLCJHZW1pbmlTZXJ2aWNlIiwic2FmZUpzb25QYXJzZSIsIlRva3lvT3BlbkRhdGFTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJjYXRhbG9nQmFzZVVybCIsImFwaUJhc2VVcmwiLCJkYXRhc2V0Q2FjaGUiLCJNYXAiLCJjYWNoZUV4cGlyeSIsIkNBQ0hFX1RUTCIsImdlbWluaVNlcnZpY2UiLCJmZXRjaFJlbGV2YW50RGF0YSIsInF1ZXJ5IiwibGFuZ3VhZ2UiLCJpbmZvIiwic3Vic3RyaW5nIiwic2VhcmNoUGFyYW1zIiwiZXh0cmFjdFNlYXJjaFBhcmFtZXRlcnMiLCJkZWJ1ZyIsImRhdGFzZXRzIiwic2VhcmNoRGF0YXNldHMiLCJjb3VudCIsImxlbmd0aCIsImdldEZhbGxiYWNrRGF0YSIsInJlbGV2YW50RGF0YXNldHMiLCJyYW5rRGF0YXNldHNCeVJlbGV2YW5jZSIsInRvcERhdGFzZXRzIiwic2xpY2UiLCJkYXRhc2V0UHJvbWlzZXMiLCJtYXAiLCJkYXRhc2V0IiwicHJvY2Vzc0RhdGFzZXQiLCJlcnJvciIsIndhcm4iLCJkYXRhc2V0SWQiLCJpZCIsIm1lc3NhZ2UiLCJkYXRhc2V0UmVzdWx0cyIsIlByb21pc2UiLCJhbGxTZXR0bGVkIiwiYWxsSXRlbXMiLCJyZXN1bHQiLCJzdGF0dXMiLCJwdXNoIiwidmFsdWUiLCJ0b3RhbEl0ZW1zIiwiZGF0YXNldHNQcm9jZXNzZWQiLCJwcm9tcHQiLCJidWlsZFNlYXJjaEV4dHJhY3Rpb25Qcm9tcHQiLCJyZXNwb25zZSIsImdlbmVyYXRlVGV4dCIsInVuZGVmaW5lZCIsInBhcnNlZCIsImtleXdvcmRzIiwiZXh0cmFjdEtleXdvcmRzQmFzaWMiLCJjYXRlZ29yaWVzIiwib3JnYW5pemF0aW9ucyIsInRhZ3MiLCJmYWxsYmFjayIsInByb21wdHMiLCJqYSIsImVuIiwicmVwbGFjZSIsInNwbGl0IiwiZmlsdGVyIiwid29yZCIsImluY2x1ZGVzIiwiU2V0IiwiY2FjaGVLZXkiLCJKU09OIiwic3RyaW5naWZ5IiwiaGFzIiwiZ2V0IiwiRGF0ZSIsIm5vdyIsInNlYXJjaFF1ZXJ5IiwiYnVpbGRDS0FOUXVlcnkiLCJ1cmwiLCJwYXJhbXMiLCJxIiwicm93cyIsInN0YXJ0Iiwic29ydCIsInRpbWVvdXQiLCJoZWFkZXJzIiwidmFsaWRhdGVTdGF0dXMiLCJkYXRhIiwic3VjY2VzcyIsInJlc3VsdHMiLCJzZXQiLCJ0b3RhbENvdW50IiwicmV0dXJuZWRDb3VudCIsIkVycm9yIiwiam9pbiIsImRhdGFzZXRzVG9SYW5rIiwiZGF0YXNldFN1bW1hcmllcyIsImluZGV4IiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsIm5vdGVzIiwidGFnIiwibmFtZSIsIm9yZ2FuaXphdGlvbiIsInJhbmtpbmdQcm9taXNlIiwicGVyZm9ybUFJUmFua2luZyIsInRpbWVvdXRQcm9taXNlIiwiXyIsInJlamVjdCIsInNldFRpbWVvdXQiLCJyYW5rZWREYXRhc2V0cyIsInJhY2UiLCJyZW1haW5pbmdEYXRhc2V0cyIsImJ1aWxkUmFua2luZ1Byb21wdCIsInJhbmtpbmciLCJBcnJheSIsImlzQXJyYXkiLCJpdGVtIiwiaSIsIm9yaWdpbmFsUXVlcnkiLCJpdGVtcyIsInN1bW1hcnlJdGVtIiwiY3JlYXRlRGF0YXNldFN1bW1hcnlJdGVtIiwicHJvY2Vzc2FibGVSZXNvdXJjZXMiLCJyZXNvdXJjZXMiLCJyZXNvdXJjZSIsImlzU3VwcG9ydGVkRm9ybWF0IiwiZm9ybWF0IiwicmVzb3VyY2VJdGVtcyIsInByb2Nlc3NSZXNvdXJjZSIsInJlc291cmNlSWQiLCJjYXRlZ29yeSIsImV4dHJhY3RDYXRlZ29yeSIsImNvbnRlbnQiLCJnZW5lcmF0ZURhdGFzZXRTdW1tYXJ5Q29udGVudCIsIm1ldGFkYXRhIiwic291cmNlIiwibGFzdFVwZGF0ZWQiLCJtZXRhZGF0YV9tb2RpZmllZCIsIm1ldGFkYXRhX2NyZWF0ZWQiLCJsaWNlbnNlIiwibGljZW5zZV90aXRsZSIsInRlbXBsYXRlcyIsInRvTG9jYWxlRGF0ZVN0cmluZyIsIm1heENvbnRlbnRMZW5ndGgiLCJjb252ZXJ0UmVzb3VyY2VEYXRhVG9JdGVtcyIsInJlbGV2YW50RW50cmllcyIsImZpbmRSZWxldmFudEVudHJpZXMiLCJmb3JFYWNoIiwiZW50cnkiLCJjcmVhdGVSZXNvdXJjZUVudHJ5SXRlbSIsInF1ZXJ5V29yZHMiLCJ0b0xvd2VyQ2FzZSIsInNjb3JlIiwiZW50cnlUZXh0IiwiYSIsImIiLCJleHRyYWN0RW50cnlUaXRsZSIsImV4dHJhY3RFbnRyeURlc2NyaXB0aW9uIiwiZm9ybWF0RW50cnlDb250ZW50IiwibGFzdF9tb2RpZmllZCIsImRhdGFzZXRUaXRsZSIsInRpdGxlRmllbGRzIiwiZmllbGQiLCJmaXJzdFN0cmluZ1ZhbHVlIiwiT2JqZWN0IiwidmFsdWVzIiwiZmluZCIsInRyaW0iLCJyZXNvdXJjZURlc2NyaXB0aW9uIiwiZGVzY0ZpZWxkcyIsImVudHJpZXMiLCJrZXkiLCJncm91cHMiLCJjYXRlZ29yeUtleXdvcmRzIiwidGV4dCIsInNvbWUiLCJrZXl3b3JkIiwic3VwcG9ydGVkRm9ybWF0cyIsInRvVXBwZXJDYXNlIiwidGVtcGxhdGUiLCJnZXRBdmFpbGFibGVEYXRhU291cmNlcyIsImFsbF9maWVsZHMiLCJvcmciLCJjcmVhdGVkIiwic2VhcmNoQnlDYXRlZ29yeSIsImxpbWl0IiwiTWF0aCIsIm1pbiIsImRhdGFzZXRJdGVtcyIsImdldFN0YXRzIiwiY291bnRSZXNwb25zZSIsInRvdGFsRGF0YXNldHMiLCJvcmdSZXNwb25zZSIsInBhY2thZ2VfY291bnQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/services/TokyoOpenDataService.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/utils/jsonParser.ts":
/*!*************************************!*\
  !*** ./src/lib/utils/jsonParser.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   containsJson: () => (/* binding */ containsJson),\n/* harmony export */   debugJsonParse: () => (/* binding */ debugJsonParse),\n/* harmony export */   parseArraySafely: () => (/* binding */ parseArraySafely),\n/* harmony export */   parseJsonFromResponse: () => (/* binding */ parseJsonFromResponse),\n/* harmony export */   parseWithFallbacks: () => (/* binding */ parseWithFallbacks),\n/* harmony export */   safeJsonParse: () => (/* binding */ safeJsonParse)\n/* harmony export */ });\n/**\n * JSON解析ユーティリティ\n * Gemini APIが返すマークダウン形式のJSONを適切に解析\n */ function parseJsonFromResponse(response) {\n    try {\n        // 1. 直接JSON解析を試行\n        return JSON.parse(response);\n    } catch (firstError) {\n        try {\n            // 2. マークダウンのコードブロックを除去（改良版）\n            let cleanedResponse = response.replace(/```json\\s*/gi, \"\").replace(/```\\s*/g, \"\").replace(/^[\\s\\n\\r]+|[\\s\\n\\r]+$/g, \"\") // 前後の空白・改行除去\n            .trim();\n            return JSON.parse(cleanedResponse);\n        } catch (secondError) {\n            try {\n                // 3. より積極的なクリーニング\n                let normalizedResponse = response.replace(/```json\\s*/gi, \"\").replace(/```\\s*/g, \"\").replace(/^\\s*[\\r\\n]+/gm, \"\") // 空行除去\n                .replace(/\\s+$/gm, \"\") // 行末空白除去\n                .replace(/([^\\\\])`/g, \"$1\") // エスケープされていないバッククォートを除去\n                .trim();\n                return JSON.parse(normalizedResponse);\n            } catch (thirdError) {\n                try {\n                    // 4. 最も外側の {} を探してバランスの取れたJSONを抽出\n                    const jsonStart = response.indexOf(\"{\");\n                    if (jsonStart !== -1) {\n                        let braceCount = 0;\n                        let jsonEnd = jsonStart;\n                        for(let i = jsonStart; i < response.length; i++){\n                            if (response[i] === \"{\") braceCount++;\n                            if (response[i] === \"}\") braceCount--;\n                            if (braceCount === 0) {\n                                jsonEnd = i;\n                                break;\n                            }\n                        }\n                        if (braceCount === 0) {\n                            const extractedJson = response.substring(jsonStart, jsonEnd + 1);\n                            return JSON.parse(extractedJson);\n                        }\n                    }\n                    // 5. 配列の場合も同様に処理\n                    const arrayStart = response.indexOf(\"[\");\n                    if (arrayStart !== -1) {\n                        let bracketCount = 0;\n                        let arrayEnd = arrayStart;\n                        for(let i = arrayStart; i < response.length; i++){\n                            if (response[i] === \"[\") bracketCount++;\n                            if (response[i] === \"]\") bracketCount--;\n                            if (bracketCount === 0) {\n                                arrayEnd = i;\n                                break;\n                            }\n                        }\n                        if (bracketCount === 0) {\n                            const extractedArray = response.substring(arrayStart, arrayEnd + 1);\n                            return JSON.parse(extractedArray);\n                        }\n                    }\n                    throw new Error(\"No valid JSON found in response\");\n                } catch (fourthError) {\n                    // 5. より詳細なエラー情報を提供\n                    console.error(\"Failed to parse JSON response:\", {\n                        originalResponse: response.substring(0, 1000) + (response.length > 1000 ? \"...\" : \"\"),\n                        responseLength: response.length,\n                        hasJsonStart: response.includes(\"{\"),\n                        hasArrayStart: response.includes(\"[\"),\n                        hasCodeBlock: response.includes(\"```\"),\n                        errors: [\n                            firstError.message,\n                            secondError.message,\n                            thirdError.message,\n                            fourthError.message\n                        ]\n                    });\n                    // 6. 最後の手段：基本的な値を返す\n                    return {\n                        error: \"JSON parsing failed\",\n                        originalResponse: response.substring(0, 500) + (response.length > 500 ? \"...\" : \"\"),\n                        fallbackUsed: true\n                    };\n                }\n            }\n        }\n    }\n}\n/**\n * JSON解析の安全なラッパー\n * デフォルト値を提供し、エラーを適切に処理\n */ function safeJsonParse(response, defaultValue) {\n    try {\n        const parsed = parseJsonFromResponse(response);\n        // フォールバックが使用された場合はデフォルト値を返す\n        if (parsed && parsed.fallbackUsed) {\n            return defaultValue;\n        }\n        return parsed;\n    } catch (error) {\n        console.warn(\"Safe JSON parse failed, using default value:\", error);\n        return defaultValue;\n    }\n}\n/**\n * 特定のフィールドに対するフォールバック値を持つ安全な解析\n */ function parseWithFallbacks(response, fallbacks) {\n    try {\n        const parsed = parseJsonFromResponse(response);\n        // 解析されたオブジェクトとフォールバックをマージ\n        return {\n            ...fallbacks,\n            ...parsed\n        };\n    } catch (error) {\n        console.warn(\"JSON parse with fallbacks failed, using fallback values:\", error);\n        return fallbacks;\n    }\n}\n/**\n * 配列を期待する場合の安全な解析\n */ function parseArraySafely(response, defaultArray = []) {\n    try {\n        const parsed = parseJsonFromResponse(response);\n        if (Array.isArray(parsed)) {\n            return parsed;\n        }\n        // オブジェクトの場合、値が配列かチェック\n        if (typeof parsed === \"object\" && parsed !== null) {\n            for (const value of Object.values(parsed)){\n                if (Array.isArray(value)) {\n                    return value;\n                }\n            }\n        }\n        return defaultArray;\n    } catch (error) {\n        console.warn(\"Array parsing failed, using default array:\", error);\n        return defaultArray;\n    }\n}\n/**\n * レスポンスにJSONが含まれているかチェック\n */ function containsJson(response) {\n    // JSON開始文字の存在をチェック\n    const hasJsonStart = response.includes(\"{\") || response.includes(\"[\");\n    // マークダウンコードブロックの存在をチェック\n    const hasCodeBlock = response.includes(\"```json\") || response.includes(\"```\");\n    return hasJsonStart || hasCodeBlock;\n}\n/**\n * デバッグ用：解析失敗時の詳細情報を提供\n */ function debugJsonParse(response) {\n    const errors = [];\n    let parsed = null;\n    let success = false;\n    const cleanedResponse = response.replace(/```json\\s*/gi, \"\").replace(/```\\s*/g, \"\").trim();\n    try {\n        parsed = JSON.parse(response);\n        success = true;\n    } catch (error) {\n        errors.push(`Direct parse: ${error.message}`);\n    }\n    if (!success) {\n        try {\n            parsed = JSON.parse(cleanedResponse);\n            success = true;\n        } catch (error) {\n            errors.push(`Cleaned parse: ${error.message}`);\n        }\n    }\n    return {\n        success,\n        parsed,\n        errors,\n        cleanedResponse\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O0lBQ0Y7SUFFQSxPQUFPO1FBQ0xpQjtRQUNBYjtRQUNBTDtRQUNBNUI7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdG9reW8tb3BlbmRhdGEtaGFja2F0aG9uLy4vc3JjL2xpYi91dGlscy9qc29uUGFyc2VyLnRzPzVlZmYiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBKU09O6Kej5p6Q44Om44O844OG44Kj44Oq44OG44KjXG4gKiBHZW1pbmkgQVBJ44GM6L+U44GZ44Oe44O844Kv44OA44Km44Oz5b2i5byP44GuSlNPTuOCkumBqeWIh+OBq+ino+aekFxuICovXG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUpzb25Gcm9tUmVzcG9uc2UocmVzcG9uc2U6IHN0cmluZyk6IGFueSB7XG4gIHRyeSB7XG4gICAgLy8gMS4g55u05o6lSlNPTuino+aekOOCkuippuihjFxuICAgIHJldHVybiBKU09OLnBhcnNlKHJlc3BvbnNlKTtcbiAgfSBjYXRjaCAoZmlyc3RFcnJvcikge1xuICAgIHRyeSB7XG4gICAgICAvLyAyLiDjg57jg7zjgq/jg4Djgqbjg7Pjga7jgrPjg7zjg4njg5bjg63jg4Pjgq/jgpLpmaTljrvvvIjmlLnoia/niYjvvIlcbiAgICAgIGxldCBjbGVhbmVkUmVzcG9uc2UgPSByZXNwb25zZVxuICAgICAgICAucmVwbGFjZSgvYGBganNvblxccyovZ2ksICcnKVxuICAgICAgICAucmVwbGFjZSgvYGBgXFxzKi9nLCAnJylcbiAgICAgICAgLnJlcGxhY2UoL15bXFxzXFxuXFxyXSt8W1xcc1xcblxccl0rJC9nLCAnJykgLy8g5YmN5b6M44Gu56m655m944O75pS56KGM6Zmk5Y67XG4gICAgICAgIC50cmltKCk7XG4gICAgICBcbiAgICAgIHJldHVybiBKU09OLnBhcnNlKGNsZWFuZWRSZXNwb25zZSk7XG4gICAgfSBjYXRjaCAoc2Vjb25kRXJyb3IpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIDMuIOOCiOOCiuepjealteeahOOBquOCr+ODquODvOODi+ODs+OCsFxuICAgICAgICBsZXQgbm9ybWFsaXplZFJlc3BvbnNlID0gcmVzcG9uc2VcbiAgICAgICAgICAucmVwbGFjZSgvYGBganNvblxccyovZ2ksICcnKVxuICAgICAgICAgIC5yZXBsYWNlKC9gYGBcXHMqL2csICcnKVxuICAgICAgICAgIC5yZXBsYWNlKC9eXFxzKltcXHJcXG5dKy9nbSwgJycpIC8vIOepuuihjOmZpOWOu1xuICAgICAgICAgIC5yZXBsYWNlKC9cXHMrJC9nbSwgJycpIC8vIOihjOacq+epuueZvemZpOWOu1xuICAgICAgICAgIC5yZXBsYWNlKC8oW15cXFxcXSlgL2csICckMScpIC8vIOOCqOOCueOCseODvOODl+OBleOCjOOBpuOBhOOBquOBhOODkOODg+OCr+OCr+OCqeODvOODiOOCkumZpOWOu1xuICAgICAgICAgIC50cmltKCk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShub3JtYWxpemVkUmVzcG9uc2UpO1xuICAgICAgfSBjYXRjaCAodGhpcmRFcnJvcikge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIC8vIDQuIOacgOOCguWkluWBtOOBriB7fSDjgpLmjqLjgZfjgabjg5Djg6njg7Pjgrnjga7lj5bjgozjgZ9KU09O44KS5oq95Ye6XG4gICAgICAgICAgY29uc3QganNvblN0YXJ0ID0gcmVzcG9uc2UuaW5kZXhPZigneycpO1xuICAgICAgICAgIGlmIChqc29uU3RhcnQgIT09IC0xKSB7XG4gICAgICAgICAgICBsZXQgYnJhY2VDb3VudCA9IDA7XG4gICAgICAgICAgICBsZXQganNvbkVuZCA9IGpzb25TdGFydDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IGpzb25TdGFydDsgaSA8IHJlc3BvbnNlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgIGlmIChyZXNwb25zZVtpXSA9PT0gJ3snKSBicmFjZUNvdW50Kys7XG4gICAgICAgICAgICAgIGlmIChyZXNwb25zZVtpXSA9PT0gJ30nKSBicmFjZUNvdW50LS07XG4gICAgICAgICAgICAgIGlmIChicmFjZUNvdW50ID09PSAwKSB7XG4gICAgICAgICAgICAgICAganNvbkVuZCA9IGk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGJyYWNlQ291bnQgPT09IDApIHtcbiAgICAgICAgICAgICAgY29uc3QgZXh0cmFjdGVkSnNvbiA9IHJlc3BvbnNlLnN1YnN0cmluZyhqc29uU3RhcnQsIGpzb25FbmQgKyAxKTtcbiAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoZXh0cmFjdGVkSnNvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIDUuIOmFjeWIl+OBruWgtOWQiOOCguWQjOanmOOBq+WHpueQhlxuICAgICAgICAgIGNvbnN0IGFycmF5U3RhcnQgPSByZXNwb25zZS5pbmRleE9mKCdbJyk7XG4gICAgICAgICAgaWYgKGFycmF5U3RhcnQgIT09IC0xKSB7XG4gICAgICAgICAgICBsZXQgYnJhY2tldENvdW50ID0gMDtcbiAgICAgICAgICAgIGxldCBhcnJheUVuZCA9IGFycmF5U3RhcnQ7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSBhcnJheVN0YXJ0OyBpIDwgcmVzcG9uc2UubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlW2ldID09PSAnWycpIGJyYWNrZXRDb3VudCsrO1xuICAgICAgICAgICAgICBpZiAocmVzcG9uc2VbaV0gPT09ICddJykgYnJhY2tldENvdW50LS07XG4gICAgICAgICAgICAgIGlmIChicmFja2V0Q291bnQgPT09IDApIHtcbiAgICAgICAgICAgICAgICBhcnJheUVuZCA9IGk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGJyYWNrZXRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgICBjb25zdCBleHRyYWN0ZWRBcnJheSA9IHJlc3BvbnNlLnN1YnN0cmluZyhhcnJheVN0YXJ0LCBhcnJheUVuZCArIDEpO1xuICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShleHRyYWN0ZWRBcnJheSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gdmFsaWQgSlNPTiBmb3VuZCBpbiByZXNwb25zZScpO1xuICAgICAgICB9IGNhdGNoIChmb3VydGhFcnJvcikge1xuICAgICAgICAgIC8vIDUuIOOCiOOCiuips+e0sOOBquOCqOODqeODvOaDheWgseOCkuaPkOS+m1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBwYXJzZSBKU09OIHJlc3BvbnNlOicsIHtcbiAgICAgICAgICAgIG9yaWdpbmFsUmVzcG9uc2U6IHJlc3BvbnNlLnN1YnN0cmluZygwLCAxMDAwKSArIChyZXNwb25zZS5sZW5ndGggPiAxMDAwID8gJy4uLicgOiAnJyksXG4gICAgICAgICAgICByZXNwb25zZUxlbmd0aDogcmVzcG9uc2UubGVuZ3RoLFxuICAgICAgICAgICAgaGFzSnNvblN0YXJ0OiByZXNwb25zZS5pbmNsdWRlcygneycpLFxuICAgICAgICAgICAgaGFzQXJyYXlTdGFydDogcmVzcG9uc2UuaW5jbHVkZXMoJ1snKSxcbiAgICAgICAgICAgIGhhc0NvZGVCbG9jazogcmVzcG9uc2UuaW5jbHVkZXMoJ2BgYCcpLFxuICAgICAgICAgICAgZXJyb3JzOiBbXG4gICAgICAgICAgICAgIChmaXJzdEVycm9yIGFzIEVycm9yKS5tZXNzYWdlLFxuICAgICAgICAgICAgICAoc2Vjb25kRXJyb3IgYXMgRXJyb3IpLm1lc3NhZ2UsXG4gICAgICAgICAgICAgICh0aGlyZEVycm9yIGFzIEVycm9yKS5tZXNzYWdlLFxuICAgICAgICAgICAgICAoZm91cnRoRXJyb3IgYXMgRXJyb3IpLm1lc3NhZ2VcbiAgICAgICAgICAgIF1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyA2LiDmnIDlvozjga7miYvmrrXvvJrln7rmnKznmoTjgarlgKTjgpLov5TjgZlcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZXJyb3I6ICdKU09OIHBhcnNpbmcgZmFpbGVkJyxcbiAgICAgICAgICAgIG9yaWdpbmFsUmVzcG9uc2U6IHJlc3BvbnNlLnN1YnN0cmluZygwLCA1MDApICsgKHJlc3BvbnNlLmxlbmd0aCA+IDUwMCA/ICcuLi4nIDogJycpLFxuICAgICAgICAgICAgZmFsbGJhY2tVc2VkOiB0cnVlXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIEpTT07op6PmnpDjga7lronlhajjgarjg6njg4Pjg5Hjg7xcbiAqIOODh+ODleOCqeODq+ODiOWApOOCkuaPkOS+m+OBl+OAgeOCqOODqeODvOOCkumBqeWIh+OBq+WHpueQhlxuICovXG5leHBvcnQgZnVuY3Rpb24gc2FmZUpzb25QYXJzZTxUPihyZXNwb25zZTogc3RyaW5nLCBkZWZhdWx0VmFsdWU6IFQpOiBUIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwYXJzZWQgPSBwYXJzZUpzb25Gcm9tUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgIFxuICAgIC8vIOODleOCqeODvOODq+ODkOODg+OCr+OBjOS9v+eUqOOBleOCjOOBn+WgtOWQiOOBr+ODh+ODleOCqeODq+ODiOWApOOCkui/lOOBmVxuICAgIGlmIChwYXJzZWQgJiYgcGFyc2VkLmZhbGxiYWNrVXNlZCkge1xuICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHBhcnNlZCBhcyBUO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUud2FybignU2FmZSBKU09OIHBhcnNlIGZhaWxlZCwgdXNpbmcgZGVmYXVsdCB2YWx1ZTonLCBlcnJvcik7XG4gICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbiAgfVxufVxuXG4vKipcbiAqIOeJueWumuOBruODleOCo+ODvOODq+ODieOBq+WvvuOBmeOCi+ODleOCqeODvOODq+ODkOODg+OCr+WApOOCkuaMgeOBpOWuieWFqOOBquino+aekFxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VXaXRoRmFsbGJhY2tzPFQ+KFxuICByZXNwb25zZTogc3RyaW5nLFxuICBmYWxsYmFja3M6IFBhcnRpYWw8VD5cbik6IFQge1xuICB0cnkge1xuICAgIGNvbnN0IHBhcnNlZCA9IHBhcnNlSnNvbkZyb21SZXNwb25zZShyZXNwb25zZSk7XG4gICAgXG4gICAgLy8g6Kej5p6Q44GV44KM44Gf44Kq44OW44K444Kn44Kv44OI44Go44OV44Kp44O844Or44OQ44OD44Kv44KS44Oe44O844K4XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmZhbGxiYWNrcyxcbiAgICAgIC4uLnBhcnNlZFxuICAgIH0gYXMgVDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLndhcm4oJ0pTT04gcGFyc2Ugd2l0aCBmYWxsYmFja3MgZmFpbGVkLCB1c2luZyBmYWxsYmFjayB2YWx1ZXM6JywgZXJyb3IpO1xuICAgIHJldHVybiBmYWxsYmFja3MgYXMgVDtcbiAgfVxufVxuXG4vKipcbiAqIOmFjeWIl+OCkuacn+W+heOBmeOCi+WgtOWQiOOBruWuieWFqOOBquino+aekFxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VBcnJheVNhZmVseTxUPihyZXNwb25zZTogc3RyaW5nLCBkZWZhdWx0QXJyYXk6IFRbXSA9IFtdKTogVFtdIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwYXJzZWQgPSBwYXJzZUpzb25Gcm9tUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgIFxuICAgIGlmIChBcnJheS5pc0FycmF5KHBhcnNlZCkpIHtcbiAgICAgIHJldHVybiBwYXJzZWQ7XG4gICAgfVxuICAgIFxuICAgIC8vIOOCquODluOCuOOCp+OCr+ODiOOBruWgtOWQiOOAgeWApOOBjOmFjeWIl+OBi+ODgeOCp+ODg+OCr1xuICAgIGlmICh0eXBlb2YgcGFyc2VkID09PSAnb2JqZWN0JyAmJiBwYXJzZWQgIT09IG51bGwpIHtcbiAgICAgIGZvciAoY29uc3QgdmFsdWUgb2YgT2JqZWN0LnZhbHVlcyhwYXJzZWQpKSB7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZGVmYXVsdEFycmF5O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUud2FybignQXJyYXkgcGFyc2luZyBmYWlsZWQsIHVzaW5nIGRlZmF1bHQgYXJyYXk6JywgZXJyb3IpO1xuICAgIHJldHVybiBkZWZhdWx0QXJyYXk7XG4gIH1cbn1cblxuLyoqXG4gKiDjg6zjgrnjg53jg7PjgrnjgatKU09O44GM5ZCr44G+44KM44Gm44GE44KL44GL44OB44Kn44OD44KvXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb250YWluc0pzb24ocmVzcG9uc2U6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAvLyBKU09O6ZaL5aeL5paH5a2X44Gu5a2Y5Zyo44KS44OB44Kn44OD44KvXG4gIGNvbnN0IGhhc0pzb25TdGFydCA9IHJlc3BvbnNlLmluY2x1ZGVzKCd7JykgfHwgcmVzcG9uc2UuaW5jbHVkZXMoJ1snKTtcbiAgXG4gIC8vIOODnuODvOOCr+ODgOOCpuODs+OCs+ODvOODieODluODreODg+OCr+OBruWtmOWcqOOCkuODgeOCp+ODg+OCr1xuICBjb25zdCBoYXNDb2RlQmxvY2sgPSByZXNwb25zZS5pbmNsdWRlcygnYGBganNvbicpIHx8IHJlc3BvbnNlLmluY2x1ZGVzKCdgYGAnKTtcbiAgXG4gIHJldHVybiBoYXNKc29uU3RhcnQgfHwgaGFzQ29kZUJsb2NrO1xufVxuXG4vKipcbiAqIOODh+ODkOODg+OCsOeUqO+8muino+aekOWkseaVl+aZguOBruips+e0sOaDheWgseOCkuaPkOS+m1xuICovXG5leHBvcnQgZnVuY3Rpb24gZGVidWdKc29uUGFyc2UocmVzcG9uc2U6IHN0cmluZyk6IHtcbiAgc3VjY2VzczogYm9vbGVhbjtcbiAgcGFyc2VkPzogYW55O1xuICBlcnJvcnM6IHN0cmluZ1tdO1xuICBjbGVhbmVkUmVzcG9uc2U6IHN0cmluZztcbn0ge1xuICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG4gIGxldCBwYXJzZWQ6IGFueSA9IG51bGw7XG4gIGxldCBzdWNjZXNzID0gZmFsc2U7XG4gIFxuICBjb25zdCBjbGVhbmVkUmVzcG9uc2UgPSByZXNwb25zZVxuICAgIC5yZXBsYWNlKC9gYGBqc29uXFxzKi9naSwgJycpXG4gICAgLnJlcGxhY2UoL2BgYFxccyovZywgJycpXG4gICAgLnRyaW0oKTtcbiAgXG4gIHRyeSB7XG4gICAgcGFyc2VkID0gSlNPTi5wYXJzZShyZXNwb25zZSk7XG4gICAgc3VjY2VzcyA9IHRydWU7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgZXJyb3JzLnB1c2goYERpcmVjdCBwYXJzZTogJHsoZXJyb3IgYXMgRXJyb3IpLm1lc3NhZ2V9YCk7XG4gIH1cbiAgXG4gIGlmICghc3VjY2Vzcykge1xuICAgIHRyeSB7XG4gICAgICBwYXJzZWQgPSBKU09OLnBhcnNlKGNsZWFuZWRSZXNwb25zZSk7XG4gICAgICBzdWNjZXNzID0gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgZXJyb3JzLnB1c2goYENsZWFuZWQgcGFyc2U6ICR7KGVycm9yIGFzIEVycm9yKS5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuICBcbiAgcmV0dXJuIHtcbiAgICBzdWNjZXNzLFxuICAgIHBhcnNlZCxcbiAgICBlcnJvcnMsXG4gICAgY2xlYW5lZFJlc3BvbnNlXG4gIH07XG59Il0sIm5hbWVzIjpbInBhcnNlSnNvbkZyb21SZXNwb25zZSIsInJlc3BvbnNlIiwiSlNPTiIsInBhcnNlIiwiZmlyc3RFcnJvciIsImNsZWFuZWRSZXNwb25zZSIsInJlcGxhY2UiLCJ0cmltIiwic2Vjb25kRXJyb3IiLCJub3JtYWxpemVkUmVzcG9uc2UiLCJ0aGlyZEVycm9yIiwianNvblN0YXJ0IiwiaW5kZXhPZiIsImJyYWNlQ291bnQiLCJqc29uRW5kIiwiaSIsImxlbmd0aCIsImV4dHJhY3RlZEpzb24iLCJzdWJzdHJpbmciLCJhcnJheVN0YXJ0IiwiYnJhY2tldENvdW50IiwiYXJyYXlFbmQiLCJleHRyYWN0ZWRBcnJheSIsIkVycm9yIiwiZm91cnRoRXJyb3IiLCJjb25zb2xlIiwiZXJyb3IiLCJvcmlnaW5hbFJlc3BvbnNlIiwicmVzcG9uc2VMZW5ndGgiLCJoYXNKc29uU3RhcnQiLCJpbmNsdWRlcyIsImhhc0FycmF5U3RhcnQiLCJoYXNDb2RlQmxvY2siLCJlcnJvcnMiLCJtZXNzYWdlIiwiZmFsbGJhY2tVc2VkIiwic2FmZUpzb25QYXJzZSIsImRlZmF1bHRWYWx1ZSIsInBhcnNlZCIsIndhcm4iLCJwYXJzZVdpdGhGYWxsYmFja3MiLCJmYWxsYmFja3MiLCJwYXJzZUFycmF5U2FmZWx5IiwiZGVmYXVsdEFycmF5IiwiQXJyYXkiLCJpc0FycmF5IiwidmFsdWUiLCJPYmplY3QiLCJ2YWx1ZXMiLCJjb250YWluc0pzb24iLCJkZWJ1Z0pzb25QYXJzZSIsInN1Y2Nlc3MiLCJwdXNoIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/utils/jsonParser.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/validation.ts":
/*!*******************************!*\
  !*** ./src/lib/validation.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   checkRateLimit: () => (/* binding */ checkRateLimit),\n/* harmony export */   cleanupRateLimit: () => (/* binding */ cleanupRateLimit),\n/* harmony export */   sanitizeHtmlContent: () => (/* binding */ sanitizeHtmlContent),\n/* harmony export */   validateAndSanitizeText: () => (/* binding */ validateAndSanitizeText),\n/* harmony export */   validateAudioFile: () => (/* binding */ validateAudioFile),\n/* harmony export */   validateChatRequest: () => (/* binding */ validateChatRequest),\n/* harmony export */   validateLanguage: () => (/* binding */ validateLanguage),\n/* harmony export */   validateLocation: () => (/* binding */ validateLocation),\n/* harmony export */   validateRequestedScope: () => (/* binding */ validateRequestedScope),\n/* harmony export */   validateSessionId: () => (/* binding */ validateSessionId)\n/* harmony export */ });\n/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./config */ \"(rsc)/./src/lib/config.ts\");\n\n// Text sanitization and validation\nconst validateAndSanitizeText = (input, fieldName = \"text\")=>{\n    const errors = [];\n    // Check if input exists\n    if (!input || typeof input !== \"string\") {\n        return {\n            isValid: false,\n            errors: [\n                `${fieldName} is required and must be a string`\n            ]\n        };\n    }\n    // Trim whitespace\n    let sanitized = input.trim();\n    // Check length\n    if (sanitized.length === 0) {\n        errors.push(`${fieldName} cannot be empty`);\n    }\n    if (sanitized.length > _config__WEBPACK_IMPORTED_MODULE_0__.securityConfig.validation.maxMessageLength) {\n        errors.push(`${fieldName} exceeds maximum length of ${_config__WEBPACK_IMPORTED_MODULE_0__.securityConfig.validation.maxMessageLength} characters`);\n    }\n    // Remove dangerous characters and patterns\n    // Remove control characters except newline, tab, and carriage return\n    sanitized = sanitized.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F]/g, \"\");\n    // Enhanced XSS protection\n    const xssPatterns = [\n        // Script tags (various forms)\n        /<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi,\n        /<\\/script>/gi,\n        /<script[^>]*>/gi,\n        // Javascript protocols\n        /javascript:/gi,\n        /vbscript:/gi,\n        /data:text\\/html/gi,\n        // Event handlers\n        /on\\w+\\s*=/gi,\n        // HTML tags that can execute JavaScript\n        /<iframe\\b[^>]*>/gi,\n        /<object\\b[^>]*>/gi,\n        /<embed\\b[^>]*>/gi,\n        /<link\\b[^>]*>/gi,\n        /<meta\\b[^>]*>/gi,\n        /<form\\b[^>]*>/gi,\n        // Style with expression\n        /style\\s*=.*expression\\s*\\(/gi,\n        // HTML entities that might be used for XSS\n        /&\\#x?[0-9a-f]+;?/gi\n    ];\n    let hadXssContent = false;\n    xssPatterns.forEach((pattern)=>{\n        if (pattern.test(sanitized)) {\n            hadXssContent = true;\n            sanitized = sanitized.replace(pattern, \"\");\n        }\n    });\n    if (hadXssContent) {\n        errors.push(`${fieldName} contained potentially malicious content that was removed`);\n    }\n    // Enhanced SQL injection protection\n    const sqlPatterns = [\n        // SQL keywords\n        /(\\b(SELECT|INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|EXEC|EXECUTE|UNION|TRUNCATE|GRANT|REVOKE)\\b)/gi,\n        // SQL comments and terminators\n        /(--|\\/\\*|\\*\\/|;)/g,\n        // SQL injection patterns\n        /(\\b(OR|AND)\\s+\\w+\\s*=\\s*\\w+)/gi,\n        /(\\b(OR|AND)\\s+1\\s*=\\s*1)/gi,\n        /(\\b(OR|AND)\\s+\\w+\\s*(LIKE|IN|IS))/gi,\n        // Union-based injection\n        /UNION\\s+SELECT/gi,\n        // Information schema access\n        /information_schema/gi,\n        // System functions\n        /(LOAD_FILE|INTO\\s+OUTFILE|INTO\\s+DUMPFILE)/gi,\n        // Hex encoding patterns\n        /0x[0-9a-f]+/gi\n    ];\n    let hadSqlContent = false;\n    sqlPatterns.forEach((pattern)=>{\n        if (pattern.test(sanitized)) {\n            hadSqlContent = true;\n        }\n    });\n    if (hadSqlContent) {\n        errors.push(`${fieldName} contains potentially dangerous SQL patterns`);\n    }\n    // Path traversal protection\n    const pathTraversalPatterns = [\n        /\\.\\.\\//g,\n        /\\.\\.\\\\/g,\n        /%2e%2e%2f/gi,\n        /%2e%2e%5c/gi,\n        /\\.\\.%2f/gi,\n        /\\.\\.%5c/gi\n    ];\n    let hadPathTraversal = false;\n    pathTraversalPatterns.forEach((pattern)=>{\n        if (pattern.test(sanitized)) {\n            hadPathTraversal = true;\n        }\n    });\n    if (hadPathTraversal) {\n        errors.push(`${fieldName} contains path traversal patterns`);\n    }\n    // LDAP injection protection\n    const ldapPatterns = [\n        /[()\\\\*\\x00]/g\n    ];\n    let hadLdapContent = false;\n    ldapPatterns.forEach((pattern)=>{\n        if (pattern.test(sanitized)) {\n            hadLdapContent = true;\n        }\n    });\n    if (hadLdapContent) {\n        errors.push(`${fieldName} contains LDAP injection patterns`);\n    }\n    // Check for excessive repetition (potential spam)\n    const repeatedPattern = /(.)\\1{20,}/;\n    if (repeatedPattern.test(sanitized)) {\n        errors.push(`${fieldName} contains excessive character repetition`);\n    }\n    // Final safety check: ensure no null bytes or excessive whitespace\n    sanitized = sanitized.replace(/\\0/g, \"\");\n    sanitized = sanitized.replace(/\\s{10,}/g, \" \"); // Replace excessive whitespace\n    // Check for encoded attacks\n    const encodedPatterns = [\n        /%3c/gi,\n        /%3e/gi,\n        /%22/gi,\n        /%27/gi,\n        /%28/gi,\n        /%29/gi,\n        /%3b/gi\n    ];\n    let hadEncodedAttack = false;\n    encodedPatterns.forEach((pattern)=>{\n        if (pattern.test(sanitized)) {\n            hadEncodedAttack = true;\n        }\n    });\n    if (hadEncodedAttack) {\n        errors.push(`${fieldName} contains URL-encoded potentially dangerous content`);\n    }\n    return {\n        isValid: errors.length === 0,\n        errors,\n        sanitized: errors.length === 0 ? sanitized : undefined\n    };\n};\n// Additional sanitization for HTML content (if needed)\nconst sanitizeHtmlContent = (input)=>{\n    if (!input) return \"\";\n    // Basic HTML entity encoding for dangerous characters\n    const htmlEntities = {\n        \"&\": \"&amp;\",\n        \"<\": \"&lt;\",\n        \">\": \"&gt;\",\n        '\"': \"&quot;\",\n        \"'\": \"&#x27;\",\n        \"/\": \"&#x2F;\"\n    };\n    return input.replace(/[&<>\"'/]/g, (char)=>htmlEntities[char] || char);\n};\n// Session ID validation\nconst validateSessionId = (sessionId)=>{\n    const errors = [];\n    if (!sessionId || typeof sessionId !== \"string\") {\n        return {\n            isValid: false,\n            errors: [\n                \"Session ID is required\"\n            ]\n        };\n    }\n    // Check format (UUID v4 format)\n    const uuidPattern = /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\n    if (!uuidPattern.test(sessionId)) {\n        errors.push(\"Invalid session ID format\");\n    }\n    return {\n        isValid: errors.length === 0,\n        errors,\n        sanitized: sessionId\n    };\n};\n// Language validation\nconst validateLanguage = (language)=>{\n    const supportedLanguages = [\n        \"ja\",\n        \"en\",\n        \"zh\",\n        \"ko\"\n    ];\n    const errors = [];\n    if (!language || typeof language !== \"string\") {\n        return {\n            isValid: false,\n            errors: [\n                \"Language is required\"\n            ]\n        };\n    }\n    const sanitized = language.toLowerCase().trim();\n    if (!supportedLanguages.includes(sanitized)) {\n        errors.push(`Unsupported language: ${language}. Supported languages: ${supportedLanguages.join(\", \")}`);\n    }\n    return {\n        isValid: errors.length === 0,\n        errors,\n        sanitized: errors.length === 0 ? sanitized : undefined\n    };\n};\n// Audio file validation\nconst validateAudioFile = (file)=>{\n    const errors = [];\n    // Check file size\n    if (file.size > _config__WEBPACK_IMPORTED_MODULE_0__.securityConfig.validation.maxFileSize) {\n        errors.push(`File size exceeds maximum limit of ${_config__WEBPACK_IMPORTED_MODULE_0__.securityConfig.validation.maxFileSize / 1024 / 1024}MB`);\n    }\n    // Check MIME type\n    if (!_config__WEBPACK_IMPORTED_MODULE_0__.securityConfig.validation.allowedAudioTypes.includes(file.type)) {\n        errors.push(`Unsupported audio format: ${file.type}. Allowed formats: ${_config__WEBPACK_IMPORTED_MODULE_0__.securityConfig.validation.allowedAudioTypes.join(\", \")}`);\n    }\n    // Validate base64 data\n    try {\n        const base64Pattern = /^[A-Za-z0-9+/]*={0,2}$/;\n        if (!base64Pattern.test(file.data)) {\n            errors.push(\"Invalid audio data format\");\n        }\n    } catch  {\n        errors.push(\"Invalid audio data\");\n    }\n    return {\n        isValid: errors.length === 0,\n        errors\n    };\n};\n// Request body validation for chat endpoint\nconst validateChatRequest = (body)=>{\n    const errors = [];\n    if (!body || typeof body !== \"object\") {\n        return {\n            isValid: false,\n            errors: [\n                \"Request body is required\"\n            ]\n        };\n    }\n    // Validate message\n    const messageValidation = validateAndSanitizeText(body.message, \"message\");\n    if (!messageValidation.isValid) {\n        errors.push(...messageValidation.errors);\n    }\n    // Validate session ID\n    const sessionValidation = validateSessionId(body.sessionId);\n    if (!sessionValidation.isValid) {\n        errors.push(...sessionValidation.errors);\n    }\n    // Validate language (optional)\n    let languageValidation;\n    if (body.language) {\n        languageValidation = validateLanguage(body.language);\n        if (!languageValidation.isValid) {\n            errors.push(...languageValidation.errors);\n        }\n    }\n    // Validate boolean fields\n    if (body.useVoice !== undefined && typeof body.useVoice !== \"boolean\") {\n        errors.push(\"useVoice must be a boolean\");\n    }\n    // Validate inputType (optional)\n    if (body.inputType !== undefined && ![\n        \"text\",\n        \"voice\"\n    ].includes(body.inputType)) {\n        errors.push('inputType must be either \"text\" or \"voice\"');\n    }\n    // Validate location (optional)\n    let locationValidation;\n    if (body.location) {\n        locationValidation = validateLocation(body.location);\n        if (!locationValidation.isValid) {\n            errors.push(...locationValidation.errors);\n        }\n    }\n    // Validate requestedScope (optional)\n    let scopeValidation;\n    if (body.requestedScope) {\n        scopeValidation = validateRequestedScope(body.requestedScope);\n        if (!scopeValidation.isValid) {\n            errors.push(...scopeValidation.errors);\n        }\n    }\n    return {\n        isValid: errors.length === 0,\n        errors,\n        sanitized: errors.length === 0 && messageValidation.sanitized && sessionValidation.sanitized ? {\n            message: messageValidation.sanitized,\n            sessionId: sessionValidation.sanitized,\n            language: body.language ? languageValidation?.sanitized || \"ja\" : \"ja\",\n            useVoice: Boolean(body.useVoice),\n            inputType: body.inputType || \"text\",\n            location: locationValidation?.sanitized,\n            requestedScope: scopeValidation?.sanitized\n        } : undefined\n    };\n};\n// Rate limiting check (simple in-memory implementation)\nconst rateLimitStore = new Map();\nconst checkRateLimit = (identifier)=>{\n    const now = Date.now();\n    const windowMs = _config__WEBPACK_IMPORTED_MODULE_0__.securityConfig.rateLimiting.windowMs;\n    const maxRequests = _config__WEBPACK_IMPORTED_MODULE_0__.securityConfig.rateLimiting.maxRequests;\n    const current = rateLimitStore.get(identifier);\n    if (!current || now > current.resetTime) {\n        // First request or window expired\n        rateLimitStore.set(identifier, {\n            count: 1,\n            resetTime: now + windowMs\n        });\n        return {\n            allowed: true\n        };\n    }\n    if (current.count >= maxRequests) {\n        return {\n            allowed: false,\n            retryAfter: Math.ceil((current.resetTime - now) / 1000)\n        };\n    }\n    // Increment counter\n    current.count++;\n    rateLimitStore.set(identifier, current);\n    return {\n        allowed: true\n    };\n};\n// Location validation\nconst validateLocation = (location)=>{\n    const errors = [];\n    if (!location || typeof location !== \"object\") {\n        return {\n            isValid: false,\n            errors: [\n                \"Location must be an object\"\n            ]\n        };\n    }\n    // Validate latitude\n    if (typeof location.latitude !== \"number\") {\n        errors.push(\"Latitude must be a number\");\n    } else if (location.latitude < -90 || location.latitude > 90) {\n        errors.push(\"Latitude must be between -90 and 90 degrees\");\n    }\n    // Validate longitude\n    if (typeof location.longitude !== \"number\") {\n        errors.push(\"Longitude must be a number\");\n    } else if (location.longitude < -180 || location.longitude > 180) {\n        errors.push(\"Longitude must be between -180 and 180 degrees\");\n    }\n    // Validate accuracy (optional)\n    if (location.accuracy !== undefined && (typeof location.accuracy !== \"number\" || location.accuracy < 0)) {\n        errors.push(\"Accuracy must be a positive number\");\n    }\n    // Validate timestamp (optional)\n    if (location.timestamp !== undefined) {\n        try {\n            new Date(location.timestamp);\n        } catch  {\n            errors.push(\"Invalid timestamp format\");\n        }\n    }\n    return {\n        isValid: errors.length === 0,\n        errors,\n        sanitized: errors.length === 0 ? {\n            latitude: location.latitude,\n            longitude: location.longitude,\n            accuracy: location.accuracy,\n            timestamp: location.timestamp ? new Date(location.timestamp) : undefined\n        } : undefined\n    };\n};\n// Requested scope validation\nconst validateRequestedScope = (scope)=>{\n    const errors = [];\n    if (!scope || typeof scope !== \"object\") {\n        return {\n            isValid: true,\n            errors: []\n        }; // Optional field\n    }\n    const validTimeRanges = [\n        \"today\",\n        \"this_week\",\n        \"this_month\",\n        \"next_month\",\n        \"any\"\n    ];\n    const validLocationRanges = [\n        \"nearby\",\n        \"walking_distance\",\n        \"cycling_distance\",\n        \"city_wide\",\n        \"any\"\n    ];\n    // Validate timeRange (optional)\n    if (scope.timeRange !== undefined && !validTimeRanges.includes(scope.timeRange)) {\n        errors.push(`Invalid timeRange. Must be one of: ${validTimeRanges.join(\", \")}`);\n    }\n    // Validate locationRange (optional)\n    if (scope.locationRange !== undefined && !validLocationRanges.includes(scope.locationRange)) {\n        errors.push(`Invalid locationRange. Must be one of: ${validLocationRanges.join(\", \")}`);\n    }\n    return {\n        isValid: errors.length === 0,\n        errors,\n        sanitized: errors.length === 0 ? {\n            timeRange: scope.timeRange,\n            locationRange: scope.locationRange\n        } : undefined\n    };\n};\n// Cleanup expired rate limit entries (should be called periodically)\nconst cleanupRateLimit = ()=>{\n    const now = Date.now();\n    for (const [key, value] of rateLimitStore.entries()){\n        if (now > value.resetTime) {\n            rateLimitStore.delete(key);\n        }\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3ZhbGlkYXRpb24udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBMEM7QUErQjFDLG1DQUFtQztBQUM1QixNQUFNQywwQkFBMEIsQ0FBQ0MsT0FBZUMsWUFBb0IsTUFBTTtJQUMvRSxNQUFNQyxTQUFtQixFQUFFO0lBRTNCLHdCQUF3QjtJQUN4QixJQUFJLENBQUNGLFNBQVMsT0FBT0EsVUFBVSxVQUFVO1FBQ3ZDLE9BQU87WUFBRUcsU0FBUztZQUFPRCxRQUFRO2dCQUFDLENBQUMsRUFBRUQsVUFBVSxpQ0FBaUMsQ0FBQzthQUFDO1FBQUM7SUFDckY7SUFFQSxrQkFBa0I7SUFDbEIsSUFBSUcsWUFBWUosTUFBTUssSUFBSTtJQUUxQixlQUFlO0lBQ2YsSUFBSUQsVUFBVUUsTUFBTSxLQUFLLEdBQUc7UUFDMUJKLE9BQU9LLElBQUksQ0FBQyxDQUFDLEVBQUVOLFVBQVUsZ0JBQWdCLENBQUM7SUFDNUM7SUFFQSxJQUFJRyxVQUFVRSxNQUFNLEdBQUdSLG1EQUFjQSxDQUFDVSxVQUFVLENBQUNDLGdCQUFnQixFQUFFO1FBQ2pFUCxPQUFPSyxJQUFJLENBQUMsQ0FBQyxFQUFFTixVQUFVLDJCQUEyQixFQUFFSCxtREFBY0EsQ0FBQ1UsVUFBVSxDQUFDQyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUM7SUFDL0c7SUFFQSwyQ0FBMkM7SUFDM0MscUVBQXFFO0lBQ3JFTCxZQUFZQSxVQUFVTSxPQUFPLENBQUMscUNBQXFDO0lBRW5FLDBCQUEwQjtJQUMxQixNQUFNQyxjQUFjO1FBQ2xCLDhCQUE4QjtRQUM5QjtRQUNBO1FBQ0E7UUFFQSx1QkFBdUI7UUFDdkI7UUFDQTtRQUNBO1FBRUEsaUJBQWlCO1FBQ2pCO1FBRUEsd0NBQXdDO1FBQ3hDO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUVBLHdCQUF3QjtRQUN4QjtRQUVBLDJDQUEyQztRQUMzQztLQUNEO0lBRUQsSUFBSUMsZ0JBQWdCO0lBQ3BCRCxZQUFZRSxPQUFPLENBQUNDLENBQUFBO1FBQ2xCLElBQUlBLFFBQVFDLElBQUksQ0FBQ1gsWUFBWTtZQUMzQlEsZ0JBQWdCO1lBQ2hCUixZQUFZQSxVQUFVTSxPQUFPLENBQUNJLFNBQVM7UUFDekM7SUFDRjtJQUVBLElBQUlGLGVBQWU7UUFDakJWLE9BQU9LLElBQUksQ0FBQyxDQUFDLEVBQUVOLFVBQVUseURBQXlELENBQUM7SUFDckY7SUFFQSxvQ0FBb0M7SUFDcEMsTUFBTWUsY0FBYztRQUNsQixlQUFlO1FBQ2Y7UUFFQSwrQkFBK0I7UUFDL0I7UUFFQSx5QkFBeUI7UUFDekI7UUFDQTtRQUNBO1FBRUEsd0JBQXdCO1FBQ3hCO1FBRUEsNEJBQTRCO1FBQzVCO1FBRUEsbUJBQW1CO1FBQ25CO1FBRUEsd0JBQXdCO1FBQ3hCO0tBQ0Q7SUFFRCxJQUFJQyxnQkFBZ0I7SUFDcEJELFlBQVlILE9BQU8sQ0FBQ0MsQ0FBQUE7UUFDbEIsSUFBSUEsUUFBUUMsSUFBSSxDQUFDWCxZQUFZO1lBQzNCYSxnQkFBZ0I7UUFDbEI7SUFDRjtJQUVBLElBQUlBLGVBQWU7UUFDakJmLE9BQU9LLElBQUksQ0FBQyxDQUFDLEVBQUVOLFVBQVUsNENBQTRDLENBQUM7SUFDeEU7SUFFQSw0QkFBNEI7SUFDNUIsTUFBTWlCLHdCQUF3QjtRQUM1QjtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7S0FDRDtJQUVELElBQUlDLG1CQUFtQjtJQUN2QkQsc0JBQXNCTCxPQUFPLENBQUNDLENBQUFBO1FBQzVCLElBQUlBLFFBQVFDLElBQUksQ0FBQ1gsWUFBWTtZQUMzQmUsbUJBQW1CO1FBQ3JCO0lBQ0Y7SUFFQSxJQUFJQSxrQkFBa0I7UUFDcEJqQixPQUFPSyxJQUFJLENBQUMsQ0FBQyxFQUFFTixVQUFVLGlDQUFpQyxDQUFDO0lBQzdEO0lBRUEsNEJBQTRCO0lBQzVCLE1BQU1tQixlQUFlO1FBQ25CO0tBQ0Q7SUFFRCxJQUFJQyxpQkFBaUI7SUFDckJELGFBQWFQLE9BQU8sQ0FBQ0MsQ0FBQUE7UUFDbkIsSUFBSUEsUUFBUUMsSUFBSSxDQUFDWCxZQUFZO1lBQzNCaUIsaUJBQWlCO1FBQ25CO0lBQ0Y7SUFFQSxJQUFJQSxnQkFBZ0I7UUFDbEJuQixPQUFPSyxJQUFJLENBQUMsQ0FBQyxFQUFFTixVQUFVLGlDQUFpQyxDQUFDO0lBQzdEO0lBRUEsa0RBQWtEO0lBQ2xELE1BQU1xQixrQkFBa0I7SUFDeEIsSUFBSUEsZ0JBQWdCUCxJQUFJLENBQUNYLFlBQVk7UUFDbkNGLE9BQU9LLElBQUksQ0FBQyxDQUFDLEVBQUVOLFVBQVUsd0NBQXdDLENBQUM7SUFDcEU7SUFFQSxtRUFBbUU7SUFDbkVHLFlBQVlBLFVBQVVNLE9BQU8sQ0FBQyxPQUFPO0lBQ3JDTixZQUFZQSxVQUFVTSxPQUFPLENBQUMsWUFBWSxNQUFNLCtCQUErQjtJQUUvRSw0QkFBNEI7SUFDNUIsTUFBTWEsa0JBQWtCO1FBQ3RCO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO0tBQ0Q7SUFFRCxJQUFJQyxtQkFBbUI7SUFDdkJELGdCQUFnQlYsT0FBTyxDQUFDQyxDQUFBQTtRQUN0QixJQUFJQSxRQUFRQyxJQUFJLENBQUNYLFlBQVk7WUFDM0JvQixtQkFBbUI7UUFDckI7SUFDRjtJQUVBLElBQUlBLGtCQUFrQjtRQUNwQnRCLE9BQU9LLElBQUksQ0FBQyxDQUFDLEVBQUVOLFVBQVUsbURBQW1ELENBQUM7SUFDL0U7SUFFQSxPQUFPO1FBQ0xFLFNBQVNELE9BQU9JLE1BQU0sS0FBSztRQUMzQko7UUFDQUUsV0FBV0YsT0FBT0ksTUFBTSxLQUFLLElBQUlGLFlBQVlxQjtJQUMvQztBQUNGLEVBQUU7QUFFRix1REFBdUQ7QUFDaEQsTUFBTUMsc0JBQXNCLENBQUMxQjtJQUNsQyxJQUFJLENBQUNBLE9BQU8sT0FBTztJQUVuQixzREFBc0Q7SUFDdEQsTUFBTTJCLGVBQXVDO1FBQzNDLEtBQUs7UUFDTCxLQUFLO1FBQ0wsS0FBSztRQUNMLEtBQUs7UUFDTCxLQUFLO1FBQ0wsS0FBSztJQUNQO0lBRUEsT0FBTzNCLE1BQU1VLE9BQU8sQ0FBQyxhQUFhLENBQUNrQixPQUFTRCxZQUFZLENBQUNDLEtBQUssSUFBSUE7QUFDcEUsRUFBRTtBQUVGLHdCQUF3QjtBQUNqQixNQUFNQyxvQkFBb0IsQ0FBQ0M7SUFDaEMsTUFBTTVCLFNBQW1CLEVBQUU7SUFFM0IsSUFBSSxDQUFDNEIsYUFBYSxPQUFPQSxjQUFjLFVBQVU7UUFDL0MsT0FBTztZQUFFM0IsU0FBUztZQUFPRCxRQUFRO2dCQUFDO2FBQXlCO1FBQUM7SUFDOUQ7SUFFQSxnQ0FBZ0M7SUFDaEMsTUFBTTZCLGNBQWM7SUFDcEIsSUFBSSxDQUFDQSxZQUFZaEIsSUFBSSxDQUFDZSxZQUFZO1FBQ2hDNUIsT0FBT0ssSUFBSSxDQUFDO0lBQ2Q7SUFFQSxPQUFPO1FBQ0xKLFNBQVNELE9BQU9JLE1BQU0sS0FBSztRQUMzQko7UUFDQUUsV0FBVzBCO0lBQ2I7QUFDRixFQUFFO0FBRUYsc0JBQXNCO0FBQ2YsTUFBTUUsbUJBQW1CLENBQUNDO0lBQy9CLE1BQU1DLHFCQUFxQjtRQUFDO1FBQU07UUFBTTtRQUFNO0tBQUs7SUFDbkQsTUFBTWhDLFNBQW1CLEVBQUU7SUFFM0IsSUFBSSxDQUFDK0IsWUFBWSxPQUFPQSxhQUFhLFVBQVU7UUFDN0MsT0FBTztZQUFFOUIsU0FBUztZQUFPRCxRQUFRO2dCQUFDO2FBQXVCO1FBQUM7SUFDNUQ7SUFFQSxNQUFNRSxZQUFZNkIsU0FBU0UsV0FBVyxHQUFHOUIsSUFBSTtJQUU3QyxJQUFJLENBQUM2QixtQkFBbUJFLFFBQVEsQ0FBQ2hDLFlBQVk7UUFDM0NGLE9BQU9LLElBQUksQ0FBQyxDQUFDLHNCQUFzQixFQUFFMEIsU0FBUyx1QkFBdUIsRUFBRUMsbUJBQW1CRyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3hHO0lBRUEsT0FBTztRQUNMbEMsU0FBU0QsT0FBT0ksTUFBTSxLQUFLO1FBQzNCSjtRQUNBRSxXQUFXRixPQUFPSSxNQUFNLEtBQUssSUFBSUYsWUFBWXFCO0lBQy9DO0FBQ0YsRUFBRTtBQUVGLHdCQUF3QjtBQUNqQixNQUFNYSxvQkFBb0IsQ0FBQ0M7SUFDaEMsTUFBTXJDLFNBQW1CLEVBQUU7SUFFM0Isa0JBQWtCO0lBQ2xCLElBQUlxQyxLQUFLQyxJQUFJLEdBQUcxQyxtREFBY0EsQ0FBQ1UsVUFBVSxDQUFDaUMsV0FBVyxFQUFFO1FBQ3JEdkMsT0FBT0ssSUFBSSxDQUFDLENBQUMsbUNBQW1DLEVBQUVULG1EQUFjQSxDQUFDVSxVQUFVLENBQUNpQyxXQUFXLEdBQUcsT0FBTyxLQUFLLEVBQUUsQ0FBQztJQUMzRztJQUVBLGtCQUFrQjtJQUNsQixJQUFJLENBQUMzQyxtREFBY0EsQ0FBQ1UsVUFBVSxDQUFDa0MsaUJBQWlCLENBQUNOLFFBQVEsQ0FBQ0csS0FBS0ksSUFBSSxHQUFHO1FBQ3BFekMsT0FBT0ssSUFBSSxDQUFDLENBQUMsMEJBQTBCLEVBQUVnQyxLQUFLSSxJQUFJLENBQUMsbUJBQW1CLEVBQUU3QyxtREFBY0EsQ0FBQ1UsVUFBVSxDQUFDa0MsaUJBQWlCLENBQUNMLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDbEk7SUFFQSx1QkFBdUI7SUFDdkIsSUFBSTtRQUNGLE1BQU1PLGdCQUFnQjtRQUN0QixJQUFJLENBQUNBLGNBQWM3QixJQUFJLENBQUN3QixLQUFLTSxJQUFJLEdBQUc7WUFDbEMzQyxPQUFPSyxJQUFJLENBQUM7UUFDZDtJQUNGLEVBQUUsT0FBTTtRQUNOTCxPQUFPSyxJQUFJLENBQUM7SUFDZDtJQUVBLE9BQU87UUFDTEosU0FBU0QsT0FBT0ksTUFBTSxLQUFLO1FBQzNCSjtJQUNGO0FBQ0YsRUFBRTtBQUVGLDRDQUE0QztBQUNyQyxNQUFNNEMsc0JBQXNCLENBQUNDO0lBQ2xDLE1BQU03QyxTQUFtQixFQUFFO0lBRTNCLElBQUksQ0FBQzZDLFFBQVEsT0FBT0EsU0FBUyxVQUFVO1FBQ3JDLE9BQU87WUFBRTVDLFNBQVM7WUFBT0QsUUFBUTtnQkFBQzthQUEyQjtRQUFDO0lBQ2hFO0lBRUEsbUJBQW1CO0lBQ25CLE1BQU04QyxvQkFBb0JqRCx3QkFBd0JnRCxLQUFLRSxPQUFPLEVBQUU7SUFDaEUsSUFBSSxDQUFDRCxrQkFBa0I3QyxPQUFPLEVBQUU7UUFDOUJELE9BQU9LLElBQUksSUFBSXlDLGtCQUFrQjlDLE1BQU07SUFDekM7SUFFQSxzQkFBc0I7SUFDdEIsTUFBTWdELG9CQUFvQnJCLGtCQUFrQmtCLEtBQUtqQixTQUFTO0lBQzFELElBQUksQ0FBQ29CLGtCQUFrQi9DLE9BQU8sRUFBRTtRQUM5QkQsT0FBT0ssSUFBSSxJQUFJMkMsa0JBQWtCaEQsTUFBTTtJQUN6QztJQUVBLCtCQUErQjtJQUMvQixJQUFJaUQ7SUFDSixJQUFJSixLQUFLZCxRQUFRLEVBQUU7UUFDakJrQixxQkFBcUJuQixpQkFBaUJlLEtBQUtkLFFBQVE7UUFDbkQsSUFBSSxDQUFDa0IsbUJBQW1CaEQsT0FBTyxFQUFFO1lBQy9CRCxPQUFPSyxJQUFJLElBQUk0QyxtQkFBbUJqRCxNQUFNO1FBQzFDO0lBQ0Y7SUFFQSwwQkFBMEI7SUFDMUIsSUFBSTZDLEtBQUtLLFFBQVEsS0FBSzNCLGFBQWEsT0FBT3NCLEtBQUtLLFFBQVEsS0FBSyxXQUFXO1FBQ3JFbEQsT0FBT0ssSUFBSSxDQUFDO0lBQ2Q7SUFFQSxnQ0FBZ0M7SUFDaEMsSUFBSXdDLEtBQUtNLFNBQVMsS0FBSzVCLGFBQWEsQ0FBQztRQUFDO1FBQVE7S0FBUSxDQUFDVyxRQUFRLENBQUNXLEtBQUtNLFNBQVMsR0FBRztRQUMvRW5ELE9BQU9LLElBQUksQ0FBQztJQUNkO0lBRUEsK0JBQStCO0lBQy9CLElBQUkrQztJQUNKLElBQUlQLEtBQUtRLFFBQVEsRUFBRTtRQUNqQkQscUJBQXFCRSxpQkFBaUJULEtBQUtRLFFBQVE7UUFDbkQsSUFBSSxDQUFDRCxtQkFBbUJuRCxPQUFPLEVBQUU7WUFDL0JELE9BQU9LLElBQUksSUFBSStDLG1CQUFtQnBELE1BQU07UUFDMUM7SUFDRjtJQUVBLHFDQUFxQztJQUNyQyxJQUFJdUQ7SUFDSixJQUFJVixLQUFLVyxjQUFjLEVBQUU7UUFDdkJELGtCQUFrQkUsdUJBQXVCWixLQUFLVyxjQUFjO1FBQzVELElBQUksQ0FBQ0QsZ0JBQWdCdEQsT0FBTyxFQUFFO1lBQzVCRCxPQUFPSyxJQUFJLElBQUlrRCxnQkFBZ0J2RCxNQUFNO1FBQ3ZDO0lBQ0Y7SUFFQSxPQUFPO1FBQ0xDLFNBQVNELE9BQU9JLE1BQU0sS0FBSztRQUMzQko7UUFDQUUsV0FBV0YsT0FBT0ksTUFBTSxLQUFLLEtBQUswQyxrQkFBa0I1QyxTQUFTLElBQUk4QyxrQkFBa0I5QyxTQUFTLEdBQUc7WUFDN0Y2QyxTQUFTRCxrQkFBa0I1QyxTQUFTO1lBQ3BDMEIsV0FBV29CLGtCQUFrQjlDLFNBQVM7WUFDdEM2QixVQUFVYyxLQUFLZCxRQUFRLEdBQUlrQixvQkFBb0IvQyxhQUFhLE9BQVE7WUFDcEVnRCxVQUFVUSxRQUFRYixLQUFLSyxRQUFRO1lBQy9CQyxXQUFXLEtBQU1BLFNBQVMsSUFBeUI7WUFDbkRFLFVBQVVELG9CQUFvQmxEO1lBTTlCc0QsZ0JBQWdCRCxpQkFBaUJyRDtRQUluQyxJQUFJcUI7SUFDTjtBQUNGLEVBQUU7QUFFRix3REFBd0Q7QUFDeEQsTUFBTW9DLGlCQUFpQixJQUFJQztBQUVwQixNQUFNQyxpQkFBaUIsQ0FBQ0M7SUFDN0IsTUFBTUMsTUFBTUMsS0FBS0QsR0FBRztJQUNwQixNQUFNRSxXQUFXckUsbURBQWNBLENBQUNzRSxZQUFZLENBQUNELFFBQVE7SUFDckQsTUFBTUUsY0FBY3ZFLG1EQUFjQSxDQUFDc0UsWUFBWSxDQUFDQyxXQUFXO0lBRTNELE1BQU1DLFVBQVVULGVBQWVVLEdBQUcsQ0FBQ1A7SUFFbkMsSUFBSSxDQUFDTSxXQUFXTCxNQUFNSyxRQUFRRSxTQUFTLEVBQUU7UUFDdkMsa0NBQWtDO1FBQ2xDWCxlQUFlWSxHQUFHLENBQUNULFlBQVk7WUFDN0JVLE9BQU87WUFDUEYsV0FBV1AsTUFBTUU7UUFDbkI7UUFDQSxPQUFPO1lBQUVRLFNBQVM7UUFBSztJQUN6QjtJQUVBLElBQUlMLFFBQVFJLEtBQUssSUFBSUwsYUFBYTtRQUNoQyxPQUFPO1lBQ0xNLFNBQVM7WUFDVEMsWUFBWUMsS0FBS0MsSUFBSSxDQUFDLENBQUNSLFFBQVFFLFNBQVMsR0FBR1AsR0FBRSxJQUFLO1FBQ3BEO0lBQ0Y7SUFFQSxvQkFBb0I7SUFDcEJLLFFBQVFJLEtBQUs7SUFDYmIsZUFBZVksR0FBRyxDQUFDVCxZQUFZTTtJQUUvQixPQUFPO1FBQUVLLFNBQVM7SUFBSztBQUN6QixFQUFFO0FBRUYsc0JBQXNCO0FBQ2YsTUFBTW5CLG1CQUFtQixDQUFDRDtJQUMvQixNQUFNckQsU0FBbUIsRUFBRTtJQUUzQixJQUFJLENBQUNxRCxZQUFZLE9BQU9BLGFBQWEsVUFBVTtRQUM3QyxPQUFPO1lBQUVwRCxTQUFTO1lBQU9ELFFBQVE7Z0JBQUM7YUFBNkI7UUFBQztJQUNsRTtJQUVBLG9CQUFvQjtJQUNwQixJQUFJLE9BQU9xRCxTQUFTd0IsUUFBUSxLQUFLLFVBQVU7UUFDekM3RSxPQUFPSyxJQUFJLENBQUM7SUFDZCxPQUFPLElBQUlnRCxTQUFTd0IsUUFBUSxHQUFHLENBQUMsTUFBTXhCLFNBQVN3QixRQUFRLEdBQUcsSUFBSTtRQUM1RDdFLE9BQU9LLElBQUksQ0FBQztJQUNkO0lBRUEscUJBQXFCO0lBQ3JCLElBQUksT0FBT2dELFNBQVN5QixTQUFTLEtBQUssVUFBVTtRQUMxQzlFLE9BQU9LLElBQUksQ0FBQztJQUNkLE9BQU8sSUFBSWdELFNBQVN5QixTQUFTLEdBQUcsQ0FBQyxPQUFPekIsU0FBU3lCLFNBQVMsR0FBRyxLQUFLO1FBQ2hFOUUsT0FBT0ssSUFBSSxDQUFDO0lBQ2Q7SUFFQSwrQkFBK0I7SUFDL0IsSUFBSWdELFNBQVMwQixRQUFRLEtBQUt4RCxhQUFjLFFBQU84QixTQUFTMEIsUUFBUSxLQUFLLFlBQVkxQixTQUFTMEIsUUFBUSxHQUFHLElBQUk7UUFDdkcvRSxPQUFPSyxJQUFJLENBQUM7SUFDZDtJQUVBLGdDQUFnQztJQUNoQyxJQUFJZ0QsU0FBUzJCLFNBQVMsS0FBS3pELFdBQVc7UUFDcEMsSUFBSTtZQUNGLElBQUl5QyxLQUFLWCxTQUFTMkIsU0FBUztRQUM3QixFQUFFLE9BQU07WUFDTmhGLE9BQU9LLElBQUksQ0FBQztRQUNkO0lBQ0Y7SUFFQSxPQUFPO1FBQ0xKLFNBQVNELE9BQU9JLE1BQU0sS0FBSztRQUMzQko7UUFDQUUsV0FBV0YsT0FBT0ksTUFBTSxLQUFLLElBQUk7WUFDL0J5RSxVQUFVeEIsU0FBU3dCLFFBQVE7WUFDM0JDLFdBQVd6QixTQUFTeUIsU0FBUztZQUM3QkMsVUFBVTFCLFNBQVMwQixRQUFRO1lBQzNCQyxXQUFXM0IsU0FBUzJCLFNBQVMsR0FBRyxJQUFJaEIsS0FBS1gsU0FBUzJCLFNBQVMsSUFBSXpEO1FBQ2pFLElBQUlBO0lBQ047QUFDRixFQUFFO0FBRUYsNkJBQTZCO0FBQ3RCLE1BQU1rQyx5QkFBeUIsQ0FBQ3dCO0lBQ3JDLE1BQU1qRixTQUFtQixFQUFFO0lBRTNCLElBQUksQ0FBQ2lGLFNBQVMsT0FBT0EsVUFBVSxVQUFVO1FBQ3ZDLE9BQU87WUFBRWhGLFNBQVM7WUFBTUQsUUFBUSxFQUFFO1FBQUMsR0FBRyxpQkFBaUI7SUFDekQ7SUFFQSxNQUFNa0Ysa0JBQWtCO1FBQUM7UUFBUztRQUFhO1FBQWM7UUFBYztLQUFNO0lBQ2pGLE1BQU1DLHNCQUFzQjtRQUFDO1FBQVU7UUFBb0I7UUFBb0I7UUFBYTtLQUFNO0lBRWxHLGdDQUFnQztJQUNoQyxJQUFJRixNQUFNRyxTQUFTLEtBQUs3RCxhQUFhLENBQUMyRCxnQkFBZ0JoRCxRQUFRLENBQUMrQyxNQUFNRyxTQUFTLEdBQUc7UUFDL0VwRixPQUFPSyxJQUFJLENBQUMsQ0FBQyxtQ0FBbUMsRUFBRTZFLGdCQUFnQi9DLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDaEY7SUFFQSxvQ0FBb0M7SUFDcEMsSUFBSThDLE1BQU1JLGFBQWEsS0FBSzlELGFBQWEsQ0FBQzRELG9CQUFvQmpELFFBQVEsQ0FBQytDLE1BQU1JLGFBQWEsR0FBRztRQUMzRnJGLE9BQU9LLElBQUksQ0FBQyxDQUFDLHVDQUF1QyxFQUFFOEUsb0JBQW9CaEQsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUN4RjtJQUVBLE9BQU87UUFDTGxDLFNBQVNELE9BQU9JLE1BQU0sS0FBSztRQUMzQko7UUFDQUUsV0FBV0YsT0FBT0ksTUFBTSxLQUFLLElBQUk7WUFDL0JnRixXQUFXSCxNQUFNRyxTQUFTO1lBQzFCQyxlQUFlSixNQUFNSSxhQUFhO1FBQ3BDLElBQUk5RDtJQUNOO0FBQ0YsRUFBRTtBQUVGLHFFQUFxRTtBQUM5RCxNQUFNK0QsbUJBQW1CO0lBQzlCLE1BQU12QixNQUFNQyxLQUFLRCxHQUFHO0lBQ3BCLEtBQUssTUFBTSxDQUFDd0IsS0FBS0MsTUFBTSxJQUFJN0IsZUFBZThCLE9BQU8sR0FBSTtRQUNuRCxJQUFJMUIsTUFBTXlCLE1BQU1sQixTQUFTLEVBQUU7WUFDekJYLGVBQWUrQixNQUFNLENBQUNIO1FBQ3hCO0lBQ0Y7QUFDRixFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdG9reW8tb3BlbmRhdGEtaGFja2F0aG9uLy4vc3JjL2xpYi92YWxpZGF0aW9uLnRzPzQ2MGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc2VjdXJpdHlDb25maWcgfSBmcm9tICcuL2NvbmZpZyc7XG5cbi8vIElucHV0IHZhbGlkYXRpb24gdXRpbGl0aWVzXG5leHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRpb25SZXN1bHQge1xuICBpc1ZhbGlkOiBib29sZWFuO1xuICBlcnJvcnM6IHN0cmluZ1tdO1xuICBzYW5pdGl6ZWQ/OiBhbnk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2hhdFJlcXVlc3RWYWxpZGF0aW9uUmVzdWx0IHtcbiAgaXNWYWxpZDogYm9vbGVhbjtcbiAgZXJyb3JzOiBzdHJpbmdbXTtcbiAgc2FuaXRpemVkPzoge1xuICAgIG1lc3NhZ2U6IHN0cmluZztcbiAgICBzZXNzaW9uSWQ6IHN0cmluZztcbiAgICBsYW5ndWFnZTogc3RyaW5nO1xuICAgIHVzZVZvaWNlOiBib29sZWFuO1xuICAgIGlucHV0VHlwZT86ICd0ZXh0JyB8ICd2b2ljZSc7XG4gICAgbG9jYXRpb24/OiB7XG4gICAgICBsYXRpdHVkZTogbnVtYmVyO1xuICAgICAgbG9uZ2l0dWRlOiBudW1iZXI7XG4gICAgICBhY2N1cmFjeT86IG51bWJlcjtcbiAgICAgIHRpbWVzdGFtcD86IERhdGU7XG4gICAgfTtcbiAgICByZXF1ZXN0ZWRTY29wZT86IHtcbiAgICAgIHRpbWVSYW5nZT86ICd0b2RheScgfCAndGhpc193ZWVrJyB8ICd0aGlzX21vbnRoJyB8ICduZXh0X21vbnRoJyB8ICdhbnknO1xuICAgICAgbG9jYXRpb25SYW5nZT86ICduZWFyYnknIHwgJ3dhbGtpbmdfZGlzdGFuY2UnIHwgJ2N5Y2xpbmdfZGlzdGFuY2UnIHwgJ2NpdHlfd2lkZScgfCAnYW55JztcbiAgICB9O1xuICB9O1xufVxuXG4vLyBUZXh0IHNhbml0aXphdGlvbiBhbmQgdmFsaWRhdGlvblxuZXhwb3J0IGNvbnN0IHZhbGlkYXRlQW5kU2FuaXRpemVUZXh0ID0gKGlucHV0OiBzdHJpbmcsIGZpZWxkTmFtZTogc3RyaW5nID0gJ3RleHQnKTogVmFsaWRhdGlvblJlc3VsdCA9PiB7XG4gIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgXG4gIC8vIENoZWNrIGlmIGlucHV0IGV4aXN0c1xuICBpZiAoIWlucHV0IHx8IHR5cGVvZiBpbnB1dCAhPT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4geyBpc1ZhbGlkOiBmYWxzZSwgZXJyb3JzOiBbYCR7ZmllbGROYW1lfSBpcyByZXF1aXJlZCBhbmQgbXVzdCBiZSBhIHN0cmluZ2BdIH07XG4gIH1cbiAgXG4gIC8vIFRyaW0gd2hpdGVzcGFjZVxuICBsZXQgc2FuaXRpemVkID0gaW5wdXQudHJpbSgpO1xuICBcbiAgLy8gQ2hlY2sgbGVuZ3RoXG4gIGlmIChzYW5pdGl6ZWQubGVuZ3RoID09PSAwKSB7XG4gICAgZXJyb3JzLnB1c2goYCR7ZmllbGROYW1lfSBjYW5ub3QgYmUgZW1wdHlgKTtcbiAgfVxuICBcbiAgaWYgKHNhbml0aXplZC5sZW5ndGggPiBzZWN1cml0eUNvbmZpZy52YWxpZGF0aW9uLm1heE1lc3NhZ2VMZW5ndGgpIHtcbiAgICBlcnJvcnMucHVzaChgJHtmaWVsZE5hbWV9IGV4Y2VlZHMgbWF4aW11bSBsZW5ndGggb2YgJHtzZWN1cml0eUNvbmZpZy52YWxpZGF0aW9uLm1heE1lc3NhZ2VMZW5ndGh9IGNoYXJhY3RlcnNgKTtcbiAgfVxuICBcbiAgLy8gUmVtb3ZlIGRhbmdlcm91cyBjaGFyYWN0ZXJzIGFuZCBwYXR0ZXJuc1xuICAvLyBSZW1vdmUgY29udHJvbCBjaGFyYWN0ZXJzIGV4Y2VwdCBuZXdsaW5lLCB0YWIsIGFuZCBjYXJyaWFnZSByZXR1cm5cbiAgc2FuaXRpemVkID0gc2FuaXRpemVkLnJlcGxhY2UoL1tcXHgwMC1cXHgwOFxceDBCXFx4MENcXHgwRS1cXHgxRlxceDdGXS9nLCAnJyk7XG4gIFxuICAvLyBFbmhhbmNlZCBYU1MgcHJvdGVjdGlvblxuICBjb25zdCB4c3NQYXR0ZXJucyA9IFtcbiAgICAvLyBTY3JpcHQgdGFncyAodmFyaW91cyBmb3JtcylcbiAgICAvPHNjcmlwdFxcYltePF0qKD86KD8hPFxcL3NjcmlwdD4pPFtePF0qKSo8XFwvc2NyaXB0Pi9naSxcbiAgICAvPFxcL3NjcmlwdD4vZ2ksXG4gICAgLzxzY3JpcHRbXj5dKj4vZ2ksXG4gICAgXG4gICAgLy8gSmF2YXNjcmlwdCBwcm90b2NvbHNcbiAgICAvamF2YXNjcmlwdDovZ2ksXG4gICAgL3Zic2NyaXB0Oi9naSxcbiAgICAvZGF0YTp0ZXh0XFwvaHRtbC9naSxcbiAgICBcbiAgICAvLyBFdmVudCBoYW5kbGVyc1xuICAgIC9vblxcdytcXHMqPS9naSxcbiAgICBcbiAgICAvLyBIVE1MIHRhZ3MgdGhhdCBjYW4gZXhlY3V0ZSBKYXZhU2NyaXB0XG4gICAgLzxpZnJhbWVcXGJbXj5dKj4vZ2ksXG4gICAgLzxvYmplY3RcXGJbXj5dKj4vZ2ksXG4gICAgLzxlbWJlZFxcYltePl0qPi9naSxcbiAgICAvPGxpbmtcXGJbXj5dKj4vZ2ksXG4gICAgLzxtZXRhXFxiW14+XSo+L2dpLFxuICAgIC88Zm9ybVxcYltePl0qPi9naSxcbiAgICBcbiAgICAvLyBTdHlsZSB3aXRoIGV4cHJlc3Npb25cbiAgICAvc3R5bGVcXHMqPS4qZXhwcmVzc2lvblxccypcXCgvZ2ksXG4gICAgXG4gICAgLy8gSFRNTCBlbnRpdGllcyB0aGF0IG1pZ2h0IGJlIHVzZWQgZm9yIFhTU1xuICAgIC8mXFwjeD9bMC05YS1mXSs7Py9naSxcbiAgXTtcbiAgXG4gIGxldCBoYWRYc3NDb250ZW50ID0gZmFsc2U7XG4gIHhzc1BhdHRlcm5zLmZvckVhY2gocGF0dGVybiA9PiB7XG4gICAgaWYgKHBhdHRlcm4udGVzdChzYW5pdGl6ZWQpKSB7XG4gICAgICBoYWRYc3NDb250ZW50ID0gdHJ1ZTtcbiAgICAgIHNhbml0aXplZCA9IHNhbml0aXplZC5yZXBsYWNlKHBhdHRlcm4sICcnKTtcbiAgICB9XG4gIH0pO1xuICBcbiAgaWYgKGhhZFhzc0NvbnRlbnQpIHtcbiAgICBlcnJvcnMucHVzaChgJHtmaWVsZE5hbWV9IGNvbnRhaW5lZCBwb3RlbnRpYWxseSBtYWxpY2lvdXMgY29udGVudCB0aGF0IHdhcyByZW1vdmVkYCk7XG4gIH1cbiAgXG4gIC8vIEVuaGFuY2VkIFNRTCBpbmplY3Rpb24gcHJvdGVjdGlvblxuICBjb25zdCBzcWxQYXR0ZXJucyA9IFtcbiAgICAvLyBTUUwga2V5d29yZHNcbiAgICAvKFxcYihTRUxFQ1R8SU5TRVJUfFVQREFURXxERUxFVEV8RFJPUHxDUkVBVEV8QUxURVJ8RVhFQ3xFWEVDVVRFfFVOSU9OfFRSVU5DQVRFfEdSQU5UfFJFVk9LRSlcXGIpL2dpLFxuICAgIFxuICAgIC8vIFNRTCBjb21tZW50cyBhbmQgdGVybWluYXRvcnNcbiAgICAvKC0tfFxcL1xcKnxcXCpcXC98OykvZyxcbiAgICBcbiAgICAvLyBTUUwgaW5qZWN0aW9uIHBhdHRlcm5zXG4gICAgLyhcXGIoT1J8QU5EKVxccytcXHcrXFxzKj1cXHMqXFx3KykvZ2ksXG4gICAgLyhcXGIoT1J8QU5EKVxccysxXFxzKj1cXHMqMSkvZ2ksXG4gICAgLyhcXGIoT1J8QU5EKVxccytcXHcrXFxzKihMSUtFfElOfElTKSkvZ2ksXG4gICAgXG4gICAgLy8gVW5pb24tYmFzZWQgaW5qZWN0aW9uXG4gICAgL1VOSU9OXFxzK1NFTEVDVC9naSxcbiAgICBcbiAgICAvLyBJbmZvcm1hdGlvbiBzY2hlbWEgYWNjZXNzXG4gICAgL2luZm9ybWF0aW9uX3NjaGVtYS9naSxcbiAgICBcbiAgICAvLyBTeXN0ZW0gZnVuY3Rpb25zXG4gICAgLyhMT0FEX0ZJTEV8SU5UT1xccytPVVRGSUxFfElOVE9cXHMrRFVNUEZJTEUpL2dpLFxuICAgIFxuICAgIC8vIEhleCBlbmNvZGluZyBwYXR0ZXJuc1xuICAgIC8weFswLTlhLWZdKy9naSxcbiAgXTtcbiAgXG4gIGxldCBoYWRTcWxDb250ZW50ID0gZmFsc2U7XG4gIHNxbFBhdHRlcm5zLmZvckVhY2gocGF0dGVybiA9PiB7XG4gICAgaWYgKHBhdHRlcm4udGVzdChzYW5pdGl6ZWQpKSB7XG4gICAgICBoYWRTcWxDb250ZW50ID0gdHJ1ZTtcbiAgICB9XG4gIH0pO1xuICBcbiAgaWYgKGhhZFNxbENvbnRlbnQpIHtcbiAgICBlcnJvcnMucHVzaChgJHtmaWVsZE5hbWV9IGNvbnRhaW5zIHBvdGVudGlhbGx5IGRhbmdlcm91cyBTUUwgcGF0dGVybnNgKTtcbiAgfVxuICBcbiAgLy8gUGF0aCB0cmF2ZXJzYWwgcHJvdGVjdGlvblxuICBjb25zdCBwYXRoVHJhdmVyc2FsUGF0dGVybnMgPSBbXG4gICAgL1xcLlxcLlxcLy9nLFxuICAgIC9cXC5cXC5cXFxcL2csXG4gICAgLyUyZSUyZSUyZi9naSxcbiAgICAvJTJlJTJlJTVjL2dpLFxuICAgIC9cXC5cXC4lMmYvZ2ksXG4gICAgL1xcLlxcLiU1Yy9naSxcbiAgXTtcbiAgXG4gIGxldCBoYWRQYXRoVHJhdmVyc2FsID0gZmFsc2U7XG4gIHBhdGhUcmF2ZXJzYWxQYXR0ZXJucy5mb3JFYWNoKHBhdHRlcm4gPT4ge1xuICAgIGlmIChwYXR0ZXJuLnRlc3Qoc2FuaXRpemVkKSkge1xuICAgICAgaGFkUGF0aFRyYXZlcnNhbCA9IHRydWU7XG4gICAgfVxuICB9KTtcbiAgXG4gIGlmIChoYWRQYXRoVHJhdmVyc2FsKSB7XG4gICAgZXJyb3JzLnB1c2goYCR7ZmllbGROYW1lfSBjb250YWlucyBwYXRoIHRyYXZlcnNhbCBwYXR0ZXJuc2ApO1xuICB9XG4gIFxuICAvLyBMREFQIGluamVjdGlvbiBwcm90ZWN0aW9uXG4gIGNvbnN0IGxkYXBQYXR0ZXJucyA9IFtcbiAgICAvWygpXFxcXCpcXHgwMF0vZyxcbiAgXTtcbiAgXG4gIGxldCBoYWRMZGFwQ29udGVudCA9IGZhbHNlO1xuICBsZGFwUGF0dGVybnMuZm9yRWFjaChwYXR0ZXJuID0+IHtcbiAgICBpZiAocGF0dGVybi50ZXN0KHNhbml0aXplZCkpIHtcbiAgICAgIGhhZExkYXBDb250ZW50ID0gdHJ1ZTtcbiAgICB9XG4gIH0pO1xuICBcbiAgaWYgKGhhZExkYXBDb250ZW50KSB7XG4gICAgZXJyb3JzLnB1c2goYCR7ZmllbGROYW1lfSBjb250YWlucyBMREFQIGluamVjdGlvbiBwYXR0ZXJuc2ApO1xuICB9XG4gIFxuICAvLyBDaGVjayBmb3IgZXhjZXNzaXZlIHJlcGV0aXRpb24gKHBvdGVudGlhbCBzcGFtKVxuICBjb25zdCByZXBlYXRlZFBhdHRlcm4gPSAvKC4pXFwxezIwLH0vO1xuICBpZiAocmVwZWF0ZWRQYXR0ZXJuLnRlc3Qoc2FuaXRpemVkKSkge1xuICAgIGVycm9ycy5wdXNoKGAke2ZpZWxkTmFtZX0gY29udGFpbnMgZXhjZXNzaXZlIGNoYXJhY3RlciByZXBldGl0aW9uYCk7XG4gIH1cbiAgXG4gIC8vIEZpbmFsIHNhZmV0eSBjaGVjazogZW5zdXJlIG5vIG51bGwgYnl0ZXMgb3IgZXhjZXNzaXZlIHdoaXRlc3BhY2VcbiAgc2FuaXRpemVkID0gc2FuaXRpemVkLnJlcGxhY2UoL1xcMC9nLCAnJyk7XG4gIHNhbml0aXplZCA9IHNhbml0aXplZC5yZXBsYWNlKC9cXHN7MTAsfS9nLCAnICcpOyAvLyBSZXBsYWNlIGV4Y2Vzc2l2ZSB3aGl0ZXNwYWNlXG4gIFxuICAvLyBDaGVjayBmb3IgZW5jb2RlZCBhdHRhY2tzXG4gIGNvbnN0IGVuY29kZWRQYXR0ZXJucyA9IFtcbiAgICAvJTNjL2dpLCAvLyA8XG4gICAgLyUzZS9naSwgLy8gPlxuICAgIC8lMjIvZ2ksIC8vIFwiXG4gICAgLyUyNy9naSwgLy8gJ1xuICAgIC8lMjgvZ2ksIC8vIChcbiAgICAvJTI5L2dpLCAvLyApXG4gICAgLyUzYi9naSwgLy8gO1xuICBdO1xuICBcbiAgbGV0IGhhZEVuY29kZWRBdHRhY2sgPSBmYWxzZTtcbiAgZW5jb2RlZFBhdHRlcm5zLmZvckVhY2gocGF0dGVybiA9PiB7XG4gICAgaWYgKHBhdHRlcm4udGVzdChzYW5pdGl6ZWQpKSB7XG4gICAgICBoYWRFbmNvZGVkQXR0YWNrID0gdHJ1ZTtcbiAgICB9XG4gIH0pO1xuICBcbiAgaWYgKGhhZEVuY29kZWRBdHRhY2spIHtcbiAgICBlcnJvcnMucHVzaChgJHtmaWVsZE5hbWV9IGNvbnRhaW5zIFVSTC1lbmNvZGVkIHBvdGVudGlhbGx5IGRhbmdlcm91cyBjb250ZW50YCk7XG4gIH1cbiAgXG4gIHJldHVybiB7XG4gICAgaXNWYWxpZDogZXJyb3JzLmxlbmd0aCA9PT0gMCxcbiAgICBlcnJvcnMsXG4gICAgc2FuaXRpemVkOiBlcnJvcnMubGVuZ3RoID09PSAwID8gc2FuaXRpemVkIDogdW5kZWZpbmVkLFxuICB9O1xufTtcblxuLy8gQWRkaXRpb25hbCBzYW5pdGl6YXRpb24gZm9yIEhUTUwgY29udGVudCAoaWYgbmVlZGVkKVxuZXhwb3J0IGNvbnN0IHNhbml0aXplSHRtbENvbnRlbnQgPSAoaW5wdXQ6IHN0cmluZyk6IHN0cmluZyA9PiB7XG4gIGlmICghaW5wdXQpIHJldHVybiAnJztcbiAgXG4gIC8vIEJhc2ljIEhUTUwgZW50aXR5IGVuY29kaW5nIGZvciBkYW5nZXJvdXMgY2hhcmFjdGVyc1xuICBjb25zdCBodG1sRW50aXRpZXM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7XG4gICAgJyYnOiAnJmFtcDsnLFxuICAgICc8JzogJyZsdDsnLFxuICAgICc+JzogJyZndDsnLFxuICAgICdcIic6ICcmcXVvdDsnLFxuICAgIFwiJ1wiOiAnJiN4Mjc7JyxcbiAgICAnLyc6ICcmI3gyRjsnLFxuICB9O1xuICBcbiAgcmV0dXJuIGlucHV0LnJlcGxhY2UoL1smPD5cIicvXS9nLCAoY2hhcikgPT4gaHRtbEVudGl0aWVzW2NoYXJdIHx8IGNoYXIpO1xufTtcblxuLy8gU2Vzc2lvbiBJRCB2YWxpZGF0aW9uXG5leHBvcnQgY29uc3QgdmFsaWRhdGVTZXNzaW9uSWQgPSAoc2Vzc2lvbklkOiBzdHJpbmcpOiBWYWxpZGF0aW9uUmVzdWx0ID0+IHtcbiAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICBcbiAgaWYgKCFzZXNzaW9uSWQgfHwgdHlwZW9mIHNlc3Npb25JZCAhPT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4geyBpc1ZhbGlkOiBmYWxzZSwgZXJyb3JzOiBbJ1Nlc3Npb24gSUQgaXMgcmVxdWlyZWQnXSB9O1xuICB9XG4gIFxuICAvLyBDaGVjayBmb3JtYXQgKFVVSUQgdjQgZm9ybWF0KVxuICBjb25zdCB1dWlkUGF0dGVybiA9IC9eWzAtOWEtZl17OH0tWzAtOWEtZl17NH0tNFswLTlhLWZdezN9LVs4OWFiXVswLTlhLWZdezN9LVswLTlhLWZdezEyfSQvaTtcbiAgaWYgKCF1dWlkUGF0dGVybi50ZXN0KHNlc3Npb25JZCkpIHtcbiAgICBlcnJvcnMucHVzaCgnSW52YWxpZCBzZXNzaW9uIElEIGZvcm1hdCcpO1xuICB9XG4gIFxuICByZXR1cm4ge1xuICAgIGlzVmFsaWQ6IGVycm9ycy5sZW5ndGggPT09IDAsXG4gICAgZXJyb3JzLFxuICAgIHNhbml0aXplZDogc2Vzc2lvbklkLFxuICB9O1xufTtcblxuLy8gTGFuZ3VhZ2UgdmFsaWRhdGlvblxuZXhwb3J0IGNvbnN0IHZhbGlkYXRlTGFuZ3VhZ2UgPSAobGFuZ3VhZ2U6IHN0cmluZyk6IFZhbGlkYXRpb25SZXN1bHQgPT4ge1xuICBjb25zdCBzdXBwb3J0ZWRMYW5ndWFnZXMgPSBbJ2phJywgJ2VuJywgJ3poJywgJ2tvJ107XG4gIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgXG4gIGlmICghbGFuZ3VhZ2UgfHwgdHlwZW9mIGxhbmd1YWdlICE9PSAnc3RyaW5nJykge1xuICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcnM6IFsnTGFuZ3VhZ2UgaXMgcmVxdWlyZWQnXSB9O1xuICB9XG4gIFxuICBjb25zdCBzYW5pdGl6ZWQgPSBsYW5ndWFnZS50b0xvd2VyQ2FzZSgpLnRyaW0oKTtcbiAgXG4gIGlmICghc3VwcG9ydGVkTGFuZ3VhZ2VzLmluY2x1ZGVzKHNhbml0aXplZCkpIHtcbiAgICBlcnJvcnMucHVzaChgVW5zdXBwb3J0ZWQgbGFuZ3VhZ2U6ICR7bGFuZ3VhZ2V9LiBTdXBwb3J0ZWQgbGFuZ3VhZ2VzOiAke3N1cHBvcnRlZExhbmd1YWdlcy5qb2luKCcsICcpfWApO1xuICB9XG4gIFxuICByZXR1cm4ge1xuICAgIGlzVmFsaWQ6IGVycm9ycy5sZW5ndGggPT09IDAsXG4gICAgZXJyb3JzLFxuICAgIHNhbml0aXplZDogZXJyb3JzLmxlbmd0aCA9PT0gMCA/IHNhbml0aXplZCA6IHVuZGVmaW5lZCxcbiAgfTtcbn07XG5cbi8vIEF1ZGlvIGZpbGUgdmFsaWRhdGlvblxuZXhwb3J0IGNvbnN0IHZhbGlkYXRlQXVkaW9GaWxlID0gKGZpbGU6IHsgc2l6ZTogbnVtYmVyOyB0eXBlOiBzdHJpbmc7IGRhdGE6IHN0cmluZyB9KTogVmFsaWRhdGlvblJlc3VsdCA9PiB7XG4gIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgXG4gIC8vIENoZWNrIGZpbGUgc2l6ZVxuICBpZiAoZmlsZS5zaXplID4gc2VjdXJpdHlDb25maWcudmFsaWRhdGlvbi5tYXhGaWxlU2l6ZSkge1xuICAgIGVycm9ycy5wdXNoKGBGaWxlIHNpemUgZXhjZWVkcyBtYXhpbXVtIGxpbWl0IG9mICR7c2VjdXJpdHlDb25maWcudmFsaWRhdGlvbi5tYXhGaWxlU2l6ZSAvIDEwMjQgLyAxMDI0fU1CYCk7XG4gIH1cbiAgXG4gIC8vIENoZWNrIE1JTUUgdHlwZVxuICBpZiAoIXNlY3VyaXR5Q29uZmlnLnZhbGlkYXRpb24uYWxsb3dlZEF1ZGlvVHlwZXMuaW5jbHVkZXMoZmlsZS50eXBlKSkge1xuICAgIGVycm9ycy5wdXNoKGBVbnN1cHBvcnRlZCBhdWRpbyBmb3JtYXQ6ICR7ZmlsZS50eXBlfS4gQWxsb3dlZCBmb3JtYXRzOiAke3NlY3VyaXR5Q29uZmlnLnZhbGlkYXRpb24uYWxsb3dlZEF1ZGlvVHlwZXMuam9pbignLCAnKX1gKTtcbiAgfVxuICBcbiAgLy8gVmFsaWRhdGUgYmFzZTY0IGRhdGFcbiAgdHJ5IHtcbiAgICBjb25zdCBiYXNlNjRQYXR0ZXJuID0gL15bQS1aYS16MC05Ky9dKj17MCwyfSQvO1xuICAgIGlmICghYmFzZTY0UGF0dGVybi50ZXN0KGZpbGUuZGF0YSkpIHtcbiAgICAgIGVycm9ycy5wdXNoKCdJbnZhbGlkIGF1ZGlvIGRhdGEgZm9ybWF0Jyk7XG4gICAgfVxuICB9IGNhdGNoIHtcbiAgICBlcnJvcnMucHVzaCgnSW52YWxpZCBhdWRpbyBkYXRhJyk7XG4gIH1cbiAgXG4gIHJldHVybiB7XG4gICAgaXNWYWxpZDogZXJyb3JzLmxlbmd0aCA9PT0gMCxcbiAgICBlcnJvcnMsXG4gIH07XG59O1xuXG4vLyBSZXF1ZXN0IGJvZHkgdmFsaWRhdGlvbiBmb3IgY2hhdCBlbmRwb2ludFxuZXhwb3J0IGNvbnN0IHZhbGlkYXRlQ2hhdFJlcXVlc3QgPSAoYm9keTogYW55KTogQ2hhdFJlcXVlc3RWYWxpZGF0aW9uUmVzdWx0ID0+IHtcbiAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICBcbiAgaWYgKCFib2R5IHx8IHR5cGVvZiBib2R5ICE9PSAnb2JqZWN0Jykge1xuICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcnM6IFsnUmVxdWVzdCBib2R5IGlzIHJlcXVpcmVkJ10gfTtcbiAgfVxuICBcbiAgLy8gVmFsaWRhdGUgbWVzc2FnZVxuICBjb25zdCBtZXNzYWdlVmFsaWRhdGlvbiA9IHZhbGlkYXRlQW5kU2FuaXRpemVUZXh0KGJvZHkubWVzc2FnZSwgJ21lc3NhZ2UnKTtcbiAgaWYgKCFtZXNzYWdlVmFsaWRhdGlvbi5pc1ZhbGlkKSB7XG4gICAgZXJyb3JzLnB1c2goLi4ubWVzc2FnZVZhbGlkYXRpb24uZXJyb3JzKTtcbiAgfVxuICBcbiAgLy8gVmFsaWRhdGUgc2Vzc2lvbiBJRFxuICBjb25zdCBzZXNzaW9uVmFsaWRhdGlvbiA9IHZhbGlkYXRlU2Vzc2lvbklkKGJvZHkuc2Vzc2lvbklkKTtcbiAgaWYgKCFzZXNzaW9uVmFsaWRhdGlvbi5pc1ZhbGlkKSB7XG4gICAgZXJyb3JzLnB1c2goLi4uc2Vzc2lvblZhbGlkYXRpb24uZXJyb3JzKTtcbiAgfVxuICBcbiAgLy8gVmFsaWRhdGUgbGFuZ3VhZ2UgKG9wdGlvbmFsKVxuICBsZXQgbGFuZ3VhZ2VWYWxpZGF0aW9uO1xuICBpZiAoYm9keS5sYW5ndWFnZSkge1xuICAgIGxhbmd1YWdlVmFsaWRhdGlvbiA9IHZhbGlkYXRlTGFuZ3VhZ2UoYm9keS5sYW5ndWFnZSk7XG4gICAgaWYgKCFsYW5ndWFnZVZhbGlkYXRpb24uaXNWYWxpZCkge1xuICAgICAgZXJyb3JzLnB1c2goLi4ubGFuZ3VhZ2VWYWxpZGF0aW9uLmVycm9ycyk7XG4gICAgfVxuICB9XG4gIFxuICAvLyBWYWxpZGF0ZSBib29sZWFuIGZpZWxkc1xuICBpZiAoYm9keS51c2VWb2ljZSAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBib2R5LnVzZVZvaWNlICE9PSAnYm9vbGVhbicpIHtcbiAgICBlcnJvcnMucHVzaCgndXNlVm9pY2UgbXVzdCBiZSBhIGJvb2xlYW4nKTtcbiAgfVxuICBcbiAgLy8gVmFsaWRhdGUgaW5wdXRUeXBlIChvcHRpb25hbClcbiAgaWYgKGJvZHkuaW5wdXRUeXBlICE9PSB1bmRlZmluZWQgJiYgIVsndGV4dCcsICd2b2ljZSddLmluY2x1ZGVzKGJvZHkuaW5wdXRUeXBlKSkge1xuICAgIGVycm9ycy5wdXNoKCdpbnB1dFR5cGUgbXVzdCBiZSBlaXRoZXIgXCJ0ZXh0XCIgb3IgXCJ2b2ljZVwiJyk7XG4gIH1cbiAgXG4gIC8vIFZhbGlkYXRlIGxvY2F0aW9uIChvcHRpb25hbClcbiAgbGV0IGxvY2F0aW9uVmFsaWRhdGlvbjtcbiAgaWYgKGJvZHkubG9jYXRpb24pIHtcbiAgICBsb2NhdGlvblZhbGlkYXRpb24gPSB2YWxpZGF0ZUxvY2F0aW9uKGJvZHkubG9jYXRpb24pO1xuICAgIGlmICghbG9jYXRpb25WYWxpZGF0aW9uLmlzVmFsaWQpIHtcbiAgICAgIGVycm9ycy5wdXNoKC4uLmxvY2F0aW9uVmFsaWRhdGlvbi5lcnJvcnMpO1xuICAgIH1cbiAgfVxuICBcbiAgLy8gVmFsaWRhdGUgcmVxdWVzdGVkU2NvcGUgKG9wdGlvbmFsKVxuICBsZXQgc2NvcGVWYWxpZGF0aW9uO1xuICBpZiAoYm9keS5yZXF1ZXN0ZWRTY29wZSkge1xuICAgIHNjb3BlVmFsaWRhdGlvbiA9IHZhbGlkYXRlUmVxdWVzdGVkU2NvcGUoYm9keS5yZXF1ZXN0ZWRTY29wZSk7XG4gICAgaWYgKCFzY29wZVZhbGlkYXRpb24uaXNWYWxpZCkge1xuICAgICAgZXJyb3JzLnB1c2goLi4uc2NvcGVWYWxpZGF0aW9uLmVycm9ycyk7XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4ge1xuICAgIGlzVmFsaWQ6IGVycm9ycy5sZW5ndGggPT09IDAsXG4gICAgZXJyb3JzLFxuICAgIHNhbml0aXplZDogZXJyb3JzLmxlbmd0aCA9PT0gMCAmJiBtZXNzYWdlVmFsaWRhdGlvbi5zYW5pdGl6ZWQgJiYgc2Vzc2lvblZhbGlkYXRpb24uc2FuaXRpemVkID8ge1xuICAgICAgbWVzc2FnZTogbWVzc2FnZVZhbGlkYXRpb24uc2FuaXRpemVkLFxuICAgICAgc2Vzc2lvbklkOiBzZXNzaW9uVmFsaWRhdGlvbi5zYW5pdGl6ZWQsXG4gICAgICBsYW5ndWFnZTogYm9keS5sYW5ndWFnZSA/IChsYW5ndWFnZVZhbGlkYXRpb24/LnNhbml0aXplZCB8fCAnamEnKSA6ICdqYScsXG4gICAgICB1c2VWb2ljZTogQm9vbGVhbihib2R5LnVzZVZvaWNlKSxcbiAgICAgIGlucHV0VHlwZTogKGJvZHkuaW5wdXRUeXBlIGFzICd0ZXh0JyB8ICd2b2ljZScpIHx8ICd0ZXh0JyxcbiAgICAgIGxvY2F0aW9uOiBsb2NhdGlvblZhbGlkYXRpb24/LnNhbml0aXplZCBhcyB7XG4gICAgICAgIGxhdGl0dWRlOiBudW1iZXI7XG4gICAgICAgIGxvbmdpdHVkZTogbnVtYmVyO1xuICAgICAgICBhY2N1cmFjeT86IG51bWJlcjtcbiAgICAgICAgdGltZXN0YW1wPzogRGF0ZTtcbiAgICAgIH0gfCB1bmRlZmluZWQsXG4gICAgICByZXF1ZXN0ZWRTY29wZTogc2NvcGVWYWxpZGF0aW9uPy5zYW5pdGl6ZWQgYXMge1xuICAgICAgICB0aW1lUmFuZ2U/OiAndG9kYXknIHwgJ3RoaXNfd2VlaycgfCAndGhpc19tb250aCcgfCAnbmV4dF9tb250aCcgfCAnYW55JztcbiAgICAgICAgbG9jYXRpb25SYW5nZT86ICduZWFyYnknIHwgJ3dhbGtpbmdfZGlzdGFuY2UnIHwgJ2N5Y2xpbmdfZGlzdGFuY2UnIHwgJ2NpdHlfd2lkZScgfCAnYW55JztcbiAgICAgIH0gfCB1bmRlZmluZWQsXG4gICAgfSA6IHVuZGVmaW5lZCxcbiAgfTtcbn07XG5cbi8vIFJhdGUgbGltaXRpbmcgY2hlY2sgKHNpbXBsZSBpbi1tZW1vcnkgaW1wbGVtZW50YXRpb24pXG5jb25zdCByYXRlTGltaXRTdG9yZSA9IG5ldyBNYXA8c3RyaW5nLCB7IGNvdW50OiBudW1iZXI7IHJlc2V0VGltZTogbnVtYmVyIH0+KCk7XG5cbmV4cG9ydCBjb25zdCBjaGVja1JhdGVMaW1pdCA9IChpZGVudGlmaWVyOiBzdHJpbmcpOiB7IGFsbG93ZWQ6IGJvb2xlYW47IHJldHJ5QWZ0ZXI/OiBudW1iZXIgfSA9PiB7XG4gIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gIGNvbnN0IHdpbmRvd01zID0gc2VjdXJpdHlDb25maWcucmF0ZUxpbWl0aW5nLndpbmRvd01zO1xuICBjb25zdCBtYXhSZXF1ZXN0cyA9IHNlY3VyaXR5Q29uZmlnLnJhdGVMaW1pdGluZy5tYXhSZXF1ZXN0cztcbiAgXG4gIGNvbnN0IGN1cnJlbnQgPSByYXRlTGltaXRTdG9yZS5nZXQoaWRlbnRpZmllcik7XG4gIFxuICBpZiAoIWN1cnJlbnQgfHwgbm93ID4gY3VycmVudC5yZXNldFRpbWUpIHtcbiAgICAvLyBGaXJzdCByZXF1ZXN0IG9yIHdpbmRvdyBleHBpcmVkXG4gICAgcmF0ZUxpbWl0U3RvcmUuc2V0KGlkZW50aWZpZXIsIHtcbiAgICAgIGNvdW50OiAxLFxuICAgICAgcmVzZXRUaW1lOiBub3cgKyB3aW5kb3dNcyxcbiAgICB9KTtcbiAgICByZXR1cm4geyBhbGxvd2VkOiB0cnVlIH07XG4gIH1cbiAgXG4gIGlmIChjdXJyZW50LmNvdW50ID49IG1heFJlcXVlc3RzKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgcmV0cnlBZnRlcjogTWF0aC5jZWlsKChjdXJyZW50LnJlc2V0VGltZSAtIG5vdykgLyAxMDAwKSxcbiAgICB9O1xuICB9XG4gIFxuICAvLyBJbmNyZW1lbnQgY291bnRlclxuICBjdXJyZW50LmNvdW50Kys7XG4gIHJhdGVMaW1pdFN0b3JlLnNldChpZGVudGlmaWVyLCBjdXJyZW50KTtcbiAgXG4gIHJldHVybiB7IGFsbG93ZWQ6IHRydWUgfTtcbn07XG5cbi8vIExvY2F0aW9uIHZhbGlkYXRpb25cbmV4cG9ydCBjb25zdCB2YWxpZGF0ZUxvY2F0aW9uID0gKGxvY2F0aW9uOiBhbnkpOiBWYWxpZGF0aW9uUmVzdWx0ID0+IHtcbiAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICBcbiAgaWYgKCFsb2NhdGlvbiB8fCB0eXBlb2YgbG9jYXRpb24gIT09ICdvYmplY3QnKSB7XG4gICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yczogWydMb2NhdGlvbiBtdXN0IGJlIGFuIG9iamVjdCddIH07XG4gIH1cbiAgXG4gIC8vIFZhbGlkYXRlIGxhdGl0dWRlXG4gIGlmICh0eXBlb2YgbG9jYXRpb24ubGF0aXR1ZGUgIT09ICdudW1iZXInKSB7XG4gICAgZXJyb3JzLnB1c2goJ0xhdGl0dWRlIG11c3QgYmUgYSBudW1iZXInKTtcbiAgfSBlbHNlIGlmIChsb2NhdGlvbi5sYXRpdHVkZSA8IC05MCB8fCBsb2NhdGlvbi5sYXRpdHVkZSA+IDkwKSB7XG4gICAgZXJyb3JzLnB1c2goJ0xhdGl0dWRlIG11c3QgYmUgYmV0d2VlbiAtOTAgYW5kIDkwIGRlZ3JlZXMnKTtcbiAgfVxuICBcbiAgLy8gVmFsaWRhdGUgbG9uZ2l0dWRlXG4gIGlmICh0eXBlb2YgbG9jYXRpb24ubG9uZ2l0dWRlICE9PSAnbnVtYmVyJykge1xuICAgIGVycm9ycy5wdXNoKCdMb25naXR1ZGUgbXVzdCBiZSBhIG51bWJlcicpO1xuICB9IGVsc2UgaWYgKGxvY2F0aW9uLmxvbmdpdHVkZSA8IC0xODAgfHwgbG9jYXRpb24ubG9uZ2l0dWRlID4gMTgwKSB7XG4gICAgZXJyb3JzLnB1c2goJ0xvbmdpdHVkZSBtdXN0IGJlIGJldHdlZW4gLTE4MCBhbmQgMTgwIGRlZ3JlZXMnKTtcbiAgfVxuICBcbiAgLy8gVmFsaWRhdGUgYWNjdXJhY3kgKG9wdGlvbmFsKVxuICBpZiAobG9jYXRpb24uYWNjdXJhY3kgIT09IHVuZGVmaW5lZCAmJiAodHlwZW9mIGxvY2F0aW9uLmFjY3VyYWN5ICE9PSAnbnVtYmVyJyB8fCBsb2NhdGlvbi5hY2N1cmFjeSA8IDApKSB7XG4gICAgZXJyb3JzLnB1c2goJ0FjY3VyYWN5IG11c3QgYmUgYSBwb3NpdGl2ZSBudW1iZXInKTtcbiAgfVxuICBcbiAgLy8gVmFsaWRhdGUgdGltZXN0YW1wIChvcHRpb25hbClcbiAgaWYgKGxvY2F0aW9uLnRpbWVzdGFtcCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgdHJ5IHtcbiAgICAgIG5ldyBEYXRlKGxvY2F0aW9uLnRpbWVzdGFtcCk7XG4gICAgfSBjYXRjaCB7XG4gICAgICBlcnJvcnMucHVzaCgnSW52YWxpZCB0aW1lc3RhbXAgZm9ybWF0Jyk7XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4ge1xuICAgIGlzVmFsaWQ6IGVycm9ycy5sZW5ndGggPT09IDAsXG4gICAgZXJyb3JzLFxuICAgIHNhbml0aXplZDogZXJyb3JzLmxlbmd0aCA9PT0gMCA/IHtcbiAgICAgIGxhdGl0dWRlOiBsb2NhdGlvbi5sYXRpdHVkZSxcbiAgICAgIGxvbmdpdHVkZTogbG9jYXRpb24ubG9uZ2l0dWRlLFxuICAgICAgYWNjdXJhY3k6IGxvY2F0aW9uLmFjY3VyYWN5LFxuICAgICAgdGltZXN0YW1wOiBsb2NhdGlvbi50aW1lc3RhbXAgPyBuZXcgRGF0ZShsb2NhdGlvbi50aW1lc3RhbXApIDogdW5kZWZpbmVkXG4gICAgfSA6IHVuZGVmaW5lZCxcbiAgfTtcbn07XG5cbi8vIFJlcXVlc3RlZCBzY29wZSB2YWxpZGF0aW9uXG5leHBvcnQgY29uc3QgdmFsaWRhdGVSZXF1ZXN0ZWRTY29wZSA9IChzY29wZTogYW55KTogVmFsaWRhdGlvblJlc3VsdCA9PiB7XG4gIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgXG4gIGlmICghc2NvcGUgfHwgdHlwZW9mIHNjb3BlICE9PSAnb2JqZWN0Jykge1xuICAgIHJldHVybiB7IGlzVmFsaWQ6IHRydWUsIGVycm9yczogW10gfTsgLy8gT3B0aW9uYWwgZmllbGRcbiAgfVxuICBcbiAgY29uc3QgdmFsaWRUaW1lUmFuZ2VzID0gWyd0b2RheScsICd0aGlzX3dlZWsnLCAndGhpc19tb250aCcsICduZXh0X21vbnRoJywgJ2FueSddO1xuICBjb25zdCB2YWxpZExvY2F0aW9uUmFuZ2VzID0gWyduZWFyYnknLCAnd2Fsa2luZ19kaXN0YW5jZScsICdjeWNsaW5nX2Rpc3RhbmNlJywgJ2NpdHlfd2lkZScsICdhbnknXTtcbiAgXG4gIC8vIFZhbGlkYXRlIHRpbWVSYW5nZSAob3B0aW9uYWwpXG4gIGlmIChzY29wZS50aW1lUmFuZ2UgIT09IHVuZGVmaW5lZCAmJiAhdmFsaWRUaW1lUmFuZ2VzLmluY2x1ZGVzKHNjb3BlLnRpbWVSYW5nZSkpIHtcbiAgICBlcnJvcnMucHVzaChgSW52YWxpZCB0aW1lUmFuZ2UuIE11c3QgYmUgb25lIG9mOiAke3ZhbGlkVGltZVJhbmdlcy5qb2luKCcsICcpfWApO1xuICB9XG4gIFxuICAvLyBWYWxpZGF0ZSBsb2NhdGlvblJhbmdlIChvcHRpb25hbClcbiAgaWYgKHNjb3BlLmxvY2F0aW9uUmFuZ2UgIT09IHVuZGVmaW5lZCAmJiAhdmFsaWRMb2NhdGlvblJhbmdlcy5pbmNsdWRlcyhzY29wZS5sb2NhdGlvblJhbmdlKSkge1xuICAgIGVycm9ycy5wdXNoKGBJbnZhbGlkIGxvY2F0aW9uUmFuZ2UuIE11c3QgYmUgb25lIG9mOiAke3ZhbGlkTG9jYXRpb25SYW5nZXMuam9pbignLCAnKX1gKTtcbiAgfVxuICBcbiAgcmV0dXJuIHtcbiAgICBpc1ZhbGlkOiBlcnJvcnMubGVuZ3RoID09PSAwLFxuICAgIGVycm9ycyxcbiAgICBzYW5pdGl6ZWQ6IGVycm9ycy5sZW5ndGggPT09IDAgPyB7XG4gICAgICB0aW1lUmFuZ2U6IHNjb3BlLnRpbWVSYW5nZSxcbiAgICAgIGxvY2F0aW9uUmFuZ2U6IHNjb3BlLmxvY2F0aW9uUmFuZ2VcbiAgICB9IDogdW5kZWZpbmVkLFxuICB9O1xufTtcblxuLy8gQ2xlYW51cCBleHBpcmVkIHJhdGUgbGltaXQgZW50cmllcyAoc2hvdWxkIGJlIGNhbGxlZCBwZXJpb2RpY2FsbHkpXG5leHBvcnQgY29uc3QgY2xlYW51cFJhdGVMaW1pdCA9ICgpOiB2b2lkID0+IHtcbiAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgcmF0ZUxpbWl0U3RvcmUuZW50cmllcygpKSB7XG4gICAgaWYgKG5vdyA+IHZhbHVlLnJlc2V0VGltZSkge1xuICAgICAgcmF0ZUxpbWl0U3RvcmUuZGVsZXRlKGtleSk7XG4gICAgfVxuICB9XG59OyJdLCJuYW1lcyI6WyJzZWN1cml0eUNvbmZpZyIsInZhbGlkYXRlQW5kU2FuaXRpemVUZXh0IiwiaW5wdXQiLCJmaWVsZE5hbWUiLCJlcnJvcnMiLCJpc1ZhbGlkIiwic2FuaXRpemVkIiwidHJpbSIsImxlbmd0aCIsInB1c2giLCJ2YWxpZGF0aW9uIiwibWF4TWVzc2FnZUxlbmd0aCIsInJlcGxhY2UiLCJ4c3NQYXR0ZXJucyIsImhhZFhzc0NvbnRlbnQiLCJmb3JFYWNoIiwicGF0dGVybiIsInRlc3QiLCJzcWxQYXR0ZXJucyIsImhhZFNxbENvbnRlbnQiLCJwYXRoVHJhdmVyc2FsUGF0dGVybnMiLCJoYWRQYXRoVHJhdmVyc2FsIiwibGRhcFBhdHRlcm5zIiwiaGFkTGRhcENvbnRlbnQiLCJyZXBlYXRlZFBhdHRlcm4iLCJlbmNvZGVkUGF0dGVybnMiLCJoYWRFbmNvZGVkQXR0YWNrIiwidW5kZWZpbmVkIiwic2FuaXRpemVIdG1sQ29udGVudCIsImh0bWxFbnRpdGllcyIsImNoYXIiLCJ2YWxpZGF0ZVNlc3Npb25JZCIsInNlc3Npb25JZCIsInV1aWRQYXR0ZXJuIiwidmFsaWRhdGVMYW5ndWFnZSIsImxhbmd1YWdlIiwic3VwcG9ydGVkTGFuZ3VhZ2VzIiwidG9Mb3dlckNhc2UiLCJpbmNsdWRlcyIsImpvaW4iLCJ2YWxpZGF0ZUF1ZGlvRmlsZSIsImZpbGUiLCJzaXplIiwibWF4RmlsZVNpemUiLCJhbGxvd2VkQXVkaW9UeXBlcyIsInR5cGUiLCJiYXNlNjRQYXR0ZXJuIiwiZGF0YSIsInZhbGlkYXRlQ2hhdFJlcXVlc3QiLCJib2R5IiwibWVzc2FnZVZhbGlkYXRpb24iLCJtZXNzYWdlIiwic2Vzc2lvblZhbGlkYXRpb24iLCJsYW5ndWFnZVZhbGlkYXRpb24iLCJ1c2VWb2ljZSIsImlucHV0VHlwZSIsImxvY2F0aW9uVmFsaWRhdGlvbiIsImxvY2F0aW9uIiwidmFsaWRhdGVMb2NhdGlvbiIsInNjb3BlVmFsaWRhdGlvbiIsInJlcXVlc3RlZFNjb3BlIiwidmFsaWRhdGVSZXF1ZXN0ZWRTY29wZSIsIkJvb2xlYW4iLCJyYXRlTGltaXRTdG9yZSIsIk1hcCIsImNoZWNrUmF0ZUxpbWl0IiwiaWRlbnRpZmllciIsIm5vdyIsIkRhdGUiLCJ3aW5kb3dNcyIsInJhdGVMaW1pdGluZyIsIm1heFJlcXVlc3RzIiwiY3VycmVudCIsImdldCIsInJlc2V0VGltZSIsInNldCIsImNvdW50IiwiYWxsb3dlZCIsInJldHJ5QWZ0ZXIiLCJNYXRoIiwiY2VpbCIsImxhdGl0dWRlIiwibG9uZ2l0dWRlIiwiYWNjdXJhY3kiLCJ0aW1lc3RhbXAiLCJzY29wZSIsInZhbGlkVGltZVJhbmdlcyIsInZhbGlkTG9jYXRpb25SYW5nZXMiLCJ0aW1lUmFuZ2UiLCJsb2NhdGlvblJhbmdlIiwiY2xlYW51cFJhdGVMaW1pdCIsImtleSIsInZhbHVlIiwiZW50cmllcyIsImRlbGV0ZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/validation.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/uuid","vendor-chunks/@redis","vendor-chunks/mime-db","vendor-chunks/axios","vendor-chunks/generic-pool","vendor-chunks/follow-redirects","vendor-chunks/debug","vendor-chunks/form-data","vendor-chunks/get-intrinsic","vendor-chunks/asynckit","vendor-chunks/combined-stream","vendor-chunks/yallist","vendor-chunks/mime-types","vendor-chunks/proxy-from-env","vendor-chunks/cluster-key-slot","vendor-chunks/ms","vendor-chunks/supports-color","vendor-chunks/has-symbols","vendor-chunks/delayed-stream","vendor-chunks/function-bind","vendor-chunks/es-set-tostringtag","vendor-chunks/get-proto","vendor-chunks/call-bind-apply-helpers","vendor-chunks/redis","vendor-chunks/dunder-proto","vendor-chunks/math-intrinsics","vendor-chunks/es-errors","vendor-chunks/has-flag","vendor-chunks/gopd","vendor-chunks/es-define-property","vendor-chunks/hasown","vendor-chunks/has-tostringtag","vendor-chunks/es-object-atoms","vendor-chunks/@google"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Fnegishi%2FDocuments%2Fdevelop%2FHackathon%2FTokyoOpenDataHackathon%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fnegishi%2FDocuments%2Fdevelop%2FHackathon%2FTokyoOpenDataHackathon&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();